<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>stata笔记 | 小荷才露尖尖角</title><meta name="author" content="揭晓"><meta name="copyright" content="揭晓"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MacBook技巧：如果需要复制路径，在finder里，对选中的文件，cmd+opt+c，就复制到剪贴板了。  1. 基本操作 导入数据 一般做实证分析使用的是excel中的数据，其后缀名为.xls，需要将其修改为.csv insheet using name.csv, clear use name.dta,clear 删除重复变量 sort var1 var2 duplicatesdrop va">
<meta property="og:type" content="article">
<meta property="og:title" content="stata笔记">
<meta property="og:url" content="https://dhndzwxj.github.io/1837523341.html">
<meta property="og:site_name" content="小荷才露尖尖角">
<meta property="og:description" content="MacBook技巧：如果需要复制路径，在finder里，对选中的文件，cmd+opt+c，就复制到剪贴板了。  1. 基本操作 导入数据 一般做实证分析使用的是excel中的数据，其后缀名为.xls，需要将其修改为.csv insheet using name.csv, clear use name.dta,clear 删除重复变量 sort var1 var2 duplicatesdrop va">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dhndzwxj.github.io/private_img/banner2.gif">
<meta property="article:published_time" content="2020-11-15T03:28:32.000Z">
<meta property="article:modified_time" content="2023-01-06T09:22:37.131Z">
<meta property="article:author" content="揭晓">
<meta property="article:tag" content="python">
<meta property="article:tag" content="stata">
<meta property="article:tag" content="数据处理">
<meta property="article:tag" content="数据拆分">
<meta property="article:tag" content="数据合并">
<meta property="article:tag" content="Mata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dhndzwxj.github.io/private_img/banner2.gif"><link rel="shortcut icon" href="/private_img/favicon.png"><link rel="canonical" href="https://dhndzwxj.github.io/1837523341.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":50,"position":"top","messagePrev":"本文上次更新距离今天已经过去","messageNext":"天, 文中内容可能已经过时，望周知。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'stata笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-06 17:22:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng:wght@400;500;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/wave.css?v1"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="小荷才露尖尖角" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/private_img/yuyingnan.jpg" onerror="onerror=null;src='/private_img/404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="archives/"><div class="headline">文章</div><div class="length-num">266</div></a><a href="tags/"><div class="headline">标签</div><div class="length-num">641</div></a><a href="categories/"><div class="headline">分类</div><div class="length-num">73</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/private_img/banner2.gif')"><nav id="nav"><span id="blog-info"><a href="index.html" title="小荷才露尖尖角"><span class="site-name">小荷才露尖尖角</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">stata笔记</h1><div id="post-meta"><div class="meta-firstline"><i class="fa-solid fa-user"></i><span class="post-meta-author">揭晓</span><span class="post-meta-date"><span class="post-meta-separator">|</span><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-15T03:28:32.000Z" title="发表于 2020-11-15 11:28:32">2020-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-06T09:22:37.131Z" title="更新于 2023-01-06 17:22:37">2023-01-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/">计量与模型</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/">计量</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/stata/">stata</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="stata笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>MacBook技巧：如果需要复制路径，在<code>finder</code>里，对选中的文件，<code>cmd+opt+c</code>，就复制到剪贴板了。</p>
<h2 id="1-基本操作"><a class="markdownIt-Anchor" href="#1-基本操作"></a> 1. 基本操作</h2>
<p>导入数据</p>
<p>一般做实证分析使用的是excel中的数据，其后缀名为.xls，需要将其修改为.csv</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">insheet</span> using name.csv<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">use</span> name.dta<span class="token punctuation">,</span><span class="token keyword">clear</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>删除重复变量</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sort</span> var1 var2
<span class="token command keyword">duplicatesdrop</span> var1 var2<span class="token punctuation">,</span> force<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>合并数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> data1<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">merge</span> m<span class="token punctuation">:</span>m var1 var2 using data2
<span class="token command keyword">drop</span> <span class="token keyword">if</span> _merge<span class="token operator">==</span><span class="token number">2</span>
<span class="token command keyword">drop</span> <span class="token keyword">if</span> _merge<span class="token operator">==</span><span class="token number">1</span>
<span class="token command keyword">drop</span> _merge<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>描述性统计分析</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tabstat</span> var1var2<span class="token punctuation">,</span> <span class="token function">stat</span><span class="token punctuation">(</span>n min mean median p25 p75 max sd<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">if</span> groupvar<span class="token operator">==</span><span class="token number">0</span> or <span class="token number">1</span>
<span class="token comment">//输出到word中：</span>
<span class="token command keyword">logout</span><span class="token punctuation">,</span> <span class="token function">save</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> word replace<span class="token punctuation">:</span> tabstat var<span class="token punctuation">,</span> <span class="token function">stat</span><span class="token punctuation">(</span>n min mean p50 max sd<span class="token punctuation">)</span> <span class="token function">col</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>%<span class="token number">9</span><span class="token number">.2</span>g<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>结果输出</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//安装 </span>
<span class="token command keyword">ssc</span> install estout<span class="token punctuation">,</span> replace
<span class="token comment">//单个回归</span>
<span class="token command keyword">reg</span> y x
<span class="token command keyword">esttab</span> using name.rtf<span class="token punctuation">,</span> compress nogap r2 ar2 <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
<span class="token comment">//多个回归一起</span>
<span class="token command keyword">reg</span> y x1 
<span class="token command keyword">est</span> store m1
<span class="token command keyword">reg</span> y x2
<span class="token command keyword">est</span> store m2
<span class="token command keyword">esttab</span> m1 m2 using <span class="token operator">/</span>juncker<span class="token operator">/</span>desktop<span class="token operator">/</span>name.rtf<span class="token punctuation">,</span> compress nogap r2 ar2 <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token comment">//第一种</span>
<span class="token command keyword">esttab</span> re1 re2 re3 re4 using table10.rtf<span class="token punctuation">,</span>se mtitles <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token function">b</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token function">se</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token function">r2</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">/</span>第二种<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>生成虚拟变量</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tab</span> year<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span>
<span class="token command keyword">tab</span> industry<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>industry<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>数据缩尾处理</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">findit</span> winsor2
<span class="token comment">//之后安装</span>
<span class="token command keyword">winsor2</span> varname<span class="token punctuation">,</span> replace <span class="token function">cut</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">99</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>异方差检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//怀特检验</span>
<span class="token command keyword">ssc</span> install whitetst
<span class="token command keyword">reg</span> y x1 x2
<span class="token command keyword">estat</span> imtest<span class="token punctuation">,</span> white
<span class="token comment">//处理：“OLS+稳健标准差”</span>
<span class="token command keyword">reg</span> y x1 x2 x3<span class="token punctuation">,</span> robust<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>DW检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gen</span> id<span class="token operator">=</span>_n
<span class="token command keyword">tsset</span> id
<span class="token command keyword">estat</span> dwatson<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>计算两个日期之间的间隔天数</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gen</span> td<span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span>trading_date<span class="token punctuation">,</span><span class="token variable">'YMD'</span><span class="token punctuation">)</span>
<span class="token command keyword">gen</span> ed<span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span>eventdate<span class="token punctuation">,</span><span class="token variable">'YMD'</span><span class="token punctuation">)</span>
<span class="token command keyword">form</span> td ed %td
<span class="token command keyword">gen</span> d<span class="token operator">=</span>ed<span class="token operator">-</span>td<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>生成滞后、差分数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tsset</span> code year
<span class="token command keyword">gen</span> newvarname<span class="token operator">=</span>l.varname
<span class="token command keyword">gen</span> newvarname<span class="token operator">=</span>d.varname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>多重共线检验之方差膨胀因子</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">reg</span> y x1 x2 x3
<span class="token command keyword">vif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>多重共线修正之逐步回归</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">stepwise</span><span class="token punctuation">,</span> <span class="token function">pe</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token command keyword">reg</span> y x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检验是否遗漏高次项</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">reg</span> y x
<span class="token command keyword">estat</span> ovtest
<span class="token comment">//或者</span>
<span class="token command keyword">estat</span> ovtest<span class="token punctuation">,</span> rhs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>样本检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//两样本均值T检验</span>
<span class="token command keyword">ttest</span> var<span class="token punctuation">,</span> <span class="token keyword">by</span><span class="token punctuation">(</span>groupvar<span class="token punctuation">)</span>
<span class="token comment">//两样本中位数Z检验</span>
<span class="token command keyword">ranksum</span> var<span class="token punctuation">,</span> <span class="token keyword">by</span><span class="token punctuation">(</span>groupvar<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-pythonstata"><a class="markdownIt-Anchor" href="#2-pythonstata"></a> 2. Python+Stata</h2>
<p>stata在数据处理与分析方面具有一定的优势，而且软件又小，在配置一般的PC机里运行也较为流畅。</p>
<h3 id="21-另外保存do文件在python中运行外部do文件"><a class="markdownIt-Anchor" href="#21-另外保存do文件在python中运行外部do文件"></a> 2.1 另外保存do文件，在python中运行外部do文件</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> codecs
<span class="token keyword">import</span> os
<span class="token comment">#使用的stata软件路径</span>
stata_path<span class="token operator">=</span><span class="token string">"/Applications/Stata 16/StataSE.app"</span>
<span class="token comment">#要运行的代码路径</span>
dofile_path<span class="token operator">=</span><span class="token string">"/Users/juncker/dlog/public/local_file/《应用计量经济学讲稿》配套dofile.do"</span>
<span class="token comment">#cmd中三个参数分别为：stata软件路径、命令、do文件路径</span>
cmd <span class="token operator">=</span> <span class="token punctuation">[</span>stata_path<span class="token punctuation">,</span> <span class="token string">"doedit"</span><span class="token punctuation">,</span> dofile_path<span class="token punctuation">]</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="22-有时会遇到改变do文档内容的情形因此需要在python中写一个do文档"><a class="markdownIt-Anchor" href="#22-有时会遇到改变do文档内容的情形因此需要在python中写一个do文档"></a> 2.2 有时会遇到改变do文档内容的情形，因此需要在python中写一个do文档</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">varstr<span class="token operator">=</span><span class="token string">'price length weight'</span>
code<span class="token operator">=</span><span class="token triple-quoted-string string">'''clear all
sysuse auto
sum
reg '''</span>
statacode<span class="token operator">=</span>code<span class="token operator">+</span>varstr <span class="token comment">#自己编写的do文件代码，不过当前是字符转格式，下一步是将其写入一个do文件</span>
<span class="token keyword">with</span> codecs<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dofile_2.do'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>statacode<span class="token punctuation">)</span>
  f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
cmd <span class="token operator">=</span> <span class="token punctuation">[</span>stata_path<span class="token punctuation">,</span> <span class="token string">"do"</span><span class="token punctuation">,</span> dofile_path<span class="token punctuation">]</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
<span class="token comment"># 关闭stata</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'TASKKILL /F /IM StataMP-64.exe'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="23-在python和stata中传递数据最容易想到的一个思路是将要传递的内容保存下来然后python或stata再读取数据"><a class="markdownIt-Anchor" href="#23-在python和stata中传递数据最容易想到的一个思路是将要传递的内容保存下来然后python或stata再读取数据"></a> 2.3 在python和stata中传递数据（最容易想到的一个思路是将要传递的内容保存下来，然后python或stata再读取数据）</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token operator">#</span> 以stata向python传递数据为例
<span class="token operator">#</span> 首先生成一个stata数据
<span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">keep</span> price
<span class="token command keyword">export</span> delimited price using <span class="token string-literal"><span class="token string">"statatest.txt"</span></span><span class="token punctuation">,</span> <span class="token function">delimiter</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span> novarnames replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python读取数据</span>
<span class="token keyword">import</span> codecs
<span class="token keyword">with</span> codecs<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'statatest.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  data<span class="token operator">=</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
  f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">import</span> re
<span class="token comment"># 读取的数据包含空格和换行，通过正则表达式提取数据</span>
datamatch<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[\d]*'</span><span class="token punctuation">)</span>
data2<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> re
<span class="token keyword">for</span> s <span class="token keyword">in</span> data<span class="token punctuation">:</span>
  s<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>datamatch<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>
  data2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>PS：</p>
<p>github上有一个ipystata的包可以<a href='https://github.com/TiesdeKok/ipystata' target='_blank'>通过Jupyter在python中使用stata</a>，或者可以参考<a href='https://zhuanlan.zhihu.com/p/22645950' target='_blank'>这篇文章</a>。</p>
<h2 id="3-数据拆分与合并"><a class="markdownIt-Anchor" href="#3-数据拆分与合并"></a> 3. 数据拆分与合并</h2>
<ul>
<li>数据拆分
<ol>
<li>数据横向拆分—— <code>keep</code>&amp; <code>drop</code></li>
<li>数据纵向拆分—— <code>keep</code>&amp; <code>drop</code></li>
<li>一步到位保存数据子集—— <code>savesome</code></li>
</ol>
</li>
<li>数据合并
<ol>
<li>数据的横向合并—— <code>merge</code></li>
<li>数据的纵向合并—— <code>append</code></li>
<li>对多个 <code>csv</code>文件纵向合并—— <code>csvconvert</code></li>
</ol>
</li>
</ul>
<h3 id="31-长宽数据转换-reshape命令"><a class="markdownIt-Anchor" href="#31-长宽数据转换-reshape命令"></a> 3.1 长宽数据转换—— <code>reshape</code>命令</h3>
<ul>
<li>宽数据转为长数据</li>
<li>长数据转为宽数据</li>
</ul>
<blockquote>
<p>数据文件下载：<a href='/local_file/data_file.zip' target='_blank'>地址</a></p>
</blockquote>
<h3 id="32-数据拆分"><a class="markdownIt-Anchor" href="#32-数据拆分"></a> 3.2 数据拆分</h3>
<p>如果把内存中的数据集视为一个矩阵，则我们对数据的基本操作包括两类：删除列或删除行。对于 Stata 而言，命令的主要操作对象是变量 (矩阵的列)，而有些时候我们也需要删除特定的观察值 (矩阵的行)。这些操作都可以配合使用 <code>drop</code> 和 <code>keep</code> 命令来实现。</p>
<h4 id="删除保留变量数据的横向拆分"><a class="markdownIt-Anchor" href="#删除保留变量数据的横向拆分"></a> 删除\保留变量：数据的横向拆分</h4>
<p>原始数据有时包含过多的变量，但在实际应用中可能根据需要将原始数据拆分为不同的数据表，这时就要实现数据的横向拆分。数据的横向拆分用到的两个命令为 <code>drop</code> 和 <code>keep</code>。</p>
<blockquote>
<p>Stata 范例：</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> cleardrop weight lengthsave <span class="token string-literal"><span class="token string">"d:\data\auto_sim01.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们调入数据后，使用 <code>drop</code> 命令删除了两个变量，进而把处理后的数据文件另存到 <code>D:\data</code> 文件夹中。若该文件夹下已经存在一个名称为 <code>auto_sim01.dta</code> 则自动覆盖之，这是 <code>replace</code> 选项的作用。</p>
<p>按照上述思路，也就不难理解如下命令的含义了：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep make price mpg rep78 foreignsave <span class="token string-literal"><span class="token string">"d:\data\auto_sim02.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>特别说明： 一般而言，除非数据文件非常大导致每次调入耗时较长，我们很少另存数据文件。我们会将主要的修改动作都保留于 dofile 中。每次分析时，只需修改 dofile 或执行 dofile 中的特定语句即可实现对子样本的处理。毕竟，dofile 本质上是文本文件，文件大小通常不过几十 k。</p>
</blockquote>
<h4 id="删除保留观察值数据的纵向拆分"><a class="markdownIt-Anchor" href="#删除保留观察值数据的纵向拆分"></a> 删除\保留观察值：数据的纵向拆分</h4>
<p>原始数据有时包含过多的样本观测值，但在实际应用中可能根据需要将其按某种特征拆分为不同的数据表，这是就要实现数据的纵向拆分。此时，仍然可以使用 <code>drop</code> 和 <code>keep</code> 命令。</p>
<p>例如将 <code>auto.dta</code> 数据文件拆分为两个数据文件：<code>auto_domestic.dta</code> 和 <code>auto_foreign.dta</code>，操作如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep <span class="token keyword">if</span> foreign<span class="token operator">==</span>0save auto_domestic.dta<span class="token punctuation">,</span> replace sysuse <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep<span class="token operator">=</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span>1save auto_foreign.dta<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="一步到位保存数据子集-savesome-命令"><a class="markdownIt-Anchor" href="#一步到位保存数据子集-savesome-命令"></a> 一步到位保存数据子集： <code>savesome</code> 命令</h4>
<p>通过上述范例可以看出，使用 Stata 自带的 <code>keep</code> 和 <code>drop</code> 命令可以快捷地删除变量或观察值，但在命令写法上较为繁琐。我们可以使用外部命令 <code>savesome</code> 来提高效率 （该命令是 Stata 官方命令 <code>save</code> 的扩展版）：</p>
<ul>
<li>安装程序文件：</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">ssc</span> install savesome<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在命令窗口中输入 <code>help savesome</code> 可以查看该命令的帮助文件，其语法格式如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">savesome</span> <span class="token punctuation">[</span><span class="token keyword">varlist</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">if</span> exp<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">in</span> range<span class="token punctuation">]</span> using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> old save_options<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中，</p>
<ul>
<li><code>using filename</code> 表示要保存的子集文件名及文件路径；</li>
<li><code>old</code> 是较为重要的选项，可以将数据保存为较低版本的文件格式，如 stata15 用户可以将数据另存为在 stata14 或以下版本中的打开的数据文件。类似的命令还有 Stata 官方命令 <code>saveold</code>。</li>
</ul>
<p>对于前文提到的例子，我们可以使用 <code>savesome</code> 来实现相同的功能：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep make price mpg rep78 foreignsave <span class="token string-literal"><span class="token string">"d:\data\auto_sim02.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>等价于</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearsavesome make price mpg rep78 foreign <span class="token comment">/// using "d:\data\auto_sim02.dta", replace</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>评论： 凭心而论，笔者更喜欢前一种方式。虽然多写了一行命令，但思路清晰，也便于记忆。</p>
<blockquote>
<p>Stata 范例 2：</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep <span class="token keyword">if</span> foreign<span class="token operator">==</span>0save auto_domestic.dta<span class="token punctuation">,</span> replace <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>等价于：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearsavesome <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span> using auto_domestic.dta<span class="token punctuation">,</span> replace <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="34-数据合并"><a class="markdownIt-Anchor" href="#34-数据合并"></a> 3.4 数据合并</h3>
<h4 id="341-数据的横向合并"><a class="markdownIt-Anchor" href="#341-数据的横向合并"></a> 3.4.1 数据的横向合并</h4>
<p>数据的横向合并是横向拆分的逆操作，但是其要比拆分复杂。对于时间序列资料而言，要保证同一时点的两个变量的观察值对接到同一行；而对于界面个体资料而言，要保证同一个人的年龄数据与该人的收入数据在同一行。而对于面板数据资料，则需数据中有两个变量能够唯一标示每一行观察值，以保证 A 数据文件中的 “张三疯-2016” 与 B 数据文件中的 “张三疯-2016” 处于同一行。合并所使用的命令语句为 <code>merge</code>，具体语句如下所示：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">merge</span> <span class="token punctuation">[</span><span class="token keyword">varlist</span><span class="token punctuation">]</span> using filename <span class="token punctuation">[</span>filename ...<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>merge</code>为合并的命令语句， <code>[varlist]</code>代表合并进去的新变量， <code>using filename</code>指的是所要与原文件合并的文件路径， <code>options</code>包含较多的功能，表 2.11 显示了其具体内容。</p>
<table>
<thead>
<tr>
<th>keep(varlist)</th>
<th>只保留filename中特定的变量</th>
</tr>
</thead>
<tbody>
<tr>
<td>_merge(newvar)</td>
<td>合并之后生成新变量,默认名称为_merge</td>
</tr>
<tr>
<td>nolabel</td>
<td>不要复制flename中所定义的标签</td>
</tr>
<tr>
<td>nonotes</td>
<td>不要复制filename中所定义的注释</td>
</tr>
<tr>
<td>update</td>
<td>用flename中的数据代替内存中的缺失值。</td>
</tr>
<tr>
<td>replace</td>
<td>用flename  中的数据代替内存中的非缺失值。</td>
</tr>
<tr>
<td>nokeep</td>
<td>删除数据库中不能匹配的观测值</td>
</tr>
<tr>
<td>nosummary</td>
<td>删除summary变量</td>
</tr>
<tr>
<td>unique</td>
<td>匹配变量在原文件与合并文件中都是唯一的。</td>
</tr>
<tr>
<td>unigmaster:</td>
<td>匹配变量在原文件中必须是唯一的</td>
</tr>
<tr>
<td>uniqusing</td>
<td>匹配变量在合并文件中必须是唯一的</td>
</tr>
</tbody>
</table>
<p><em>举例</em>：利用横向拆分实验中生成的数据文件 <code>waterinput</code> 和 <code>wateroutput</code>实现数据的横向合并，匹配变量为 <code>year</code>，生成新的数据文件命名为 <code>waternew</code>。这个操作的命令为：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> c<span class="token punctuation">:</span>\data\wateroutput<span class="token punctuation">,</span> clearsort yearsave c<span class="token punctuation">:</span>\data\wateroutput<span class="token punctuation">,</span> replaceuse c<span class="token punctuation">:</span>\data\waterinput<span class="token punctuation">,</span> clearsort yearmerge year using c<span class="token punctuation">:</span>\data\wateroutputsave c<span class="token punctuation">:</span>\data\waternew<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在以上命令语句中，第一个命令语句实现了 <code>wateroutput</code>数据文件的打开，第二个命令语句将文件按年份变量进行排序，第三个命令语句保存了排序之后的数据文件，第四个命令语句实现了 <code>waterinput</code>数据文件的打开，第五个命令语句将此数据按年份变量进行排序，第六个命令语句按年份变量将 <code>wateroutput</code>文件合并到 <code>waterinput</code>文件中，第七个命令语句保存合并之后的数据文件。</p>
<h4 id="342-数据的纵向合并"><a class="markdownIt-Anchor" href="#342-数据的纵向合并"></a> 3.4.2 数据的纵向合并</h4>
<p>数据的纵向合并为数据纵向拆分的逆操作，使用的主要命令为 <code>append</code>命令，具体语句如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">append</span> using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在这个命令语句中， <code>append</code>是进行纵向合并的命令语句， <code>using filename</code>是进行纵向合并的文件路径， <code>[, options]</code>的内容与 <code>merge</code>相似，但更为简化。</p>
<p>例如，利用纵向拆分实验中生成的数据文 <code>domesticauto</code>和 <code>foreignauto</code>实现数据的纵向合并，生成的数据文件命名为 <code>usaautonew</code>。这个操作的命令为：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> c<span class="token punctuation">:</span>\data\domesticauto<span class="token punctuation">,</span> clearappend using c<span class="token punctuation">:</span>\data\foreignautosave c<span class="token punctuation">:</span>\data\usaautonew<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在以上命令中，第一个命令语句打开了原始数据文件，第二个命令将 <code>foreignauto</code>文件合并到 <code>domesticauto</code>文件中，第三个命令语句存储了合并后的数据文件。</p>
<h4 id="343-一次合并多个csv文件-csvconvert"><a class="markdownIt-Anchor" href="#343-一次合并多个csv文件-csvconvert"></a> 3.4.3 一次合并多个csv文件—— <code>csvconvert</code></h4>
<p><code>csvconvert</code> 命令用于将多个 <code>csv</code>格式文件合并为一个 <code>.dta</code>格式文件，比较适合处理具有时间周期性特点的变量。<br />
命令：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> input_directory <span class="token punctuation">,</span> replace <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该命令有三个参数：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">output_file(file_name)</td>
<td style="text-align:left">设置输出文件名</td>
</tr>
<tr>
<td style="text-align:left">output_dir(output_directory)</td>
<td style="text-align:left">设置输出路径</td>
</tr>
<tr>
<td style="text-align:left">input_file(.csv file list)</td>
<td style="text-align:left">选择要合并的文件</td>
</tr>
</tbody>
</table>
<p>命令下载：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">help</span> csvconvert<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以命令配套的四个世界银行文件为例，首先看文件结构</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">dir</span> C<span class="token punctuation">:</span>\Uers\Administrator\Desktop\stata学习文件\worldbank\<span class="token operator">*</span>.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>Country  Name</th>
<th>Country Code</th>
<th>Year</th>
<th>YearCode</th>
<th>GDP (current  US$)</th>
<th>Population,  total</th>
</tr>
</thead>
<tbody>
<tr>
<td>United States</td>
<td>USA</td>
<td>2010</td>
<td>YR2010</td>
<td>1. 46E+13</td>
<td>309050816</td>
</tr>
<tr>
<td>United Kingdom</td>
<td>GBR</td>
<td>2010</td>
<td>YR2010</td>
<td>2.25E+12</td>
<td>62218761</td>
</tr>
<tr>
<td>Canada</td>
<td>CAN</td>
<td>2010</td>
<td>YR2010</td>
<td>1.57E+12</td>
<td>34108752</td>
</tr>
</tbody>
</table>
<p>使用 <code>csvconvert</code>命令将四个年度数据纵向合并</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> C<span class="token punctuation">:</span>\Users\Administrator\Desktop\stata学习文件\worldbank<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th></th>
<th>countryname</th>
<th>countrycode</th>
<th>year</th>
<th>yearcode</th>
<th>gdpcurrentus</th>
<th>population~l</th>
<th>_csvfile</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>United  States</td>
<td>USA</td>
<td>2010</td>
<td>YR2010</td>
<td>1.  458e+13</td>
<td>309050816</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>2</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2010</td>
<td>YR2010</td>
<td>2.246e+12</td>
<td>62218761</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>3</td>
<td>Canada</td>
<td>CAN</td>
<td>2010</td>
<td>YR2010</td>
<td>1.574e+12</td>
<td>34108752</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>4</td>
<td>United  States</td>
<td>USA</td>
<td>2009</td>
<td>YR2009</td>
<td>1.  . 404e+13</td>
<td>307007000</td>
<td>wb2009.  csv</td>
</tr>
<tr>
<td>5</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2009</td>
<td>YR2009</td>
<td>2.173e+122</td>
<td>61801570</td>
<td>wb2009。  csv</td>
</tr>
<tr>
<td>6</td>
<td>Canada</td>
<td>CAN</td>
<td>2009</td>
<td>YR2009</td>
<td>1.336e+12</td>
<td>33739900</td>
<td>wb2009.  Csv</td>
</tr>
<tr>
<td>7</td>
<td>United  States</td>
<td>USA</td>
<td>2008</td>
<td>YR2008</td>
<td>1.  430e+13</td>
<td>304375000</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>8</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2008</td>
<td>YR2008</td>
<td>2.657e+12</td>
<td>61393521</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>9</td>
<td>Canada</td>
<td>CAN</td>
<td>2008</td>
<td>YR2008</td>
<td>1.499e+12</td>
<td>33311400</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>10</td>
<td>United  States</td>
<td>USA</td>
<td>2007</td>
<td>YR2007</td>
<td>1.400e+13</td>
<td>301580000</td>
<td>wb2007.  csv</td>
</tr>
<tr>
<td>11</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2007</td>
<td>YR2007</td>
<td>2.811e+12</td>
<td>60986649</td>
<td>wb2007.  csv</td>
</tr>
<tr>
<td>12</td>
<td>Canada</td>
<td>CAN</td>
<td>2007</td>
<td>YR2007</td>
<td>1.424e+12</td>
<td>32976000</td>
<td>wb2007.  csv</td>
</tr>
</tbody>
</table>
<p>要合并的四个子文件必须在同一个文件夹中，默认情况下， <code>csvconvert</code>命令会合并文件夹中所有文件 ，可以用 <code>note</code> 命令核对所合并的文件情况 .用 <code>input_file</code>参数选择所有合并的文件名，在此，我们只选择2008年度和2009年度的数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> C<span class="token punctuation">:</span>\Users\Administrator\Desktop\stata学习文件\worldbank<span class="token punctuation">,</span> replace <span class="token function">input_file</span><span class="token punctuation">(</span>wb2008.csv wb2009.csv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-stata中的mata"><a class="markdownIt-Anchor" href="#4-stata中的mata"></a> 4. Stata中的Mata</h2>
<h3 id="41-mata-基础语法"><a class="markdownIt-Anchor" href="#41-mata-基础语法"></a> 4.1 Mata 基础语法</h3>
<p>在正式介绍 Mata 程序编写之前，我们必须了解 Mata 的基础语法，如注释方式、基础运算符、循环、条件语句等。</p>
<h4 id="411-注释方式-comments"><a class="markdownIt-Anchor" href="#411-注释方式-comments"></a> 4.1.1 注释方式 (Comments)</h4>
<p>相较 Stata 的 <code>*</code>，Mata 中的注释方式发生了较大改变。如果不事先了解 Mata 的注释方式，那么在命令语句写作和运行中可能会多次报错。输入 <code>help mata comments</code>，可查看相关 help 文档。</p>
<p>Mata 的语句注释分为以下两类：</p>
<ol>
<li><code>/* enclosed comment */</code></li>
<li><code>// rest-of-line comment</code></li>
</ol>
<p>注意点：(1) 注释语句可以出现在 do-files 和 ado-files 中；但不能够在命令窗口的交互状态下使用 (在命令窗口输入 <code>mata</code> 即可进入 Mata 交互状态)。(2) Stata 中利用 “*” 注释在 Mata 中是不允许的。</p>
<p>故在运行命令时有以下注意点：（1）在 Mata 状态下， 由双斜线引导的注释语句在命令窗口中必须连同双斜线一起删除才能 (在命令窗口) 执行 。但在 Do 文件编辑窗口中编写的语句不必删除注释语句，选中全部语句执行即可。（2）Mata 状态下，在 Do 文件编辑窗口中编写的语句不能单独执行。</p>
<p>为更好掌握语法，建议读者在 Stata 命令窗口中输入 <code>mata</code> 进入 Mata 环境 (可通过 <code>end</code> 退出)，再将下文中的命令语句删去由 // 注释的文字后，逐行输入命令窗口以感受运算过程。（当然，也可以整体粘贴入 do-file 中运行。）</p>
<p>另一方面，在结果显示中，Mata 的命令提示符是冒号 (😃，而在Stata中是句号 (.)。</p>
<h4 id="412-运算符-operators"><a class="markdownIt-Anchor" href="#412-运算符-operators"></a> 4.1.2 运算符 (Operators)</h4>
<p>在本部分，主要介绍 Mata 的运算符中的基础运算 (含元素运算)、逻辑运算、下标运算三大内容。有兴趣的读者可以查看<code>3.2.4 运算符优先级总结</code>。Mata 的运算符充分体现了作为矩阵编程语言的特征。</p>
<h5 id="4121-基础运算-部分"><a class="markdownIt-Anchor" href="#4121-基础运算-部分"></a> 4.1.2.1 基础运算 (部分)</h5>
<p>具体运算符和解释已写入以下代码块中，其中较有特色的是元素运算(element-by-element)。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入 Mata</span>

<span class="token comment">// --基本运算--</span>
<span class="token command keyword">a1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//","逗号为列合并运算符</span>
<span class="token command keyword">a2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.4</span><span class="token punctuation">)</span> <span class="token comment">//利用".."生成[1,4]范围内的(整数)行向量</span>
<span class="token command keyword">a3</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> \<span class="token number">2</span> \<span class="token number">3</span> \<span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//"\"反斜杠为行合并运算符</span>
<span class="token command keyword">a4</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//利用"::"生成[1,4]范围内的(整数)列向量</span>
<span class="token command keyword">a5</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>' <span class="token comment">//"'"撇号为转置运算符</span>

<span class="token comment">// --代数运算--</span>
<span class="token command keyword">b1</span> <span class="token operator">=</span> a1 <span class="token operator">+</span> a1 <span class="token comment">//"+" 加法</span>
<span class="token command keyword">b2</span> <span class="token operator">=</span> a1 <span class="token operator">-</span> a1 <span class="token comment">//"-" 减法</span>
<span class="token command keyword">b3</span> <span class="token operator">=</span> a5 <span class="token operator">*</span> a1 <span class="token comment">//"*" 乘法</span>

<span class="token comment">// --例子：混合运算--</span>
<span class="token command keyword">c1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> \ <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> \ <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment">//生成3×3矩阵</span>
<span class="token command keyword">c2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.3</span><span class="token punctuation">)</span>\<span class="token punctuation">(</span><span class="token number">4</span>.<span class="token number">.6</span><span class="token punctuation">)</span>\<span class="token punctuation">(</span><span class="token number">7</span>.<span class="token number">.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//生成的c2矩阵与c1矩阵相同</span>
<span class="token command keyword">c3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> \ <span class="token number">2</span> \ <span class="token number">3</span> <span class="token punctuation">)</span>' <span class="token comment">//生成行向量</span>


<span class="token comment">// --元素运算(element-by-element)--</span>
<span class="token comment">// -注：Mata中的代数运算，包括用于除法的斜杠(/)，都可在前面加一个冒号(:)，实现元素运算</span>
<span class="token command keyword">r1</span> <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span>
<span class="token command keyword">r2</span> <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> \ <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> \ <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">)</span>
<span class="token command keyword">m1</span> <span class="token operator">=</span> r1 <span class="token punctuation">:</span><span class="token operator">+</span> r2 <span class="token comment">//将行向量r1中的元素逐行加入到r2的每一行，最终得到3*3矩阵</span>
<span class="token command keyword">m2</span> <span class="token operator">=</span> r2 <span class="token punctuation">:</span><span class="token operator">+</span> r1 <span class="token comment">//生成的m2与m1相同</span>
<span class="token command keyword">m3</span> <span class="token operator">=</span> r1 <span class="token punctuation">:</span><span class="token operator">/</span> r2 <span class="token comment">//将行向量r1中的元素逐行除以r2的每一行，得3*3矩阵</span>
<span class="token command keyword">m4</span> <span class="token operator">=</span> r2 <span class="token punctuation">:</span><span class="token operator">/</span> r1 <span class="token comment">//将行向量r2中的元素逐行除以r1的每一行，得3*3矩阵</span>
<span class="token command keyword">m5</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment">//针对每个元素的开根运算</span>

<span class="token command keyword">end</span> <span class="token comment">//退出 Mata</span>

<span class="token comment">/* 部分结果展示：
: a2
1 2 3 4
+-----------------+
1 | 1 2 3 4 |
+-----------------+

: b3
[symmetric]
1 2
+---------+
1 | 1 |
2 | 2 4 |
+---------+

: m2
1 2 3
+----------------+
1 | 2 4 6 |
2 | 5 7 9 |
3 | 8 10 12 |
+----------------+

: m3
1 2 3
+-------------------------------------------+
1 | 1 1 1 |
2 | .25 .4 .5 |
3 | .1428571429 .25 .3333333333 |
+-------------------------------------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4122-逻辑运算符-logical-operators"><a class="markdownIt-Anchor" href="#4122-逻辑运算符-logical-operators"></a> 4.1.2.2 逻辑运算符 (Logical Operators)</h5>
<p>和 Stata 相同，相等逻辑运算符为 <code>a == b</code> 和 <code>a != b</code> 。该逻辑运算不需要考虑 <code>a</code> 和 <code>b</code> 是否一致，或是否是相同类型。其返回值为 0 或 1。</p>
<p>与相等比较不同，余下的逻辑比较运算符 <code>&gt;</code>，<code>&gt;=</code>，<code>&lt;</code>，<code>&lt;=</code> 只可以在两个对象是相同的类型 (数字或字符) 且维数 (conformable) 相同时才可以比较。</p>
<p>而逻辑运算符 与 (<code>&amp;</code>) 或 (<code>|</code>) 只能够用于实数类型的标量 (real scalar)。</p>
<h5 id="4123-下标运算-subscripts"><a class="markdownIt-Anchor" href="#4123-下标运算-subscripts"></a> 4.1.2.3 下标运算 (Subscripts)</h5>
<p>Mata 运用中括号 (<code>[]</code>) 进行下标运算，其可以出现在代数表达式的左端或右端。共有两类：① 列表下表 (list subscripts) 和范围下标 (range subscripts)。</p>
<p>利用下标运算，可用于引用、修改、提取数组中元素。</p>
<ul>
<li>列表下标</li>
</ul>
<p>下标运算 <code>x[i,j]</code> 中的 <code>i</code> 或 <code>j</code> 可以是一个向量，如：<code>x[i,jvec]</code>，<code>jvec=(4,6,8)</code>。<code>i</code> 或 <code>j</code> 也可以缺失 (或用 <code>.</code> ) ，用于指代该行或该列中的所有元素，如：<code>x[i,.]</code>、 <code>x[i,]</code>提取第 i 行的所有元素；<code>x[.,.]</code>、 <code>x[,]</code>提取整个矩阵中的元素。</p>
<p>为了避免输入每个连续数字，可以用范围运算符 (前文提到的<code>..</code> 和 <code>::</code> ) 来进行下标运算，如 <code>x[(1..4),.]</code> 和 <code>x[(1::4),.]</code>，都指代了矩阵 x 的前四行。同时范围运算也可以是降序的，如 <code>x[(4::1),.]</code>。</p>
<ul>
<li>范围下标</li>
</ul>
<p>范围下标运算方式为 <code>[| |]</code>。该表达可以用于指代矩阵中的单个元素，但更加重要的是使用 <code>x[| i, j \m, n |]</code>，该命令可以生成一个子矩阵，从 <code>x[i, j]</code> 开始至 <code>x[m, n]</code> 结束。形如 <code>x[| 1, 1 \4, .|]</code> 和 <code>x[| 4, 4 \., .|]</code> 也可以正常运行，前者代表了子矩阵至最后一列，后者跳过了 x 矩阵的前三行和前三列。</p>
<blockquote>
<p>Tip：当可以同时使用范围下标运算 <code>[| |]</code> 和列表下标运算 <code>[i,j]</code> 时，使用范围下标运算效率更高 ( 无论是矩阵提取还是用时方面 )。</p>
</blockquote>
<h5 id="4124-运算符优先级总结"><a class="markdownIt-Anchor" href="#4124-运算符优先级总结"></a> 4.1.2.4 运算符优先级总结</h5>
<p>参考 Gould(2018, p.86)，下标总结了 Mata 中的运算符及其优先级。利用优先级可以简化代码，例如，<code>a&gt;2+3</code> 与 <code>a&gt;(2+3)</code>的实现效果相同 (算术运算优先于逻辑运算)。</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符优先级汇总 (从高到低)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">下标运算</td>
<td>[]</td>
</tr>
<tr>
<td style="text-align:left">递增 &amp; 递减运算</td>
<td>–, ++</td>
</tr>
<tr>
<td style="text-align:left">结构 &amp; 类元素引用运算</td>
<td>-&gt;, .</td>
</tr>
<tr>
<td style="text-align:left">指针运算</td>
<td>*, &amp;</td>
</tr>
<tr>
<td style="text-align:left">算术运算</td>
<td>', ^, - (负号), /, #, *, -, +</td>
</tr>
<tr>
<td style="text-align:left">逻辑运算</td>
<td>!, !=, &gt;, &lt;, &gt;=, &lt;=, ==, &amp;, |</td>
</tr>
<tr>
<td style="text-align:left">行填充</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:left">列合并</td>
<td>,</td>
</tr>
<tr>
<td style="text-align:left">列填充</td>
<td>::</td>
</tr>
<tr>
<td style="text-align:left">行合并</td>
<td>\</td>
</tr>
<tr>
<td style="text-align:left">三元条件运算</td>
<td>? :</td>
</tr>
<tr>
<td style="text-align:left">转为空白</td>
<td>(void)</td>
</tr>
<tr>
<td style="text-align:left">赋值</td>
<td>=</td>
</tr>
</tbody>
</table>
<p>注：由冒号 <code>:</code> 代表的元素运算优先级仅低于相应的非冒号运算，如 <code>:==</code> 在逻辑运算 <code>==</code> 之后，<code>:*</code> 在代数运算 <code>*</code> 之后。</p>
<h4 id="413-循环语句-loop"><a class="markdownIt-Anchor" href="#413-循环语句-loop"></a> 4.1.3 循环语句 (Loop)</h4>
<p>Stata 中的循环有：<code>foreach</code>、<code>forvalues</code> 和 <code>while</code>，Mata 中的循环也有三类：<code>for</code>、<code>while</code> 和 <code>do...while</code>，但是语法多有不同。</p>
<p><code>for</code> 和 <code>while</code> 在循环开始时检查循环的运行条件，这意味着循环可能根本不会执行，可以用于优雅地处理极端情况。而 <code>do...while</code> 在循环结束时检查运行条件，用于需要至少循环一次的情况。</p>
<blockquote>
<p>Tip：Mata 作为矩阵语言，在可以使用矩阵运算的时候就应当避免使用明确的循环语句。</p>
</blockquote>
<h5 id="4131-for"><a class="markdownIt-Anchor" href="#4131-for"></a> 4.1.3.1 for</h5>
<p>Mata 中的 <code>for</code> 与 C 语言中的循环语句语法类似。</p>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>exp1; exp2; exp3<span class="token punctuation">)</span> statement
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>exp1; exp2; exp3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*注意点：
- exp1、exp3可以为空，但exp2不可为空
- exp3具体表达中可使用递增(++)或递减(--)运算符，如i++，++i
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>例子：求1~100见的整数和及平方和</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">v</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.100</span><span class="token punctuation">)</span>
<span class="token command keyword">sum1</span> <span class="token operator">=</span> sum2 <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//初始化</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span>; i<span class="token operator">&lt;=</span><span class="token function">length</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>; i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">sum1</span> <span class="token operator">=</span> sum1 <span class="token operator">+</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token command keyword">sum2</span> <span class="token operator">=</span> sum2 <span class="token operator">+</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">(</span>sum1<span class="token punctuation">,</span>sum2<span class="token punctuation">)</span> <span class="token comment">//展示结果</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>

<span class="token comment">/*输出结果：
: (sum1,sum2)
1 2
+-------------------+
1 | 5050 338350 |
+-------------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4132-while"><a class="markdownIt-Anchor" href="#4132-while"></a> 4.1.3.2 while</h5>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//注意exp必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>例子：求 ，要求精度</li>
</ul>
<p>Tip：<code>while</code> 通常被用于迭代求解近似值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">x</span><span class="token operator">=</span><span class="token number">2</span> <span class="token comment">//初始化为2</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">></span> 1e<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token command keyword">x</span> <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token comment">//2*x为f(x)=x^2的求导</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">x</span> <span class="token comment">//展示结果</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>

<span class="token comment">/*输出结果：
: x
2.645751311
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4133-dowhile"><a class="markdownIt-Anchor" href="#4133-dowhile"></a> 4.1.3.3 do…while</h5>
<p><code>do...while</code> 的语法如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">do</span> stmt <span class="token function">while</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">do</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">stmts</span>
<span class="token punctuation">&#125;</span> <span class="token function">while</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
<span class="token comment">//注意exp必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="414-条件语句-conditional"><a class="markdownIt-Anchor" href="#414-条件语句-conditional"></a> 4.1.4 条件语句 (Conditional)</h4>
<p>与 Stata 类似，在 Mata 中可以使用 <code>if...else</code> 来进行条件判断；不同的是，Mata 中有特殊的三元条件运算符 <code>a ? b : c</code></p>
<h4 id="415-ifelse"><a class="markdownIt-Anchor" href="#415-ifelse"></a> 4.1.5 if…else</h4>
<p><code>if...else</code> 语法结构如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement
<span class="token comment">//或者</span>
<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement1
<span class="token command keyword">else</span> statement2
<span class="token comment">//或者</span>
<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statement1</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statement2</span>
<span class="token punctuation">&#125;</span>

<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements1</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>exp2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements2</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements3</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//注意：exp, exp1, exp2...必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="416-a-b-c-条件运算符"><a class="markdownIt-Anchor" href="#416-a-b-c-条件运算符"></a> 4.1.6 a ? b : c 条件运算符</h4>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">a</span> ? b <span class="token punctuation">:</span> c
<span class="token comment">//其中，a必须与实数标量相比较，而b,c的形式不受限制</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>结果输出</li>
</ul>
<p>如果 a 为真 (a不为0)，则条件运算符返回 b，否则返回 c。</p>
<ul>
<li>举个例子</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">k</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token command keyword">n</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token command keyword">dof</span> <span class="token operator">=</span> <span class="token punctuation">(</span> k<span class="token operator">==</span><span class="token number">0</span> ? n<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> n<span class="token operator">-</span>k <span class="token punctuation">)</span> <span class="token comment">//k=0则返回n-1,否则返回n-k</span>
<span class="token command keyword">dof</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>
<span class="token comment">/*输出结果：
: dof
8
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="42-使用单行命令调用-mata"><a class="markdownIt-Anchor" href="#42-使用单行命令调用-mata"></a> 4.2 使用单行命令调用 Mata</h3>
<h4 id="421-实现逻辑及方法"><a class="markdownIt-Anchor" href="#421-实现逻辑及方法"></a> 4.2.1 实现逻辑及方法</h4>
<p>Stata 命令窗口、do-file 或 ado-file 中输入单行命令 <code>mata:一个或多个 Mata 命令，使用分号分割</code>，即可实现 Mata 环境的调用。且我们在 Mata 环境中生成的变量会一直保留，直至输入<code>mata: mata clear</code>。</p>
<p>在上文中，我们提到 Mata 的一大优势是灵活的交互以实现 Stata 与 Mata 的互补， <code>mata:语句</code> 的方式就是极佳的实现方式。</p>
<p>但是该交互的前提是两者工作空间内的变量与结果的相互调用或修改，因此，我们不可避免需要用到 <code>st_interface</code> 这类函数。</p>
<p>基于 <code>st_interface</code> 类型的函数，Mata 可以获取 Stata 中的所有对象 (数据、宏、标量和矩阵)，并实现 Stata 和 Mata 计算结果的无缝交互。</p>
<h4 id="422-例子利用-mata-提取回归后的-t-值"><a class="markdownIt-Anchor" href="#422-例子利用-mata-提取回归后的-t-值"></a> 4.2.2 例子：利用 Mata 提取回归后的 t 值</h4>
<blockquote>
<p>注：以下例子来源于 Baum(2016) Chapter 13.4</p>
</blockquote>
<h5 id="4221-问题阐述及分析"><a class="markdownIt-Anchor" href="#4221-问题阐述及分析"></a> 4.2.2.1 问题阐述及分析</h5>
<p>在使用 <code>reg</code> 命令后，回归结果的会自动保存在 <code>e()</code> 矩阵中，但 统计量未被保存，那么如何才能计算出 统计量呢？</p>
<p>所幸，<code>e()</code> 中保留了估计系数- <code>e(b)</code> 和估计量的方差-协方差矩阵 <code>e(V)</code> ，从而可以通过 来实现 统计量的计算。</p>
<h5 id="4222-mata-实现"><a class="markdownIt-Anchor" href="#4222-mata-实现"></a> 4.2.2.2 Mata 实现</h5>
<ul>
<li>思路如下</li>
</ul>
<ol>
<li>完成回归，获得 <code>e(b)</code> 和 <code>e(B)</code> 矩阵，供 统计量的计算</li>
<li>通过 <code>st_matrix</code> 函数调用 <code>e(b)</code> 和 <code>e(B)</code> 矩阵，并在 Mata 环境中完成 统计量计算</li>
<li>完成相关细节调整</li>
</ol>
<ul>
<li>代码如下</li>
</ul>
<p>(命令窗口运行以下语句需删去 //及其注释语句)</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">*----1.回归----</span>
<span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span> <span class="token keyword">clear</span> <span class="token comment">//调动auto.dta数据集</span>
<span class="token command keyword">reg</span> price displacement weight foreign

<span class="token comment">*----2.单行调用Mata并计算t统计量---</span>
<span class="token command keyword">mata</span><span class="token punctuation">:</span> <span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bst"</span></span><span class="token punctuation">,</span><span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e(b)"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">diagonal</span><span class="token punctuation">(</span><span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e(V)"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/*该行代码具体解释如下：
st_matrix()的使用可利用 help mata st_matrix 进行查看
bst为逗号后矩阵命名。st_matrix(name, X)将Stata中的名为name的矩阵新建/替换为X中的内容
st_matrix("e(b)")调用系数矩阵
diagonal(st_matrix("e(V)"))'代表提取协方差矩阵后取对角线元素，并转置
利用元素运算符:/完成对应估计量的t统计量运算
*/</span>

<span class="token comment">*----3.处理生成的bst矩阵的行列名细节----</span>
<span class="token command keyword">matrix</span> rownames bst <span class="token operator">=</span> tstat <span class="token comment">//行命名</span>
<span class="token command keyword">matrix</span> colnames bst <span class="token operator">=</span> `<span class="token punctuation">:</span> colnames <span class="token function">e</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>' <span class="token comment">//列命名</span>
<span class="token command keyword">matrix</span> list bst<span class="token punctuation">,</span> <span class="token function">format</span><span class="token punctuation">(</span>%<span class="token number">9</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token comment">//输出结果</span>

<span class="token comment">/*矩阵输出结果如下：
. matrix list bst, format(%9.3f)
bst[1,4]
displacement weight foreign _cons
tstat 1.671 3.275 5.745 -2.826
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由上述例子可知，通过在 Mata 环境中调用 Stata 中元素，借助 Mata 矩阵运算的优势，轻松实现 统计量的实现，从而实现双方的互补。</p>
<h4 id="423-stata-实现"><a class="markdownIt-Anchor" href="#423-stata-实现"></a> 4.2.3 Stata 实现</h4>
<p>虽然 Mata 可以一键输出，Stata 中处理就一定复杂吗？参考 st: Re: p&gt;t value extraction 给出的答案，代码如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span> <span class="token keyword">clear</span> <span class="token comment">//调用auto.dta数据集</span>
<span class="token command keyword">reg</span> price displacement weight foreign
<span class="token command keyword">matrix</span> a <span class="token operator">=</span> <span class="token function">vecdiag</span><span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//保存e(V)对角线元素，组成行向量</span>
<span class="token command keyword">matrix</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>\a<span class="token punctuation">)</span>' <span class="token comment">//合并矩阵e(b),a至矩阵b，并转置</span>
<span class="token command keyword">svmat</span> b <span class="token comment">//将矩阵b转化为变量</span>
<span class="token command keyword">rename</span> b1 beta <span class="token comment">//将b1变量(对应b矩阵的第一列)重命名为beta</span>
<span class="token command keyword">gen</span> se <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span> <span class="token comment">//对b2变量开根，相当于求出se</span>
<span class="token command keyword">gen</span> t <span class="token operator">=</span> beta<span class="token operator">/</span>se <span class="token comment">//得到t统计量</span>
<span class="token command keyword">list</span> t <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token comment">//列出所有t统计量的值(因为是变量，所以余下的全部缺失)</span>

<span class="token comment">/*
. mat list b
b[4,2]
y1 r1
displacement 10.253866 37.671085
weight 2.3286255 .50552151
foreign 3899.6304 460717.13
_cons -4048.3431 2052742.2

. list t in 1/4
+------------+
| t |
|------------|
1. | 1.6706426 |
2. | 3.2751395 |
3. | 5.7452147 |
4. | -2.8255962 |
+------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过对比可知，在回归后生成 统计量，Stata 代码需要 6 行，而使用 Mata 仅需一行。主要原因在于 Stata 中的矩阵无法对其中元素进行逐一的开根号运算，于是无法取出标准误，只能先转化为变量后开根。</p>
<p>以上只是一个小例子，Mata 作为专业矩阵编程语言，可以想象它会为我们的科研带来极大的便利。</p>
<blockquote>
<p>Tip：以上的方法都是基于回归后生成的 <code>e()</code> 后计算 统计量 ，实际上使用回归保留的 r(table) 矩阵会更加方便 <mark>(目前为止没有找到更简便的方法)</mark>。语句如下，有兴趣的读者可尝试。</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">matrix</span> a<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
<span class="token command keyword">matrix</span> b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span>.<span class="token number">.4</span><span class="token punctuation">]</span>
<span class="token command keyword">mat</span> list b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="5-微观计量经济学实操"><a class="markdownIt-Anchor" href="#5-微观计量经济学实操"></a> 5. 微观计量经济学实操</h2>
<p>参考这篇文章<a href='/767402338.html#micro-stata' target='_blank'>《微观计量经济学》</a>。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="tags/python/">python</a><a class="post-meta__tags" href="tags/stata/">stata</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">数据处理</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86/">数据拆分</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6/">数据合并</a><a class="post-meta__tags" href="tags/Mata/">Mata</a></div><div class="post_share"><div class="social-share" data-image="/private_img/banner2.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/private_img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/private_img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/private_img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/private_img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="2928949794.html" title="python2 与 python3的区别"><img class="cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python2 与 python3的区别</div></div></a></div><div class="next-post pull-right"><a href="4253525416.html" title="资本循环笔记20201114"><img class="cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">资本循环笔记20201114</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="5504202.html" title="python数据处理手册"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-23</div><div class="title">python数据处理手册</div></div></a></div><div><a href="101587567.html" title="python做计量"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-15</div><div class="title">python做计量</div></div></a></div><div><a href="2928949794.html" title="python2 与 python3的区别"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-15</div><div class="title">python2 与 python3的区别</div></div></a></div><div><a href="3805420524.html" title="助教：一键登记提交和成绩"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-16</div><div class="title">助教：一键登记提交和成绩</div></div></a></div><div><a href="3845945498.html" title="高级计量经济学课件"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-24</div><div class="title">高级计量经济学课件</div></div></a></div><div><a href="2914285830.html" title="商品价格和银行危机"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-03</div><div class="title">商品价格和银行危机</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/private_img/yuyingnan.jpg" onerror="this.onerror=null;this.src='/private_img/404.gif'" alt="avatar"/></div><div class="author-info__name">揭晓</div><div class="author-info__description">随手写一写，揭晓这世界</div></div><a id="card-info-btn" href="/"><i class="fas fa-home"></i><span>回到首页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text"> 1. 基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-pythonstata"><span class="toc-text"> 2. Python+Stata</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%8F%A6%E5%A4%96%E4%BF%9D%E5%AD%98do%E6%96%87%E4%BB%B6%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8C%E5%A4%96%E9%83%A8do%E6%96%87%E4%BB%B6"><span class="toc-text"> 2.1 另外保存do文件，在python中运行外部do文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%9C%89%E6%97%B6%E4%BC%9A%E9%81%87%E5%88%B0%E6%94%B9%E5%8F%98do%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9%E7%9A%84%E6%83%85%E5%BD%A2%E5%9B%A0%E6%AD%A4%E9%9C%80%E8%A6%81%E5%9C%A8python%E4%B8%AD%E5%86%99%E4%B8%80%E4%B8%AAdo%E6%96%87%E6%A1%A3"><span class="toc-text"> 2.2 有时会遇到改变do文档内容的情形，因此需要在python中写一个do文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E5%9C%A8python%E5%92%8Cstata%E4%B8%AD%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E6%9C%80%E5%AE%B9%E6%98%93%E6%83%B3%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%9D%E8%B7%AF%E6%98%AF%E5%B0%86%E8%A6%81%E4%BC%A0%E9%80%92%E7%9A%84%E5%86%85%E5%AE%B9%E4%BF%9D%E5%AD%98%E4%B8%8B%E6%9D%A5%E7%84%B6%E5%90%8Epython%E6%88%96stata%E5%86%8D%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text"> 2.3 在python和stata中传递数据（最容易想到的一个思路是将要传递的内容保存下来，然后python或stata再读取数据）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86%E4%B8%8E%E5%90%88%E5%B9%B6"><span class="toc-text"> 3. 数据拆分与合并</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E9%95%BF%E5%AE%BD%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-reshape%E5%91%BD%E4%BB%A4"><span class="toc-text"> 3.1 长宽数据转换—— reshape命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86"><span class="toc-text"> 3.2 数据拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%BF%9D%E7%95%99%E5%8F%98%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A8%AA%E5%90%91%E6%8B%86%E5%88%86"><span class="toc-text"> 删除\保留变量：数据的横向拆分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%BF%9D%E7%95%99%E8%A7%82%E5%AF%9F%E5%80%BC%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BA%B5%E5%90%91%E6%8B%86%E5%88%86"><span class="toc-text"> 删除\保留观察值：数据的纵向拆分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86-savesome-%E5%91%BD%E4%BB%A4"><span class="toc-text"> 一步到位保存数据子集： savesome 命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.4 数据合并</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#341-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A8%AA%E5%90%91%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.4.1 数据的横向合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#342-%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BA%B5%E5%90%91%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.4.2 数据的纵向合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#343-%E4%B8%80%E6%AC%A1%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AAcsv%E6%96%87%E4%BB%B6-csvconvert"><span class="toc-text"> 3.4.3 一次合并多个csv文件—— csvconvert</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-stata%E4%B8%AD%E7%9A%84mata"><span class="toc-text"> 4. Stata中的Mata</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-mata-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-text"> 4.1 Mata 基础语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-%E6%B3%A8%E9%87%8A%E6%96%B9%E5%BC%8F-comments"><span class="toc-text"> 4.1.1 注释方式 (Comments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-%E8%BF%90%E7%AE%97%E7%AC%A6-operators"><span class="toc-text"> 4.1.2 运算符 (Operators)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4121-%E5%9F%BA%E7%A1%80%E8%BF%90%E7%AE%97-%E9%83%A8%E5%88%86"><span class="toc-text"> 4.1.2.1 基础运算 (部分)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4122-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-logical-operators"><span class="toc-text"> 4.1.2.2 逻辑运算符 (Logical Operators)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4123-%E4%B8%8B%E6%A0%87%E8%BF%90%E7%AE%97-subscripts"><span class="toc-text"> 4.1.2.3 下标运算 (Subscripts)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4124-%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%E6%80%BB%E7%BB%93"><span class="toc-text"> 4.1.2.4 运算符优先级总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#413-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5-loop"><span class="toc-text"> 4.1.3 循环语句 (Loop)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4131-for"><span class="toc-text"> 4.1.3.1 for</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4132-while"><span class="toc-text"> 4.1.3.2 while</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4133-dowhile"><span class="toc-text"> 4.1.3.3 do…while</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#414-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5-conditional"><span class="toc-text"> 4.1.4 条件语句 (Conditional)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#415-ifelse"><span class="toc-text"> 4.1.5 if…else</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#416-a-b-c-%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text"> 4.1.6 a ? b : c 条件运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E4%BD%BF%E7%94%A8%E5%8D%95%E8%A1%8C%E5%91%BD%E4%BB%A4%E8%B0%83%E7%94%A8-mata"><span class="toc-text"> 4.2 使用单行命令调用 Mata</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%8F%8A%E6%96%B9%E6%B3%95"><span class="toc-text"> 4.2.1 实现逻辑及方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-%E4%BE%8B%E5%AD%90%E5%88%A9%E7%94%A8-mata-%E6%8F%90%E5%8F%96%E5%9B%9E%E5%BD%92%E5%90%8E%E7%9A%84-t-%E5%80%BC"><span class="toc-text"> 4.2.2 例子：利用 Mata 提取回归后的 t 值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4221-%E9%97%AE%E9%A2%98%E9%98%90%E8%BF%B0%E5%8F%8A%E5%88%86%E6%9E%90"><span class="toc-text"> 4.2.2.1 问题阐述及分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4222-mata-%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 4.2.2.2 Mata 实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#423-stata-%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 4.2.3 Stata 实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%BE%AE%E8%A7%82%E8%AE%A1%E9%87%8F%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%AE%9E%E6%93%8D"><span class="toc-text"> 5. 微观计量经济学实操</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2511924152.html" title="博士论文提纲">博士论文提纲</a><time datetime="2023-02-04T09:14:06.342Z" title="更新于 2023-02-04 17:14:06">2023-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="1547882094.html" title="青木昌彦比较制度分析">青木昌彦比较制度分析</a><time datetime="2023-02-04T08:29:06.432Z" title="更新于 2023-02-04 16:29:06">2023-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="595459505.html" title="厦门大学学生常用网站">厦门大学学生常用网站</a><time datetime="2023-02-04T04:04:51.277Z" title="更新于 2023-02-04 12:04:51">2023-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="1564093463.html" title="商品美学批判——关注高科技资本主义社会的商品美学">商品美学批判——关注高科技资本主义社会的商品美学</a><time datetime="2023-02-03T15:19:55.503Z" title="更新于 2023-02-03 23:19:55">2023-02-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3666905482.html" title="马恩全集摘抄">马恩全集摘抄</a><time datetime="2023-02-03T02:29:02.569Z" title="更新于 2023-02-03 10:29:02">2023-02-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2863665956.html" title="劳动与垄断资本">劳动与垄断资本</a><time datetime="2023-02-01T05:01:38.097Z" title="更新于 2023-02-01 13:01:38">2023-02-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="584278389.html" title="Git教程">Git教程</a><time datetime="2023-01-31T07:58:42.111Z" title="更新于 2023-01-31 15:58:42">2023-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="1835528881.html" title="劳动价值论辨析">劳动价值论辨析</a><time datetime="2023-01-20T04:16:48.061Z" title="更新于 2023-01-20 12:16:48">2023-01-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/private_img/banner2.gif')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 揭晓</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎参观我的<a href='https://github.com/dhndzwxj' target='_blank'>github</a>个人主页！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="js/utils.js"></script><script src="js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://dhndzwxj.github.io/1837523341.html'
    this.page.identifier = ''
    this.page.title = 'stata笔记'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://https-www-dhndzwxj-top.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script type='text/javascript' src='https://ajax.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script id="dsq-count-scr" src="//https-www-dhndzwxj-top.disqus.com/count.js" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>