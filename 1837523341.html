<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>stata笔记 | 小荷才露尖尖角</title><meta name="author" content="揭晓"><meta name="copyright" content="揭晓"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MacBook技巧：如果需要复制路径，在finder里，对选中的文件，cmd+opt+c，就复制到剪贴板了。 参考书籍：陈传波-stata软件教程。    0 简介 Stata 统计软件包是目前世界上最著名的统计软件之一，与SAS、SPSS 一起被并称为三大权威软件。它广泛的应用于经济、教育、人口、政治学、社会学、医学、药学、工矿、农林等学科领域，同时具有数据管理软件、统计分析软件、绘图软件、矩阵">
<meta property="og:type" content="article">
<meta property="og:title" content="stata笔记">
<meta property="og:url" content="https://dhndzwxj.github.io/1837523341.html">
<meta property="og:site_name" content="小荷才露尖尖角">
<meta property="og:description" content="MacBook技巧：如果需要复制路径，在finder里，对选中的文件，cmd+opt+c，就复制到剪贴板了。 参考书籍：陈传波-stata软件教程。    0 简介 Stata 统计软件包是目前世界上最著名的统计软件之一，与SAS、SPSS 一起被并称为三大权威软件。它广泛的应用于经济、教育、人口、政治学、社会学、医学、药学、工矿、农林等学科领域，同时具有数据管理软件、统计分析软件、绘图软件、矩阵">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dhndzwxj.github.io/private_img/banner2.gif">
<meta property="article:published_time" content="2020-11-15T03:28:32.000Z">
<meta property="article:modified_time" content="2023-10-09T13:20:21.259Z">
<meta property="article:author" content="揭晓">
<meta property="article:tag" content="python">
<meta property="article:tag" content="数据处理">
<meta property="article:tag" content="stata">
<meta property="article:tag" content="数据拆分">
<meta property="article:tag" content="数据合并">
<meta property="article:tag" content="Mata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dhndzwxj.github.io/private_img/banner2.gif"><link rel="shortcut icon" href="/private_img/favicon.png"><link rel="canonical" href="https://dhndzwxj.github.io/1837523341.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":50,"position":"top","messagePrev":"本文上次更新距离今天已经过去","messageNext":"天, 文中内容可能已经过时，望周知。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'stata笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-09 21:20:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng:wght@400;500;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/wave.css?v1"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="小荷才露尖尖角" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="../private_img/yuyingnan.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="../archives/"><div class="headline">文章</div><div class="length-num">316</div></a><a href="../tags/"><div class="headline">标签</div><div class="length-num">669</div></a><a href="../categories/"><div class="headline">分类</div><div class="length-num">78</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="../about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="../categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="../archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="../tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="../air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/private_img/banner2.gif')"><nav id="nav"><span id="blog-info"><a href="../index.html" title="小荷才露尖尖角"><span class="site-name">小荷才露尖尖角</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="../about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="../categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="../archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="../tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="../air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">stata笔记</h1><div id="post-meta"><div class="meta-firstline"><i class="fa-solid fa-user"></i><span class="post-meta-author">揭晓</span><span class="post-meta-date"><span class="post-meta-separator">|</span><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-15T03:28:32.000Z" title="发表于 2020-11-15 11:28:32">2020-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-09T13:20:21.259Z" title="更新于 2023-10-09 21:20:21">2023-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/">计量与模型</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/">计量</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/stata/">stata</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>51分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="stata笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>MacBook技巧：如果需要复制路径，在<code>finder</code>里，对选中的文件，<code>cmd+opt+c</code>，就复制到剪贴板了。</p>
<p>参考书籍：陈传波-stata软件教程。</p>
<p><embed height=500px width=800px fullscreen='yes' src='/local_file/陈传波-stata软件教程.pdf'> </embed></p>
<h2 id="0-简介"><a class="markdownIt-Anchor" href="#0-简介"></a> 0 简介</h2>
<p>Stata 统计软件包是目前世界上最著名的统计软件之一，与SAS、SPSS 一起被并称为三大权威软件。它广泛的应用于经济、教育、人口、政治学、社会学、医学、药学、工矿、农林等学科领域，同时具有数据管理软件、统计分析软件、绘图软件、矩阵计算软件和程序语言的特点，几乎可以完成全部复杂的统计分析工作。其功能非常强大且操作简单、使用灵活、易学易用、运行速度极快，在许多方面别具一格。</p>
<p>Stata 的另一个特点是他的许多高级统计模块均是编程人员用宏语言写成的程序文件（ADO 文件），这些文件可以自行修改、添加和下载。用户可随时到Stata 网站寻找并下载最新的升级文件。这一特点使得STATA 始终处于统计分析方法发展的最前沿，用户几乎总是能很快找到最新统计算法的Stata 程序版本，而这也使得Stata 自身成了几大统计软件中升级最多、最频繁的一个。</p>
<p>几个主要的网站：</p>
<ul>
<li>STATA公司官方网站<a target="_blank" rel="noopener" href="http://www.stata.com">http://www.stata.com</a></li>
<li>STATA 资源链接<a target="_blank" rel="noopener" href="http://www.stata.com/links/resources.html">http://www.stata.com/links/resources.html</a></li>
<li>STATA出版社<a target="_blank" rel="noopener" href="http://www.stata-press.com">http://www.stata-press.com</a></li>
<li>STATA电子杂志<a target="_blank" rel="noopener" href="http://www.stata-journal.com/">http://www.stata-journal.com/</a></li>
<li>STATA 技术公告版
<ul>
<li>Frequently asked questions on using Stata:<a target="_blank" rel="noopener" href="http://www.stata.com/support/faqs/">http://www.stata.com/support/faqs/</a></li>
<li></li>
<li><a target="_blank" rel="noopener" href="http://www.ats.ucla.edu/stat/stata/examples/default.htm">http://www.ats.ucla.edu/stat/stata/examples/default.htm</a></li>
</ul>
</li>
</ul>
<h3 id="01-获得帮助"><a class="markdownIt-Anchor" href="#01-获得帮助"></a> 0.1 获得帮助</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">help</span> <span class="token comment">//显示出STATA 所有帮助内容的目录结构。</span>
<span class="token command keyword">help</span> summarize <span class="token comment">//如果输入具体的命令，则只显示该命令的帮助</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也可以通过菜单式的点选方式获得帮助: Help&gt;&gt;stata command…在弹出的对话框中输入：summarize 然后回车，得到与help summarize 同样的结果。</p>
<p><b>网络帮助</b>可以采用如下命令获得</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">findit</span> scat3
<span class="token command keyword">search</span> scat3<span class="token punctuation">,</span>net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="1-基本操作"><a class="markdownIt-Anchor" href="#1-基本操作"></a> 1. 基本操作</h2>
<h3 id="11-数据导入与输出"><a class="markdownIt-Anchor" href="#11-数据导入与输出"></a> 1.1 数据导入与输出</h3>
<p>导入数据</p>
<p>一般做实证分析使用的是excel中的数据，其后缀名为.xls，需要将其修改为.csv</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">insheet</span> using name.csv<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">use</span> name.dta<span class="token punctuation">,</span><span class="token keyword">clear</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>当数据中某个变量的位数特别长或者对导入数据的精度要求很高的时候，需要在该命令后面加<code>double</code>选项。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">insheet</span> using name.csv<span class="token punctuation">,</span> double <span class="token keyword">clear</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>系统自带文件和网络文件的打开</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">webuse</span> nlswork<span class="token punctuation">,</span><span class="token keyword">clear</span> <span class="token comment">//从STATA 官方数据库获取数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>删除重复变量</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sort</span> var1 var2
<span class="token command keyword">duplicatesdrop</span> var1 var2<span class="token punctuation">,</span> force<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>合并数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> data1<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">merge</span> m<span class="token punctuation">:</span>m var1 var2 using data2
<span class="token command keyword">drop</span> <span class="token keyword">if</span> _merge<span class="token operator">==</span><span class="token number">2</span>
<span class="token command keyword">drop</span> <span class="token keyword">if</span> _merge<span class="token operator">==</span><span class="token number">1</span>
<span class="token command keyword">drop</span> _merge<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出为excel文件</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">export</span> excel using <span class="token string-literal"><span class="token string">"mywide.xls"</span></span><span class="token punctuation">,</span><span class="token function">firstrow</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>结果输出</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//安装 </span>
<span class="token command keyword">ssc</span> install estout<span class="token punctuation">,</span> replace
<span class="token comment">//单个回归</span>
<span class="token command keyword">reg</span> y x
<span class="token command keyword">esttab</span> using name.rtf<span class="token punctuation">,</span> compress nogap r2 ar2 <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
<span class="token comment">//多个回归一起</span>
<span class="token command keyword">reg</span> y x1 
<span class="token command keyword">est</span> store m1
<span class="token command keyword">reg</span> y x2
<span class="token command keyword">est</span> store m2
<span class="token command keyword">esttab</span> m1 m2 using <span class="token operator">/</span>juncker<span class="token operator">/</span>desktop<span class="token operator">/</span>name.rtf<span class="token punctuation">,</span> compress nogap r2 ar2 <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token comment">//第一种</span>
<span class="token command keyword">esttab</span> re1 re2 re3 re4 using table10.rtf<span class="token punctuation">,</span>se mtitles <span class="token function">star</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token function">b</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token function">se</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token function">r2</span><span class="token punctuation">(</span>%<span class="token number">4</span><span class="token number">.3</span>f<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">/</span>第二种<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="11a-生成新数据的方法"><a class="markdownIt-Anchor" href="#11a-生成新数据的方法"></a> 1.1a 生成新数据的方法</h3>
<p>生成新数据：生成新的数据x(x=1,2,…,1000);y=x+100</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span> 
<span class="token command keyword">set</span> obs <span class="token number">1000</span>
<span class="token command keyword">gen</span> x <span class="token operator">=</span> _n
<span class="token command keyword">gen</span> y <span class="token operator">=</span> x<span class="token operator">+</span><span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="11b-数据类型转化"><a class="markdownIt-Anchor" href="#11b-数据类型转化"></a> 1.1b 数据类型转化</h3>
<p>字符型转化为数字型</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">destring</span><span class="token punctuation">,</span> replace <span class="token comment">//全部转换为数值型，replace 表示将原来的变量（值）更新</span>
<span class="token command keyword">destring</span> date<span class="token punctuation">,</span> replace <span class="token function">ignore</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">" "</span></span><span class="token punctuation">)</span> <span class="token comment">//忽略空格，然后转换，注意这里的" "中间有一个空格，不是""。</span>
<span class="token command keyword">destring</span> price percent<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>price2 percent2<span class="token punctuation">)</span> <span class="token function">ignore</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"$,%"</span></span><span class="token punctuation">)</span> <span class="token comment">////注意到price2 前面的$号消失，percent2 后面的%号消失</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>数字型转化为字符型</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">webuse</span> tostring<span class="token punctuation">,</span><span class="token keyword">clear</span> 
<span class="token command keyword">des</span> <span class="token comment">//注意到month 为字符型，而年和日为数值型</span>
<span class="token comment">//由于month 为字符型,年和日为数值型,不同类型不能相加</span>
<span class="token command keyword">tostring</span> year day<span class="token punctuation">,</span>replace <span class="token comment">//将年和日转化为字符型</span>
<span class="token command keyword">gen</span> date1 <span class="token operator">=</span> month <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"/"</span></span> <span class="token operator">+</span> day <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"/"</span></span> <span class="token operator">+</span> year
<span class="token command keyword">list</span>
<span class="token command keyword">gen</span> date2 <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span>date1<span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"MDY"</span></span><span class="token punctuation">)</span> <span class="token comment">//date（）为日期函数，它以1960年1月1日为第0天，计算从那天起直到括号中指定的某天date1一共过了多少天。”mdy”指定date1的排列顺序，这里是按照月日年的顺序来表示日期。</span>
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="11c-gen和egen的区别"><a class="markdownIt-Anchor" href="#11c-gen和egen的区别"></a> 1.1c gen和egen的区别</h3>
<p>egen命令相对复杂一些，对于变量包含重复序列的大型数据库非常有用。它能生成一些“gen”命令无法生成的变量。egen 的特点是它更强大的函数功能。 gen 可以支持一些函数， egen 支持额外的函数。例如可以生成wagesum为每个人的工资和，以及生成wagemedian为工资的中位数(median)，wagemax为工资的最大值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gen</span> educsqr<span class="token operator">=</span>educ<span class="token operator">^</span><span class="token number">2</span>
<span class="token command keyword">egen</span> wagesum <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>
<span class="token command keyword">egen</span> wagemedian <span class="token operator">=</span> <span class="token function">median</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>
<span class="token command keyword">egen</span> wagemax <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span>
<span class="token comment">//更复杂的如想产生一个变量“wagemax”为相同教育水平里的最高工资。</span>
<span class="token command keyword">egen</span> wagemaxeduc <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>wage<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">by</span><span class="token punctuation">(</span>educ<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再举个简单的例子:</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span> 
<span class="token command keyword">set</span> obs <span class="token number">5</span>
<span class="token command keyword">gen</span> x <span class="token operator">=</span> _n
<span class="token command keyword">gen</span> y <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token command keyword">egen</span> z <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下</p>
<table>
<thead>
<tr>
<th></th>
<th>x</th>
<th>y</th>
<th>z</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
<td>15</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>6</td>
<td>15</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>10</td>
<td>15</td>
</tr>
<tr>
<td>5</td>
<td>5</td>
<td>15</td>
<td>15</td>
</tr>
</tbody>
</table>
<p>例子：通过多列求平均，生成新列。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">egen</span> testmean <span class="token operator">=</span> <span class="token function">rowmean</span><span class="token punctuation">(</span>test1 test2<span class="token punctuation">)</span>
<span class="token command keyword">list</span> testmean test1 test2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="12-描述性统计"><a class="markdownIt-Anchor" href="#12-描述性统计"></a> 1.2 描述性统计</h3>
<p>格式化生成结果：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tabstat</span> var1 var2<span class="token punctuation">,</span> <span class="token function">stat</span><span class="token punctuation">(</span>n min mean median p25 p75 max sd<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">if</span> groupvar<span class="token operator">==</span><span class="token number">0</span> or <span class="token number">1</span>
<span class="token comment">//输出到word中：</span>
<span class="token command keyword">logout</span><span class="token punctuation">,</span> <span class="token function">save</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> word replace<span class="token punctuation">:</span> tabstat var<span class="token punctuation">,</span> <span class="token function">stat</span><span class="token punctuation">(</span>n min mean p50 max sd<span class="token punctuation">)</span> <span class="token function">col</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>%<span class="token number">9</span><span class="token number">.2</span>g<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>再举个简单的例子，帮助理解sum函数生成的变量的样子（按某列样本累加，因此样本的排序就很重要！）:</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span> 
<span class="token command keyword">set</span> obs <span class="token number">5</span>
<span class="token command keyword">gen</span> x <span class="token operator">=</span> _n
<span class="token command keyword">gen</span> y <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下</p>
<table>
<thead>
<tr>
<th></th>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>6</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>10</td>
</tr>
<tr>
<td>5</td>
<td>5</td>
<td>15</td>
</tr>
</tbody>
</table>
<h3 id="12a-画图"><a class="markdownIt-Anchor" href="#12a-画图"></a> 1.2a 画图</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">sum</span> weight	<span class="token comment">///</span>
<span class="token command keyword">price</span>	<span class="token comment">///</span>
<span class="token command keyword">length</span>	<span class="token comment">//求重量、价格、长度的平均值</span>
<span class="token command keyword">scatter</span> price weight <span class="token comment">//绘价格和重量的散点图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对较长的命令或者为便于阅读，将一行命令写成几行时，用<code>///</code>来分开</p>
<h3 id="13-统计检验"><a class="markdownIt-Anchor" href="#13-统计检验"></a> 1.3 统计检验</h3>
<p>生成虚拟变量</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tab</span> year<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span>
<span class="token command keyword">tab</span> industry<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>industry<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>数据缩尾处理</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">findit</span> winsor2
<span class="token comment">//之后安装</span>
<span class="token command keyword">winsor2</span> varname<span class="token punctuation">,</span> replace <span class="token function">cut</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">99</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>异方差检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//怀特检验</span>
<span class="token command keyword">ssc</span> install whitetst
<span class="token command keyword">reg</span> y x1 x2
<span class="token command keyword">estat</span> imtest<span class="token punctuation">,</span> white
<span class="token comment">//处理：“OLS+稳健标准差”</span>
<span class="token command keyword">reg</span> y x1 x2 x3<span class="token punctuation">,</span> robust<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>DW检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gen</span> id<span class="token operator">=</span>_n
<span class="token command keyword">tsset</span> id
<span class="token command keyword">estat</span> dwatson<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>计算两个日期之间的间隔天数</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gen</span> td<span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span>trading_date<span class="token punctuation">,</span><span class="token variable">'YMD'</span><span class="token punctuation">)</span>
<span class="token command keyword">gen</span> ed<span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span>eventdate<span class="token punctuation">,</span><span class="token variable">'YMD'</span><span class="token punctuation">)</span>
<span class="token command keyword">form</span> td ed %td
<span class="token command keyword">gen</span> d<span class="token operator">=</span>ed<span class="token operator">-</span>td<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>生成滞后、差分数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tsset</span> code year
<span class="token command keyword">gen</span> newvarname<span class="token operator">=</span>l.varname
<span class="token command keyword">gen</span> newvarname<span class="token operator">=</span>d.varname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>多重共线检验之方差膨胀因子</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">reg</span> y x1 x2 x3
<span class="token command keyword">vif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>多重共线修正之逐步回归</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">stepwise</span><span class="token punctuation">,</span> <span class="token function">pe</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token command keyword">reg</span> y x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检验是否遗漏高次项</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">reg</span> y x
<span class="token command keyword">estat</span> ovtest
<span class="token comment">//或者</span>
<span class="token command keyword">estat</span> ovtest<span class="token punctuation">,</span> rhs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>样本检验</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//两样本均值T检验</span>
<span class="token command keyword">ttest</span> var<span class="token punctuation">,</span> <span class="token keyword">by</span><span class="token punctuation">(</span>groupvar<span class="token punctuation">)</span>
<span class="token comment">//两样本中位数Z检验</span>
<span class="token command keyword">ranksum</span> var<span class="token punctuation">,</span> <span class="token keyword">by</span><span class="token punctuation">(</span>groupvar<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="14-数据排序"><a class="markdownIt-Anchor" href="#14-数据排序"></a> 1.4 数据排序</h3>
<h4 id="141-sort"><a class="markdownIt-Anchor" href="#141-sort"></a> 1.4.1 sort</h4>
<p>如果sort命令中只包含一个变量名，无论变量类型是数值还是字符串，stata都会以此变量对数据进行<b>升序</b>排序。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">sort</span> mpg
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>观测值相同的排序:还是对mpg进行排序，但我们加上一个小尾巴，结果就会满足我们的需求：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">sort</span> mpg<span class="token punctuation">,</span>stable
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果命令包含有两个或者更多变量名的varlist，数据将以如下方式排序：</p>
<p>键入sort命令，按第一个变量对观测值进行排序，然后，对于在第一个变量有相同取值的观测值，stata按第二个变量对这些观测值进行排序，等等。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">sort</span> mpg length
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在使用 sort命令之后，数据集将被标记为是按那些变量排序的，<b>但如果希望保存这一新排序次序的话，需要将此新的数据集保存到硬盘里</b>。</p>
<h4 id="142-gsort"><a class="markdownIt-Anchor" href="#142-gsort"></a> 1.4.2 gsort</h4>
<p>基本语法：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">gsort</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">|</span><span class="token operator">-</span><span class="token punctuation">]</span> varname <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">|</span><span class="token operator">-</span><span class="token punctuation">]</span> varname ...<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token function">generate</span><span class="token punctuation">(</span>newvar<span class="token punctuation">)</span> mfirst<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中需要说明的内容有两点：</p>
<ul>
<li>[+]表示按升序排列，这也是Stata默认的排列方式，[-]表示按降序排列；</li>
<li>generate(newvar)表示排序之后生成新的变量，mfirst表示将缺失值排在最前面。</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">gsort</span> <span class="token operator">-</span>make
<span class="token command keyword">list</span> <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="15-分类操作"><a class="markdownIt-Anchor" href="#15-分类操作"></a> 1.5 分类操作</h3>
<p>例子1：有一个变量foreign，该变量表示某个车是进口车（1 Foreign）还是国产车（0 Domestic）。如果需要分别知道国产车和进口车的价格和重量，可以采用分类操作来求得，</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token keyword">by</span> foreign<span class="token punctuation">:</span> <span class="token command keyword">sum</span> price weight<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><span style='color:red'>可能犯的错</span>：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sort</span> price
<span class="token keyword">by</span> foreign<span class="token punctuation">:</span> <span class="token command keyword">sum</span> price weight<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><span style='color:red'>系统提示没有排序，这是因为by varlist 在执行时要求内存中的数据是按照by后面的变量排序的。当我们用sort price 重新排序后，就打乱了原来按照foreign 的排序，所以出现了错误提示</span>。更正的办法是：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sort</span> foreign
<span class="token keyword">by</span> foreign<span class="token punctuation">:</span> <span class="token command keyword">sum</span> price weight<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>或者简化代码：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">by</span> foreign<span class="token punctuation">,</span> <span class="token keyword">sort</span><span class="token punctuation">:</span> <span class="token command keyword">sum</span> price weight<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例子2：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">set</span> obs <span class="token number">5</span>
<span class="token command keyword">input</span> x y
<span class="token number">1</span> <span class="token number">1.1</span>
<span class="token number">1</span> <span class="token number">1.2</span>
<span class="token number">1</span> <span class="token number">1.3</span>
<span class="token number">2</span> <span class="token number">2.1</span>
<span class="token number">2</span> <span class="token number">2.2</span>
<span class="token command keyword">end</span>
<span class="token command keyword">gen</span> n <span class="token operator">=</span> _n
<span class="token command keyword">gen</span> N <span class="token operator">=</span> _N
<span class="token command keyword">gen</span> z <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token command keyword">export</span> excel using <span class="token string-literal"><span class="token string">"mydata.xls"</span></span><span class="token punctuation">,</span><span class="token function">firstrow</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>生成的数据如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>x</th>
<th>y</th>
<th>n</th>
<th>N</th>
<th>z</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>2</td>
<td>4</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>2</td>
<td>5</td>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">by</span> x<span class="token punctuation">,</span> <span class="token keyword">sort</span><span class="token punctuation">:</span> <span class="token command keyword">gen</span> n1 <span class="token operator">=</span> _n <span class="token comment">//先根据x分组，n1对应于每一组数据对应的位置</span>
<span class="token keyword">by</span> x<span class="token punctuation">,</span> <span class="token keyword">sort</span><span class="token punctuation">:</span> <span class="token command keyword">gen</span> N1 <span class="token operator">=</span> _N <span class="token comment">//先根据x分组，N1是每一组数据的总数</span>
<span class="token keyword">by</span> x<span class="token punctuation">,</span> <span class="token keyword">sort</span><span class="token punctuation">:</span> <span class="token command keyword">gen</span> z1 <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">//先根据x分组，z1是y每一组第一个值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="15a-生成虚拟变量的一个方法"><a class="markdownIt-Anchor" href="#15a-生成虚拟变量的一个方法"></a> 1.5a 生成虚拟变量的一个方法</h3>
<p><code>cut()</code>将连续的数值，转换为区间的分类变量。先举个简单的例子：[3000, 7500)=便宜, [7500, 12000)=适中, [12000, 165000)=贵，共3个类别</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">egen</span> price_category <span class="token operator">=</span> <span class="token function">cut</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">at</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token number">7140</span><span class="token punctuation">,</span><span class="token number">12000</span><span class="token punctuation">,</span><span class="token number">16500</span><span class="token punctuation">)</span> label <span class="token comment">//这里分成了[3000, 7500), [7500, 12000), [12000, 165000) 共3个类别</span>
<span class="token command keyword">list</span> price price_category
<span class="token command keyword">tab</span> price price_category<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>从tab结果来看，实际上生成了标记类别的变量，似乎可以往虚拟变量那个方向考虑。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th>Price_category</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>price</td>
<td>3000-</td>
<td>7500-</td>
<td>12000-</td>
<td>Total</td>
</tr>
<tr>
<td>3299</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>3667</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>3799</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>3955</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>3984</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4082</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4099</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4453</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4504</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4749</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>4816</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>5104</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>5189</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>5705</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>5788</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>7827</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>10372</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>11385</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>14500</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>15906</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>Total</td>
<td>15</td>
<td>3</td>
<td>2</td>
<td>20</td>
</tr>
</tbody>
</table>
<p>通过recode命令，对分类型变量重新编码</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">tab</span> price_category<span class="token punctuation">,</span> nolabel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>price_categ</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ory</td>
<td>Freq.</td>
<td>Percent</td>
<td>Cum.</td>
</tr>
<tr>
<td>0</td>
<td>59</td>
<td>79.73</td>
<td>79.73</td>
</tr>
<tr>
<td>1</td>
<td>10</td>
<td>13.51</td>
<td>93.24</td>
</tr>
<tr>
<td>2</td>
<td>5</td>
<td>6.76</td>
<td>100.00</td>
</tr>
<tr>
<td>Total</td>
<td>74</td>
<td>100.00</td>
<td></td>
</tr>
</tbody>
</table>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">recode</span> price_category <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token command keyword">tab</span> price_category<span class="token punctuation">,</span> nolabel
<span class="token command keyword">tab</span> price_category<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="15b-将分类编码进行数字编码未解决"><a class="markdownIt-Anchor" href="#15b-将分类编码进行数字编码未解决"></a> 1.5b 将分类编码进行数字编码（未解决）</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">encode</span> foreign<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>foreign_id<span class="token punctuation">)</span>
<span class="token command keyword">label</span> list foreign_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="15c-取某个具体的值作为列分组的值"><a class="markdownIt-Anchor" href="#15c-取某个具体的值作为列分组的值"></a> 1.5c 取某个具体的值作为列分组的值</h3>
<p>生成新变量，取分组的第一个或者一个取值为分组的取值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sort</span> docid
<span class="token keyword">by</span> docid<span class="token punctuation">:</span> <span class="token command keyword">gen</span> first_age <span class="token operator">=</span> age<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">//取分组的第一个值为分组的取值</span>
<span class="token keyword">by</span> docid<span class="token punctuation">:</span> <span class="token command keyword">gen</span> lag_age <span class="token operator">=</span> age<span class="token punctuation">[</span>_n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">//取分组内上一个位置的取值</span>
<span class="token keyword">by</span> docid<span class="token punctuation">:</span> <span class="token command keyword">gen</span> last_age <span class="token operator">=</span> age<span class="token punctuation">[</span>_N<span class="token punctuation">]</span> <span class="token comment">//去分组的最后一个值为分组的组织</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<table>
<thead>
<tr>
<th></th>
<th>docid</th>
<th>age</th>
<th>first_age</th>
<th>lag_age</th>
<th>last_age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-1</td>
<td>1</td>
<td>1</td>
<td>.</td>
<td>4</td>
</tr>
<tr>
<td>2</td>
<td>1-1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>1-1</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>4</td>
<td>1-1</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>5</td>
<td>1-2</td>
<td>5</td>
<td>5</td>
<td>.</td>
<td>8</td>
</tr>
<tr>
<td>6</td>
<td>1-2</td>
<td>6</td>
<td>5</td>
<td>5</td>
<td>8</td>
</tr>
<tr>
<td>7</td>
<td>1-2</td>
<td>7</td>
<td>5</td>
<td>6</td>
<td>8</td>
</tr>
<tr>
<td>8</td>
<td>1-2</td>
<td>8</td>
<td>5</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>9</td>
<td>1-3</td>
<td>9</td>
<td>9.</td>
<td>.</td>
<td>11</td>
</tr>
<tr>
<td>10</td>
<td>1-3</td>
<td>10</td>
<td>9</td>
<td>9</td>
<td>11</td>
</tr>
<tr>
<td>11</td>
<td>1-3</td>
<td>11</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</tbody>
</table>
<h3 id="16-条件表达式与范围筛选"><a class="markdownIt-Anchor" href="#16-条件表达式与范围筛选"></a> 1.6 条件表达式与范围筛选</h3>
<p>若只想查看国产车的品牌和价格，则加入筛选条件</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">list</span> make price <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>要计算较低的前10台车的平均价格，则要先按价格排序，然后仅对前10个车的价格求平均值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">sort</span> price
<span class="token command keyword">sum</span> price <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>要计算较高的前10台车的平均价格，则要先按价格排序，然后仅对前10个车的价格求平均值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">gsort</span> <span class="token operator">-</span>price
<span class="token command keyword">sum</span> price <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>要计算前10台车中的国产车的平均价格，则可将范围和条件筛选联合使用。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sum</span> price <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意：in和by不能一起使用。</p>
<h3 id="17-加权weight"><a class="markdownIt-Anchor" href="#17-加权weight"></a> 1.7 加权weight</h3>
<p>下表是2005 年湖北省高考640 分及以上成绩一分一段的人数统计，第一列<code>score</code>为高考分数，第二列<code>num</code>为该分数段的人数。现在我们要求640分及以上考生的平均分数。</p>
<table>
<thead>
<tr>
<th>score</th>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>650</td>
<td>193</td>
</tr>
<tr>
<td>649</td>
<td>26</td>
</tr>
<tr>
<td>648</td>
<td>23</td>
</tr>
<tr>
<td>647</td>
<td>16</td>
</tr>
<tr>
<td>646</td>
<td>21</td>
</tr>
<tr>
<td>645</td>
<td>26</td>
</tr>
<tr>
<td>644</td>
<td>32</td>
</tr>
<tr>
<td>643</td>
<td>23</td>
</tr>
<tr>
<td>642</td>
<td>38</td>
</tr>
<tr>
<td>641</td>
<td>29</td>
</tr>
<tr>
<td>640</td>
<td>38</td>
</tr>
</tbody>
</table>
<p>那么如何在stata中生成这两列数据呢？参考如下代码：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">set</span> obs <span class="token number">11</span>
<span class="token command keyword">gen</span> score <span class="token operator">=</span> <span class="token number">651</span><span class="token operator">-</span>_n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以使用代码建立新变量<code>num</code>输入数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">input</span> str10 num<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后逐个数据输入。【如果中途要结束，直接输入代码<code>end</code>】</p>
<p>然后计算加权平均分。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sum</span> score <span class="token punctuation">[</span>weight<span class="token operator">=</span>num<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="18-其他可选项"><a class="markdownIt-Anchor" href="#18-其他可选项"></a> 1.8 其他可选项</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">list</span> price <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token function">sep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//每10个观察值之间加一横线</span>
<span class="token command keyword">list</span> price <span class="token keyword">in</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token function">sep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token command keyword">list</span> price<span class="token punctuation">,</span> nohead <span class="token comment">//不要表头</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="1n-2-多行编辑"><a class="markdownIt-Anchor" href="#1n-2-多行编辑"></a> 1.(n-2) 多行编辑</h3>
<p>VS Code 提供了多种多行编辑的快捷键，可以大大提高编码效率。以下是常用的几个快捷键：</p>
<ol>
<li>Alt + 鼠标左键拖动：可以同时选中多个位置进行编辑。</li>
<li>Ctrl + Alt + 方向键上/下：可以在选中多行的情况下在上方或下方添加光标。</li>
<li>Ctrl + Shift + L：可以选中所有与当前选中单词相同的单词，方便一次性修改。</li>
<li>Shift + Alt + I：可以在选中多行的情况下在行尾插入光标，方便同时编辑多行。</li>
<li>Ctrl + Shift + Alt + 方向键上/下：可以在选中多行的情况下复制并插入多个光标。</li>
</ol>
<h3 id="1n-1-四则运算-函数运算"><a class="markdownIt-Anchor" href="#1n-1-四则运算-函数运算"></a> 1.(n-1) 四则运算、函数运算</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">display</span> <span class="token number">4</span><span class="token operator">+</span><span class="token number">8</span>
<span class="token command keyword">di</span> <span class="token number">4</span><span class="token operator">+</span><span class="token number">8</span>
<span class="token command keyword">di</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token command keyword">di</span> <span class="token number">4</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token command keyword">di</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token command keyword">di</span> <span class="token function">ln</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//stata中ln和log是一个函数！</span>
<span class="token command keyword">di</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="常用函数"><a class="markdownIt-Anchor" href="#常用函数"></a> 常用函数</h4>
<table>
<thead>
<tr>
<th></th>
<th>函数</th>
<th>含义</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>数值型函数</td>
<td>abs(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>comb(n,k)</td>
<td>从n中取k个组合</td>
<td>comb(10,2)  =45</td>
</tr>
<tr>
<td></td>
<td>exp(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>fill()</td>
<td>自动填充数据</td>
<td></td>
</tr>
<tr>
<td></td>
<td>int(x)</td>
<td>取整</td>
<td>int(5.6)=5,int(-5.2)=-5</td>
</tr>
<tr>
<td></td>
<td>ln(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>log10(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>mod(x,y)</td>
<td>模运算</td>
<td></td>
</tr>
<tr>
<td></td>
<td>round(x)</td>
<td>四舍五入</td>
<td></td>
</tr>
<tr>
<td></td>
<td>sqrt(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>sum(x)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>随机函数</td>
<td>uniform()</td>
<td>均匀分布随机数</td>
<td></td>
</tr>
<tr>
<td></td>
<td>invnormal(uniform())</td>
<td>标准正态分布随机数</td>
<td></td>
</tr>
<tr>
<td>字符函数</td>
<td>real(s)</td>
<td>字符型转化为数值型</td>
<td></td>
</tr>
<tr>
<td></td>
<td>string(n)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>substr(s,n1,n2)</td>
<td>从s的第n1个字符开始，截取n2个字符</td>
<td>substr(“family”,3,2) = mi</td>
</tr>
<tr>
<td>这个不行！</td>
<td>word(s,n)</td>
<td>返回s的第n个字符</td>
<td>word(“family”,4)=i</td>
</tr>
<tr>
<td>系统变量</td>
<td>_n</td>
<td>当前观察值的序号</td>
<td></td>
</tr>
<tr>
<td></td>
<td>_N</td>
<td>共有多少观察值</td>
<td></td>
</tr>
<tr>
<td></td>
<td>_pi</td>
<td>圆周率</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="分组函数"><a class="markdownIt-Anchor" href="#分组函数"></a> 分组函数</h4>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">input</span> a b
<span class="token number">1</span> <span class="token number">0</span>
<span class="token number">0</span> <span class="token number">0</span>
<span class="token number">1</span> <span class="token number">1</span>
<span class="token number">0</span> <span class="token number">1</span>
<span class="token number">0</span> <span class="token number">0</span>
<span class="token number">1</span> .
. <span class="token number">0</span>
<span class="token command keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用分组函数：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">egen</span> ab <span class="token operator">=</span> <span class="token function">group</span><span class="token punctuation">(</span>a b<span class="token punctuation">)</span> <span class="token comment">//按a 和b 来进行交叉分组，a=0,b=0 为第一组，…,a=1,b=1 为第四组，缺失值不参与分组</span>
<span class="token command keyword">egen</span> ab2 <span class="token operator">=</span> <span class="token function">group</span><span class="token punctuation">(</span>a b<span class="token punctuation">)</span><span class="token punctuation">,</span>missing <span class="token comment">//将缺失的组当作另外的一组</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="生成范围变量"><a class="markdownIt-Anchor" href="#生成范围变量"></a> 生成范围变量</h4>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">set</span> obs <span class="token number">100</span>
<span class="token command keyword">gen</span> age <span class="token operator">=</span> _n  <span class="token comment">//生成一个假设的年龄变量age，依次取1，2，…，100</span>
<span class="token command keyword">recode</span> age <span class="token punctuation">(</span>min<span class="token operator">/</span><span class="token number">30</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token operator">/</span><span class="token number">60</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">/</span>max<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">gen</span><span class="token punctuation">(</span>agegrp<span class="token punctuation">)</span> <span class="token comment">//生成新的分组变量agegrp,当年龄age 在30 及以下时取值为1，30 到60 为2，60 以上为3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1n-几个环境设置"><a class="markdownIt-Anchor" href="#1n-几个环境设置"></a> 1.n 几个环境设置</h3>
<h4 id="1n1-设置屏幕滚动"><a class="markdownIt-Anchor" href="#1n1-设置屏幕滚动"></a> 1.n.1 设置屏幕滚动</h4>
<p>在列示1 到1000 之前，若先设置<code>set more off</code>，则屏幕不停止；反之<code>set more on</code>会使显示停止。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">set</span> more <span class="token boolean">off</span>
<span class="token command keyword">list</span>
<span class="token command keyword">set</span> more <span class="token boolean">on</span> 
<span class="token command keyword">list</span>
<span class="token command keyword">q</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1n2-设置内存大小"><a class="markdownIt-Anchor" href="#1n2-设置内存大小"></a> 1.n.2 设置内存大小</h4>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">memory</span> <span class="token comment">//查看内存使用情况</span>
<span class="token command keyword">set</span> memory 10m <span class="token comment">//设置内存</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="1n3-设置文件存取路径"><a class="markdownIt-Anchor" href="#1n3-设置文件存取路径"></a> 1.n.3 设置文件存取路径</h4>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">cd</span> d<span class="token punctuation">:</span><span class="token operator">/</span>stata17 <span class="token comment">//定位数据的位置</span>
<span class="token command keyword">dir</span> <span class="token comment">//道当前路径下有哪些文件</span>
<span class="token command keyword">mkdir</span> d<span class="token punctuation">:</span><span class="token operator">/</span>mydata <span class="token comment">//想在D盘的根目录下创建一个新的文件夹mydata来存放数据文件</span>
<span class="token command keyword">cd</span> d<span class="token punctuation">:</span><span class="token operator">/</span>mydata<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1n4-错误提示"><a class="markdownIt-Anchor" href="#1n4-错误提示"></a> 1.n.4 错误提示</h4>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">list</span> myvar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>上述命令试图显示变量myvar，但是结果窗口仅出现如下的显示</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">variable</span> myvar not found
<span class="token command keyword">r</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>红色信息表明，没有找到一个叫<code>myvar</code>的变量，的确，我们的数据中并没有这个变量。<code>list</code> 巧妇难为无米之炊。红色信息下面还有一个天兰色的<code>r(111)</code>，用鼠标点击，即可弹进一个帮助信息框，给出错误的更详尽解释。</p>
<h2 id="1a-流程语句"><a class="markdownIt-Anchor" href="#1a-流程语句"></a> 1a 流程语句</h2>
<h3 id="1a1-循环"><a class="markdownIt-Anchor" href="#1a1-循环"></a> 1a.1 循环</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">capture</span> <span class="token command keyword">drop</span> count5
<span class="token command keyword">program</span> count5
<span class="token command keyword">local</span> i<span class="token operator">=</span><span class="token number">1</span>
<span class="token command keyword">while</span> <span class="token variable">`i'</span><span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">display</span> <span class="token variable">`i'</span>
    <span class="token command keyword">local</span> i <span class="token operator">=</span> <span class="token variable">`i'</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="forvalues"><a class="markdownIt-Anchor" href="#forvalues"></a> forvalues</h4>
<p>更简洁的写法：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">forvalues</span> i <span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">display</span> <span class="token variable">`i'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>步长为负</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">forvalues</span> i<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">display</span> <span class="token variable">`i'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>求和</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">scalar</span> s<span class="token operator">=</span><span class="token number">0</span>
<span class="token command keyword">forvalue</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">scalar</span> s <span class="token operator">=</span> s<span class="token operator">+</span><span class="token variable">`i'</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">scalar</span> list s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="foreach"><a class="markdownIt-Anchor" href="#foreach"></a> foreach</h4>
<p>将student.dta, economy.dta, math.dta 纵向拼接起来</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> student<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">foreach</span> file <span class="token keyword">in</span> economy math<span class="token punctuation">&#123;</span>
    <span class="token command keyword">append</span> using <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`file'</span></span></span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">local</span> flist economy math <span class="token comment">//先将文件名赋于宏flist</span>
<span class="token command keyword">foreach</span> file <span class="token keyword">in</span> <span class="token variable">`flist'</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">append</span> using <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`file'</span></span></span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>(按项循环)：逐行显示粮食（rice wheat flax maize）和货币（Dollar Lira Pound RMB）</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">local</span> grains <span class="token string-literal"><span class="token string">"rice wheat flax maize"</span></span>
<span class="token command keyword">foreach</span> x <span class="token keyword">of</span> local grains<span class="token punctuation">&#123;</span>
    <span class="token command keyword">di</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`x'</span></span></span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">global</span> money <span class="token string-literal"><span class="token string">"Dollar Lira Pound RMB"</span></span>
<span class="token command keyword">foreach</span> y <span class="token keyword">of</span> global money<span class="token punctuation">&#123;</span>
    <span class="token command keyword">di</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`y'</span></span></span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(生成新变量)：生成五个新变量b1,b2,b3,b4,b5，每个变量都是均匀分布随机数</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span> 
<span class="token command keyword">set</span> obs <span class="token number">10</span>
<span class="token command keyword">foreach</span> v <span class="token keyword">of</span> newlist b1<span class="token operator">-</span>b5<span class="token punctuation">&#123;</span>
    <span class="token command keyword">gen</span> <span class="token variable">`v'</span> <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(按数值循环)：逐行显示1 2 3 4 8 105</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">foreach</span> num <span class="token keyword">of</span> numlist <span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token number">8</span> <span class="token number">105</span><span class="token punctuation">&#123;</span>
    <span class="token command keyword">di</span> <span class="token variable">`num'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="1b-命令小结"><a class="markdownIt-Anchor" href="#1b-命令小结"></a> 1b 命令小结</h2>
<table>
<thead>
<tr>
<th>需求帮助</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>help</td>
<td>帮助</td>
</tr>
<tr>
<td>search</td>
<td>网络寻求帮助</td>
</tr>
<tr>
<td>进入某路径</td>
<td></td>
</tr>
<tr>
<td>cd</td>
<td></td>
</tr>
<tr>
<td>设定内存</td>
<td></td>
</tr>
<tr>
<td>set memory 20m</td>
<td>设置STATA 的内存空间为20m</td>
</tr>
<tr>
<td>打开和保存数据</td>
<td></td>
</tr>
<tr>
<td>clear</td>
<td>清空内存</td>
</tr>
<tr>
<td>use</td>
<td>打开stata格式的数据文件</td>
</tr>
<tr>
<td>save</td>
<td>保存内存中的数据</td>
</tr>
<tr>
<td>导入数据</td>
<td></td>
</tr>
<tr>
<td>input</td>
<td></td>
</tr>
<tr>
<td>edit</td>
<td></td>
</tr>
<tr>
<td>infile</td>
<td></td>
</tr>
<tr>
<td>insheet</td>
<td></td>
</tr>
<tr>
<td>重整数据</td>
<td></td>
</tr>
<tr>
<td>append</td>
<td>将有相同结果的数据纵向拼接（观察值拼接）</td>
</tr>
<tr>
<td>merge</td>
<td>将两个数据文件横向拼接</td>
</tr>
<tr>
<td>xpose</td>
<td>数据转置</td>
</tr>
<tr>
<td>reshape</td>
<td></td>
</tr>
<tr>
<td>generate</td>
<td>生成新的数据</td>
</tr>
<tr>
<td>egen</td>
<td>生成新的数据</td>
</tr>
<tr>
<td>rename</td>
<td>变量重命令</td>
</tr>
<tr>
<td>drop</td>
<td>删除变量或观察值</td>
</tr>
<tr>
<td>keep</td>
<td>保留变量或观察值</td>
</tr>
<tr>
<td>sort</td>
<td>对<span style='color:red'>观察值</span>按从小到大顺序重新排列</td>
</tr>
<tr>
<td>order</td>
<td><span style='color:red'>变量顺序</span>的重新排列</td>
</tr>
<tr>
<td>encode</td>
<td>数值型数据转换为字符型数据</td>
</tr>
<tr>
<td>decode</td>
<td>字符型数据转换为数值型数据</td>
</tr>
<tr>
<td>by</td>
<td>分类操作</td>
</tr>
<tr>
<td>报告数据</td>
<td></td>
</tr>
<tr>
<td>describe</td>
<td>总体展示数据情况</td>
</tr>
<tr>
<td>codebook</td>
<td>展示数据库中的每个变量情况</td>
</tr>
<tr>
<td>list</td>
<td>列示<span style='color:red'>内存中</span>的数据</td>
</tr>
<tr>
<td>count</td>
<td>报告共有多少观察值</td>
</tr>
<tr>
<td>inspect</td>
<td>报告变量的分布</td>
</tr>
<tr>
<td>table</td>
<td>数据列表</td>
</tr>
<tr>
<td>tabulate</td>
<td>联列表</td>
</tr>
<tr>
<td>显示和保存输出结果</td>
<td></td>
</tr>
<tr>
<td>display</td>
<td>显示计算结果</td>
</tr>
<tr>
<td>log</td>
<td>将输出结果存放入结果文件</td>
</tr>
</tbody>
</table>
<h2 id="1c-标签数据label"><a class="markdownIt-Anchor" href="#1c-标签数据label"></a> 1c 标签数据：label</h2>
<table>
<thead>
<tr>
<th>命令</th>
<th>命令解释</th>
<th>用法示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>pwd</td>
<td>显示当前路径</td>
<td>pwd</td>
</tr>
<tr>
<td>dir</td>
<td>列示当前路径所有文件</td>
<td>dir</td>
</tr>
<tr>
<td>mkdir</td>
<td>在当前路径下创建一个新的文件夹</td>
<td>mkdir d:/mydata</td>
</tr>
<tr>
<td>label</td>
<td>给数据/变量/变量值增加标注签说明</td>
<td></td>
</tr>
<tr>
<td>label data</td>
<td>标签数据</td>
<td>label data “XX表”</td>
</tr>
<tr>
<td>label var</td>
<td>标签变量</td>
<td>label var name “姓名”</td>
</tr>
<tr>
<td>label value<br/>label define</td>
<td>标签变量值</td>
<td>label values gender genderlb<br/>label define genderlb 1&quot;男&quot;0&quot;女&quot;</td>
</tr>
<tr>
<td>note</td>
<td>为数据加注额外说明</td>
<td>note: 10月8日的数据</td>
</tr>
<tr>
<td>list</td>
<td>列示内存中的数据</td>
<td>list id name</td>
</tr>
<tr>
<td>save</td>
<td>保存数据</td>
<td>save mydata, replace</td>
</tr>
<tr>
<td>erase</td>
<td>删除数据文件</td>
<td>erase mydata.dta,replace</td>
</tr>
</tbody>
</table>
<p>例子：原始数据：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>gender</th>
<th>minority</th>
<th>economy</th>
<th>math</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>John</td>
<td>1</td>
<td>1</td>
<td>40</td>
<td>68</td>
</tr>
<tr>
<td>2</td>
<td>Chris</td>
<td>1</td>
<td>2</td>
<td>80</td>
<td>52</td>
</tr>
<tr>
<td>3</td>
<td>Jack</td>
<td>0</td>
<td>2</td>
<td>90</td>
<td>76</td>
</tr>
<tr>
<td>4</td>
<td>Huang</td>
<td>0</td>
<td>2</td>
<td>43</td>
<td>90</td>
</tr>
<tr>
<td>5</td>
<td>Tom</td>
<td>0</td>
<td>3</td>
<td>70</td>
<td>96</td>
</tr>
<tr>
<td>6</td>
<td>Han</td>
<td>1</td>
<td>1</td>
<td>53</td>
<td>85</td>
</tr>
<tr>
<td>7</td>
<td>Phillip</td>
<td>0</td>
<td>2</td>
<td>85</td>
<td>36</td>
</tr>
<tr>
<td>8</td>
<td>Jin</td>
<td>1</td>
<td>2</td>
<td>95</td>
<td>65</td>
</tr>
</tbody>
</table>
<p>为避免时间太长，忘记变量的含义，我们可以用label 命令来标记。该命令可以用来标记数据文件，如将文件取名为“2007年秋5632班学习成绩单”</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> data “<span class="token number">2007</span>年秋<span class="token number">5632</span>班学习成绩单”<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在文件处理过程中加注说明，命令为notes</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">note</span><span class="token punctuation">:</span> <span class="token number">2007</span>年<span class="token number">9</span>月<span class="token number">6</span>日由任我行创建该数据
<span class="token command keyword">note</span> <span class="token comment">//下一次打开数据，要查看创建和数据处理的说明时，直接键入</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也可以用label 命令来标记变量，如将id 标记为“学号”</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> var id <span class="token string-literal"><span class="token string">"学号"</span></span>
<span class="token command keyword">label</span> var gender “性别 <span class="token number">1</span><span class="token operator">=</span>男 <span class="token number">2</span><span class="token operator">=</span>女”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>还可以标记变量的取值。注意要按以下两步来操作：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> define genderlb <span class="token number">1</span> <span class="token string-literal"><span class="token string">"男"</span></span> <span class="token number">0</span> <span class="token string-literal"><span class="token string">"女"</span></span>
<span class="token command keyword">list</span> <span class="token comment">//注意此时gender 变量显示的值为0 或1</span>
<span class="token command keyword">label</span> values gender genderlb <span class="token comment">////该命令仅仅是显示的变化，实质不变</span>
<span class="token command keyword">list</span> 
<span class="token comment">//注意此时gender 变量显示的值为男或女</span>
<span class="token command keyword">label</span> define minoritylb <span class="token number">1</span><span class="token string-literal"><span class="token string">"汉族"</span></span> <span class="token number">2</span> <span class="token string-literal"><span class="token string">"少数民族"</span></span>
<span class="token command keyword">label</span> values minority minoritylb
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>定义完汉族和少数民族后发现还有些学生的民族是不知道的（原始值为 3），但是下面代码会报错</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> define minoritylb <span class="token number">3</span> <span class="token string-literal"><span class="token string">"不知道"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>label minoritylb already defined</code>，因为minoritylb 已经存在并被定义，我们需要加上选项,add</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> define minoritylb <span class="token number">3</span> <span class="token string-literal"><span class="token string">"不知道"</span></span><span class="token punctuation">,</span> add
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>下面代码依然会报错</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> define minoritylb <span class="token number">3</span> <span class="token string-literal"><span class="token string">"don’t know"</span></span><span class="token punctuation">,</span> add<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>因为3 已被定义，这次不是增加而是修改，所以选项为,modify</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> define minoritylb <span class="token number">3</span> <span class="token string-literal"><span class="token string">"don’t know"</span></span><span class="token punctuation">,</span> modify<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>标签的显示与删除</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">label</span> dir <span class="token comment">//显示标签</span>
<span class="token command keyword">label</span> list <span class="token comment">//显示标签的赋值含义</span>
<span class="token command keyword">label</span> drop minoritylb <span class="token comment">//删除标签</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="2-数据拆分与合并"><a class="markdownIt-Anchor" href="#2-数据拆分与合并"></a> 2. 数据拆分与合并</h2>
<ul>
<li>数据拆分
<ol>
<li>数据横向拆分—— <code>keep</code>&amp; <code>drop</code></li>
<li>数据纵向拆分—— <code>keep</code>&amp; <code>drop</code></li>
<li>一步到位保存数据子集—— <code>savesome</code></li>
</ol>
</li>
<li>数据合并
<ol>
<li>数据的横向合并—— <code>merge</code></li>
<li>数据的纵向合并—— <code>append</code></li>
<li>对多个 <code>csv</code>文件纵向合并—— <code>csvconvert</code></li>
<li>将多列数据转换成一列数据：<code>stack</code> stack a b c d, into(e f)</li>
</ol>
</li>
<li>转置：<code>xpose</code></li>
</ul>
<div align='center'>
    <img src='/../../images/stata笔记/image-20231008171811181.png' width=400px>
</div>
<h3 id="21-长宽数据转换-reshape命令"><a class="markdownIt-Anchor" href="#21-长宽数据转换-reshape命令"></a> 2.1 长宽数据转换—— <code>reshape</code>命令</h3>
<ul>
<li>宽数据转为长数据</li>
<li>长数据转为宽数据</li>
</ul>
<blockquote>
<p>数据文件下载：<a href='/local_file/data_file.zip' target='_blank'>地址</a></p>
</blockquote>
<h3 id="22-数据拆分"><a class="markdownIt-Anchor" href="#22-数据拆分"></a> 2.2 数据拆分</h3>
<p>如果把内存中的数据集视为一个矩阵，则我们对数据的基本操作包括两类：删除列或删除行。对于 Stata 而言，命令的主要操作对象是变量 (矩阵的列)，而有些时候我们也需要删除特定的观察值 (矩阵的行)。这些操作都可以配合使用 <code>drop</code> 和 <code>keep</code> 命令来实现。</p>
<h4 id="221-删除保留变量数据的横向拆分"><a class="markdownIt-Anchor" href="#221-删除保留变量数据的横向拆分"></a> 2.2.1 删除\保留变量：数据的横向拆分</h4>
<p>原始数据有时包含过多的变量，但在实际应用中可能根据需要将原始数据拆分为不同的数据表，这时就要实现数据的横向拆分。数据的横向拆分用到的两个命令为 <code>drop</code> 和 <code>keep</code>。</p>
<blockquote>
<p>Stata 范例：</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">drop</span> weight length
<span class="token command keyword">save</span> <span class="token string-literal"><span class="token string">"d:\data\auto_sim01.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们调入数据后，使用 <code>drop</code> 命令删除了两个变量，进而把处理后的数据文件另存到 <code>D:\data</code> 文件夹中。若该文件夹下已经存在一个名称为 <code>auto_sim01.dta</code> 则自动覆盖之，这是 <code>replace</code> 选项的作用。</p>
<p>按照上述思路，也就不难理解如下命令的含义了：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">keep</span> make price mpg rep78 foreign
<span class="token command keyword">save</span> <span class="token string-literal"><span class="token string">"d:\data\auto_sim02.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>特别说明： 一般而言，除非数据文件非常大导致每次调入耗时较长，我们很少另存数据文件。我们会将主要的修改动作都保留于 dofile 中。每次分析时，只需修改 dofile 或执行 dofile 中的特定语句即可实现对子样本的处理。毕竟，dofile 本质上是文本文件，文件大小通常不过几十k。</p>
</blockquote>
<h4 id="222-删除保留观察值数据的纵向拆分"><a class="markdownIt-Anchor" href="#222-删除保留观察值数据的纵向拆分"></a> 2.2.2 删除\保留观察值：数据的纵向拆分</h4>
<p>原始数据有时包含过多的样本观测值，但在实际应用中可能根据需要将其按某种特征拆分为不同的数据表，这是就要实现数据的纵向拆分。此时，仍然可以使用 <code>drop</code> 和 <code>keep</code> 命令。</p>
<p>例如将 <code>auto.dta</code> 数据文件拆分为两个数据文件：<code>auto_domestic.dta</code> 和 <code>auto_foreign.dta</code>，操作如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">keep</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span>
<span class="token command keyword">save</span> auto_domestic.dta<span class="token punctuation">,</span> replace 
<span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">keep</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">1</span>
<span class="token command keyword">save</span> auto_foreign.dta<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="223-一步到位保存数据子集-savesome-命令"><a class="markdownIt-Anchor" href="#223-一步到位保存数据子集-savesome-命令"></a> 2.2.3 一步到位保存数据子集： <code>savesome</code> 命令</h4>
<p>通过上述范例可以看出，使用 Stata 自带的 <code>keep</code> 和 <code>drop</code> 命令可以快捷地删除变量或观察值，但在命令写法上较为繁琐。我们可以使用外部命令 <code>savesome</code> 来提高效率 （该命令是 Stata 官方命令 <code>save</code> 的扩展版）：</p>
<ul>
<li>安装程序文件：</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">ssc</span> install savesome<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在命令窗口中输入 <code>help savesome</code> 可以查看该命令的帮助文件，其语法格式如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">savesome</span> <span class="token punctuation">[</span><span class="token keyword">varlist</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">if</span> exp<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">in</span> range<span class="token punctuation">]</span> using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> old save_options<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中，</p>
<ul>
<li><code>using filename</code> 表示要保存的子集文件名及文件路径；</li>
<li><code>old</code> 是较为重要的选项，可以将数据保存为较低版本的文件格式，如 stata15 用户可以将数据另存为在 stata14 或以下版本中的打开的数据文件。类似的命令还有 Stata 官方命令 <code>saveold</code>。</li>
</ul>
<p>对于前文提到的例子，我们可以使用 <code>savesome</code> 来实现相同的功能：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> clearkeep make price mpg rep78 foreignsave <span class="token string-literal"><span class="token string">"d:\data\auto_sim02.dta"</span></span><span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>等价于</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">savesome</span> make price mpg rep78 foreign <span class="token comment">/// using "d:\data\auto_sim02.dta", replace</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>评论： 凭心而论，笔者更喜欢前一种方式。虽然多写了一行命令，但思路清晰，也便于记忆。</p>
<blockquote>
<p>Stata 范例 2：</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">keep</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span>
<span class="token command keyword">save</span> auto_domestic.dta<span class="token punctuation">,</span> replace <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>等价于：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> <span class="token string-literal"><span class="token string">"auto.dta"</span></span><span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">savesome</span> <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span> using auto_domestic.dta<span class="token punctuation">,</span> replace <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="24-数据合并"><a class="markdownIt-Anchor" href="#24-数据合并"></a> 2.4 数据合并</h3>
<h4 id="241-数据的横向合并"><a class="markdownIt-Anchor" href="#241-数据的横向合并"></a> 2.4.1 数据的横向合并</h4>
<p>数据的横向合并是横向拆分的逆操作，但是其要比拆分复杂。对于时间序列资料而言，要保证同一时点的两个变量的观察值对接到同一行；而对于界面个体资料而言，要保证同一个人的年龄数据与该人的收入数据在同一行。而对于面板数据资料，则需数据中有两个变量能够唯一标示每一行观察值，以保证 A 数据文件中的 “张三疯-2016” 与 B 数据文件中的 “张三疯-2016” 处于同一行。合并所使用的命令语句为 <code>merge</code>，具体语句如下所示：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">merge</span> <span class="token punctuation">[</span><span class="token keyword">varlist</span><span class="token punctuation">]</span> using filename <span class="token punctuation">[</span>filename ...<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>merge</code>为合并的命令语句， <code>[varlist]</code>代表合并进去的新变量， <code>using filename</code>指的是所要与原文件合并的文件路径， <code>options</code>包含较多的功能，下表显示了其具体内容。</p>
<table>
<thead>
<tr>
<th>keep(varlist)</th>
<th>只保留filename中特定的变量</th>
</tr>
</thead>
<tbody>
<tr>
<td>_merge(newvar)</td>
<td>合并之后生成新变量,默认名称为_merge</td>
</tr>
<tr>
<td>nolabel</td>
<td>不要复制flename中所定义的标签</td>
</tr>
<tr>
<td>nonotes</td>
<td>不要复制filename中所定义的注释</td>
</tr>
<tr>
<td>update</td>
<td>用flename中的数据代替内存中的缺失值。</td>
</tr>
<tr>
<td>replace</td>
<td>用flename  中的数据代替内存中的非缺失值。</td>
</tr>
<tr>
<td>nokeep</td>
<td>删除数据库中不能匹配的观测值</td>
</tr>
<tr>
<td>nosummary</td>
<td>删除summary变量</td>
</tr>
<tr>
<td>unique</td>
<td>匹配变量在原文件与合并文件中都是唯一的。</td>
</tr>
<tr>
<td>unigmaster</td>
<td>匹配变量在原文件中必须是唯一的</td>
</tr>
<tr>
<td>uniqusing</td>
<td>匹配变量在合并文件中必须是唯一的</td>
</tr>
</tbody>
</table>
<p><em>举例</em>：利用横向拆分实验中生成的数据文件 <code>waterinput</code> 和 <code>wateroutput</code>实现数据的横向合并，匹配变量为 <code>year</code>，生成新的数据文件命名为 <code>waternew</code>。这个操作的命令为：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> c<span class="token punctuation">:</span>\data\wateroutput<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">sort</span> year <span class="token comment">//按year排序</span>
<span class="token command keyword">save</span> c<span class="token punctuation">:</span>\data\wateroutput<span class="token punctuation">,</span> replace <span class="token comment">//重新保存一下</span>
<span class="token command keyword">use</span> c<span class="token punctuation">:</span>\data\waterinput<span class="token punctuation">,</span> <span class="token keyword">clear</span> <span class="token comment">//打开新的数据文件</span>
<span class="token command keyword">sort</span> year <span class="token comment">//按year排序</span>
<span class="token command keyword">merge</span> year using c<span class="token punctuation">:</span>\data\wateroutput <span class="token comment">//以year为关联，将两个表合并</span>
<span class="token command keyword">save</span> c<span class="token punctuation">:</span>\data\waternew<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在以上命令语句中，</p>
<ul>
<li>第一个命令语句实现了 <code>wateroutput</code>数据文件的打开</li>
<li>第二个命令语句将文件按年份变量进行排序</li>
<li>第三个命令语句保存了排序之后的数据文件</li>
<li>第四个命令语句实现了 <code>waterinput</code>数据文件的打开</li>
<li>第五个命令语句将此数据按年份变量进行排序</li>
<li>第六个命令语句按年份变量将 <code>wateroutput</code>文件合并到 <code>waterinput</code>文件中</li>
<li>第七个命令语句保存合并之后的数据文件。</li>
</ul>
<h4 id="242-数据的纵向合并"><a class="markdownIt-Anchor" href="#242-数据的纵向合并"></a> 2.4.2 数据的纵向合并</h4>
<p>数据的纵向合并为数据纵向拆分的逆操作，使用的主要命令为 <code>append</code>命令，具体语句如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">append</span> using filename <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在这个命令语句中， <code>append</code>是进行纵向合并的命令语句， <code>using filename</code>是进行纵向合并的文件路径， <code>[, options]</code>的内容与 <code>merge</code>相似，但更为简化。</p>
<p>例如，利用纵向拆分实验中生成的数据文 <code>domesticauto</code>和 <code>foreignauto</code>实现数据的纵向合并，生成的数据文件命名为 <code>usaautonew</code>。这个操作的命令为：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">use</span> c<span class="token punctuation">:</span>\data\domesticauto<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">append</span> using c<span class="token punctuation">:</span>\data\foreignauto
<span class="token command keyword">save</span> c<span class="token punctuation">:</span>\data\usaautonew<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在以上命令中，第一个命令语句打开了原始数据文件，第二个命令将 <code>foreignauto</code>文件合并到 <code>domesticauto</code>文件中，第三个命令语句存储了合并后的数据文件。</p>
<h4 id="243-一次合并多个csv文件-csvconvert"><a class="markdownIt-Anchor" href="#243-一次合并多个csv文件-csvconvert"></a> 2.4.3 一次合并多个csv文件—— <code>csvconvert</code></h4>
<p><code>csvconvert</code> 命令用于将多个 <code>csv</code>格式文件合并为一个 <code>.dta</code>格式文件，比较适合处理具有时间周期性特点的变量。命令：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> input_directory<span class="token punctuation">,</span> replace <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该命令有三个参数：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">output_file(file_name)</td>
<td style="text-align:left">设置输出文件名</td>
</tr>
<tr>
<td style="text-align:left">output_dir(output_directory)</td>
<td style="text-align:left">设置输出路径</td>
</tr>
<tr>
<td style="text-align:left">input_file(.csv file list)</td>
<td style="text-align:left">选择要合并的文件</td>
</tr>
</tbody>
</table>
<p>命令下载：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">help</span> csvconvert<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以命令配套的四个世界银行文件为例，首先看文件结构</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">dir</span> C<span class="token punctuation">:</span>\Uers\Administrator\Desktop\stata学习文件\worldbank\<span class="token operator">*</span>.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>Country  Name</th>
<th>Country Code</th>
<th>Year</th>
<th>YearCode</th>
<th>GDP (current  US$)</th>
<th>Population,  total</th>
</tr>
</thead>
<tbody>
<tr>
<td>United States</td>
<td>USA</td>
<td>2010</td>
<td>YR2010</td>
<td>1. 46E+13</td>
<td>309050816</td>
</tr>
<tr>
<td>United Kingdom</td>
<td>GBR</td>
<td>2010</td>
<td>YR2010</td>
<td>2.25E+12</td>
<td>62218761</td>
</tr>
<tr>
<td>Canada</td>
<td>CAN</td>
<td>2010</td>
<td>YR2010</td>
<td>1.57E+12</td>
<td>34108752</td>
</tr>
</tbody>
</table>
<p>使用 <code>csvconvert</code>命令将四个年度数据纵向合并</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> C<span class="token punctuation">:</span>\Users\Administrator\Desktop\stata学习文件\worldbank<span class="token punctuation">,</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th></th>
<th>countryname</th>
<th>countrycode</th>
<th>year</th>
<th>yearcode</th>
<th>gdpcurrentus</th>
<th>population~l</th>
<th>_csvfile</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>United  States</td>
<td>USA</td>
<td>2010</td>
<td>YR2010</td>
<td>1.458e+13</td>
<td>309050816</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>2</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2010</td>
<td>YR2010</td>
<td>2.246e+12</td>
<td>62218761</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>3</td>
<td>Canada</td>
<td>CAN</td>
<td>2010</td>
<td>YR2010</td>
<td>1.574e+12</td>
<td>34108752</td>
<td>wb2010.  csv</td>
</tr>
<tr>
<td>4</td>
<td>United  States</td>
<td>USA</td>
<td>2009</td>
<td>YR2009</td>
<td>1.404e+13</td>
<td>307007000</td>
<td>wb2009.  csv</td>
</tr>
<tr>
<td>5</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2009</td>
<td>YR2009</td>
<td>2.173e+122</td>
<td>61801570</td>
<td>wb2009。  csv</td>
</tr>
<tr>
<td>6</td>
<td>Canada</td>
<td>CAN</td>
<td>2009</td>
<td>YR2009</td>
<td>1.336e+12</td>
<td>33739900</td>
<td>wb2009.  Csv</td>
</tr>
<tr>
<td>7</td>
<td>United  States</td>
<td>USA</td>
<td>2008</td>
<td>YR2008</td>
<td>1.430e+13</td>
<td>304375000</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>8</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2008</td>
<td>YR2008</td>
<td>2.657e+12</td>
<td>61393521</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>9</td>
<td>Canada</td>
<td>CAN</td>
<td>2008</td>
<td>YR2008</td>
<td>1.499e+12</td>
<td>33311400</td>
<td>wb2008.  Csv</td>
</tr>
<tr>
<td>10</td>
<td>United  States</td>
<td>USA</td>
<td>2007</td>
<td>YR2007</td>
<td>1.400e+13</td>
<td>301580000</td>
<td>wb2007.  csv</td>
</tr>
<tr>
<td>11</td>
<td>United  Kingdom</td>
<td>GBR</td>
<td>2007</td>
<td>YR2007</td>
<td>2.811e+12</td>
<td>60986649</td>
<td>wb2007.  csv</td>
</tr>
<tr>
<td>12</td>
<td>Canada</td>
<td>CAN</td>
<td>2007</td>
<td>YR2007</td>
<td>1.424e+12</td>
<td>32976000</td>
<td>wb2007.  csv</td>
</tr>
</tbody>
</table>
<p>要合并的四个子文件必须在同一个文件夹中，默认情况下， <code>csvconvert</code>命令会合并文件夹中所有文件 ，可以用 <code>note</code> 命令核对所合并的文件情况 .用 <code>input_file</code>参数选择所有合并的文件名，在此，我们只选择2008年度和2009年度的数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">csvconvert</span> C<span class="token punctuation">:</span>\Users\Administrator\Desktop\stata学习文件\worldbank<span class="token punctuation">,</span> replace <span class="token function">input_file</span><span class="token punctuation">(</span>wb2008.csv wb2009.csv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="25-数据重整"><a class="markdownIt-Anchor" href="#25-数据重整"></a> 2.5 数据重整</h3>
<p>举个例子更好理解：数据集mywide.dta共有六个变量，其中后四个变量分别为2003年和2004年的数据成绩和经济学成绩，现要求将数据转化为mylong.dta的格式，将年份单独做成变量，数学和经济学成绩则成为两个单独变量。</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>math2003</th>
<th>math2004</th>
<th>economy2003</th>
<th>economy2004</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>John</td>
<td>40</td>
<td>13</td>
<td>68</td>
<td>55</td>
</tr>
<tr>
<td>2</td>
<td>Chris</td>
<td>80</td>
<td>64</td>
<td>52</td>
<td>87</td>
</tr>
<tr>
<td>3</td>
<td>Jack</td>
<td>90</td>
<td>55</td>
<td>76</td>
<td>25</td>
</tr>
<tr>
<td>4</td>
<td>Huang</td>
<td>43</td>
<td>60</td>
<td>90</td>
<td>4</td>
</tr>
<tr>
<td>5</td>
<td>Tom</td>
<td>70</td>
<td>68</td>
<td>96</td>
<td>42</td>
</tr>
<tr>
<td>6</td>
<td>Han</td>
<td>53</td>
<td>10</td>
<td>85</td>
<td>89</td>
</tr>
<tr>
<td>7</td>
<td>Phillip</td>
<td>85</td>
<td>61</td>
<td>36</td>
<td>52</td>
</tr>
<tr>
<td>8</td>
<td>Jin</td>
<td>95</td>
<td>6</td>
<td>65</td>
<td>84</td>
</tr>
</tbody>
</table>
<p>想要转化为如下格式：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>year</th>
<th>math</th>
<th>economy</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>John</td>
<td>2003</td>
<td>40</td>
<td>68</td>
</tr>
<tr>
<td>2</td>
<td>John</td>
<td>2004</td>
<td>13</td>
<td>55</td>
</tr>
<tr>
<td>3</td>
<td>Chris</td>
<td>2003</td>
<td>80</td>
<td>52</td>
</tr>
<tr>
<td>4</td>
<td>Chris</td>
<td>2004</td>
<td>64</td>
<td>87</td>
</tr>
<tr>
<td>5</td>
<td>Jack</td>
<td>2003</td>
<td>90</td>
<td>76</td>
</tr>
<tr>
<td>6</td>
<td>Jack</td>
<td>2004</td>
<td>55</td>
<td>25</td>
</tr>
<tr>
<td>7</td>
<td>Huang</td>
<td>2003</td>
<td>43</td>
<td>90</td>
</tr>
<tr>
<td>8</td>
<td>Huang</td>
<td>2004</td>
<td>60</td>
<td>4</td>
</tr>
<tr>
<td>9</td>
<td>Tom</td>
<td>2003</td>
<td>70</td>
<td>96</td>
</tr>
<tr>
<td>10</td>
<td>Tom</td>
<td>2004</td>
<td>68</td>
<td>42</td>
</tr>
<tr>
<td>11</td>
<td>Han</td>
<td>2003</td>
<td>53</td>
<td>85</td>
</tr>
<tr>
<td>12</td>
<td>Han</td>
<td>2004</td>
<td>10</td>
<td>89</td>
</tr>
<tr>
<td>13</td>
<td>Phillip</td>
<td>2003</td>
<td>85</td>
<td>36</td>
</tr>
<tr>
<td>14</td>
<td>Phillip</td>
<td>2004</td>
<td>61</td>
<td>52</td>
</tr>
<tr>
<td>15</td>
<td>Jin</td>
<td>2003</td>
<td>95</td>
<td>65</td>
</tr>
<tr>
<td>16</td>
<td>Jin</td>
<td>2004</td>
<td>6</td>
<td>84</td>
</tr>
</tbody>
</table>
<p>先输入数据</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">set</span> obs <span class="token number">8</span>
<span class="token command keyword">gen</span> id <span class="token operator">=</span> _n
<span class="token command keyword">input</span> str10 name int math2003 math2004 economy2003 economy2004
<span class="token command keyword">John</span> <span class="token number">40</span> <span class="token number">13</span> <span class="token number">68</span> <span class="token number">55</span>
<span class="token command keyword">Chris</span> <span class="token number">80</span> <span class="token number">64</span> <span class="token number">52</span> <span class="token number">87</span>
<span class="token command keyword">Jack</span> <span class="token number">90</span> <span class="token number">55</span> <span class="token number">76</span> <span class="token number">25</span>
<span class="token command keyword">Huang</span> <span class="token number">43</span> <span class="token number">60</span> <span class="token number">90</span> <span class="token number">4</span>
<span class="token command keyword">Tom</span> <span class="token number">70</span> <span class="token number">68</span> <span class="token number">96</span> <span class="token number">42</span>
<span class="token command keyword">Han</span> <span class="token number">53</span> <span class="token number">10</span> <span class="token number">85</span> <span class="token number">89</span>
<span class="token command keyword">Phillip</span> <span class="token number">85</span> <span class="token number">61</span> <span class="token number">36</span> <span class="token number">52</span>
<span class="token command keyword">Jin</span> <span class="token number">95</span> <span class="token number">6</span> <span class="token number">65</span> <span class="token number">84</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实现代码为：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">reshape</span> long math economy<span class="token punctuation">,</span> <span class="token function">i</span><span class="token punctuation">(</span>id name<span class="token punctuation">)</span> <span class="token function">j</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span>
<span class="token command keyword">save</span> mylong<span class="token punctuation">,</span> replace
<span class="token command keyword">export</span> excel using <span class="token string-literal"><span class="token string">"mylong.xls"</span></span><span class="token punctuation">,</span><span class="token function">firstrow</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span> replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>窗口输出内容</p>
<table>
<thead>
<tr>
<th>Data</th>
<th>Wide</th>
<th>-&gt;</th>
<th>Long</th>
</tr>
</thead>
<tbody>
<tr>
<td>Number of Observations</td>
<td>8</td>
<td>-&gt;</td>
<td>16</td>
</tr>
<tr>
<td>Number of variables</td>
<td>6</td>
<td>-&gt;</td>
<td>5</td>
</tr>
<tr>
<td>j variables(2 vlues)</td>
<td></td>
<td>-&gt;</td>
<td>year</td>
</tr>
<tr>
<td>xij variables:</td>
<td></td>
<td>-&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td>math2003 math2004</td>
<td>-&gt;</td>
<td>math</td>
</tr>
<tr>
<td></td>
<td>economy2003 economy2004</td>
<td>-&gt;</td>
<td>economy</td>
</tr>
</tbody>
</table>
<h2 id="3-绘图"><a class="markdownIt-Anchor" href="#3-绘图"></a> 3. 绘图</h2>
<p>例子</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">twoway</span><span class="token punctuation">(</span>scatter mpg weight <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token punctuation">(</span>scatter mpg weight <span class="token keyword">if</span> foreign<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">msymbol</span><span class="token punctuation">(</span>Sh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">/*曲线选项，点的类型*/</span> <span class="token comment">///</span>
	<span class="token punctuation">,</span> <span class="token comment">///</span>
	<span class="token command keyword">title</span><span class="token punctuation">(</span>标题：行驶里程与车重关系<span class="token punctuation">)</span> <span class="token comment">///</span>
	<span class="token command keyword">subtitle</span><span class="token punctuation">(</span>副标题：国产与进口<span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token command keyword">ytitle</span><span class="token punctuation">(</span>纵坐标标题<span class="token punctuation">)</span> <span class="token comment">///</span>
	<span class="token command keyword">xtitle</span><span class="token punctuation">(</span>横坐标标题<span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token command keyword">note</span><span class="token punctuation">(</span>数据来源：美国汽车协会<span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token command keyword">text</span><span class="token punctuation">(</span><span class="token number">35</span> <span class="token number">3400</span> <span class="token string-literal"><span class="token string">"曲线类型"</span></span><span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token command keyword">legend</span><span class="token punctuation">(</span><span class="token function">title</span><span class="token punctuation">(</span>图例<span class="token punctuation">)</span> <span class="token function">label</span><span class="token punctuation">(</span><span class="token number">1</span> 国产车<span class="token punctuation">)</span> <span class="token function">label</span><span class="token punctuation">(</span><span class="token number">2</span> 进口车<span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">///</span>
	<span class="token command keyword">scheme</span><span class="token punctuation">(</span>slrcolor<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>各类图</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">scatter</span> rainfall year <span class="token comment">//点</span>
<span class="token command keyword">line</span> rainfall year <span class="token comment">//线</span>
<span class="token command keyword">tw</span> area rainfall year <span class="token comment">//面</span>
<span class="token comment">///////////////////////////</span>
<span class="token command keyword">net</span> install vgsg2<span class="token punctuation">,</span>replace
<span class="token command keyword">vguse</span> allstates<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">tw</span> histogram popk <span class="token comment">//直方图</span>
<span class="token command keyword">tw</span> kdensity popk <span class="token comment">//核估计图</span>
<span class="token command keyword">graph</span> bar popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>division<span class="token punctuation">)</span> <span class="token comment">//条形图</span>
<span class="token command keyword">graph</span> hbar popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>division<span class="token punctuation">)</span>  <span class="token comment">//条形图</span>
<span class="token command keyword">graph</span> hbox popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>division<span class="token punctuation">)</span> <span class="token comment">//箱型图</span>
<span class="token command keyword">graph</span> box popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>division<span class="token punctuation">)</span> <span class="token comment">//箱型图</span>
<span class="token command keyword">graph</span> pie popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span> <span class="token comment">//饼图</span>
<span class="token command keyword">graph</span> matrix propval100 rent700 popden <span class="token comment">//矩阵图</span>
<span class="token command keyword">graph</span> dot popk<span class="token punctuation">,</span> <span class="token function">over</span><span class="token punctuation">(</span>division<span class="token punctuation">)</span> <span class="token comment">//点阵图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>股价数据图</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">vguse</span> spjanfeb2001<span class="token punctuation">,</span> <span class="token keyword">clear</span>
<span class="token command keyword">twoway</span> dropline close tradeday <span class="token comment">//</span>
<span class="token command keyword">tw</span> spike close tradeday <span class="token comment">//针式图</span>
<span class="token command keyword">tw</span> dot close tradeday <span class="token comment">//点线图</span>
<span class="token command keyword">tw</span> connected close tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//点连线图</span>
<span class="token command keyword">tw</span> area close tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//和线图类似，显示线以下的面积</span>
<span class="token command keyword">tw</span> bar close tradeday<span class="token punctuation">,</span><span class="token keyword">sort</span> <span class="token comment">/*对每个X绘出相应Y的条图，而graph bar是针对
分类变量X的*/</span>
<span class="token command keyword">twoway</span> rarea high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//显示最高与最低价，并填充两者之间的面积</span>
<span class="token command keyword">tw</span> rline high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//显示最高与最低价，但不填充其间</span>
<span class="token command keyword">tw</span> rconnected high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//显示最低与最高为两点，并连接起来</span>
<span class="token command keyword">tw</span> rscatter high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//显示最低与最高为两点，不连接</span>
<span class="token command keyword">tw</span> rcap high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//两端用小横线标示</span>
<span class="token command keyword">tw</span> rspike high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//两端用点标示</span>
<span class="token command keyword">tw</span> rcapsym high low tradeday<span class="token punctuation">,</span> <span class="token keyword">sort</span>
对时间序列数据，可以先设定时期，简化命令
<span class="token command keyword">tsset</span> tradeday <span class="token comment">//X轴为时间，由tsset设定.</span>
<span class="token command keyword">twoway</span> tsline close<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//tsline用于时间序列数据，收盘价</span>
<span class="token command keyword">tw</span> tsrline high low<span class="token punctuation">,</span> <span class="token keyword">sort</span> <span class="token comment">//最高价与最低价</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3astata命令语句格式"><a class="markdownIt-Anchor" href="#3astata命令语句格式"></a> 3a.STATA命令语句格式</h2>
<p>很高级，不会，收录只是为了方便查阅</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">capture</span> <span class="token command keyword">program</span> drop gini
<span class="token command keyword">program</span> gini
<span class="token command keyword">syntax</span> <span class="token keyword">varlist</span> <span class="token punctuation">[</span><span class="token keyword">if</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">in</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token function">title</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">//设定我们自己的命令格式</span>
<span class="token command keyword">tempvar</span> tinc tp m gini <span class="token comment">//设定tinc tp m gini 四个变量为临时变量</span>
<span class="token command keyword">marksample</span> touse <span class="token comment">//生成一个0/1 暂元，暂元名为touse</span>
<span class="token command keyword">preserve</span> <span class="token comment">//将当前内存中数据暂封存，直到restore 命令再复原</span>
<span class="token command keyword">quietly</span> <span class="token punctuation">&#123;</span> <span class="token comment">//大括号内的命令将在后台执行，前台无显示</span>
	<span class="token command keyword">keep</span> <span class="token keyword">if</span> <span class="token variable">`touse'</span> <span class="token comment">//根据if 后输入的条件得到一个子数据</span>
	<span class="token command keyword">egen</span> <span class="token variable">`tinc'</span><span class="token operator">=</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">`1'</span><span class="token punctuation">)</span> <span class="token comment">//生成总收入，将总收入数据暂存在临时变量’tinc’中</span>
	<span class="token command keyword">if</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`2'</span></span></span><span class="token string">"</span></span><span class="token operator">==</span><span class="token string-literal"><span class="token string">""</span></span> <span class="token punctuation">&#123;</span>
		<span class="token command keyword">local</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">1</span>
	<span class="token punctuation">&#125;</span> <span class="token comment">//如果没有人口变量，则默认为该变量为1</span>
	<span class="token command keyword">egen</span> <span class="token variable">`tp'</span><span class="token operator">=</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">`2'</span><span class="token punctuation">)</span>
	<span class="token command keyword">gen</span> <span class="token variable">`m'</span><span class="token operator">=</span><span class="token variable">`1'</span><span class="token operator">/</span><span class="token variable">`2'</span>
	<span class="token command keyword">sort</span> <span class="token variable">`m'</span>
	<span class="token command keyword">gen</span> <span class="token variable">`gini'</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">-</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">`2'</span><span class="token operator">/</span><span class="token variable">`tp'</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">`1'</span><span class="token operator">/</span><span class="token variable">`tinc'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token variable">`1'</span><span class="token operator">/</span><span class="token variable">`tinc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token command keyword">display</span> as result <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token expression"><span class="token variable">`title'</span></span></span><span class="token string">基尼系数为："</span></span> as error <span class="token variable">`gini'</span><span class="token punctuation">[</span>_N<span class="token punctuation">]</span> <span class="token comment">//显示基尼系数</span>
<span class="token command keyword">restore</span>
<span class="token command keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-pythonstata"><a class="markdownIt-Anchor" href="#4-pythonstata"></a> 4. Python+Stata</h2>
<p>stata在数据处理与分析方面具有一定的优势，而且软件又小，在配置一般的PC机里运行也较为流畅。</p>
<h3 id="41-另外保存do文件在python中运行外部do文件"><a class="markdownIt-Anchor" href="#41-另外保存do文件在python中运行外部do文件"></a> 4.1 另外保存do文件，在python中运行外部do文件</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> codecs
<span class="token keyword">import</span> os
<span class="token comment">#使用的stata软件路径</span>
stata_path<span class="token operator">=</span><span class="token string">"/Applications/Stata 16/StataSE.app"</span>
<span class="token comment">#要运行的代码路径</span>
dofile_path<span class="token operator">=</span><span class="token string">"/Users/juncker/dlog/public/local_file/《应用计量经济学讲稿》配套dofile.do"</span>
<span class="token comment">#cmd中三个参数分别为：stata软件路径、命令、do文件路径</span>
cmd <span class="token operator">=</span> <span class="token punctuation">[</span>stata_path<span class="token punctuation">,</span> <span class="token string">"doedit"</span><span class="token punctuation">,</span> dofile_path<span class="token punctuation">]</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="42-有时会遇到改变do文档内容的情形因此需要在python中写一个do文档"><a class="markdownIt-Anchor" href="#42-有时会遇到改变do文档内容的情形因此需要在python中写一个do文档"></a> 4.2 有时会遇到改变do文档内容的情形，因此需要在python中写一个do文档</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">varstr<span class="token operator">=</span><span class="token string">'price length weight'</span>
code<span class="token operator">=</span><span class="token triple-quoted-string string">'''clear all
sysuse auto
sum
reg '''</span>
statacode<span class="token operator">=</span>code<span class="token operator">+</span>varstr <span class="token comment">#自己编写的do文件代码，不过当前是字符转格式，下一步是将其写入一个do文件</span>
<span class="token keyword">with</span> codecs<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dofile_2.do'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>statacode<span class="token punctuation">)</span>
  f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
cmd <span class="token operator">=</span> <span class="token punctuation">[</span>stata_path<span class="token punctuation">,</span> <span class="token string">"do"</span><span class="token punctuation">,</span> dofile_path<span class="token punctuation">]</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
<span class="token comment"># 关闭stata</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'TASKKILL /F /IM StataMP-64.exe'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="43-在python和stata中传递数据最容易想到的一个思路是将要传递的内容保存下来然后python或stata再读取数据"><a class="markdownIt-Anchor" href="#43-在python和stata中传递数据最容易想到的一个思路是将要传递的内容保存下来然后python或stata再读取数据"></a> 4.3 在python和stata中传递数据（最容易想到的一个思路是将要传递的内容保存下来，然后python或stata再读取数据）</h3>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token operator">#</span> 以stata向python传递数据为例
<span class="token operator">#</span> 首先生成一个stata数据
<span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span><span class="token keyword">clear</span>
<span class="token command keyword">keep</span> price
<span class="token command keyword">export</span> delimited price using <span class="token string-literal"><span class="token string">"statatest.txt"</span></span><span class="token punctuation">,</span> <span class="token function">delimiter</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span> novarnames replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python读取数据</span>
<span class="token keyword">import</span> codecs
<span class="token keyword">with</span> codecs<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'statatest.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  data<span class="token operator">=</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
  f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">import</span> re
<span class="token comment"># 读取的数据包含空格和换行，通过正则表达式提取数据</span>
datamatch<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[\d]*'</span><span class="token punctuation">)</span>
data2<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> re
<span class="token keyword">for</span> s <span class="token keyword">in</span> data<span class="token punctuation">:</span>
  s<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>datamatch<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>
  data2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>PS：</p>
<p>github上有一个ipystata的包可以<a href='https://github.com/TiesdeKok/ipystata' target='_blank'>通过Jupyter在python中使用stata</a>，或者可以参考<a href='https://zhuanlan.zhihu.com/p/22645950' target='_blank'>这篇文章</a>。</p>
<h2 id="5-stata中的mata"><a class="markdownIt-Anchor" href="#5-stata中的mata"></a> 5. Stata中的Mata</h2>
<h3 id="51-mata-基础语法"><a class="markdownIt-Anchor" href="#51-mata-基础语法"></a> 5.1 Mata 基础语法</h3>
<p>在正式介绍 Mata 程序编写之前，我们必须了解 Mata 的基础语法，如注释方式、基础运算符、循环、条件语句等。</p>
<h4 id="511-注释方式-comments"><a class="markdownIt-Anchor" href="#511-注释方式-comments"></a> 5.1.1 注释方式 (Comments)</h4>
<p>相较 Stata 的 <code>*</code>，Mata 中的注释方式发生了较大改变。如果不事先了解 Mata 的注释方式，那么在命令语句写作和运行中可能会多次报错。输入 <code>help mata comments</code>，可查看相关 help 文档。</p>
<p>Mata 的语句注释分为以下两类：</p>
<ol>
<li><code>/* enclosed comment */</code></li>
<li><code>// rest-of-line comment</code></li>
</ol>
<p>注意点：(1) 注释语句可以出现在 do-files 和 ado-files 中；但不能够在命令窗口的交互状态下使用 (在命令窗口输入 <code>mata</code> 即可进入 Mata 交互状态)。(2) Stata 中利用 “*” 注释在 Mata 中是不允许的。</p>
<p>故在运行命令时有以下注意点：（1）在 Mata 状态下， 由双斜线引导的注释语句在命令窗口中必须连同双斜线一起删除才能 (在命令窗口) 执行 。但在 Do 文件编辑窗口中编写的语句不必删除注释语句，选中全部语句执行即可。（2）Mata 状态下，在 Do 文件编辑窗口中编写的语句不能单独执行。</p>
<p>为更好掌握语法，建议读者在 Stata 命令窗口中输入 <code>mata</code> 进入 Mata 环境 (可通过 <code>end</code> 退出)，再将下文中的命令语句删去由 // 注释的文字后，逐行输入命令窗口以感受运算过程。（当然，也可以整体粘贴入 do-file 中运行。）</p>
<p>另一方面，在结果显示中，Mata 的命令提示符是冒号 (😃，而在Stata中是句号 (.)。</p>
<h4 id="512-运算符-operators"><a class="markdownIt-Anchor" href="#512-运算符-operators"></a> 5.1.2 运算符 (Operators)</h4>
<p>在本部分，主要介绍 Mata 的运算符中的基础运算 (含元素运算)、逻辑运算、下标运算三大内容。有兴趣的读者可以查看<code>3.2.4 运算符优先级总结</code>。Mata 的运算符充分体现了作为矩阵编程语言的特征。</p>
<h5 id="5121-基础运算-部分"><a class="markdownIt-Anchor" href="#5121-基础运算-部分"></a> 5.1.2.1 基础运算 (部分)</h5>
<p>具体运算符和解释已写入以下代码块中，其中较有特色的是元素运算(element-by-element)。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入 Mata</span>

<span class="token comment">// --基本运算--</span>
<span class="token command keyword">a1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//","逗号为列合并运算符</span>
<span class="token command keyword">a2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.4</span><span class="token punctuation">)</span> <span class="token comment">//利用".."生成[1,4]范围内的(整数)行向量</span>
<span class="token command keyword">a3</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> \<span class="token number">2</span> \<span class="token number">3</span> \<span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//"\"反斜杠为行合并运算符</span>
<span class="token command keyword">a4</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//利用"::"生成[1,4]范围内的(整数)列向量</span>
<span class="token command keyword">a5</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>' <span class="token comment">//"'"撇号为转置运算符</span>

<span class="token comment">// --代数运算--</span>
<span class="token command keyword">b1</span> <span class="token operator">=</span> a1 <span class="token operator">+</span> a1 <span class="token comment">//"+" 加法</span>
<span class="token command keyword">b2</span> <span class="token operator">=</span> a1 <span class="token operator">-</span> a1 <span class="token comment">//"-" 减法</span>
<span class="token command keyword">b3</span> <span class="token operator">=</span> a5 <span class="token operator">*</span> a1 <span class="token comment">//"*" 乘法</span>

<span class="token comment">// --例子：混合运算--</span>
<span class="token command keyword">c1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> \ <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> \ <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token comment">//生成3×3矩阵</span>
<span class="token command keyword">c2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.3</span><span class="token punctuation">)</span>\<span class="token punctuation">(</span><span class="token number">4</span>.<span class="token number">.6</span><span class="token punctuation">)</span>\<span class="token punctuation">(</span><span class="token number">7</span>.<span class="token number">.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//生成的c2矩阵与c1矩阵相同</span>
<span class="token command keyword">c3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> \ <span class="token number">2</span> \ <span class="token number">3</span> <span class="token punctuation">)</span>' <span class="token comment">//生成行向量</span>


<span class="token comment">// --元素运算(element-by-element)--</span>
<span class="token comment">// -注：Mata中的代数运算，包括用于除法的斜杠(/)，都可在前面加一个冒号(:)，实现元素运算</span>
<span class="token command keyword">r1</span> <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span>
<span class="token command keyword">r2</span> <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> \ <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> \ <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">)</span>
<span class="token command keyword">m1</span> <span class="token operator">=</span> r1 <span class="token punctuation">:</span><span class="token operator">+</span> r2 <span class="token comment">//将行向量r1中的元素逐行加入到r2的每一行，最终得到3*3矩阵</span>
<span class="token command keyword">m2</span> <span class="token operator">=</span> r2 <span class="token punctuation">:</span><span class="token operator">+</span> r1 <span class="token comment">//生成的m2与m1相同</span>
<span class="token command keyword">m3</span> <span class="token operator">=</span> r1 <span class="token punctuation">:</span><span class="token operator">/</span> r2 <span class="token comment">//将行向量r1中的元素逐行除以r2的每一行，得3*3矩阵</span>
<span class="token command keyword">m4</span> <span class="token operator">=</span> r2 <span class="token punctuation">:</span><span class="token operator">/</span> r1 <span class="token comment">//将行向量r2中的元素逐行除以r1的每一行，得3*3矩阵</span>
<span class="token command keyword">m5</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment">//针对每个元素的开根运算</span>

<span class="token command keyword">end</span> <span class="token comment">//退出 Mata</span>

<span class="token comment">/* 部分结果展示：
: a2
1 2 3 4
+-----------------+
1 | 1 2 3 4 |
+-----------------+

: b3
[symmetric]
1 2
+---------+
1 | 1 |
2 | 2 4 |
+---------+

: m2
1 2 3
+----------------+
1 | 2 4 6 |
2 | 5 7 9 |
3 | 8 10 12 |
+----------------+

: m3
1 2 3
+-------------------------------------------+
1 | 1 1 1 |
2 | .25 .4 .5 |
3 | .1428571429 .25 .3333333333 |
+-------------------------------------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5122-逻辑运算符-logical-operators"><a class="markdownIt-Anchor" href="#5122-逻辑运算符-logical-operators"></a> 5.1.2.2 逻辑运算符 (Logical Operators)</h5>
<p>和 Stata 相同，相等逻辑运算符为 <code>a == b</code> 和 <code>a != b</code> 。该逻辑运算不需要考虑 <code>a</code> 和 <code>b</code> 是否一致，或是否是相同类型。其返回值为 0 或 1。</p>
<p>与相等比较不同，余下的逻辑比较运算符 <code>&gt;</code>，<code>&gt;=</code>，<code>&lt;</code>，<code>&lt;=</code> 只可以在两个对象是相同的类型 (数字或字符) 且维数 (conformable) 相同时才可以比较。</p>
<p>而逻辑运算符 与 (<code>&amp;</code>) 或 (<code>|</code>) 只能够用于实数类型的标量 (real scalar)。</p>
<h5 id="5123-下标运算-subscripts"><a class="markdownIt-Anchor" href="#5123-下标运算-subscripts"></a> 5.1.2.3 下标运算 (Subscripts)</h5>
<p>Mata 运用中括号 (<code>[]</code>) 进行下标运算，其可以出现在代数表达式的左端或右端。共有两类：① 列表下表 (list subscripts) 和范围下标 (range subscripts)。</p>
<p>利用下标运算，可用于引用、修改、提取数组中元素。</p>
<ul>
<li>列表下标</li>
</ul>
<p>下标运算 <code>x[i,j]</code> 中的 <code>i</code> 或 <code>j</code> 可以是一个向量，如：<code>x[i,jvec]</code>，<code>jvec=(4,6,8)</code>。<code>i</code> 或 <code>j</code> 也可以缺失 (或用 <code>.</code> ) ，用于指代该行或该列中的所有元素，如：<code>x[i,.]</code>、 <code>x[i,]</code>提取第 i 行的所有元素；<code>x[.,.]</code>、 <code>x[,]</code>提取整个矩阵中的元素。</p>
<p>为了避免输入每个连续数字，可以用范围运算符 (前文提到的<code>..</code> 和 <code>::</code> ) 来进行下标运算，如 <code>x[(1..4),.]</code> 和 <code>x[(1::4),.]</code>，都指代了矩阵 x 的前四行。同时范围运算也可以是降序的，如 <code>x[(4::1),.]</code>。</p>
<ul>
<li>范围下标</li>
</ul>
<p>范围下标运算方式为 <code>[| |]</code>。该表达可以用于指代矩阵中的单个元素，但更加重要的是使用 <code>x[| i, j \m, n |]</code>，该命令可以生成一个子矩阵，从 <code>x[i, j]</code> 开始至 <code>x[m, n]</code> 结束。形如 <code>x[| 1, 1 \4, .|]</code> 和 <code>x[| 4, 4 \., .|]</code> 也可以正常运行，前者代表了子矩阵至最后一列，后者跳过了 x 矩阵的前三行和前三列。</p>
<blockquote>
<p>Tip：当可以同时使用范围下标运算 <code>[| |]</code> 和列表下标运算 <code>[i,j]</code> 时，使用范围下标运算效率更高 ( 无论是矩阵提取还是用时方面 )。</p>
</blockquote>
<h5 id="5124-运算符优先级总结"><a class="markdownIt-Anchor" href="#5124-运算符优先级总结"></a> 5.1.2.4 运算符优先级总结</h5>
<p>参考 Gould(2018, p.86)，下标总结了 Mata 中的运算符及其优先级。利用优先级可以简化代码，例如，<code>a&gt;2+3</code> 与 <code>a&gt;(2+3)</code>的实现效果相同 (算术运算优先于逻辑运算)。</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符优先级汇总 (从高到低)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">下标运算</td>
<td>[]</td>
</tr>
<tr>
<td style="text-align:left">递增 &amp; 递减运算</td>
<td>–, ++</td>
</tr>
<tr>
<td style="text-align:left">结构 &amp; 类元素引用运算</td>
<td>-&gt;, .</td>
</tr>
<tr>
<td style="text-align:left">指针运算</td>
<td>*, &amp;</td>
</tr>
<tr>
<td style="text-align:left">算术运算</td>
<td>', ^, - (负号), /, #, *, -, +</td>
</tr>
<tr>
<td style="text-align:left">逻辑运算</td>
<td>!, !=, &gt;, &lt;, &gt;=, &lt;=, ==, &amp;, |</td>
</tr>
<tr>
<td style="text-align:left">行填充</td>
<td>…</td>
</tr>
<tr>
<td style="text-align:left">列合并</td>
<td>,</td>
</tr>
<tr>
<td style="text-align:left">列填充</td>
<td>::</td>
</tr>
<tr>
<td style="text-align:left">行合并</td>
<td>\</td>
</tr>
<tr>
<td style="text-align:left">三元条件运算</td>
<td>? :</td>
</tr>
<tr>
<td style="text-align:left">转为空白</td>
<td>(void)</td>
</tr>
<tr>
<td style="text-align:left">赋值</td>
<td>=</td>
</tr>
</tbody>
</table>
<p>注：由冒号 <code>:</code> 代表的元素运算优先级仅低于相应的非冒号运算，如 <code>:==</code> 在逻辑运算 <code>==</code> 之后，<code>:*</code> 在代数运算 <code>*</code> 之后。</p>
<h4 id="513-循环语句-loop"><a class="markdownIt-Anchor" href="#513-循环语句-loop"></a> 5.1.3 循环语句 (Loop)</h4>
<p>Stata 中的循环有：<code>foreach</code>、<code>forvalues</code> 和 <code>while</code>，Mata 中的循环也有三类：<code>for</code>、<code>while</code> 和 <code>do...while</code>，但是语法多有不同。</p>
<p><code>for</code> 和 <code>while</code> 在循环开始时检查循环的运行条件，这意味着循环可能根本不会执行，可以用于优雅地处理极端情况。而 <code>do...while</code> 在循环结束时检查运行条件，用于需要至少循环一次的情况。</p>
<blockquote>
<p>Tip：Mata 作为矩阵语言，在可以使用矩阵运算的时候就应当避免使用明确的循环语句。</p>
</blockquote>
<h5 id="5131-for"><a class="markdownIt-Anchor" href="#5131-for"></a> 5.1.3.1 for</h5>
<p>Mata 中的 <code>for</code> 与 C 语言中的循环语句语法类似。</p>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>exp1; exp2; exp3<span class="token punctuation">)</span> statement
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>exp1; exp2; exp3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*注意点：
- exp1、exp3可以为空，但exp2不可为空
- exp3具体表达中可使用递增(++)或递减(--)运算符，如i++，++i
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>例子：求1~100见的整数和及平方和</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">v</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span>.<span class="token number">.100</span><span class="token punctuation">)</span>
<span class="token command keyword">sum1</span> <span class="token operator">=</span> sum2 <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//初始化</span>
<span class="token command keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span>; i<span class="token operator">&lt;=</span><span class="token function">length</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>; i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">sum1</span> <span class="token operator">=</span> sum1 <span class="token operator">+</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token command keyword">sum2</span> <span class="token operator">=</span> sum2 <span class="token operator">+</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">(</span>sum1<span class="token punctuation">,</span>sum2<span class="token punctuation">)</span> <span class="token comment">//展示结果</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>

<span class="token comment">/*输出结果：
: (sum1,sum2)
1 2
+-------------------+
1 | 5050 338350 |
+-------------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5132-while"><a class="markdownIt-Anchor" href="#5132-while"></a> 5.1.3.2 while</h5>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//注意exp必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>例子：求 ，要求精度</li>
</ul>
<p>Tip：<code>while</code> 通常被用于迭代求解近似值。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">x</span><span class="token operator">=</span><span class="token number">2</span> <span class="token comment">//初始化为2</span>
<span class="token command keyword">while</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">></span> 1e<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token command keyword">x</span> <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token comment">//2*x为f(x)=x^2的求导</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">x</span> <span class="token comment">//展示结果</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>

<span class="token comment">/*输出结果：
: x
2.645751311
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5133-dowhile"><a class="markdownIt-Anchor" href="#5133-dowhile"></a> 5.1.3.3 do…while</h5>
<p><code>do...while</code> 的语法如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">//单行命令</span>
<span class="token command keyword">do</span> stmt <span class="token function">while</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
<span class="token comment">//多行命令需要放入大括号中</span>
<span class="token command keyword">do</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">stmts</span>
<span class="token punctuation">&#125;</span> <span class="token function">while</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
<span class="token comment">//注意exp必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="514-条件语句-conditional"><a class="markdownIt-Anchor" href="#514-条件语句-conditional"></a> 5.1.4 条件语句 (Conditional)</h4>
<p>与 Stata 类似，在 Mata 中可以使用 <code>if...else</code> 来进行条件判断；不同的是，Mata 中有特殊的三元条件运算符 <code>a ? b : c</code></p>
<h4 id="515-ifelse"><a class="markdownIt-Anchor" href="#515-ifelse"></a> 5.1.5 if…else</h4>
<p><code>if...else</code> 语法结构如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement
<span class="token comment">//或者</span>
<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> statement1
<span class="token command keyword">else</span> statement2
<span class="token comment">//或者</span>
<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statement1</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statement2</span>
<span class="token punctuation">&#125;</span>

<span class="token command keyword">if</span> <span class="token punctuation">(</span>exp1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements1</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>exp2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements2</span>
<span class="token punctuation">&#125;</span>
<span class="token command keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token command keyword">statements3</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//注意：exp, exp1, exp2...必须是与实数标量相比较</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="516-a-b-c-条件运算符"><a class="markdownIt-Anchor" href="#516-a-b-c-条件运算符"></a> 5.1.6 a ? b : c 条件运算符</h4>
<ul>
<li>语法</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">a</span> ? b <span class="token punctuation">:</span> c
<span class="token comment">//其中，a必须与实数标量相比较，而b,c的形式不受限制</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>结果输出</li>
</ul>
<p>如果 a 为真 (a不为0)，则条件运算符返回 b，否则返回 c。</p>
<ul>
<li>举个例子</li>
</ul>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">mata</span> <span class="token comment">//进入mata</span>
<span class="token command keyword">k</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token command keyword">n</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token command keyword">dof</span> <span class="token operator">=</span> <span class="token punctuation">(</span> k<span class="token operator">==</span><span class="token number">0</span> ? n<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> n<span class="token operator">-</span>k <span class="token punctuation">)</span> <span class="token comment">//k=0则返回n-1,否则返回n-k</span>
<span class="token command keyword">dof</span>
<span class="token command keyword">end</span> <span class="token comment">//退出mata</span>
<span class="token comment">/*输出结果：
: dof
8
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="52-使用单行命令调用-mata"><a class="markdownIt-Anchor" href="#52-使用单行命令调用-mata"></a> 5.2 使用单行命令调用 Mata</h3>
<h4 id="521-实现逻辑及方法"><a class="markdownIt-Anchor" href="#521-实现逻辑及方法"></a> 5.2.1 实现逻辑及方法</h4>
<p>Stata 命令窗口、do-file 或 ado-file 中输入单行命令 <code>mata:一个或多个 Mata 命令，使用分号分割</code>，即可实现 Mata 环境的调用。且我们在 Mata 环境中生成的变量会一直保留，直至输入<code>mata: mata clear</code>。</p>
<p>在上文中，我们提到 Mata 的一大优势是灵活的交互以实现 Stata 与 Mata 的互补， <code>mata:语句</code> 的方式就是极佳的实现方式。</p>
<p>但是该交互的前提是两者工作空间内的变量与结果的相互调用或修改，因此，我们不可避免需要用到 <code>st_interface</code> 这类函数。</p>
<p>基于 <code>st_interface</code> 类型的函数，Mata 可以获取 Stata 中的所有对象 (数据、宏、标量和矩阵)，并实现 Stata 和 Mata 计算结果的无缝交互。</p>
<h4 id="522-例子利用-mata-提取回归后的-t-值"><a class="markdownIt-Anchor" href="#522-例子利用-mata-提取回归后的-t-值"></a> 5.2.2 例子：利用 Mata 提取回归后的 t 值</h4>
<blockquote>
<p>注：以下例子来源于 Baum(2016) Chapter 13.4</p>
</blockquote>
<h5 id="5221-问题阐述及分析"><a class="markdownIt-Anchor" href="#5221-问题阐述及分析"></a> 5.2.2.1 问题阐述及分析</h5>
<p>在使用 <code>reg</code> 命令后，回归结果的会自动保存在 <code>e()</code> 矩阵中，但 统计量未被保存，那么如何才能计算出 统计量呢？</p>
<p>所幸，<code>e()</code> 中保留了估计系数- <code>e(b)</code> 和估计量的方差-协方差矩阵 <code>e(V)</code> ，从而可以通过 来实现 统计量的计算。</p>
<h5 id="5222-mata-实现"><a class="markdownIt-Anchor" href="#5222-mata-实现"></a> 5.2.2.2 Mata 实现</h5>
<ul>
<li>思路如下</li>
</ul>
<ol>
<li>完成回归，获得 <code>e(b)</code> 和 <code>e(B)</code> 矩阵，供 统计量的计算</li>
<li>通过 <code>st_matrix</code> 函数调用 <code>e(b)</code> 和 <code>e(B)</code> 矩阵，并在 Mata 环境中完成 统计量计算</li>
<li>完成相关细节调整</li>
</ol>
<ul>
<li>代码如下</li>
</ul>
<p>(命令窗口运行以下语句需删去 //及其注释语句)</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token comment">*----1.回归----</span>
<span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span> <span class="token keyword">clear</span> <span class="token comment">//调动auto.dta数据集</span>
<span class="token command keyword">reg</span> price displacement weight foreign

<span class="token comment">*----2.单行调用Mata并计算t统计量---</span>
<span class="token command keyword">mata</span><span class="token punctuation">:</span> <span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bst"</span></span><span class="token punctuation">,</span><span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e(b)"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">diagonal</span><span class="token punctuation">(</span><span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e(V)"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/*该行代码具体解释如下：
st_matrix()的使用可利用 help mata st_matrix 进行查看
bst为逗号后矩阵命名。st_matrix(name, X)将Stata中的名为name的矩阵新建/替换为X中的内容
st_matrix("e(b)")调用系数矩阵
diagonal(st_matrix("e(V)"))'代表提取协方差矩阵后取对角线元素，并转置
利用元素运算符:/完成对应估计量的t统计量运算
*/</span>

<span class="token comment">*----3.处理生成的bst矩阵的行列名细节----</span>
<span class="token command keyword">matrix</span> rownames bst <span class="token operator">=</span> tstat <span class="token comment">//行命名</span>
<span class="token command keyword">matrix</span> colnames bst <span class="token operator">=</span> `<span class="token punctuation">:</span> colnames <span class="token function">e</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>' <span class="token comment">//列命名</span>
<span class="token command keyword">matrix</span> list bst<span class="token punctuation">,</span> <span class="token function">format</span><span class="token punctuation">(</span>%<span class="token number">9</span><span class="token number">.3</span>f<span class="token punctuation">)</span> <span class="token comment">//输出结果</span>

<span class="token comment">/*矩阵输出结果如下：
. matrix list bst, format(%9.3f)
bst[1,4]
displacement weight foreign _cons
tstat 1.671 3.275 5.745 -2.826
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由上述例子可知，通过在 Mata 环境中调用 Stata 中元素，借助 Mata 矩阵运算的优势，轻松实现 统计量的实现，从而实现双方的互补。</p>
<h4 id="523-stata-实现"><a class="markdownIt-Anchor" href="#523-stata-实现"></a> 5.2.3 Stata 实现</h4>
<p>虽然 Mata 可以一键输出，Stata 中处理就一定复杂吗？参考 st: Re: p&gt;t value extraction 给出的答案，代码如下：</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">sysuse</span> auto<span class="token punctuation">,</span> <span class="token keyword">clear</span> <span class="token comment">//调用auto.dta数据集</span>
<span class="token command keyword">reg</span> price displacement weight foreign
<span class="token command keyword">matrix</span> a <span class="token operator">=</span> <span class="token function">vecdiag</span><span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//保存e(V)对角线元素，组成行向量</span>
<span class="token command keyword">matrix</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>\a<span class="token punctuation">)</span>' <span class="token comment">//合并矩阵e(b),a至矩阵b，并转置</span>
<span class="token command keyword">svmat</span> b <span class="token comment">//将矩阵b转化为变量</span>
<span class="token command keyword">rename</span> b1 beta <span class="token comment">//将b1变量(对应b矩阵的第一列)重命名为beta</span>
<span class="token command keyword">gen</span> se <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span> <span class="token comment">//对b2变量开根，相当于求出se</span>
<span class="token command keyword">gen</span> t <span class="token operator">=</span> beta<span class="token operator">/</span>se <span class="token comment">//得到t统计量</span>
<span class="token command keyword">list</span> t <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token comment">//列出所有t统计量的值(因为是变量，所以余下的全部缺失)</span>

<span class="token comment">/*
. mat list b
b[4,2]
y1 r1
displacement 10.253866 37.671085
weight 2.3286255 .50552151
foreign 3899.6304 460717.13
_cons -4048.3431 2052742.2

. list t in 1/4
+------------+
| t |
|------------|
1. | 1.6706426 |
2. | 3.2751395 |
3. | 5.7452147 |
4. | -2.8255962 |
+------------+
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过对比可知，在回归后生成 统计量，Stata 代码需要 6 行，而使用 Mata 仅需一行。主要原因在于 Stata 中的矩阵无法对其中元素进行逐一的开根号运算，于是无法取出标准误，只能先转化为变量后开根。</p>
<p>以上只是一个小例子，Mata 作为专业矩阵编程语言，可以想象它会为我们的科研带来极大的便利。</p>
<blockquote>
<p>Tip：以上的方法都是基于回归后生成的 <code>e()</code> 后计算 统计量 ，实际上使用回归保留的 r(table) 矩阵会更加方便 <mark>(目前为止没有找到更简便的方法)</mark>。语句如下，有兴趣的读者可尝试。</p>
</blockquote>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">matrix</span> a<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
<span class="token command keyword">matrix</span> b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span>.<span class="token number">.4</span><span class="token punctuation">]</span>
<span class="token command keyword">mat</span> list b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="6-随机模拟"><a class="markdownIt-Anchor" href="#6-随机模拟"></a> 6. 随机模拟</h2>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token command keyword">clear</span>
<span class="token command keyword">set</span> obs <span class="token number">10</span>
<span class="token command keyword">gen</span> x1 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">gen</span> x2 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">set</span> seed <span class="token number">1234</span>
<span class="token command keyword">gen</span> y1 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">set</span> seed <span class="token number">1234</span>
<span class="token command keyword">gen</span> y2 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">gen</span> y3 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">set</span> seed <span class="token number">5634</span>
<span class="token command keyword">gen</span> z1 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">set</span> seed <span class="token number">1234</span>
<span class="token command keyword">gen</span> z2 <span class="token operator">=</span> <span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token command keyword">list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="61-简单重复实验"><a class="markdownIt-Anchor" href="#61-简单重复实验"></a> 6.1 简单重复实验</h3>
<p>大部分的人认为连续正面或反面不太容易发生。但模拟结果【连续三次正面】足以修正我们直觉错误。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">capture</span> <span class="token command keyword">program</span> drop seq3
<span class="token command keyword">prog</span> seq3<span class="token punctuation">,</span>rclass <span class="token comment">//rclass 选项表示计算结果将由return 返回到r()</span>
	<span class="token command keyword">version</span> <span class="token number">17</span>
	<span class="token command keyword">drop</span> _all <span class="token comment">//清空所有数据，不能用clear</span>
	<span class="token command keyword">set</span> obs <span class="token number">10</span> <span class="token comment">//将生成10 个观察值</span>
	<span class="token command keyword">tempvar</span> x y z <span class="token comment">//设定x,y,z 为临时变量</span>
	<span class="token command keyword">gen</span> <span class="token variable">`x'</span><span class="token operator">=</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//产生10 个随机变量，可能为0，1，…，9</span>
	<span class="token command keyword">gen</span> <span class="token variable">`y'</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token variable">`x'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//如果生成的随机变量为奇数，则y=0;为偶数，y=1</span>
	<span class="token command keyword">gen</span> <span class="token variable">`z'</span><span class="token operator">=</span><span class="token number">0</span> <span class="token comment">//生成Z=0</span>
	<span class="token command keyword">forvalues</span> i<span class="token operator">=</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
		<span class="token command keyword">replace</span> <span class="token variable">`z'</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token variable">`y'</span><span class="token operator">==</span><span class="token variable">`y'</span><span class="token punctuation">[</span>_n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token variable">`y'</span><span class="token operator">==</span><span class="token variable">`y'</span><span class="token punctuation">[</span>_n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token variable">`i'</span> <span class="token comment">//连续三个变量相等时z=1</span>
	<span class="token punctuation">&#125;</span>
	<span class="token command keyword">sum</span> <span class="token variable">`z'</span>
	<span class="token command keyword">return</span> scalar max<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token comment">//z 取1 表示高兴的事发生（三连续），否则失败</span>
<span class="token command keyword">end</span>
<span class="token keyword">simulate</span> max<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> nodots<span class="token punctuation">:</span><span class="token command keyword">seq3</span> <span class="token comment">//重复1 万次，取平均结果</span>
<span class="token command keyword">sum</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="62-复杂模拟"><a class="markdownIt-Anchor" href="#62-复杂模拟"></a> 6.2 复杂模拟</h3>
<p>任务：一对夫妇计划生孩子生到有女儿才停，或者生了三个就停，他们拥有女儿的概率<br />
是多大？</p>
<p>第一步：概率模型<br />
每一个孩子是女孩的概率是0.49，且各个孩子的性别是互相独立的。<br />
第二步：分配数字<br />
00，01，02，。。。，49=女孩<br />
49，50，51，。。。，99=男孩<br />
第三步：模拟<br />
从随机数表中生成一对一对的数字，直到有了女儿，或已有3个孩子。<br />
重复100次。</p>
<pre class="line-numbers language-stata" data-language="stata"><code class="language-stata"><span class="token keyword">capture</span> <span class="token command keyword">program</span> drop girl
<span class="token command keyword">program</span> girl<span class="token punctuation">,</span> rclass
	<span class="token command keyword">drop</span> _all
	<span class="token command keyword">set</span> obs <span class="token number">3</span>
	<span class="token command keyword">gen</span> x <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span><span class="token function">uniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token command keyword">gen</span> y<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token operator">&lt;</span><span class="token number">49</span><span class="token punctuation">)</span> <span class="token comment">//生女孩y=1,生男孩，y=0</span>
	<span class="token command keyword">sum</span> y
	<span class="token command keyword">return</span> scalar max<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token comment">//若至少有一个女孩，则max 取1，若三个全为男孩，取0</span>
<span class="token command keyword">end</span>
<span class="token keyword">simulate</span> max<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> nodots<span class="token punctuation">:</span><span class="token command keyword">girl</span>
<span class="token command keyword">sum</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="7-微观计量经济学实操"><a class="markdownIt-Anchor" href="#7-微观计量经济学实操"></a> 7. 微观计量经济学实操</h2>
<p>参考这篇文章<a href='/767402338.html#micro-stata' target='_blank'>《微观计量经济学》</a>。</p>
<h2 id="8-mac-stata同时打开两个dta文件"><a class="markdownIt-Anchor" href="#8-mac-stata同时打开两个dta文件"></a> 8. mac stata同时打开两个dta文件</h2>
<p>打开【终端.app】：在聚焦搜索里直接搜“终端”或者“terminal”【也可以用iTerm这个软件】，就行</p>
<p>在【终端.app】里输入下面代码：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">open</span> <span class="token parameter variable">-n</span> <span class="token punctuation">[</span>stata的安装路径<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>怎么确定stata的安装路径？</p>
<p>打开 Finder ，应用程序，看自己的stata安装路径就行。</p>
<p>不过值得注意的是，Mac不太支持路径中包括空格，如果有空格的话，代码会报错。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="tags/python/">python</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">数据处理</a><a class="post-meta__tags" href="tags/stata/">stata</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86/">数据拆分</a><a class="post-meta__tags" href="tags/%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6/">数据合并</a><a class="post-meta__tags" href="tags/Mata/">Mata</a></div><div class="post_share"><div class="social-share" data-image="/private_img/banner2.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/private_img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/private_img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/private_img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/private_img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="2928949794.html" title="python2 与 python3的区别"><img class="cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python2 与 python3的区别</div></div></a></div><div class="next-post pull-right"><a href="4253525416.html" title="资本循环笔记20201114"><img class="cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">资本循环笔记20201114</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="5504202.html" title="python数据处理手册"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-23</div><div class="title">python数据处理手册</div></div></a></div><div><a href="2928949794.html" title="python2 与 python3的区别"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-15</div><div class="title">python2 与 python3的区别</div></div></a></div><div><a href="101587567.html" title="python做计量"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-15</div><div class="title">python做计量</div></div></a></div><div><a href="3805420524.html" title="助教：一键登记提交和成绩"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-16</div><div class="title">助教：一键登记提交和成绩</div></div></a></div><div><a href="3845945498.html" title="高级计量经济学课件"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-24</div><div class="title">高级计量经济学课件</div></div></a></div><div><a href="2840705512.html" title="建筑业投入产出闭模型"><img class="cover" src="/private_img/banner2.gif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-28</div><div class="title">建筑业投入产出闭模型</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/private_img/yuyingnan.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">揭晓</div><div class="author-info__description">随手写一写，揭晓这世界</div></div><a id="card-info-btn" href="/"><i class="fas fa-home"></i><span>回到首页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E7%AE%80%E4%BB%8B"><span class="toc-text"> 0 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#01-%E8%8E%B7%E5%BE%97%E5%B8%AE%E5%8A%A9"><span class="toc-text"> 0.1 获得帮助</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text"> 1. 基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA"><span class="toc-text"> 1.1 数据导入与输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11a-%E7%94%9F%E6%88%90%E6%96%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text"> 1.1a 生成新数据的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11b-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E5%8C%96"><span class="toc-text"> 1.1b 数据类型转化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11c-gen%E5%92%8Cegen%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> 1.1c gen和egen的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1"><span class="toc-text"> 1.2 描述性统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12a-%E7%94%BB%E5%9B%BE"><span class="toc-text"> 1.2a 画图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E7%BB%9F%E8%AE%A1%E6%A3%80%E9%AA%8C"><span class="toc-text"> 1.3 统计检验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F"><span class="toc-text"> 1.4 数据排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#141-sort"><span class="toc-text"> 1.4.1 sort</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#142-gsort"><span class="toc-text"> 1.4.2 gsort</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E5%88%86%E7%B1%BB%E6%93%8D%E4%BD%9C"><span class="toc-text"> 1.5 分类操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15a-%E7%94%9F%E6%88%90%E8%99%9A%E6%8B%9F%E5%8F%98%E9%87%8F%E7%9A%84%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95"><span class="toc-text"> 1.5a 生成虚拟变量的一个方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15b-%E5%B0%86%E5%88%86%E7%B1%BB%E7%BC%96%E7%A0%81%E8%BF%9B%E8%A1%8C%E6%95%B0%E5%AD%97%E7%BC%96%E7%A0%81%E6%9C%AA%E8%A7%A3%E5%86%B3"><span class="toc-text"> 1.5b 将分类编码进行数字编码（未解决）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15c-%E5%8F%96%E6%9F%90%E4%B8%AA%E5%85%B7%E4%BD%93%E7%9A%84%E5%80%BC%E4%BD%9C%E4%B8%BA%E5%88%97%E5%88%86%E7%BB%84%E7%9A%84%E5%80%BC"><span class="toc-text"> 1.5c 取某个具体的值作为列分组的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8E%E8%8C%83%E5%9B%B4%E7%AD%9B%E9%80%89"><span class="toc-text"> 1.6 条件表达式与范围筛选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E5%8A%A0%E6%9D%83weight"><span class="toc-text"> 1.7 加权weight</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%E5%85%B6%E4%BB%96%E5%8F%AF%E9%80%89%E9%A1%B9"><span class="toc-text"> 1.8 其他可选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1n-2-%E5%A4%9A%E8%A1%8C%E7%BC%96%E8%BE%91"><span class="toc-text"> 1.(n-2) 多行编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1n-1-%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97-%E5%87%BD%E6%95%B0%E8%BF%90%E7%AE%97"><span class="toc-text"> 1.(n-1) 四则运算、函数运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text"> 常用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="toc-text"> 分组函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%8C%83%E5%9B%B4%E5%8F%98%E9%87%8F"><span class="toc-text"> 生成范围变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1n-%E5%87%A0%E4%B8%AA%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 1.n 几个环境设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1n1-%E8%AE%BE%E7%BD%AE%E5%B1%8F%E5%B9%95%E6%BB%9A%E5%8A%A8"><span class="toc-text"> 1.n.1 设置屏幕滚动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1n2-%E8%AE%BE%E7%BD%AE%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F"><span class="toc-text"> 1.n.2 设置内存大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1n3-%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AD%98%E5%8F%96%E8%B7%AF%E5%BE%84"><span class="toc-text"> 1.n.3 设置文件存取路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1n4-%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA"><span class="toc-text"> 1.n.4 错误提示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1a-%E6%B5%81%E7%A8%8B%E8%AF%AD%E5%8F%A5"><span class="toc-text"> 1a 流程语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1a1-%E5%BE%AA%E7%8E%AF"><span class="toc-text"> 1a.1 循环</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#forvalues"><span class="toc-text"> forvalues</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#foreach"><span class="toc-text"> foreach</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1b-%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93"><span class="toc-text"> 1b 命令小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1c-%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AElabel"><span class="toc-text"> 1c 标签数据：label</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86%E4%B8%8E%E5%90%88%E5%B9%B6"><span class="toc-text"> 2. 数据拆分与合并</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E9%95%BF%E5%AE%BD%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-reshape%E5%91%BD%E4%BB%A4"><span class="toc-text"> 2.1 长宽数据转换—— reshape命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86"><span class="toc-text"> 2.2 数据拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-%E5%88%A0%E9%99%A4%E4%BF%9D%E7%95%99%E5%8F%98%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A8%AA%E5%90%91%E6%8B%86%E5%88%86"><span class="toc-text"> 2.2.1 删除\保留变量：数据的横向拆分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-%E5%88%A0%E9%99%A4%E4%BF%9D%E7%95%99%E8%A7%82%E5%AF%9F%E5%80%BC%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BA%B5%E5%90%91%E6%8B%86%E5%88%86"><span class="toc-text"> 2.2.2 删除\保留观察值：数据的纵向拆分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#223-%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86-savesome-%E5%91%BD%E4%BB%A4"><span class="toc-text"> 2.2.3 一步到位保存数据子集： savesome 命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6"><span class="toc-text"> 2.4 数据合并</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#241-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A8%AA%E5%90%91%E5%90%88%E5%B9%B6"><span class="toc-text"> 2.4.1 数据的横向合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#242-%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BA%B5%E5%90%91%E5%90%88%E5%B9%B6"><span class="toc-text"> 2.4.2 数据的纵向合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#243-%E4%B8%80%E6%AC%A1%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AAcsv%E6%96%87%E4%BB%B6-csvconvert"><span class="toc-text"> 2.4.3 一次合并多个csv文件—— csvconvert</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%95%B0%E6%8D%AE%E9%87%8D%E6%95%B4"><span class="toc-text"> 2.5 数据重整</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BB%98%E5%9B%BE"><span class="toc-text"> 3. 绘图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3astata%E5%91%BD%E4%BB%A4%E8%AF%AD%E5%8F%A5%E6%A0%BC%E5%BC%8F"><span class="toc-text"> 3a.STATA命令语句格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-pythonstata"><span class="toc-text"> 4. Python+Stata</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%8F%A6%E5%A4%96%E4%BF%9D%E5%AD%98do%E6%96%87%E4%BB%B6%E5%9C%A8python%E4%B8%AD%E8%BF%90%E8%A1%8C%E5%A4%96%E9%83%A8do%E6%96%87%E4%BB%B6"><span class="toc-text"> 4.1 另外保存do文件，在python中运行外部do文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E6%9C%89%E6%97%B6%E4%BC%9A%E9%81%87%E5%88%B0%E6%94%B9%E5%8F%98do%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9%E7%9A%84%E6%83%85%E5%BD%A2%E5%9B%A0%E6%AD%A4%E9%9C%80%E8%A6%81%E5%9C%A8python%E4%B8%AD%E5%86%99%E4%B8%80%E4%B8%AAdo%E6%96%87%E6%A1%A3"><span class="toc-text"> 4.2 有时会遇到改变do文档内容的情形，因此需要在python中写一个do文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E5%9C%A8python%E5%92%8Cstata%E4%B8%AD%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E6%9C%80%E5%AE%B9%E6%98%93%E6%83%B3%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%9D%E8%B7%AF%E6%98%AF%E5%B0%86%E8%A6%81%E4%BC%A0%E9%80%92%E7%9A%84%E5%86%85%E5%AE%B9%E4%BF%9D%E5%AD%98%E4%B8%8B%E6%9D%A5%E7%84%B6%E5%90%8Epython%E6%88%96stata%E5%86%8D%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text"> 4.3 在python和stata中传递数据（最容易想到的一个思路是将要传递的内容保存下来，然后python或stata再读取数据）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-stata%E4%B8%AD%E7%9A%84mata"><span class="toc-text"> 5. Stata中的Mata</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-mata-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-text"> 5.1 Mata 基础语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#511-%E6%B3%A8%E9%87%8A%E6%96%B9%E5%BC%8F-comments"><span class="toc-text"> 5.1.1 注释方式 (Comments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#512-%E8%BF%90%E7%AE%97%E7%AC%A6-operators"><span class="toc-text"> 5.1.2 运算符 (Operators)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5121-%E5%9F%BA%E7%A1%80%E8%BF%90%E7%AE%97-%E9%83%A8%E5%88%86"><span class="toc-text"> 5.1.2.1 基础运算 (部分)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5122-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-logical-operators"><span class="toc-text"> 5.1.2.2 逻辑运算符 (Logical Operators)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5123-%E4%B8%8B%E6%A0%87%E8%BF%90%E7%AE%97-subscripts"><span class="toc-text"> 5.1.2.3 下标运算 (Subscripts)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5124-%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%E6%80%BB%E7%BB%93"><span class="toc-text"> 5.1.2.4 运算符优先级总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#513-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5-loop"><span class="toc-text"> 5.1.3 循环语句 (Loop)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5131-for"><span class="toc-text"> 5.1.3.1 for</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5132-while"><span class="toc-text"> 5.1.3.2 while</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5133-dowhile"><span class="toc-text"> 5.1.3.3 do…while</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#514-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5-conditional"><span class="toc-text"> 5.1.4 条件语句 (Conditional)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#515-ifelse"><span class="toc-text"> 5.1.5 if…else</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#516-a-b-c-%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text"> 5.1.6 a ? b : c 条件运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E4%BD%BF%E7%94%A8%E5%8D%95%E8%A1%8C%E5%91%BD%E4%BB%A4%E8%B0%83%E7%94%A8-mata"><span class="toc-text"> 5.2 使用单行命令调用 Mata</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#521-%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%8F%8A%E6%96%B9%E6%B3%95"><span class="toc-text"> 5.2.1 实现逻辑及方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#522-%E4%BE%8B%E5%AD%90%E5%88%A9%E7%94%A8-mata-%E6%8F%90%E5%8F%96%E5%9B%9E%E5%BD%92%E5%90%8E%E7%9A%84-t-%E5%80%BC"><span class="toc-text"> 5.2.2 例子：利用 Mata 提取回归后的 t 值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5221-%E9%97%AE%E9%A2%98%E9%98%90%E8%BF%B0%E5%8F%8A%E5%88%86%E6%9E%90"><span class="toc-text"> 5.2.2.1 问题阐述及分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5222-mata-%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 5.2.2.2 Mata 实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#523-stata-%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 5.2.3 Stata 实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E9%9A%8F%E6%9C%BA%E6%A8%A1%E6%8B%9F"><span class="toc-text"> 6. 随机模拟</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E7%AE%80%E5%8D%95%E9%87%8D%E5%A4%8D%E5%AE%9E%E9%AA%8C"><span class="toc-text"> 6.1 简单重复实验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E5%A4%8D%E6%9D%82%E6%A8%A1%E6%8B%9F"><span class="toc-text"> 6.2 复杂模拟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%BE%AE%E8%A7%82%E8%AE%A1%E9%87%8F%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%AE%9E%E6%93%8D"><span class="toc-text"> 7. 微观计量经济学实操</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-mac-stata%E5%90%8C%E6%97%B6%E6%89%93%E5%BC%80%E4%B8%A4%E4%B8%AAdta%E6%96%87%E4%BB%B6"><span class="toc-text"> 8. mac stata同时打开两个dta文件</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3479505605.html" title="民营企业参与一带一路中非制造业合作专题研究">民营企业参与一带一路中非制造业合作专题研究</a><time datetime="2023-10-17T11:24:25.012Z" title="更新于 2023-10-17 19:24:25">2023-10-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="954336338.html" title="国外马克思主义">国外马克思主义</a><time datetime="2023-10-11T12:16:15.966Z" title="更新于 2023-10-11 20:16:15">2023-10-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2827579200.html" title="马克思恩格斯关于城乡关系的论述">马克思恩格斯关于城乡关系的论述</a><time datetime="2023-10-10T11:47:55.057Z" title="更新于 2023-10-10 19:47:55">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="561789476.html" title="计算机时代的劳动">计算机时代的劳动</a><time datetime="2023-10-10T04:00:06.511Z" title="更新于 2023-10-10 12:00:06">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="983354507.html" title="席勒信息拜物教">席勒信息拜物教</a><time datetime="2023-10-10T04:00:06.510Z" title="更新于 2023-10-10 12:00:06">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3915587749.html" title="剑桥革命">剑桥革命</a><time datetime="2023-10-10T04:00:06.507Z" title="更新于 2023-10-10 12:00:06">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3262086267.html" title="拉沃《后凯恩斯主义》">拉沃《后凯恩斯主义》</a><time datetime="2023-10-10T03:59:55.865Z" title="更新于 2023-10-10 11:59:55">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3116173786.html" title="后凯恩斯主义选择理论">后凯恩斯主义选择理论</a><time datetime="2023-10-10T03:59:55.864Z" title="更新于 2023-10-10 11:59:55">2023-10-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/private_img/banner2.gif')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 揭晓</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="js/utils.js"></script><script src="js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>function loadDisqus () {
  const disqus_config = function () {
    this.page.url = 'https://dhndzwxj.github.io/1837523341.html'
    this.page.identifier = ''
    this.page.title = 'stata笔记'
  }

  const disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addModeChange('disqus', disqusReset)

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script type='text/javascript' src='https://ajax.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script id="dsq-count-scr" src="//https-www-dhndzwxj-top.disqus.com/count.js" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="../js/search/local-search.js"></script></div></div></body></html>