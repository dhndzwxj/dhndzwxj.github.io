<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>python数据处理手册 | 小荷才露尖尖角</title><meta name="author" content="揭晓"><meta name="copyright" content="揭晓"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="0. 链式方法的模板 根据数据处理和分析的常用方法，将链式方法的代码范式总结如下: (     pd.concat(pd.read_csv(&#39;data1.csv&#39;), pd.read_csv(&#39;data2.csv&#39;))     .fillna(...)     .append(...)     .set_index(&#39;...&#39;)     .query(&#39;some_condition&#39;)">
<meta property="og:type" content="article">
<meta property="og:title" content="python数据处理手册">
<meta property="og:url" content="https://dhndzwxj.github.io/5504202.html">
<meta property="og:site_name" content="小荷才露尖尖角">
<meta property="og:description" content="0. 链式方法的模板 根据数据处理和分析的常用方法，将链式方法的代码范式总结如下: (     pd.concat(pd.read_csv(&#39;data1.csv&#39;), pd.read_csv(&#39;data2.csv&#39;))     .fillna(...)     .append(...)     .set_index(&#39;...&#39;)     .query(&#39;some_condition&#39;)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dhndzwxj.github.io/private_img/banner2.gif">
<meta property="article:published_time" content="2022-08-23T06:09:17.000Z">
<meta property="article:modified_time" content="2022-11-29T11:47:50.046Z">
<meta property="article:author" content="揭晓">
<meta property="article:tag" content="马克思主义政治经济学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dhndzwxj.github.io/private_img/banner2.gif"><link rel="shortcut icon" href="/private_img/favicon.png"><link rel="canonical" href="https://dhndzwxj.github.io/5504202"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"本文上次更新距离今天已经过去","messageNext":"天, 文中内容可能已经过时，望周知。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python数据处理手册',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-29 19:47:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng:wght@400;500;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/wave.css?v1"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="小荷才露尖尖角" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/private_img/yuyingnan.jpg" onerror="onerror=null;src='/private_img/404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="archives/"><div class="headline">文章</div><div class="length-num">274</div></a><a href="tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="categories/"><div class="headline">分类</div><div class="length-num">74</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/private_img/banner2.gif')"><nav id="nav"><span id="blog_name"><a id="site-name" href="index.html">小荷才露尖尖角</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="../../"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-laptop-house"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw fas fa-wind"></i><span> 便携小空调</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">python数据处理手册</h1><div id="post-meta"><div class="meta-firstline"><div id="post-meta-author"><i class="fa-solid fa-user"></i><span class="post-meta-author">揭晓</span></div><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2022-11-29T11:47:50.046Z" title="更新于 2022-11-29 19:47:50">2022-11-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E6%9D%82%E6%8A%80/">杂技</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E6%9D%82%E6%8A%80/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">24.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>102分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="python数据处理手册"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="0-链式方法的模板"><a class="markdownIt-Anchor" href="#0-链式方法的模板"></a> 0. 链式方法的模板</h2>
<p>根据数据处理和分析的常用方法，将链式方法的代码范式总结如下:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>
    pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data1.csv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data2.csv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'some_condition'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>assign<span class="token punctuation">(</span>new_column <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>pipe<span class="token punctuation">(</span>fun<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span>plot
    <span class="token punctuation">.</span>line<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上范式可以完成绝大部分数据分析流程。在编写代码时，我们先 整理好代码的实现思路，然后键入一对圆括号，在括号中回车，让括号 开始和关闭分别位于代码首行和最后一行，缩进4格，开始编写代码。 每编写一行执行一次，观察结果是否符合预期，如有问题，修复后再回 车换行，开始编写下一段链条代码。依次进行，完成所有代码，直至出 现最终结果，包括可视化。</p>
<h2 id="1-python的安装与配置"><a class="markdownIt-Anchor" href="#1-python的安装与配置"></a> 1. Python的安装与配置</h2>
<p>可以从Python的官网(<a target="_blank" rel="noopener" href="https://www.python.org">https://www.python.org</a>)的下载 栏目下载安装包，下载时需要按自己实际的操作系统(Windows、 macOS等)下载相应的包，进行界面化安装。</p>
<ul>
<li>这种安装方式比较复杂，对新手不友好，比如在Windows中还要 设置一些环境变量;</li>
<li>容易与已有的Python冲突，macOS操作系统会自带Python(注 意:它是2.x版本，并不能直接使用);</li>
<li>无法灵活切换Python版本，有时我们需要使用特定版本的 Python，需要灵活切换，而这种方式无法做到。</li>
</ul>
<p>还可以安装miniconda。miniconda可以到它的官网 <a target="_blank" rel="noopener" href="https://docs.conda.io/en/latest/miniconda.html%E4%B8%8B%E8%BD%BD%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E6%8F%90%E4%BE%9B%E7%9A%84">https://docs.conda.io/en/latest/miniconda.html下载，也可以在清华大学提供的</a><a href='https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/' target='_blank'>镜像站点</a>下载，本网站的链接点击<a href='/local_file/python/Miniconda3-py39_4.12.0-MacOSX-arm64.pkg' target='_blank'>这里</a>。</p>
<p>安装jupyter notebook：它并没有安装在操作系统中 (Visual Studio Code、PyCharm等是安装在操作系统中的)，而是安装在Python中。需要再终端中输入命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> jupyter <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="2用python将数据导入"><a class="markdownIt-Anchor" href="#2用python将数据导入"></a> 2.用Python将数据导入</h2>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-1.png' width=600px>
</div>
<ul>
<li>读取函数一般会赋值给一个变量<code>df</code>，<code>df = pd.read_&lt;xxx&gt;()</code>;</li>
<li>输出函数是将变量自身进行操作并输出<code>df.to_&lt;xxx&gt;()</code></li>
</ul>
<h3 id="21-从excel将数据导入到python"><a class="markdownIt-Anchor" href="#21-从excel将数据导入到python"></a> 2.1 从Excel将数据导入到Python</h3>
<p>数据集(Data set或dataset)是一种由数据组成的集合，可以简单理解成一个Excel表格。</p>
<p>我们将数据读取到Pandas里，变量名用<code>df</code>(DataFrame的缩写，后续会介绍)，它是Pandas二维数据的基础结构。在此之前先安装一个工具包：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> openpyxl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="211-导入数据的基本操作"><a class="markdownIt-Anchor" href="#211-导入数据的基本操作"></a> 2.1.1 导入数据的基本操作</h4>
<p>然后才能编写下面的代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># 引入Pandas库，按惯例起别名pd</span>
<span class="token comment"># 以下两种效果一样，如果是网址，它会自动将数据下载到内存</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'/local_file/python/team.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment"># df = pd.read_excel('/Users/juncker/dlog/source/local_file/python/team.xlsx') # 文件在同一目录下</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面代码第一行，首先导入程序包<code>pandas</code>，然后把网上的excel表格（也可以是本地的excel表格）导入到内存当中来，存在<code>df</code>当中来，导入效果如下：</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-2.png' width=300px>
</div>
<ul>
<li>自动增加了第一列，是Pandas为数据增加的索引，从0开始，程序不知道我们真正的业务索引(可能对应于上图中的<code>name</code>)，往往需要后面重新指定，使它有 一定的业务意义;</li>
<li>由于数据量大，自动隐藏了中间部分，只显示前后5条;</li>
<li>底部显示了行数和列数。</li>
</ul>
<p>如果excel文件有多个sheet，可以指定<code>sheet_name</code>，如果不指定，默认读取第一个。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 第二个sheet</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'测试sheet2'</span><span class="token punctuation">)</span> <span class="token comment"># 按sheet的名字</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="212-表头的操作"><a class="markdownIt-Anchor" href="#212-表头的操作"></a> 2.1.2 表头的操作</h4>
<p>header参数支持整型和由整型组成的列表，指定第几行是表头，默认会自动推断把第一行作为表头。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment"># 第一行是表头</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># 第三行是表头</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 两层表头，多层索引</span>
pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># 没有表头 </span>
pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 多层索引MultiIndex</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>导入数据的时候，还可以指定列名</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'名字'</span><span class="token punctuation">,</span><span class="token string">'队伍'</span><span class="token punctuation">,</span> <span class="token string">'第1学期'</span><span class="token punctuation">,</span><span class="token string">'第2学期'</span><span class="token punctuation">,</span> <span class="token string">'第3学期'</span><span class="token punctuation">,</span><span class="token string">'第4学期'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 指定列名列表</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="213-导入数据类型的控制"><a class="markdownIt-Anchor" href="#213-导入数据类型的控制"></a> 2.1.3 导入数据类型的控制</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'string'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token string">'int32'</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token string">'float64'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以在导入的时候，让计算机把数据自动转换为合适的数据类型：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 自动转换合适的数据类型 </span>
df<span class="token punctuation">.</span>convert_dtypes<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 推断后的DataFrame </span>
df<span class="token punctuation">.</span>convert_dtypes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dtypes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="214-跳过指定行"><a class="markdownIt-Anchor" href="#214-跳过指定行"></a> 2.1.4 跳过指定行</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>skiprows<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">#跳过前两行</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>skiprows<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#跳过指定行(第1、3、5行)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>skiprows<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token operator">%</span><span class="token number">2</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#隔行跳过</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> skipfooter<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 最后一行不加载</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> skip_blank_lines<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 跳过空行</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="215-读取指定行"><a class="markdownIt-Anchor" href="#215-读取指定行"></a> 2.1.5 读取指定行</h4>
<p><code>nrows</code>参数用于指定需要读取的行数，从文件第一行算起，经常用于较大的数据，先取部分进行代码编写。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面是对数据进行验证的一些代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 查看数值型列的汇总统计（也就是描述性统计）</span>
df<span class="token punctuation">.</span>shape <span class="token comment"># (100, 6) 查看行数和列数 </span>
df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 查看索引、数据类型和内存信息  </span>
df<span class="token punctuation">.</span>dtypes <span class="token comment"># 查看各字段类型</span>
df<span class="token punctuation">.</span>axes <span class="token comment"># 显示数据行和列名 df.columns # 列名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="216-使用指定列"><a class="markdownIt-Anchor" href="#216-使用指定列"></a> 2.1.6 使用指定列</h4>
<p>如果只使用数据的部分列，可以用usecols来指定，这样可以加快加载速度并降低内存消耗。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 按索引只读取指定列，与顺序无关</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q4'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 按列名，列名必须存在</span>
<span class="token comment"># 指定列顺序，其实是df的筛选功能</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment">#按照后面的排顺序</span>
<span class="token comment"># 以下用callable方式可以巧妙指定顺序，in后面的是我们要的顺序</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="217-查看数据信息"><a class="markdownIt-Anchor" href="#217-查看数据信息"></a> 2.1.7 查看数据信息</h4>
<p>（1）查看样本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#前部数据，默认5条，可指定条数 df.head(10)</span>
df<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#尾部数据，默认5条，可指定条数。</span>
df<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#一条随机数据，可指定条数。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>（2）数据形状</p>
<p>执行df.shape会返回一个元组，该元组的第一个元素代表行数，第二个元素代表列数，这就是这个数据的基本形状，也是数据的大小。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>shape<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>shape<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（3）数据类型</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>dtypes
s<span class="token punctuation">.</span>dtype<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="22-从csv将数据导入到python"><a class="markdownIt-Anchor" href="#22-从csv将数据导入到python"></a> 2.2 从csv将数据导入到Python</h3>
<h4 id="221-简介"><a class="markdownIt-Anchor" href="#221-简介"></a> 2.2.1 简介</h4>
<p>CSV(Comma-Separated Values)是用逗号分隔值的数据形式，有时也称为字符分隔值，因为分隔字符也可以不是逗号。CSV文件的一般文件扩展名为.csv，用制表符号分隔也常用.tsv作为扩展名。CSV不仅可以是一个实体文件，还可以是字符形式，以便于在网络上传输。</p>
<p>CSV文件的读取方法如下:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 文件目录</span>
pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">)</span> <span class="token comment"># 如果文件与代码文件在同一目录下 </span>
pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/my/data.csv'</span><span class="token punctuation">)</span> <span class="token comment"># 指定目录 </span>
pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/my/my.data'</span><span class="token punctuation">)</span> <span class="token comment"># CSV文件的扩展名不一定是.csv</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>CSV文件可以存储在网络上，通过URL来访问和读取:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用URL </span>
pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'/local_file/python/team.csv'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="222-表头前缀"><a class="markdownIt-Anchor" href="#222-表头前缀"></a> 2.2.2 表头前缀</h4>
<p>如果原始数据没有列名，可以指定一个前缀加序数的名称，如n0、 n1，通过<code>prefix</code>参数指定前缀。<code>prefix</code>仅能在<code>pd.read_csv</code>里面用，<code>pd.read_excel</code>用不了！</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 指定列顺序，其实是df的筛选功能</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.csv'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>data<span class="token punctuation">,</span>prefix<span class="token operator">=</span><span class="token string">'c_'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-3.png' width=250px>
</div>
<h3 id="23-从剪贴板导入数据"><a class="markdownIt-Anchor" href="#23-从剪贴板导入数据"></a> 2.3 从剪贴板导入数据</h3>
<p>剪贴板(Clipboard)是操作系统级的一个暂存数据的地方，它保存在内存中，可以在不同软件之间传递，非常方便。Pandas支持读取剪贴板中的结构化数据，这就意味着我们不用将数据保存成文件，而可以直接从网页、Excel等文件中复制，然后从操作系统的剪贴板中读取，非常方便。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 可以从Excel表格或者网页中复制数据，然后直接赋值 </span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
cdf <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_clipboard<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="24-缺失值的处理"><a class="markdownIt-Anchor" href="#24-缺失值的处理"></a> 2.4 缺失值的处理</h3>
<p>数据中难免会存在字段值不全、缺失等情况。</p>
<p>如果想把正负无穷也当作缺 失值，可以通过以下全局配置来设定:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>mode<span class="token punctuation">.</span>use_inf_as_na <span class="token operator">=</span> <span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="241-找出缺失值"><a class="markdownIt-Anchor" href="#241-找出缺失值"></a> 2.4.1 找出缺失值</h4>
<p>一般使用特殊类型<code>NaN</code>代表缺失值，可以用NumPy定义为<code>np.NaN</code>或<code>np.nan</code>。在Pandas 1.0以后的版本中，实验性地使用标量pd.NA来代表。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'b1'</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 检测缺失值 </span>
df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 检测某一列的缺失值 </span>
df<span class="token punctuation">.</span>D<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 检测非缺失值 </span>
df<span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 每列有多少个缺失值 </span>
df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#同上</span>
<span class="token comment"># 每行有多少个缺失值 </span>
df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#同上</span>
<span class="token comment">########缺失值筛选#######</span>
<span class="token comment"># 有缺失值的行 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">#同上</span>
<span class="token comment"># 没有缺失值的行 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 有缺失值的列 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 没有缺失值的列 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">~</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由于NaN是浮点型，因此缺少一个整数的列可以转换为整型。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>pd<span class="token punctuation">.</span>Int64Dtype<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
0       1
1       2
2    &lt;NA>
3       4
dtype: Int64
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="242-缺失值的各种处理"><a class="markdownIt-Anchor" href="#242-缺失值的各种处理"></a> 2.4.2 缺失值的各种处理</h4>
<p>（1）缺失值填充</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'b1'</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 将缺失值填充为0 </span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># 填充为指定字符</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'missing'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'暂无'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'待补充'</span><span class="token punctuation">)</span>
<span class="token comment"># 指定字段填充</span>
df<span class="token punctuation">.</span>B<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'暂无'</span><span class="token punctuation">)</span> <span class="token comment">#只把B列的缺失值填充为“暂无”</span>
<span class="token comment"># 指定字段填充</span>
df<span class="token punctuation">.</span>B<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#只把B列的缺失值填充为0,且对df生效</span>
<span class="token comment"># 将不同列的缺失值替换为不同的值</span>
values <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token string">'暂无'</span><span class="token punctuation">&#125;</span> 
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span>values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>有时候我们不能填入固定值，而要按照一定的方法填充。<code>df.fillna()</code>提供了一个method参数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 取后一个有效值填充 </span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'bfill'</span><span class="token punctuation">)</span>
<span class="token comment"># 取前一个有效值填充 </span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span>
<span class="token comment">###### 平均值填充法#######</span>
<span class="token comment"># 填充列的平均值</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 对指定列填充平均值</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">:</span><span class="token string">'E'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 另一种填充列的平均值的方法</span>
df<span class="token punctuation">.</span>where<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>notna<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(2)插值填充</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>其中默认<code>method ='linear'</code>，即使用线性方法，认为数据呈一条直线。method方法指定的是插值的算法。</li>
<li>如果你的数据增长速率越来越快，可以选择<code>method='quadratic'</code>二次 插值;如果数据集呈现出累计分布的样子，推荐选择<code>method='pchip'</code>;</li>
<li>如果需要填补默认值，以平滑绘图为目标，推荐选择<code>method='akima'</code>。这些都需要你的环境中安装了<code>SciPy</code>库。</li>
</ul>
<p>(3)缺失值删除</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 删除所有有缺失值的行 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除所有有缺失值的列 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span>
<span class="token comment"># 删除所有值都缺失的行 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>how<span class="token operator">=</span><span class="token string">'all'</span><span class="token punctuation">)</span>
<span class="token comment"># 删除至少有两个缺失值的行 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>thresh<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># 指定判断缺失值的列范围 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'born'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 使删除的结果生效 </span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 指定列的缺失值删除</span>
df<span class="token punctuation">.</span>col<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="25-数据替换"><a class="markdownIt-Anchor" href="#25-数据替换"></a> 2.5 数据替换</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment"># 在Series中将0替换为5:</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">,</span><span class="token number">2.</span><span class="token punctuation">,</span><span class="token number">3.</span><span class="token punctuation">,</span><span class="token number">4.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 一一对应进行替换</span>
ser<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token comment"># 用字典映射对应替换值</span>
ser<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 将a列的0、b列中的5替换为100</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment"># 指定列里的替换规则</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 将 1，2，3 替换为它们前一个值</span>
ser<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'pad'</span><span class="token punctuation">)</span> <span class="token comment"># ffill是它同义词 </span>
<span class="token comment"># 将 1，2，3 替换为它们后一个值</span>
ser<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'bfill'</span><span class="token punctuation">)</span>

<span class="token comment"># 生成数据</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.5</span>
<span class="token comment"># 将1.5替换为NaN </span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span>
<span class="token comment"># 将1.5换为NaN，同时将左上角[0,0]的值换为a </span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 使替换生效</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于数据中存在的极端值，过大或者过小，可以使用<code>df.clip(lower,upper)</code>来修剪。当数据大于<code>upper</code>时使用<code>upper</code>的值，小于<code>lower</code>时用<code>lower</code>的值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 包含极端值的数据</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 修剪成最大为3，最小为0</span>
df<span class="token punctuation">.</span>clip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3用pandas处理数据"><a class="markdownIt-Anchor" href="#3用pandas处理数据"></a> 3.用Pandas处理数据</h2>
<h3 id="31-索引"><a class="markdownIt-Anchor" href="#31-索引"></a> 3.1 索引</h3>
<h4 id="311-建立索引"><a class="markdownIt-Anchor" href="#311-建立索引"></a> 3.1.1 建立索引</h4>
<p>以上数据真正业务意义上的<span style='color:red'>索引</span>是name列，导入数据的时候可以指定索引：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 将索引设置为name df	</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们发现name成为了索引，在显示时已经不与其他列名在一行了，而是自己单独占有一行。如果加载时没有指定索引，我们可以使用<code>df.set_index()</code>指定:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 建立索引并生效,inplace控制是否显示自然索引。</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-4.png' width=200px>
</div>
<p>其中可选参数<code>inplace=True</code>会将指定好索引的数据再赋值给<code>df</code>使索引生效，否则索引不会生效。注意，这里并没有修改原Excel，从我们读取数据后就已经和它没有关系了，<b>我们处理的是内存中的<code>df</code>变量</b>。</p>
<p>如果需要，我们还可以设置两层索引:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'team'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 设置两层索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-5.png' width=200px>
</div>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span>df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">## 将姓名的第一个字母和姓名设置为索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-6.png' width=200px>
</div>
<h4 id="312-修改索引名"><a class="markdownIt-Anchor" href="#312-修改索引名"></a> 3.1.2 修改索引名</h4>
<p>修改索引名最简单也最常用的办法就是将<code>df.index</code>和<code>df.columns</code>重新赋值为一个类似于列表的序列值，这会将其覆盖为指定序列中的名称。使用<code>df.rename</code>和<code>df.rename_axis</code>对轴名称进行修改。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'class'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">#将team改名为class</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其他常用方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"Q1"</span><span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"Q2"</span><span class="token punctuation">:</span> <span class="token string">"b"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 对表头进行修改 </span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"z"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 对索引进行修改</span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token comment"># 对类型进行修改 </span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span> <span class="token comment"># 将列名索引变成小写字母 </span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span>
<span class="token comment"># 对索引名进行修改</span>
s<span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span><span class="token string">"animal"</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span><span class="token string">"animal"</span><span class="token punctuation">)</span> <span class="token comment"># 默认是列索引 </span>
df<span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span><span class="token string">"limbs"</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">"columns"</span><span class="token punctuation">)</span> <span class="token comment"># 指定行索引 </span>
<span class="token comment"># 索引为多层索引时可以将type修改为class </span>
df<span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'class'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 可以用set_axis进行设置修改</span>
s<span class="token punctuation">.</span>set_axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'II'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>set_axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'ii'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="313-指定索引"><a class="markdownIt-Anchor" href="#313-指定索引"></a> 3.1.3 指定索引</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">#我们可以再给每个表一个一级索引，形成多层索引，这样可以清晰 地看到合成后的数据分别来自哪个DataFrame</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以字典形式传入</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pieces <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span>df1<span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span>df2<span class="token punctuation">&#125;</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="313a-将一个series指定为索引"><a class="markdownIt-Anchor" href="#313a-将一个series指定为索引"></a> 3.1.3a 将一个Series指定为索引</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment"># 指定一个索引</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 同时指定索引和现有字段</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">,</span> s<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 计算索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<table align='center'>
  <tr>
    <td>
      <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-7.png' height=300px>
  		<p  align='center' style='font-family:kaiti'>同时指定索引和现有字段</p>
    </td>
  	<td>
      <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-8.png' height=300px>
  		<p align='center' style='font-family:kaiti'>计算索引</p>
    </td>
  </tr>
</table>
<h4 id="314-时间索引"><a class="markdownIt-Anchor" href="#314-时间索引"></a> 3.1.4 时间索引：</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment"># 从一个日期连续到另一个日期</span>
pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'1/1/2018'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'1/08/2018'</span><span class="token punctuation">)</span>
<span class="token comment"># 指定开始时间和周期</span>
pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'1/1/2018'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''(以上两个结果一样)
DatetimeIndex(['2018-01-01', '2018-01-02', '2018-01-03', '2018-01-04',
               '2018-01-05', '2018-01-06', '2018-01-07', '2018-01-08'],
              dtype='datetime64[ns]', freq='D')
'''</span>
<span class="token comment"># 以月为周期</span>
pd<span class="token punctuation">.</span>period_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'2018-01-01'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'M'</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
PeriodIndex(['2017-01', '2017-02', '2017-03', '2017-04', '2017-05', '2017-06',
             '2017-07', '2017-08', '2017-09', '2017-10', '2017-11', '2017-12',
             '2018-01'],
            dtype='period[M]', freq='M')
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>【活学活用】将上述的内容结合一下，自己生成一个时间序列，然后把时间序列指定为原来的excel文件数据中的索引：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
index <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'1/1/2018'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span>index<span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#inplace=True,使得更改index直接生效于df</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token comment">#给索引起名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-9.png' width=300px>
</div>
<h4 id="315-重置索引"><a class="markdownIt-Anchor" href="#315-重置索引"></a> 3.1.5 重置索引</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 清除索引</span>
<span class="token comment"># 删除原索引，team列没了 </span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># team一级索引取消</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># Q1一级索引取消</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="316-索引的属性"><a class="markdownIt-Anchor" href="#316-索引的属性"></a> 3.1.6 索引的属性</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 常用属性</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>name <span class="token comment"># 名称</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>array <span class="token comment"># array数组 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>dtype <span class="token comment"># 数据类型 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>shape <span class="token comment"># 形状</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>size <span class="token comment"># 元素数量 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>values <span class="token comment"># array数组</span>
<span class="token comment"># 其他，不常用</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>empty <span class="token comment"># 是否为空 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>is_unique <span class="token comment"># 是否不重复 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names <span class="token comment"># 名称列表 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>is_all_dates <span class="token comment"># 是否全是日期时间 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>has_duplicates <span class="token comment"># 是否有重复值 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>values <span class="token comment"># 索引的值array</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="317-索引的操作"><a class="markdownIt-Anchor" href="#317-索引的操作"></a> 3.1.7 索引的操作</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 常用方法</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">)</span> <span class="token comment"># 转换类型</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 是否存在 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token comment"># 修改索引名称(经测试，失败) </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 不重复值的数量 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 排序，倒序 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span><span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token comment"># map函数处理 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment"># str替换 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token comment"># 分隔</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_list<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 转为列表 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_frame<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># 转成DataFrame </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_series<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 转为series</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 转为numpy</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 去重</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 去重及计数 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>where<span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token operator">==</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># 筛选 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">'grade'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 重命名索引 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'species'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 多层，重命名索引 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 最大值</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 最大索引值</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>T <span class="token comment"># 转置，在多层索引里很有用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="318-多层索引包括将dataframe转换为多层索引"><a class="markdownIt-Anchor" href="#318-多层索引包括将dataframe转换为多层索引"></a> 3.1.8 多层索引——包括将DataFrame转换为多层索引</h4>
<p>多层数据可以只有在行上为多层，可以只有在列上为多层，也可以在两个方向都为多层，理论上层数是没有上限的。除了原生的数据为多层外，在做数据分组聚合等操作时也会产生多层数据。本质上，这其实是一个以低维的形式展示的多维数据。下面是个例子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/height.xlsx'</span>
<span class="token comment"># data = '/local_file/python/height.xlsx'</span>
<span class="token comment"># 例子</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220827-10.png' width=400px>
</div>
<p>也可以由序列创建多层索引</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd 
<span class="token comment"># 第一步是生成多层索引</span>
arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>arrays<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 第二步，指定的索引是多层索引</span>
pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''		
Q1	Q2
class	team		
1	A	60	70
B	60	70
2	A	60	70
B	60	70
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还可以将一个Dataframe转换为多层索引对象：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
df_i <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">,</span><span class="token string">'team'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 将DataFrame中的数据转换成多层索引对象</span>
index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_frame<span class="token punctuation">(</span>df_i<span class="token punctuation">)</span>
<span class="token comment"># 应用多层对象</span>
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="318a-多层索引操作生成数据"><a class="markdownIt-Anchor" href="#318a-多层索引操作生成数据"></a> 3.1.8a 多层索引操作——生成数据</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 索引</span>
index_arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
<span class="token comment"># 列名</span>
columns_arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'2019'</span><span class="token punctuation">,</span> <span class="token string">'2019'</span><span class="token punctuation">,</span> <span class="token string">'2020'</span><span class="token punctuation">,</span> <span class="token string">'2020'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span><span class="token string">'上半年'</span><span class="token punctuation">,</span> <span class="token string">'下半年'</span><span class="token punctuation">,</span> <span class="token string">'上半年'</span><span class="token punctuation">,</span> <span class="token string">'下半年'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
<span class="token comment"># 索引转换为多层</span>
index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>index_arrays<span class="token punctuation">,</span>
                                  names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'班级'</span><span class="token punctuation">,</span> <span class="token string">'性别'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment"># 列名转换为多层</span>
columns <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>columns_arrays<span class="token punctuation">,</span>
                                    names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'年份'</span><span class="token punctuation">,</span> <span class="token string">'学期'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 应用到DataFrame中</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">89</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">89</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  columns<span class="token operator">=</span>columns<span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>效果图：</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220827-11.png' width=400px>
</div>
<h4 id="319-根据索引排序结合331"><a class="markdownIt-Anchor" href="#319-根据索引排序结合331"></a> 3.1.9 根据索引排序（结合3.3.1）</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用索引名可进行排序，可以指定具体的列 </span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team_multiindex.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2020'</span><span class="token punctuation">,</span><span class="token string">'下半年'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>reorder_levels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 等级顺序，互换 </span>
idx<span class="token punctuation">.</span>set_codes<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment"># 设置顺序 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>sortlevel<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 按指定级别排序 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>reindex<span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 更换顺序，或者指定一个顺序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="32-行与列的操作"><a class="markdownIt-Anchor" href="#32-行与列的操作"></a> 3.2 行与列的操作</h3>
<h4 id="321-数据筛选"><a class="markdownIt-Anchor" href="#321-数据筛选"></a> 3.2.1 数据筛选</h4>
<p>（1）选择列</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查看指定列</span>
df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>Q1 <span class="token comment"># 同上，如果列名符合Python变量名要求，可使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这里返回的是一个<b>Series类型数据，可以理解为数列，它也是带索引的。</b>之前建立的索引在这里发挥出了作用，否则我们的索引是一个数字，无法知道与之对应的是谁的数据。</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-12.png' width=300px>
</div>
<p>选择多列的可以用以下方法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 选择多列</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 只看这两列，注意括号 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 和上一行效果一样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>df.loc[x, y]</code>是一个非常强大的<b>数据选择函数</b>，其中<code>x</code>代表行，<code>y</code>代表列，行和列都支持条件表达式，也支持类似列表那样的切片(如果要用<b>自然索引</b>，需要用<code>df.iloc[]</code>)。</p>
<p>(2)选择行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 用指定索引选取</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token string">'Liver'</span><span class="token punctuation">]</span> <span class="token comment"># 指定姓名</span>
<span class="token comment"># 用自然索引选择，类似列表的切片 </span>
df<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># 取前三行</span>
df<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment"># 在前10个中每两个取一个 </span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># 前10个</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><b>总结：“行”是索引，“列”是变量名。</b></p>
<p>(3)指定行和列</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Ben'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span> <span class="token comment"># 只看Ben的四个季度成绩 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Eorge'</span><span class="token punctuation">:</span><span class="token string">'Leo'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span> <span class="token comment"># 指定行区间</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><span style='color:red'>(4)条件选择</span></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 单一条件</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">]</span> <span class="token comment"># Q1列大于90的</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>team <span class="token operator">==</span> <span class="token string">'C'</span><span class="token punctuation">]</span> <span class="token comment"># team列为'C'的</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token string">'Oscar'</span><span class="token punctuation">]</span> <span class="token comment"># 指定索引即原数据中的name</span>
<span class="token comment"># 组合条件</span>
df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># and关系 </span>
df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Q1<span class="token operator">></span><span class="token number">92</span><span class="token punctuation">]</span> <span class="token comment"># 多重筛选</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>更多数据筛选可以参考本章后面“逻辑筛选”、“函数筛选”等部分。</p>
<h4 id="322-数据增删"><a class="markdownIt-Anchor" href="#322-数据增删"></a> 3.2.2 数据增删</h4>
<p>（1）列操作</p>
<p><b>增加列：</b></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># 增加一个固定值的列</span>
df<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>Q1 <span class="token operator">+</span> df<span class="token punctuation">.</span>Q2 <span class="token operator">+</span> df<span class="token punctuation">.</span>Q3 <span class="token operator">+</span> df<span class="token punctuation">.</span>Q4 <span class="token comment"># 增加总成绩列</span>
<span class="token comment"># 将计算得来的结果赋值给新列</span>
df<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 可以把所有为数字的横向相加，关于axis的用法，可以参考附录D.2 (3)[axis=1表示横向相加]</span>
df<span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>total<span class="token operator">/</span><span class="token number">4</span> <span class="token comment"># 增加平均成绩列</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><b>插入列：</b></p>
<p>Pandas提供了<code>insert()</code>方法来为DataFrame插入一个新列。<code>insert()</code>方法可以传入三个主要参数:<code>loc</code>是一个数字，代表新列所在的位置，使用列的数字索引，如0为第一列;第二个参数<code>column</code>为新的列名;最后一 个参数<code>value</code>为列的值，一般是一个Series。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'total'</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果已经存在相同的数据列，会报错，可传入<code>allow_duplicates=True</code>插入一个同名的列。如果希望新列位于最后，可以在第一个参数位<code>loc</code>传入<code>len(df.columns)</code>。</p>
<p><b>指定一个新列<code>df.assign()</code></b></p>
<p><code>df.assign(k=v)</code>为指定一个新列的操作，<code>k</code>为新列的列名，<code>v</code>为此列的 值，<code>v</code>必须是一个与原数据同索引的Series。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>total<span class="token operator">=</span>df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#或者 df1 = df.assign(total=df.sum(1)) ,df1中包含新的一列</span>
<span class="token comment">#再增加一个Q列，它的元素均为定值100，用逗号分隔再增加一个 表达式，或者在语句后继续使用assign方法:</span>
<span class="token comment"># 增加两列</span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>total<span class="token operator">=</span>df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Q<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>total<span class="token operator">=</span>df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 效果同上</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们再增加两列<code>name_len</code>和<code>avg</code>，<code>name_len</code>值为<code>name</code>的长度，<code>avg</code>为平均分。这时有了过多的<code>assign</code>语句，为了美观整齐，将代码放在括号里:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用了链式方法 </span>
<span class="token punctuation">(</span>
    df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>total<span class="token operator">=</span>df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 总成绩 </span>
    <span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 目标满分值</span>
    <span class="token punctuation">.</span>assign<span class="token punctuation">(</span>name_len<span class="token operator">=</span>df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 姓名长度 </span>
    <span class="token punctuation">.</span>assign<span class="token punctuation">(</span>avg<span class="token operator">=</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 平均值 </span>
    <span class="token punctuation">.</span>assign<span class="token punctuation">(</span>avg2<span class="token operator">=</span><span class="token keyword">lambda</span> d<span class="token punctuation">:</span> d<span class="token punctuation">.</span>total<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># 平均值2</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>特别要说明的是<code>avg2</code>列的计算过程，因为df实际是没有<code>total</code>这一列的，如果我们需要使用<code>total</code>列，就需要用<code>lambda</code>来调用。<code>lambda</code>中第一个变量<code>d</code>是代码执行到本行前的DataFrame内容，可以认为是一个虚拟的DataFrame实体，然后用变量<code>d</code>使用这个DataFrame的数据。作为变量名，<code>d</code>可以替换为其他任意合法的名称，但为了代码可读性，建议使用<code>d</code>，代表它是一个DataFrame。如果是Series，建议使用<code>s</code>。</p>
<p>其他示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q5<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 新增加一列Q5</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q5<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 赋值生效 </span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q6<span class="token operator">=</span>df<span class="token punctuation">.</span>Q2<span class="token operator">/</span>df<span class="token punctuation">.</span>Q1<span class="token punctuation">)</span> <span class="token comment"># 计算并增加Q6 </span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q7<span class="token operator">=</span><span class="token keyword">lambda</span> d<span class="token punctuation">:</span> d<span class="token punctuation">.</span>Q1 <span class="token operator">*</span> <span class="token number">9</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token comment"># 使用lambda</span>
<span class="token comment"># 添加一列，值为表达式结果:True或False </span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>tag<span class="token operator">=</span>df<span class="token punctuation">.</span>Q1<span class="token operator">></span>df<span class="token punctuation">.</span>Q2<span class="token punctuation">)</span>
<span class="token comment"># 比较计算，True为1，False为0 </span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>tag<span class="token operator">=</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1<span class="token operator">></span>df<span class="token punctuation">.</span>Q2<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 映射文案 </span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>tag<span class="token operator">=</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1<span class="token operator">></span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token boolean">True</span><span class="token punctuation">:</span><span class="token string">'及格'</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">:</span><span class="token string">'不及格'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 增加多个</span>
df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q8<span class="token operator">=</span><span class="token keyword">lambda</span> d<span class="token punctuation">:</span> d<span class="token punctuation">.</span>Q1<span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">,</span>
          Q9<span class="token operator">=</span><span class="token keyword">lambda</span> d<span class="token punctuation">:</span> d<span class="token punctuation">.</span>Q8<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># Q8没有生效，不能直接用df.Q8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><b>更改列名</b></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'class'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">#将team改名为class</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果原始数据里没有列名，可以用<code>names</code>来指定列的名称，它是一个类似列表的序列，与数据一一对应。如果文件不包含列名，那么应该设置<code>header=None</code>，列名列表中不允许有重复值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'名字'</span><span class="token punctuation">,</span><span class="token string">'队伍'</span><span class="token punctuation">,</span> <span class="token string">'第1学期'</span><span class="token punctuation">,</span><span class="token string">'第2学期'</span><span class="token punctuation">,</span> <span class="token string">'第3学期'</span><span class="token punctuation">,</span><span class="token string">'第4学期'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 指定列名列表</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-13.png' width=350px>
</div>
<p>（2）行操作</p>
<p>增加行：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Jielu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">]</span>  
<span class="token comment"># 或者</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'jl'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'Q4'</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">&#125;</span>
<span class="token comment">#或者</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'Q4'</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">&#125;</span> <span class="token comment"># 自动增加索引</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'Q4'</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">&#125;</span> <span class="token comment"># 自动增加索引</span>
<span class="token comment">####################################################################################</span>
<span class="token comment"># 批量操作，可以使用迭代</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> rows<span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>增加行数据的使用场景相对较少，一般是采用数据追加的模式,<code>df.append()</code>可以追加一个新行:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df2<span class="token punctuation">)</span>
<span class="token comment"># 追加多个数据 </span>
df<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>df2<span class="token punctuation">,</span> df2<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于不同结构的追加，一方有而另一方没有的列会增加，没有内容的位置会用NaN填充</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df3<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>追加操作索引默认为原数据的，不会改变，如果需要忽略，可以传入ignore_index=True:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>pd.concat([s1, s2])</code>可以将两个df或s连接起来:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#保留原始索引</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">]</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 索引重新编</span>
<span class="token comment"># 原数索引不变，增加一个一层索引(keys里的内容)，变成多层索引 pd.concat([s1, s2], keys=['s1', 's2'])</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'s1'</span><span class="token punctuation">,</span> <span class="token string">'s2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Series name'</span><span class="token punctuation">,</span> <span class="token string">'Row ID'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># df同理</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df3<span class="token punctuation">]</span><span class="token punctuation">,</span> sort<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df3<span class="token punctuation">]</span><span class="token punctuation">,</span> join<span class="token operator">=</span><span class="token string">"inner"</span><span class="token punctuation">)</span> <span class="token comment"># 只连相同列 pd.concat([df1, df4], axis=1) # 连接列</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="323-数据连接pdconcat"><a class="markdownIt-Anchor" href="#323-数据连接pdconcat"></a> 3.2.3 数据连接pd.concat</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># pd.concat()的基本操作可以实现前文讲的df.append()功能</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
x	y
0	1	3
1	2	4
0	5	7
1	6	8
'''</span>
<span class="token comment"># 按列连接</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
x	y	x	y
0	1	3	5	7
1	2	4	6	8
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="323a-数据合并pdmerge"><a class="markdownIt-Anchor" href="#323a-数据合并pdmerge"></a> 3.2.3a 数据合并pd.merge</h4>
<p>可以将两个DataFrame或Series合并，最终返回一个合并后的DataFrame。基本语法如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token punctuation">,</span>right<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'inner'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>left_on<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>right_on<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
         left_index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>right_index<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>sort<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        suffixes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'_x'</span><span class="token punctuation">,</span><span class="token string">'_y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>copy<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>indicator<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>validate<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在数据连接时，如果没有指定根据哪一列(连接键)进行连接， Pandas会自动找到相同列名的列进行连接，并按左边数据的顺序取交集数据。为了代码的可阅读性和严谨性，推荐通过<code>on</code>参数指定连接键，示意图如下：</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220827-14.png' width=300px>
</div>
<p>例子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df1<span class="token punctuation">,</span>df2<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
a	b	c
0	1	3	8
1	2	4	9
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>按照索引连接：将<code>left_index</code>和<code>right_index</code>设置为True， 会以两个表的索引作为连接键</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df1<span class="token punctuation">,</span>df2<span class="token punctuation">,</span>
        left_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        right_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        suffixes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'_1'</span><span class="token punctuation">,</span><span class="token string">'_2'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
a_1	b	a_2	c
0	1	3	5	8
1	2	4	6	9
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果在合并数据时需要用多个连接键，可以以列表的形式将这些连接键传入on中，示例代码如下。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df3<span class="token punctuation">,</span> df4<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>此外还可以设置数据的连接方式，默认的方式是<code>inner join</code>，取交集，也就是保留左右表的共同内容; 如果是<code>left_join</code>，左边表中所有的内容都会保留;如果是<code>right_join</code>，右表全部保留;如果是<code>outer_join</code>，则左右表全部保留。关联不上的内容为<code>NaN</code>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 以左表为基表</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df3<span class="token punctuation">,</span> df4<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 以右表为基表</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df3<span class="token punctuation">,</span> df4<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#其他案例</span>
<span class="token comment"># 取两个表的并集</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 取两个表的交集</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'inner'</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 一个有重复连接键的例子</span>
left <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
right <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="324-使用部分列"><a class="markdownIt-Anchor" href="#324-使用部分列"></a> 3.2.4 使用部分列</h4>
<p>如果只使用数据的部分列，可以用usecols来指定，这样可以加快加载速度并降低内存消耗。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 按索引只读取指定列，与顺序无关</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q4'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 按列名，列名必须存在</span>
<span class="token comment"># 指定列顺序，其实是df的筛选功能</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'Q3'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment">#按照后面的排顺序</span>
<span class="token comment"># 以下用callable方式可以巧妙指定顺序，in后面的是我们要的顺序</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="325-删除"><a class="markdownIt-Anchor" href="#325-删除"></a> 3.2.5 删除</h4>
<p>删除有两种方法，一种是使用pop()函数。使用pop()，Series会删除指定索引的数据同时返回这个被删除的值，DataFrame会删除指定列并返回这个被删除的列。<b>以上操作都是实时生效的</b>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 删除索引为3的数据 </span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment"># 删除Q1列</span>
df<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'Q1'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="326-dfwhere"><a class="markdownIt-Anchor" href="#326-dfwhere"></a> 3.2.6 df.where()</h4>
<p><code>df.where()</code>中可以传入一个布尔表达式、布尔值的Series/DataFrame、序列或者可调用的对象，然后与原数据做对比，返回一个行索引与列索引与原数据相同的数据，且在满足条件的位置保留原值，在不满足条件的位置填充<code>NaN</code>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>where<span class="token punctuation">(</span>df <span class="token operator">></span> <span class="token number">70</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
Q1	Q2	Q3	Q4
0	89.0	NaN	NaN	NaN
1	NaN	NaN	NaN	NaN
2	NaN	NaN	NaN	84.0
3	93.0	96.0	71.0	78.0
4	NaN	NaN	NaN	86.0
...	...	...	...	...
95	NaN	NaN	87.0	74.0
96	NaN	NaN	NaN	NaN
97	98.0	93.0	NaN	NaN
98	NaN	74.0	NaN	91.0
99	NaN	NaN	NaN	74.0
100 rows × 4 columns
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="32a-修改数值行与列的操作"><a class="markdownIt-Anchor" href="#32a-修改数值行与列的操作"></a> 3.2a 修改数值（行与列的操作）</h3>
<p>在Pandas中修改数值非常简单，先筛选出需要修改的数值范围，再为这个范围重新赋值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">#查询值</span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Lily'</span> <span class="token comment">#修改值 </span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">#查看结果</span>
<span class="token comment"># 将小于60分的成绩修改为60 </span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">60</span>
<span class="token comment">#还可以传一个同样形状的数据来修改值:</span>
v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">20</span> <span class="token comment">#对比一下代码 v = [i*20 for i in [1,3,5,7,9]]</span>
df<span class="token punctuation">.</span>Q1 <span class="token operator">=</span> v <span class="token comment"># 修改</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于修改DataFrame，会按<span style='color:red'>对应的索引位</span>进行修改:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 指定修改的目的数据</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df1
<span class="token triple-quoted-string string">'''
Q1	Q2
0	1	4
1	2	5
2	3	6
'''</span>
<span class="token comment"># 将目的数据覆盖要修改的df的相应部分</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df1
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q2'</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
name	team	Q1	Q2	Q3	Q4
0	Liver	E	89.0	21.0	24	64
1	Arry	C	2.0	5.0	37	57
2	Ack	A	3.0	6.0	18	84
3	Eorge	C	NaN	NaN	71	78
4	Oah	D	65.0	49.0	61	86
5	Harlie	C	24.0	13.0	87	43
6	Acob	B	61.0	95.0	94	8
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们发现，最后的替换并没有达到我们的要求，原来是<b>索引的问题</b>！df1中索引为0、1、2，那么相应地只能替换掉df中0、1、2索引位置的内容！正确的做法应该是修改（自定义）df1的索引对应的数字。如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 指定修改的目的数据</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df1_index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span>df1_index<span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="32b-替换数据"><a class="markdownIt-Anchor" href="#32b-替换数据"></a> 3.2b 替换数据</h3>
<p><code>replace</code>方法可以对数据进行批量替换:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># 将列数据中的0换为5</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># 将数据中的所有0换为5</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># 将0~3全换成4</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 对应修改</span>
<span class="token comment"># &#123;'pad', 'ffill', 'bfill', None&#125; 试试</span>
s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'bfill'</span><span class="token punctuation">)</span> <span class="token comment"># 向下填充,即把1或者2替换为与它相邻的下一个数字</span>
s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span> <span class="token comment"># 向下填充,即把1或者2替换为与它相邻的上一个数字</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 字典对应修改——0改成10,1改成100</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 将指定字段（Q1中的0，Q2中的5）的指定值修改为100 </span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 将指定列里的指定值替换为另一个 </span>
<span class="token comment"># 使用正则表达式（全都看不懂）</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>to_replace<span class="token operator">=</span><span class="token string">r'^ba.$'</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'new'</span><span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token string">r'^ba.$'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token string">'new'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">r'^ba.$'</span><span class="token punctuation">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token string">'xyz'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">r'^ba.$'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'new'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="32c-填充空值"><a class="markdownIt-Anchor" href="#32c-填充空值"></a> 3.2c 填充空值</h3>
<p><code>fillna</code>对空值填入指定数据，通常应用于数据清洗。还有一种做法是删除有空值的数据。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 将空值全修改为0</span>
<span class="token comment"># &#123;'backfill', 'bfill', 'pad', 'ffill', None&#125;, 默认为None </span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span> <span class="token comment"># 将空值都修改为其前一个值</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'bfill'</span><span class="token punctuation">)</span> <span class="token comment"># 将空值都修改为其后一个值</span>
values <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> 
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span>values<span class="token punctuation">)</span> <span class="token comment"># 为各列填充不同的值 </span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span>values<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 只替换第一个</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="33-数据排序"><a class="markdownIt-Anchor" href="#33-数据排序"></a> 3.3 数据排序</h3>
<p>数据排序是指按一定的标准将数据重新排列，这有助于我们发现数据的变化趋势，有时还能帮助我们发现数据的谬误等。</p>
<h4 id="331-索引排序结合319"><a class="markdownIt-Anchor" href="#331-索引排序结合319"></a> 3.3.1 索引排序（结合3.1.9）</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 按照行索引排序</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment"># 索引降序</span>
<span class="token comment"># 按照列索引排序</span>
df<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 索引重新0-(n-1)排，很有用，可以得到它的排序号</span>
s<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>na_position<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span> <span class="token comment"># 空值在前，另'last'表示空值在后</span>
s<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 如果多层，排一级</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>df.reindex()</code>指定自己定义顺序的索引，实现行和列的顺序重新定义:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 按要求重新指定索引顺序 </span>
df<span class="token punctuation">.</span>reindex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 可惜没有inplace这个属性，只能直接赋值给其他变量</span>
<span class="token comment"># 指定列顺序</span>
df<span class="token punctuation">.</span>reindex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="332-数值排序"><a class="markdownIt-Anchor" href="#332-数值排序"></a> 3.3.2 数值排序</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment">#Series排序</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#Dataframe排序</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">)</span> <span class="token comment"># 按Q1列数据升序排列 </span>
<span class="token comment">#指定是按升序还是降序，默认是升序</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 降序</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># team升序，Q1降序</span>
<span class="token comment">#inplace可以让修改生效</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 空值在前</span>
s<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>na_position<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>nsmallest()</code>和<code>nlargest()</code>用来实现数字列的排序，并可指定返回的个数:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 先按Q1最小在前，如果相同，Q2小的在前 </span>
df<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
name	team	Q1	Q2	Q3	Q4
37	Sebastian	C	1	14	68	48
85	Liam	B	2	80	24	25
39	Harley	B	2	99	12	13
82	Finn	E	4	1	55	32
58	Lewis	B	4	34	77	28
'''</span>
s<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 最小的3个 </span>
s<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 最大的3个</span>
<span class="token comment"># 指定列</span>
df<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="333-混合排序"><a class="markdownIt-Anchor" href="#333-混合排序"></a> 3.3.3 混合排序</h4>
<p>有时候需要用索引和数据值混合排序。下例中假如name是索引，我 们需要先按team排名，再按索引排名:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'s_name'</span><span class="token punctuation">]</span> <span class="token comment"># 给索引起名</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span><span class="token string">'s_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#以下方法也可以实现上述需求</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="34-分组聚合"><a class="markdownIt-Anchor" href="#34-分组聚合"></a> 3.4 分组聚合</h3>
<h4 id="341-基本操作"><a class="markdownIt-Anchor" href="#341-基本操作"></a> 3.4.1 基本操作</h4>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220826-15.png' width=500px>
</div>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 按团队分组对应列相加</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 按团队分组对应列求平均</span>
<span class="token comment"># 不同列不同的计算方法 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span> <span class="token builtin">sum</span><span class="token punctuation">,</span> <span class="token comment"># 总和</span>
                        <span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token comment"># 总数 </span>
                        <span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token string">'mean'</span><span class="token punctuation">,</span> <span class="token comment"># 平均 </span>
                        <span class="token string">'Q4'</span><span class="token punctuation">:</span> <span class="token builtin">max</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 最大值</span>
<span class="token comment"># 对同一列使用不同的计算方法</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">sum</span><span class="token punctuation">,</span><span class="token string">'std'</span><span class="token punctuation">,</span><span class="token builtin">max</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># 使用三个方法</span>
                        <span class="token string">'Q2'</span><span class="token punctuation">:</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token comment"># 总数 </span>
                        <span class="token string">'Q3'</span><span class="token punctuation">:</span><span class="token string">'mean'</span><span class="token punctuation">,</span> <span class="token comment"># 平均 </span>
                        <span class="token string">'Q4'</span><span class="token punctuation">:</span> <span class="token builtin">max</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 最大值</span>
<span class="token triple-quoted-string string">'''
Q1	Q2	Q3	Q4
sum	std	max	count	mean	max
team						
A	1066	24.155136	96	17	51.470588	97
B	975	32.607896	97	22	54.636364	99
C	1056	31.000768	98	22	48.545455	98
D	860	25.886166	80	19	65.315789	99
E	963	33.242767	97	20	44.050000	98
'''</span>
<span class="token comment"># 按行聚合</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token string">"mean"</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">"columns"</span><span class="token punctuation">)</span>
<span class="token comment"># 利用pd.Series.add方法对所有数据加分，other是add方法的参数 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">.</span>add<span class="token punctuation">,</span> other<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对Series也可以使用分组聚合，<code>df.Q1</code>是一个Series，它的分组依据是<code>df.team</code>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 对Series df.Q1按team分组，求和 </span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>df<span class="token punctuation">.</span>team<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>按照索引，进行分类统计：（可以参考“数据堆叠”、解堆）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="342-统计描述"><a class="markdownIt-Anchor" href="#342-统计描述"></a> 3.4.2 统计描述</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 由于列过多，我们进行转置</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还支持以下常用的统计方法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 描述性统计 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 求和 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 每组数量，不包括缺失值 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 求最大值 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 求最小值 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 分组数量 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 平均值 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 中位数 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 标准差 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>var<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 方差</span>
grouped<span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 相关性系数 </span>
grouped<span class="token punctuation">.</span>sem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 标准误差 </span>
grouped<span class="token punctuation">.</span>prod<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 乘积 </span>
grouped<span class="token punctuation">.</span>cummax<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 每组的累计最大值 </span>
grouped<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 累加 </span>
grouped<span class="token punctuation">.</span>mad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 平均绝对偏差</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="343-组内分位数"><a class="markdownIt-Anchor" href="#343-组内分位数"></a> 3.4.3 组内分位数</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 二分位数，即中位数 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 同下 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="35-数据的统计计算"><a class="markdownIt-Anchor" href="#35-数据的统计计算"></a> 3.5 数据的统计计算</h3>
<h4 id="351-描述统计"><a class="markdownIt-Anchor" href="#351-描述统计"></a> 3.5.1 描述统计</h4>
<p><code>df.describe()</code>会返回一个有多行的所有数字列的统计表，每一行对应一个统计指标，有总数、平均数、标准差、最小值、四分位数、最大值等，这个表对我们初步了解数据很有帮助。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>还可以自己指定分位数(一般情况下，默认值包含中位数)，指定和排除数据类型:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span>percentiles<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">.05</span><span class="token punctuation">,</span> <span class="token number">.25</span><span class="token punctuation">,</span> <span class="token number">.75</span><span class="token punctuation">,</span> <span class="token number">.95</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 指定类型 </span>
df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span>exclude <span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 排除类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="352-数学统计"><a class="markdownIt-Anchor" href="#352-数学统计"></a> 3.5.2 数学统计</h4>
<p>DataFrame使用统计函数后会生成一个Series，这个Series的索引为每个数字类型列的列名，值为此列的平均数。如果DataFrame没有任何数字类型列，则会报错。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#平均数</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># pandas.core.series.Series</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Series应用数学统计函数一般会给出一个数字定值，直接计算出这一列的统计值:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 如果我们希望按行计算平均数，即数据集中每个学生Q1到Q4的成 绩的平均数，可以传入axis参数，列传index或0，行传columns或1:</span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 效果同上 </span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 效果同上</span>
<span class="token triple-quoted-string string">'''
0     49.50
1     41.75
2     54.75
3     84.50
4     65.25
      ...  
95    67.00
96    31.25
97    53.00
98    58.50
99    44.75
Length: 100, dtype: float64
'''</span>
<span class="token comment">#它仅对数字类型的列起作用，会忽略文本等其他类型。我们发现， 索引仍然是默认的自然索引，无法辨认是谁的成绩，所以可以先创建 name为索引再进行计算:</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
name
Liver       49.50
Arry        41.75
Ack         54.75
Eorge       84.50
Oah         65.25
            ...  
Gabriel     67.00
Austin7     31.25
Lincoln4    53.00
Eli         58.50
Ben         44.75
Length: 100, dtype: float64
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>统计函数总结：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回所有列的均值 </span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 返回所有行的均值，下同 </span>
df<span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回列与列之间的相关系数 </span>
df<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回每一列中的非空值的个数 </span>
df<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回每一列的最大值 </span>
df<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回每一列的最小值</span>
df<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 绝对值</span>
df<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回每一列的中位数</span>
df<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回每一列的标准差，贝塞尔校正的样本标准偏差 </span>
df<span class="token punctuation">.</span>var<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 无偏方差</span>
df<span class="token punctuation">.</span>sem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 平均值的标准误差</span>
df<span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 众数</span>
df<span class="token punctuation">.</span>prod<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 连乘</span>
df<span class="token punctuation">.</span>mad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 平均绝对偏差</span>
df<span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 累积连乘，累乘</span>
df<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 累积连加，累加</span>
df<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 去重数量，不同值的量</span>
df<span class="token punctuation">.</span>idxmax<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 每列最大值的索引名</span>
df<span class="token punctuation">.</span>idxmin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 每列最小值的索引名</span>
df<span class="token punctuation">.</span>cummax<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 累积最大值</span>
df<span class="token punctuation">.</span>cummin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 累积最小值</span>
df<span class="token punctuation">.</span>skew<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 样本偏度(第三阶)</span>
df<span class="token punctuation">.</span>kurt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 样本峰度(第四阶)</span>
df<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 样本分位数(不同 % 的值)</span>
<span class="token comment">#一些特殊方法</span>
df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> skipna<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 不除缺失数据</span>
df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token string">'blooded'</span><span class="token punctuation">)</span> <span class="token comment"># 索引级别</span>
df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 执行加法操作所需的最小有效值数 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="36-数据的非统计计算"><a class="markdownIt-Anchor" href="#36-数据的非统计计算"></a> 3.6 数据的非统计计算</h3>
<p>如去重、格式化等。接下来我们将介绍一些数据的加工处理方法。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 返回所有列all()值的Series </span>
df<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 四舍五入</span>
df<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 指定字段指定保留小数位，如有 </span>
df<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q1'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 保留10位</span>
<span class="token comment"># 每个列的去重值的数量 </span>
df<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 本列的去重值</span>
<span class="token comment"># 真假检测</span>
df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 值的真假值替换 </span>
df<span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 与上相反</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Series的一些专有函数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 不重复的值及数量</span>
s<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span> 
s<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 重复值的频率 </span>
s<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>sort<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 不按频率排序</span>
s<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 去重的值 array </span>
s<span class="token punctuation">.</span>is_unique <span class="token comment"># 是否有重复</span>
<span class="token comment"># 最大最小值</span>
s<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 最大的前5个 </span>
s<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token comment"># 最大的前15个 </span>
s<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 最小的前5个 </span>
s<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token comment"># 最小的前15个</span>
s<span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 计算与前一行的变化百分比 </span>
s<span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 前两行</span>
s1<span class="token punctuation">.</span>cov<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># 两个序列的协方差</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="37-逻辑运算"><a class="markdownIt-Anchor" href="#37-逻辑运算"></a> 3.7 逻辑运算</h3>
<p>我们以<b>DataFrame其中一列</b>进行逻辑计算，会<u>产生一个对应的由布尔值组成的Series</u>，真假值由此位上的数据是否满足逻辑表达式决定。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># Q1成绩大于36 </span>
df<span class="token punctuation">.</span>Q1 <span class="token operator">></span> <span class="token number">36</span>
<span class="token triple-quoted-string string">'''
0 True
1     False
2      True
3      True
4      True
      ...
95     True
96    False
97     True
98    False
99    False
Name: Q1, Length: 100, dtype: bool
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一个<b>针对索引的逻辑表达式会</b>产生一个<u>array类型数组</u>，该数组由布尔值组成。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 索引等于1</span>
df<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token number">1</span>
<span class="token triple-quoted-string string">'''
array([False, True, False, False, False, False, False, False, F
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再看一下<b>关于DataFrame的逻辑运算</b>，判断数值部分的所有值是否大于60，满足表达式的值显示为True，不满足表达式的值显示为False。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># df.loc[:,'Q1':'Q4']部分只取数字部分，否则会因字符无大于运算而报错</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">60</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>除了逻辑运算，Pandas还支持组合条件的Python位运算:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Q1成绩不小于60分，并且是C组成员 </span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token operator">~</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'C'</span><span class="token punctuation">)</span> <span class="token comment">#~是非的意思</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="38-数据筛选"><a class="markdownIt-Anchor" href="#38-数据筛选"></a> 3.8 数据筛选</h3>
<h4 id="381-行与列的筛选"><a class="markdownIt-Anchor" href="#381-行与列的筛选"></a> 3.8.1 行与列的筛选</h4>
<p>（1）选择列</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查看指定列</span>
df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>Q1 <span class="token comment"># 同上，如果列名符合Python变量名要求，可使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这里返回的是一个<b>Series类型数据，可以理解为数列，它也是带索引的。</b>之前建立的索引在这里发挥出了作用，否则我们的索引是一个数字，无法知道与之对应的是谁的数据。</p>
<p>选择多列的可以用以下方法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 选择多列</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 只看这两列，注意括号 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 和上一行效果一样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>df.loc[x, y]</code>是一个非常强大的<b>数据选择函数</b>，其中<code>x</code>代表行，<code>y</code>代表列，行和列都支持条件表达式，也支持类似列表那样的切片(如果要用<b>自然索引</b>，需要用<code>df.iloc[]</code>)。</p>
<p>(2)选择行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 用指定索引选取</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token string">'Liver'</span><span class="token punctuation">]</span> <span class="token comment"># 指定姓名</span>
<span class="token comment"># 用自然索引选择，类似列表的切片 </span>
df<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># 取前三行</span>
df<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment"># 在前10个中每两个取一个 </span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># 前10个</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="382-逻辑筛选数据"><a class="markdownIt-Anchor" href="#382-逻辑筛选数据"></a> 3.8.2 逻辑筛选数据</h4>
<p>切片(<code>[]</code>)、<code>.loc[]</code>和<code>.iloc[]</code>均支持上文所介绍的逻辑表达式。通过逻辑表达式进行复杂条件的数据筛选时需要注意，表达式输出的结果必须是一个布尔序列或者符合其格式要求的数据形式。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token comment"># 筛选出Q1中等于8的数据</span>
<span class="token triple-quoted-string string">'''
	name	team	Q1	Q2	Q3	Q4
43	Jude	E	8	45	13	65
45	Rory9	E	8	12	58	27
'''</span>
df<span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 筛选出Q1中不等于8的数据</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'Ben'</span><span class="token punctuation">]</span> <span class="token comment"># 筛选出姓名为Ben的数据 </span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">></span> df<span class="token punctuation">.</span>Q2<span class="token punctuation">]</span>
<span class="token comment"># 表达式与切片一致</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q3'</span><span class="token punctuation">]</span> <span class="token comment"># Q1大于90，只显示Q1到Q3列</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q2 <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># and关系 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q2 <span class="token operator">&lt;</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># or关系 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token comment"># 等于8</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Q1 <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token comment"># 等于8</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># Q1大于90，显示Q1及其后所有列</span>
<span class="token comment"># Q1、Q2成绩全为超过80分的 </span>
df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> 
<span class="token comment"># Q1、Q2成绩至少有一个超过80分的 </span>
df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="383-函数筛选数据"><a class="markdownIt-Anchor" href="#383-函数筛选数据"></a> 3.8.3 函数筛选数据</h4>
<p>可以在表达式处使用<code>lambda</code>函数，默认变量是其操作的对象。如果 操作的对象是一个DataFrame，那么变量就是这个DataFrame;如果是一 个Series，那么就是这个Series。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查询最大索引的值</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">[</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> <span class="token builtin">max</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 值为21</span>
<span class="token comment"># 计算最大值</span>
<span class="token builtin">max</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token comment"># 99</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">[</span>df<span class="token punctuation">.</span>index<span class="token operator">==</span><span class="token number">99</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
99 21
Name: Q1, dtype: int64
'''</span>
df<span class="token punctuation">[</span><span class="token keyword">lambda</span> df<span class="token punctuation">:</span> df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token comment"># Q1为8的</span>
df<span class="token punctuation">[</span><span class="token keyword">lambda</span> df<span class="token punctuation">:</span> df<span class="token punctuation">.</span>Q1 <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token comment"># Q1为8的</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token keyword">lambda</span> df<span class="token punctuation">:</span> df<span class="token punctuation">.</span>Q1 <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q2'</span><span class="token punctuation">]</span> <span class="token comment"># Q1为8的，显示 Q1、Q2 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> df<span class="token punctuation">:</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment"># 列名长度等于4的series</span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> df<span class="token punctuation">:</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">#列名长度等于4的series的前三行</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> df<span class="token punctuation">:</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns <span class="token keyword">if</span> <span class="token string">'Q'</span> <span class="token keyword">in</span> i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 列名中带Q的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另外还有一个<code>.isin()</code>函数，用于判断数据是否包含指定内容。可以传入一个列表，原数据只需要满足其中一个存在即可;也可以传入一个字典，键为列名，值为需要匹配的值，以实现按列个性化匹配存在值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>team<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 包含A、B两组的</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#复杂查询，其他值为nan</span>
<span class="token triple-quoted-string string">'''

name	team	Q1	Q2	Q3	Q4
0	NaN	NaN	NaN	NaN	NaN	NaN
1	NaN	C	36.0	NaN	NaN	NaN
2	NaN	NaN	NaN	NaN	NaN	NaN
3	NaN	C	93.0	NaN	NaN	NaN
4	NaN	D	NaN	NaN	NaN	NaN
...	...	...	...	...	...	...
95	NaN	C	NaN	NaN	NaN	NaN
96	NaN	C	NaN	NaN	NaN	NaN
97	NaN	C	NaN	NaN	NaN	NaN
98	NaN	NaN	NaN	NaN	NaN	NaN
99	NaN	NaN	NaN	NaN	NaN	NaN
100 rows × 6 columns
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="384-用dfquery和dfeval来筛选数据"><a class="markdownIt-Anchor" href="#384-用dfquery和dfeval来筛选数据"></a> 3.8.4 用df.query()和df.eval()来筛选数据</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 > Q2 > 90'</span><span class="token punctuation">)</span> <span class="token comment"># 直接写类型SQL where语句 </span>
<span class="token comment">#或者可以写成：</span>
string <span class="token operator">=</span> <span class="token string">'Q1 > Q2 > 90'</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment"># 直接写类型SQL where语句 </span>
<span class="token comment">##################################################</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 + Q2 > 180'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 == Q2'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'(Q1&lt;50) &amp; (Q2>40) and (Q3>90)'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 > Q2 > Q3 > Q4'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'team != "C"'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'team not in ("E","A","B")'</span><span class="token punctuation">)</span>
<span class="token comment"># 对于名称中带有空格的列，可以使用反引号引起来 </span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'B == `team name`'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还支持使用<code>@</code>符引入变量:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 支持传入变量，如大于平均分40分的 </span>
a <span class="token operator">=</span> df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 > @a+40'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Q1 > `Q2`+@a'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>df.eval()与df.query()类似，也可以用于表达式筛选:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># df.eval()用法与df.query类似 </span>
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"Q1 > 90 > Q3 > 10"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> 
df<span class="token punctuation">[</span>df<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"Q1 > `Q2`+@a"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="385-用dffilter筛选行名和列名"><a class="markdownIt-Anchor" href="#385-用dffilter筛选行名和列名"></a> 3.8.5 用df.filter()筛选行名和列名</h4>
<p><code>df.filter()</code>可以对行名和列名进行筛选，支持模糊匹配、正则表达式。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>items<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 选择两列 </span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'Q'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 列名包含Q的列 </span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'e$'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 正则，以e结尾的列 </span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'Q^'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 正则，索引名以Q开头</span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>like<span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 索引中有2的</span>
<span class="token comment"># 索引中以2开头、列名有Q的</span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'^2'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>like<span class="token operator">=</span><span class="token string">'Q'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#注意：上面的参数axis，表示是按行来筛选，还是按列来筛选。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="386-按数据类型筛选"><a class="markdownIt-Anchor" href="#386-按数据类型筛选"></a> 3.8.6 按数据类型筛选</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'float64'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 选择float64型数据 </span>
df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">'bool'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 只取数字型 </span>
df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'int'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 排除int类型 </span>
df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'datetime64'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="39-文件合并"><a class="markdownIt-Anchor" href="#39-文件合并"></a> 3.9 文件合并</h3>
<h4 id="391-多文件合并"><a class="markdownIt-Anchor" href="#391-多文件合并"></a> 3.9.1 多文件合并</h4>
<p>汇总表往往费时费力，如果用代码来实现就会省力很多。最简单的方法是先把数据一个个地取出来，然后进行合并:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 通过各种方式读取数据</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data1<span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'tmp.xlsx'</span><span class="token punctuation">)</span> 
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'tmp.csv'</span><span class="token punctuation">)</span>
<span class="token comment"># 合并数据</span>
merged_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">,</span> df3<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，不要一个表格用一次concat，这样性能会很差，可以先把所有表格加到列表里，然后一次性合并:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># process_your_file(f)方法将文件读取为DataFrame </span>
frames <span class="token operator">=</span> <span class="token punctuation">[</span>process_your_file<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">]</span> <span class="token comment"># 合并</span>
result <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>frames<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>【实战】同一Excel下多sheet数据合并并求和。</p>
<p>该文件中有三个sheet，每个sheet名称是企业的名称（乙企业、丙企业、甲企业），每个 sheet 的结构一模一样。整体思路是让所有的 sheet 转为 DataFrame，然后直接相加，因为相同结构的 DataFrame 可以直接完成向量化的操作。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/company.xlsx'</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'甲企业'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'栏目'</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'乙企业'</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'丙企业'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'栏目'</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df1<span class="token operator">+</span>df2<span class="token operator">+</span>df3
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'汇总.xlsx'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="392-同一目录下文件合并"><a class="markdownIt-Anchor" href="#392-同一目录下文件合并"></a> 3.9.2 同一目录下文件合并</h4>
<p>有时会将体量比较大的数据分片放到同一个硬盘目录下，在使用时进行合并。可以使用Python的官方库glob来识别目录文件:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> glob
<span class="token comment"># 取出目录下所有XLSX格式的文件</span>
files <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"data/*.xlsx"</span><span class="token punctuation">)</span>
cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">,</span> <span class="token string">'时间'</span><span class="token punctuation">,</span> <span class="token string">'名称'</span><span class="token punctuation">]</span> <span class="token comment"># 只取这些列</span>
<span class="token comment"># 列表推导出对象</span>
dflist <span class="token operator">=</span> <span class="token punctuation">[</span>pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>i<span class="token punctuation">,</span> usecols<span class="token operator">=</span>cols<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> files<span class="token punctuation">]</span> 
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>dflist<span class="token punctuation">)</span> <span class="token comment"># 合并</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其他方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 目录下的所有文件</span>
<span class="token keyword">from</span> os <span class="token keyword">import</span> listdir
filepaths <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> listdir<span class="token punctuation">(</span><span class="token string">"./data"</span><span class="token punctuation">)</span> <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.csv'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment">#找到data文件夹下所有以'.csv'结尾的文件</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">,</span> filepaths<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="310-虚拟变量"><a class="markdownIt-Anchor" href="#310-虚拟变量"></a> 3.10 虚拟变量</h3>
<p>以下将原始数据的a列生成了一个虚拟变量数据:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#生成虚拟变量</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment">#原数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">'a1'</span><span class="token punctuation">:</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token string">'b1'</span><span class="token punctuation">:</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''	
a	b	a1	b1
0	A	F	0	4
1	D	E	1	5
2	C	H	2	6
3	B	G	3	7
'''</span>
pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token comment"># 生成虚拟变量</span>
<span class="token triple-quoted-string string">'''
	A	B	C	D
0	1	0	0	0
1	0	0	0	1
2	0	0	1	0
3	0	1	0	0
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只关注<code>df.a</code>列:a列共有A、B、C、D四个值，故新数据有此四列;索引和列名交叉的位置如果为1，说明此索引位上的值为列名，为0则表示不为列名。例如，在索引2上，1在C列，对比原数据发现<code>df.loc[2, ‘a’]</code>为C。</p>
<p>有的原数据的部分列(如下例中的a1列)值为纯数字，为了方便使用，需要给生成虚拟变量的列名增加一个前缀，用<code>prefix</code>来定义:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'a1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">'a1'</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
a1_0	a1_1	a1_2	a1_3
0	1	0	0	0
1	0	1	0	0
2	0	0	1	0
3	0	0	0	1
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以直接对DataFrame生成虚拟变量，会将所有<b>非数字列</b>生成虚拟变量(<b>数字列</b>保持不变):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220827-16.png' width=400px>
</div>
<h2 id="4用python将数据导出"><a class="markdownIt-Anchor" href="#4用python将数据导出"></a> 4.用Python将数据导出</h2>
<h3 id="41-将数据导出为表格excel等"><a class="markdownIt-Anchor" href="#41-将数据导出为表格excel等"></a> 4.1 将数据导出为表格（Excel等）</h3>
<p>可以非常轻松地导出Excel和CSV文件。</p>
<h4 id="411-excel"><a class="markdownIt-Anchor" href="#411-excel"></a> 4.1.1 Excel</h4>
<p>实战操作（单个Dataframe）：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># 引入Pandas库，按惯例起别名pd</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'month'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">2013</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'sale'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">)</span> <span class="token comment"># 将dataframe写入excel，并导出 Excel文件 </span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 不要索引</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'自定义Sheet'</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 指定sheet名，不要索引</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment">#不要表头</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> index_label<span class="token operator">=</span><span class="token string">'label'</span><span class="token punctuation">,</span> merge_cells<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 指定索引名，不合并单元格</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> index_label<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 指定索引，多个值代表多层索引</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token string">'sale'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 只要这两列</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> startrow<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> startcol<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 从哪行取，从哪列取</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'team-done.xlsx'</span><span class="token punctuation">,</span> inf_rep<span class="token operator">=</span><span class="token string">'inf'</span><span class="token punctuation">)</span> <span class="token comment"># 无穷大表示法(Excel中没有无穷大的本机表示法)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-17.png' width=400px>
  <p align='center' style='font-family:kaiti'>指定索引名为'label'</p>
</div>
<p>导出多个Dataframe到一个Excel，可以借助ExcelWriter对象来实现。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'month'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">2013</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'sale'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string">'double_df.xlsx'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> writer<span class="token punctuation">:</span>
  df1<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'成绩单'</span><span class="token punctuation">)</span>
  df2<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'销售额'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>导出的时候定义样式：（可参考4.2.6）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 指定缺失值的处理方式</span>
dfs<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'gairuo.xlsx'</span><span class="token punctuation">,</span> na_rep<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">)</span>
<span class="token comment"># 浮点数字格式，下例将0.1234转为0.12 </span>
dfs<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'gairuo.xlsx'</span><span class="token punctuation">,</span> float_format<span class="token operator">=</span><span class="token string">"%.2f"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="412-csv"><a class="markdownIt-Anchor" href="#412-csv"></a> 4.1.2 CSV</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'team-done.csv'</span><span class="token punctuation">)</span> <span class="token comment"># 导出 CSV文件</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'team-done.csv'</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 不要索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>另外还可以使用<code>sep</code>参数指定分隔符，<code>columns</code>传入一个序列指定列名，编码用<code>encoding</code>传入。如果不需要表头，可以将<code>header</code>设为<code>False</code>。 如果文件较大，可以使用<code>compression</code>进行压缩:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建一个包含out.csv的压缩文件out.zip </span>
compression_opts <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'zip'</span><span class="token punctuation">,</span>archive_name<span class="token operator">=</span><span class="token string">'out.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'out.zip'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>compression<span class="token operator">=</span>compression_opts<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="413-html"><a class="markdownIt-Anchor" href="#413-html"></a> 4.1.3 HTML</h4>
<p><code>DataFrame.to_html</code>会将DataFrame中的数据组装在HTML代码的<code>table</code>标签中，输入一个字符串，这部分HTML代码可以放在网页中进行展示，也可以作为邮件正文。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 生成HTML</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_html<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#同上</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_html<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 输出指定列 </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_html<span class="token punctuation">(</span>bold_rows<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 表头不加粗 </span>
<span class="token comment"># 表格指定样式，支持多个 </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_html<span class="token punctuation">(</span>classes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'class1'</span><span class="token punctuation">,</span> <span class="token string">'class2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-18.png' width=300px>
  <p align='center' style='font-family:kaiti'>这部分HTML代码可以放在网页中进行展示</p>
</div>
<h4 id="414-markdown"><a class="markdownIt-Anchor" href="#414-markdown"></a> 4.1.4 Markdown</h4>
<p>需要提前在<code>pip</code>或者<code>conda</code>（如果安装的是anaconda或者miniconda）安装<code>tabulate</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> tabulate
conda <span class="token function">install</span> tabulate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">.</span>to_markdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到的这段Markdown代码可以放在typora中进行展示。</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-19.png' width=350px>
  <p>得到的这段Markdown代码可以放在typora中进行展示</p>
</div>
<h3 id="42-pandas样式"><a class="markdownIt-Anchor" href="#42-pandas样式"></a> 4.2 Pandas样式</h3>
<h4 id="421-空值高亮"><a class="markdownIt-Anchor" href="#421-空值高亮"></a> 4.2.1 空值高亮</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment">#####空值高亮##########</span>
<span class="token comment"># 将一个值改为空</span>
df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>NaN
<span class="token comment"># 将空值高亮，默认为红色背景 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_null<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 使用颜色名 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_null<span class="token punctuation">(</span>null_color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span> <span class="token comment"># 使用颜色值 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_null<span class="token punctuation">(</span>null_color<span class="token operator">=</span><span class="token string">'#ccc'</span><span class="token punctuation">)</span>

<span class="token comment">#####极值高亮##########</span>
<span class="token comment"># 将最大值高亮，默认为黄色背景 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_max<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 将最小值高亮</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 以上同时使用并指定颜色 </span>
<span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style
 <span class="token punctuation">.</span>highlight_null<span class="token punctuation">(</span>null_color<span class="token operator">=</span><span class="token string">'#ccc'</span><span class="token punctuation">)</span> <span class="token comment">#将空值高亮并指定颜色</span>
 <span class="token punctuation">.</span>highlight_max<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'lime'</span><span class="token punctuation">)</span> <span class="token comment"># 将最大值高亮并指定颜色</span>
 <span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 将最小值高亮 </span>
<span class="token punctuation">)</span>
<span class="token comment"># 以上标注的是在列中的最大值和最小值，也可以指定在行上的最大值和最小值</span>
<span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style
 <span class="token punctuation">.</span>highlight_null<span class="token punctuation">(</span>null_color<span class="token operator">=</span><span class="token string">'#ccc'</span><span class="token punctuation">)</span> <span class="token comment">#将空值高亮并指定颜色——null没有axis这个属性哦</span>
 <span class="token punctuation">.</span>highlight_max<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'lime'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 将最大值高亮并指定颜色</span>
 <span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 将最小值高亮 </span>
<span class="token punctuation">)</span>
<span class="token comment">######只对某些行列起作用#############</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 只对Q1起作用</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 对Q1、Q2两列起作用</span>
<span class="token comment"># 按行，只在这两列进行</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>highlight_min<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="422-背景渐变"><a class="markdownIt-Anchor" href="#422-背景渐变"></a> 4.2.2 背景渐变</h4>
<p>可通过这个网址查看色系名和颜色示例:</p>
<p><a target="_blank" rel="noopener" href="https://matplotlib.org/devdocs/gallery/color/colormap_reference.html">https://matplotlib.org/devdocs/gallery/color/colormap_reference.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 数字类型按列背景渐变 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 指定列，指定颜色系列 </span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'BuGn'</span><span class="token punctuation">)</span>
<span class="token comment"># 颜色应用的取值范围，不在这个范围的不应用 </span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>vmin<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment"># 链式方法使用样式 </span>
<span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style
 <span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'spring'</span><span class="token punctuation">)</span> <span class="token comment"># 指定色系 </span>
 <span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment"># 指定应 </span>
 <span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> high<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 高低百分 </span>
 <span class="token punctuation">.</span>background_gradient<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> text_color_threshold<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span> <span class="token comment">#</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="423-显示格式"><a class="markdownIt-Anchor" href="#423-显示格式"></a> 4.2.3 显示格式</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 给所有数据加一个方括号 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"[&#123;&#125;]"</span><span class="token punctuation">)</span> <span class="token comment">#&#123;&#125;里面的是原数据</span>
<span class="token comment"># 百分号</span>
<span class="token comment"># df.style.format("&#123;:%.2%%&#125;") #没实现</span>
<span class="token comment"># 指定列全变为大写</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># B，保留四位;D，两位小数并显示正负号</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Q2'</span><span class="token punctuation">:</span> <span class="token string">"&#123;:0&lt;4.0f&#125;"</span><span class="token punctuation">,</span> <span class="token string">'Q4'</span><span class="token punctuation">:</span> <span class="token string">'&#123;:+.2f&#125;'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="424-添加标题"><a class="markdownIt-Anchor" href="#424-添加标题"></a> 4.2.4 添加标题</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 添加标题 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">'学生成绩表'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="425-设置全局的数据精度"><a class="markdownIt-Anchor" href="#425-设置全局的数据精度"></a> 4.2.5 设置全局的数据精度</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 保留两位小数 </span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_precision<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 等同于</span>
df<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="426-表格css样式"><a class="markdownIt-Anchor" href="#426-表格css样式"></a> 4.2.6 表格css样式</h4>
<p>如果内置样式无法实现，可以通过直接指定HTML树节点上的CSS样式来实现复杂的功能。因此，在理解以下功能时需要有一定的HTML和CSS等前端编程基础。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 将Q1列文字设为红色</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_properties<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># 一些其他示例</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_properties<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">,</span> align<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_properties<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'background-color'</span><span class="token punctuation">:</span> <span class="token string">'yellow'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_properties<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'width'</span><span class="token punctuation">:</span> <span class="token string">'100px'</span><span class="token punctuation">,</span> <span class="token string">'font-size'</span><span class="token punctuation">:</span> <span class="token string">'18px'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>style<span class="token punctuation">.</span>set_properties<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'background-color'</span><span class="token punctuation">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
                           <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'lawngreen'</span><span class="token punctuation">,</span>
                           <span class="token string">'border-color'</span><span class="token punctuation">:</span> <span class="token string">'white'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="43-生成图表并导出图片可视化"><a class="markdownIt-Anchor" href="#43-生成图表并导出图片可视化"></a> 4.3 生成图表并导出图片(可视化)</h3>
<h4 id="431-折线图-plotline"><a class="markdownIt-Anchor" href="#431-折线图-plotline"></a> 4.3.1 折线图 plot.line</h4>
<p>plot默认是指折线图。基本调用方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># DataFrame调用 </span>
df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Series调用 </span>
s<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上Series默认会生成折线图，x轴为索引，y轴为数据。</p>
<p>对于 DataFrame，会将所有的数字列以多条折线的形式显示在图形中。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Ben'</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Ben四个季度的成绩变化</span>
<span class="token comment"># 各Team四个季度总成绩趋势 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
grouped <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span> <span class="token comment">#分组</span>
grouped<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>基于以上逻辑，如果希望指定的列显示为x轴，可以先将其设为索引，</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>
  df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 取部分 </span>
  <span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 设为索引 </span>
  <span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 折线图</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以指定x轴和y轴:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 指定x轴和y轴</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 指定多条</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="432-柱状图plotbar和plotbarh"><a class="markdownIt-Anchor" href="#432-柱状图plotbar和plotbarh"></a> 4.3.2 柱状图plot.bar和plot.barh</h4>
<p>DataFrame可以直接调用plot.bar()生成柱状图，与折线图类似，x轴为索引，其他数字类型的列为y轴上的条形。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'Ben'</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 柱状图 </span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'Ben'</span><span class="token punctuation">,</span><span class="token string">'Q1'</span><span class="token punctuation">:</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>barh<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 横向柱状图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Series索引为x轴，值为y轴，有值为非数字时会报错。与折线图一样，如果数据中有负值，则0刻度会在x轴之上，不会在图形底边。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">(</span>
  df<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Q1<span class="token operator">=</span>df<span class="token punctuation">.</span>Q1<span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">)</span> <span class="token comment"># 让Q1产生部分负值 </span>
  <span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment"># 取部分</span>
  <span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 设为索引</span>
  <span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 柱状图</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以将同一索引的多个数据堆叠起来，操作如以下代码所示</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>
  df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment"># 取部分 </span>
  <span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 设为索引 </span>
  <span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>stacked<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 柱状图, 堆叠</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>barh可以将柱形设置为横向，以下为一个横向+堆叠的例子</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>
  df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment"># 取部分 </span>
  <span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 设为索引</span>
  <span class="token punctuation">.</span>plot<span class="token punctuation">.</span>barh<span class="token punctuation">(</span>stacked<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 柱状图, 横向+堆叠</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>和折线图一样，柱状图也支持子图</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 柱状图，子图 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>subplots<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="433-直方图-plothist"><a class="markdownIt-Anchor" href="#433-直方图-plothist"></a> 4.3.3 直方图 plot.hist</h4>
<p>直方图(Histogram)又称质量分布图，由一系列高度不等的纵向条纹或线段表示数据分布的情况。一般用横轴表示数据类型，纵轴表示分布情况。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">grouped<span class="token punctuation">.</span>hist<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="434-饼图-plotpie"><a class="markdownIt-Anchor" href="#434-饼图-plotpie"></a> 4.3.4 饼图 plot.pie</h4>
<p>饼图(Pie Chart)可以表示不同分类的数据在总体中的占比情况，占比大小体现在弧度大小上，整个圆饼为数据的总量。一个Series很容易绘成一个饼图：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token punctuation">.</span>plot<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>DataFrame需要指定y值，示例代码如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token comment"># 各组人数对比 </span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-20.png' width=300px>
</div>
<p>子图：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>subplots<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment">#并不美观</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>一块饼被割下来一块的效果：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment">#导入数据</span>
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>

fig<span class="token punctuation">,</span>ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#创建子图</span>
explode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#该值若大于0，则说明被割下来离开一段距离</span>
colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'gold'</span><span class="token punctuation">,</span><span class="token string">'yellowgreen'</span><span class="token punctuation">,</span><span class="token string">'lightblue'</span><span class="token punctuation">,</span><span class="token string">'orange'</span><span class="token punctuation">]</span> <span class="token comment">#各个饼的颜色</span>

df_plt <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 需要作图的数据</span>
ax<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>df_plt<span class="token punctuation">.</span>Q1<span class="token punctuation">,</span> <span class="token comment">#分析Q1列的数据</span>
       explode<span class="token operator">=</span>explode<span class="token punctuation">,</span> <span class="token comment"># 设置割下来的效果</span>
       colors<span class="token operator">=</span>colors<span class="token punctuation">,</span> <span class="token comment"># 设置颜色</span>
      autopct<span class="token operator">=</span><span class="token string">'%1.1f%%'</span><span class="token punctuation">,</span> <span class="token comment">#设置显示比例的数字格式</span>
       shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#显示阴影，有立体效果 </span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>aspect<span class="token operator">=</span><span class="token string">'equal'</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'This is the title'</span><span class="token punctuation">)</span> <span class="token comment">#设置标题以及图形的对称</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-21.png' width=300px>
</div>
<h4 id="435-箱线图-plotboxplot"><a class="markdownIt-Anchor" href="#435-箱线图-plotboxplot"></a> 4.3.5 箱线图 plot.boxplot</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">grouped <span class="token operator">=</span> df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span>
grouped<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">"team"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>常见图形代码：</p>
<ul>
<li>plot.line:折线图</li>
<li>plot.pie:饼图</li>
<li>plot.bar:柱状图</li>
<li>plot.hist:直方图</li>
<li>plot.box:箱形图</li>
<li>plot.area:面积图</li>
<li>plot.scatter:散点图</li>
<li>plot.hexbin:六边形分箱图</li>
</ul>
<h3 id="43a-子图"><a class="markdownIt-Anchor" href="#43a-子图"></a> 4.3a 子图</h3>
<p>参考了知乎大神<a href='https://www.zhihu.com/people/luoyu-44-71' target='_blank'>share16</a>的文章。</p>
<p>如果一个折线图中有多条线，可以使用subplots来将它们分开，形成多张<b>子图</b>，</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token comment"># 显示子图 </span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>line<span class="token punctuation">(</span>subplots<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-22.png' width=400px>
</div>
<h4 id="43a1-均匀子图"><a class="markdownIt-Anchor" href="#43a1-均匀子图"></a> 4.3a.1 均匀子图</h4>
<p>但是，这四张子图摆放的格局并不美观，可以用<code>subplots</code>进一步设置。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token comment"># 下面两行代码用于创建画布，并分成m行n列的子图</span>
rows<span class="token punctuation">,</span>cols <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span>
fig<span class="token punctuation">,</span>ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span> <span class="token comment">#行数和列数</span>
                      figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#画面的长宽</span>
                      sharex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>sharey<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#是否共享x轴与y轴</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'示例'</span><span class="token punctuation">)</span>
index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'orange'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span>color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#读取自己的数据</span>
fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#自动调节子图大小，防止字符重叠</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-23.png' width=600px>
</div>
<h4 id="43a2-不规则子图这才是画子图的通用方法"><a class="markdownIt-Anchor" href="#43a2-不规则子图这才是画子图的通用方法"></a> 4.3a.2 不规则子图（这才是画子图的通用方法）</h4>
<p>我们发现按照上面方法生成的子图，每张子图并没办法单独命名。要实现这个缺憾，此外还有一个代码叫<code>subplot</code>，生成下面这种图！</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#生成数据</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token operator">**</span><span class="token number">3</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">]</span>
c <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
d <span class="token operator">=</span> c <span class="token operator">*</span> <span class="token number">4</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#设置整个画布的尺寸</span>
plt<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'这是总标题'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#(1,3,1)相当于把整张图分为1*3=3份，把它在第1份的位置！</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'$&#123;y=x^3&#125;$'</span><span class="token punctuation">)</span> <span class="token comment"># 可以使用latex语法！</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#(2,3,5)相当于把整张图分为2*3=6份，把它在第5份的位置！</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'v'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'y=4x'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>projection<span class="token operator">=</span><span class="token string">'polar'</span><span class="token punctuation">)</span> <span class="token comment">#极坐标中添加散点图，若直接用plt.polar(),则是一条线</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-24.png' width=550px>
</div>
<h4 id="43a3-非均匀子图"><a class="markdownIt-Anchor" href="#43a3-非均匀子图"></a> 4.3a.3 非均匀子图</h4>
<p>此外还有一种非均匀的子图：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token comment"># 下面两行代码用于创建画布，并分成m行n列的子图</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#设置整个画布的尺寸</span>
rows<span class="token punctuation">,</span>cols <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span>
spec <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_gridspec<span class="token punctuation">(</span>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span> <span class="token comment">#行数和列数</span>
                      width_ratios<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#两列图片的宽度比例</span>
index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span><span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Q3'</span><span class="token punctuation">,</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'orange'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span>spec<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>df<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span>color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#读取自己的数据</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'fig'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#自动调节子图大小，防止字符重叠</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-25.png' width=550px>
</div>
<h4 id="43a4-子图的方法"><a class="markdownIt-Anchor" href="#43a4-子图的方法"></a> 4.3a.4 子图的方法</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#生成数据</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token operator">**</span><span class="token number">3</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#设置整个画布的尺寸</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'line1'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'$&#123;y=x^3&#125;$'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#图例要配合上面的label</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#网格</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token string">'line2'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-26.png' width=400px>
</div>
<h3 id="44-plot的个性化设置"><a class="markdownIt-Anchor" href="#44-plot的个性化设置"></a> 4.4 plot()的个性化设置</h3>
<h4 id="441-plot基础方法"><a class="markdownIt-Anchor" href="#441-plot基础方法"></a> 4.4.1 plot()基础方法</h4>
<p>Series数据调用<code>plot</code>方法时，它的索引信息会排布在x轴上，y轴则是x轴上的索引对应的具体数据值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'1/1/2020'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ts<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>DataFrame调用plot时，x轴为DataFrame的索引，y轴上将显示其多 列的多条折线数据。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'1/1/2020'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df <span class="token operator">=</span><span class="token builtin">abs</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>DataFrame在绘图时可以指定x轴和y轴的列</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token comment"># 指定x和y轴的内容</span>
df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#指定两列y轴。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="442-设定x轴和y轴xy"><a class="markdownIt-Anchor" href="#442-设定x轴和y轴xy"></a> 4.4.2 设定x轴和y轴:x=,y=,</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 可以不写参数名，直接按位置传入 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 前五行Q1和Q2的成绩</span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>barh<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'Q4'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>area<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">,</span> <span class="token string">'Q2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Q3'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>横纵坐标命名</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># 引入Pandas库，按惯例起别名pd</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'/local_file/python/team.xlsx'</span><span class="token punctuation">)</span> <span class="token comment">#导入数据</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"SimHei"</span><span class="token punctuation">]</span> <span class="token comment">#字体</span>
<span class="token comment"># plt.rcParams["font.sans-serif"]=["Kaiti"] #字体</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"axes.unicode_minus"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">False</span> 
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"分组"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"总值"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-27.png' width=400px>
</div>
<h4 id="443-图形标题title"><a class="markdownIt-Anchor" href="#443-图形标题title"></a> 4.4.3 图形标题title=</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
dfp <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'Q1'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment">#对Q1进行排序</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Kaiti"</span><span class="token punctuation">]</span> <span class="token comment">#字体——没有这一样，图片中无法显示汉字。</span>
dfp<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'Q1前十名分布图'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220828-28.png' width=400px>
</div>
<h4 id="444-字体大小和图形大小fontsize"><a class="markdownIt-Anchor" href="#444-字体大小和图形大小fontsize"></a> 4.4.4 字体大小和图形大小fontsize=,</h4>
<p>fontsize指定轴上的字体大小，单位是pt(磅)。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 指定轴上的字体大小 </span>
dfp<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'Q1前十名分布图'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">#利用4.3.4的图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>figsize参数传入一个元组，可以指定图形的宽、高值（单位是英寸）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dfp<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'Q1前十名分布图'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#利用4.3.4的图</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>当然，可以给出全局默认的图形大小:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt 
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'figure.figsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">15.0</span><span class="token punctuation">,</span> <span class="token number">8.0</span><span class="token punctuation">)</span> <span class="token comment"># 固定显示大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="445-线条样式包括线条颜色stylecolorcolormap"><a class="markdownIt-Anchor" href="#445-线条样式包括线条颜色stylecolorcolormap"></a> 4.4.5 线条样式——包括线条颜色style=,color=,colormap=</h4>
<p><code>style</code>可指定图的线条等样式，并组合使用:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
<span class="token comment"># data = '/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span> <span class="token comment"># 虚线 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'-.'</span><span class="token punctuation">)</span> <span class="token comment"># 虚实相间 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">)</span> <span class="token comment"># 长虚线 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token comment"># 实线(默认) </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment"># 点 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'*-'</span><span class="token punctuation">)</span> <span class="token comment"># 实线，数值为星星 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'^-'</span><span class="token punctuation">)</span> <span class="token comment"># 实线，数值为三角形</span>
<span class="token comment"># 总体示例</span>
<span class="token comment"># 指定线条样式</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'.-'</span><span class="token punctuation">,</span> <span class="token string">'*-'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 同时指定颜色</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'.-'</span><span class="token punctuation">,</span> <span class="token string">'*-'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                 color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'blue'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'green'</span><span class="token punctuation">,</span><span class="token string">'black'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>colormap指定图形的配色，具体值可参考Matplotlib库的色系表。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>colormap<span class="token operator">=</span><span class="token string">'rainbow'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="446-背景辅助线grid"><a class="markdownIt-Anchor" href="#446-背景辅助线grid"></a> 4.4.6 背景辅助线grid=</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 增加背景辅助线 </span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>grid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="447-图例legend"><a class="markdownIt-Anchor" href="#447-图例legend"></a> 4.4.7 图例legend=</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 不显示图例 </span>
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>legend<span class="token operator">=</span><span class="token string">'reverse'</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="448-图形叠加"><a class="markdownIt-Anchor" href="#448-图形叠加"></a> 4.4.8 图形叠加</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 将两张图绘在一起 </span>
<span class="token punctuation">(</span>
    df<span class="token punctuation">[</span><span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="449-图形中的中文乱码问题"><a class="markdownIt-Anchor" href="#449-图形中的中文乱码问题"></a> 4.4.9 图形中的中文乱码问题</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># jupyter notebooks plt 图表配置</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt 
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'figure.figsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">15.0</span><span class="token punctuation">,</span> <span class="token number">8.0</span><span class="token punctuation">)</span> <span class="token comment"># 固定显示大小 </span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sans-serif'</span><span class="token punctuation">]</span> <span class="token comment"># 显示中文问题 </span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span> <span class="token comment"># 显示中文问题 </span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Kaiti'</span><span class="token punctuation">]</span> <span class="token comment"># 显示中文问题 </span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment"># 显示负号</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-时间序列"><a class="markdownIt-Anchor" href="#5-时间序列"></a> 5. 时间序列</h2>
<h3 id="51-时间属性"><a class="markdownIt-Anchor" href="#51-时间属性"></a> 5.1 时间属性</h3>
<p>我们先定义一个当前时间。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
time <span class="token operator">=</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'now'</span><span class="token punctuation">)</span>
<span class="token comment"># 输出Timestamp('2022-08-25 22:23:37.816849')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>以下是丰富的时间属性:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">time<span class="token punctuation">.</span>asm8 <span class="token comment"># 返回NumPy datetime64格式(以纳秒为单位) </span>
<span class="token comment">#numpy.datetime64('2022-08-25T22:28:08.438284000')</span>
time<span class="token punctuation">.</span>dayofweek <span class="token comment"># 3(周几，周一为0,周四为3)</span>
time<span class="token punctuation">.</span>dayofyear <span class="token comment"># 237(一年的第几天)</span>
time<span class="token punctuation">.</span>days_in_month <span class="token comment"># 31(当月有多少天)</span>
time<span class="token punctuation">.</span>daysinmonth <span class="token comment"># 31(同上)</span>
time<span class="token punctuation">.</span>freqstr <span class="token comment"># None(周期字符)</span>
time<span class="token punctuation">.</span>is_leap_year <span class="token comment"># True(是否闰年，公历的)</span>
time<span class="token punctuation">.</span>is_month_end <span class="token comment"># False(是否当月最后一天) </span>
time<span class="token punctuation">.</span>is_month_start <span class="token comment"># False(是否当月第一天) </span>
time<span class="token punctuation">.</span>is_quarter_end <span class="token comment"># False(是否当季最后一天) </span>
time<span class="token punctuation">.</span>is_quarter_start <span class="token comment"># False(是否当季第一天) </span>
time<span class="token punctuation">.</span>is_year_end <span class="token comment"># 是否当年最后一天</span>
time<span class="token punctuation">.</span>is_year_start <span class="token comment"># 是否当年第一天</span>
time<span class="token punctuation">.</span>quarter <span class="token comment"># 3(当前季度数)</span>
<span class="token comment"># 如指定，会返回类似&lt;DstTzInfo 'Asia/Shanghai' CST+8:00:00 STD> </span>
time<span class="token punctuation">.</span>tz <span class="token comment"># None(当前时区别名)</span>
time<span class="token punctuation">.</span>week <span class="token comment"># 34(当年第几周)</span>
time<span class="token punctuation">.</span>weekofyear <span class="token comment"># 34(同上)</span>
time<span class="token punctuation">.</span>day <span class="token comment"># 25(日) ,int型数据</span>
time<span class="token punctuation">.</span>fold <span class="token comment"># 0</span>
time<span class="token punctuation">.</span>freq <span class="token comment"># None(频度周期)</span>
time<span class="token punctuation">.</span>hour <span class="token comment"># 22</span>
time<span class="token punctuation">.</span>microsecond <span class="token comment"># 438284</span>
time<span class="token punctuation">.</span>minute <span class="token comment"># 28</span>
time<span class="token punctuation">.</span>month <span class="token comment"># 8</span>
time<span class="token punctuation">.</span>nanosecond <span class="token comment"># 0</span>
time<span class="token punctuation">.</span>second <span class="token comment"># 8</span>
time<span class="token punctuation">.</span>tzinfo <span class="token comment"># None</span>
time<span class="token punctuation">.</span>value <span class="token comment"># 1661466488438284000</span>
time<span class="token punctuation">.</span>year <span class="token comment"># 2022</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="52-时间的方法"><a class="markdownIt-Anchor" href="#52-时间的方法"></a> 5.2 时间的方法</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 转换为指定时区</span>
time<span class="token punctuation">.</span>tz_localize<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span>
<span class="token comment">#Timestamp('2022-08-25 22:28:08.438284+0800', tz='Asia/Shanghai')</span>
<span class="token comment"># 转换单位，向上舍入</span>
time<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span> <span class="token comment"># 转为以秒为单位</span>
time<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token string">'ns'</span><span class="token punctuation">)</span> <span class="token comment"># 转为以纳秒为单位</span>
time<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token comment"># 保留日</span>
<span class="token comment"># Timestamp('2022-08-26 00:00:00')</span>
time<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span> <span class="token comment"># 保留时</span>
<span class="token comment">#Timestamp('2022-08-25 23:00:00')</span>
<span class="token comment"># 转换单位，向下舍入</span>
time<span class="token punctuation">.</span>floor<span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span> <span class="token comment"># 保留时</span>
<span class="token comment">#Timestamp('2022-08-25 22:00:00')</span>
<span class="token comment"># 类似四舍五入 </span>
time<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span> <span class="token comment"># 保留时</span>
<span class="token comment"># 返回星期名</span>
time<span class="token punctuation">.</span>day_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'Tuesday'</span>
<span class="token comment"># 月份名称</span>
time<span class="token punctuation">.</span>month_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'August'</span>
<span class="token comment"># 将时间戳规范化为午夜，保留tz信息</span>
time<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#Timestamp('2022-08-25 00:00:00')</span>

<span class="token comment"># 将时间元素替换datetime.replace，可处理纳秒</span>
time<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>year<span class="token operator">=</span><span class="token number">2019</span><span class="token punctuation">)</span> <span class="token comment"># 年份换为2019年</span>
time<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>month<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment"># 月份换为8月</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="53-时间的格式化"><a class="markdownIt-Anchor" href="#53-时间的格式化"></a> 5.3 时间的格式化</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 解析时间格式</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token string">'2022*08*25'</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y*%m*%d'</span><span class="token punctuation">)</span>
<span class="token comment"># Timestamp('2022-08-25 00:00:00')</span>
pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'now'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y年%m月%d日'</span><span class="token punctuation">)</span>
<span class="token comment">#'2022年08月25日'</span>
t <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'20200801'</span><span class="token punctuation">,</span> <span class="token string">'20200802'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220825-29.png' width=550px>
  <p align='center' style='font-family:kaiti'>日期和时间的格式化符号</p>
</div>
<h2 id="附录python编程学习笔记"><a class="markdownIt-Anchor" href="#附录python编程学习笔记"></a> 附录：Python编程学习笔记</h2>
<h3 id="附录a-常见数据类型及转换"><a class="markdownIt-Anchor" href="#附录a-常见数据类型及转换"></a> 附录A 常见数据类型及转换</h3>
<p>Python中有六种主要的数据类型：<u>数字、字符串、列表、元组、集合和字段</u></p>
<p>有四种数字类型：<u>整数类型(int)、浮点类型(float)、复数类型(complex)和布尔类型(bool)</u></p>
<p>数字类型转换：【代码转换】</p>
<p><code>pd.to_XXX</code>系统方法可以将数据安全转换，<code>errors</code>参数可以实现无法转换则转换为兜底类型:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 按大体类型推定</span>
m1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment"># 转成数字</span>
<span class="token comment"># 应用函数</span>
df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">)</span>
m2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'2022-08-25'</span><span class="token punctuation">,</span><span class="token string">'2022-08-26'</span><span class="token punctuation">,</span><span class="token string">'2022-08-27'</span><span class="token punctuation">]</span>
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>m2<span class="token punctuation">)</span> <span class="token comment"># 转成时间</span>
pd<span class="token punctuation">.</span>to_timedelta<span class="token punctuation">(</span>m2<span class="token punctuation">)</span> <span class="token comment"># 转成时间差 ？？？？？？？？</span>
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>m1<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'coerce'</span><span class="token punctuation">)</span> <span class="token comment"># 错误处理 </span>
pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>m<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>m errors<span class="token operator">=</span><span class="token string">'coerce'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 兜底填充 </span>
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 组合成日期</span>
<span class="token comment">#astype()是最常见也是最通用的数据类型转换方法[貌似适用于dataframe]</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dtypes
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">)</span> <span class="token comment"># 索引类型转换 </span>
df<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int32'</span><span class="token punctuation">)</span> <span class="token comment"># 所有数据转换为int32 </span>
df<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'col1'</span><span class="token punctuation">:</span> <span class="token string">'int32'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># 指定字段转指定类型</span>
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">,</span> copy<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 不与原数据关联 </span>
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span> 
df<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span> 
data<span class="token punctuation">[</span><span class="token string">'Q4'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span> 
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">)</span> 
data<span class="token punctuation">[</span><span class="token string">'状态'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'bool'</span><span class="token punctuation">)</span>
<span class="token comment"># 将"89.3%"这样的文本转为浮点数</span>
data<span class="token punctuation">.</span>rate<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>布尔类型：只有两个值（True和False），它是整数类型的一个特例。转换为布尔类型：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 转换为bool类型</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># >>> False</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># >>> True</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment"># >>> False</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token comment"># >>> True</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># >>> False  空列表，被转换为False</span>
<span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment"># >>> False  空字典，被转换为False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>隐式类型转换</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token boolean">True</span>
a
<span class="token comment"># >>> 2 布尔值True被转换为整数1</span>
a <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> <span class="token boolean">True</span>
a
<span class="token comment"># >>> 2 布尔值True被转换为浮点数1.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="附录b-数据结构"><a class="markdownIt-Anchor" href="#附录b-数据结构"></a> 附录B 数据结构</h3>
<p>数据结构(Data structure)是组织数据、存储数据的方式。在计算机中，常见的数据结构有栈(Stack)、队列(Queue)、数组(Array)、链表(Linked List)、树(Tree)、图(Graph)等。</p>
<h4 id="b1-字符串"><a class="markdownIt-Anchor" href="#b1-字符串"></a> B.1 字符串</h4>
<p>字符串可以是一条或多条文本信息。</p>
<p>可以对字符串进行切片访问(同时适用于字符、列表、元组等)。 字符串从左往右，索引从0开始;从右往左，索引从-1开始。可以取字符串中的片段，切片索引按<b>左闭右开</b>原则:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">var <span class="token operator">=</span> <span class="token string">'I Love JL!'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#'JL'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#相当于复制</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#'ILv'(2为步长，按2的倍数取)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#实现反转字符功能</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><span style='color:red'>常见的字符串操作</span>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'good'</span><span class="token punctuation">)</span> <span class="token comment"># 4 (字符的长度)</span>
<span class="token string">'good'</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">)</span> <span class="token comment"># 'Good' (替换字符) </span>
<span class="token string">'山-水-风-雨'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token comment"># ['山', '水', '风', '雨'] (用指定字符分隔)</span>
<span class="token string">'好山好水好风光'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'好'</span><span class="token punctuation">)</span> <span class="token comment"># ['', '山', '水', '风光'] </span>
<span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'山'</span><span class="token punctuation">,</span><span class="token string">'水'</span><span class="token punctuation">,</span><span class="token string">'风'</span><span class="token punctuation">,</span><span class="token string">'雨'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># '山-水-风-雨',用join前面的字符把后面的列表元素粘起来</span>
<span class="token string">'和'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'诗'</span><span class="token punctuation">,</span> <span class="token string">'远方'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># '诗和远方'</span>
<span class="token string">'good'</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'GOOD' (全转大写)</span>
<span class="token string">'GOOD'</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'good' (全转小写)</span>
<span class="token string">'Good Bye'</span><span class="token punctuation">.</span>swapcase<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'gOOD bYE' (大小写互换) </span>
<span class="token string">'good'</span><span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 'Good' (首字母转大写)</span>
<span class="token string">'good'</span><span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># True (是否全是小写)</span>
<span class="token string">'good'</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># False (是否全是大写)</span>
<span class="token string">'3月'</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># '03月' (指定长度，如长度不够，前面补0)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="b2-列表list"><a class="markdownIt-Anchor" href="#b2-列表list"></a> B.2 列表(list)</h4>
<p>列表是用方括号组织起来的，每个元素用逗号隔开，每个具体元素可以是任意类型的内容。通常元素的类型是相同的，但也可以不相同，例如:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># 空列表</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 各种类型混杂 </span>
<span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># list 类型检测</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>列表和字符串一样支持切片访问，可以将字符串中的一个字符当成列表中的一个元素。以下是一些常用的列表操作:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 3(元素个数)</span>
<span class="token builtin">max</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 3(最大值)</span>
<span class="token builtin">min</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 1(最小值)</span>
<span class="token builtin">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 6(求和)</span>
a<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 1(指定元素位置)</span>
a<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 1(求元素的个数)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># 迭代元素</span>
<span class="token builtin">sorted</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 返回一个排序的列表，但不改变原列表</span>
<span class="token builtin">any</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># True(是否至少有一个元素为真)</span>
<span class="token builtin">all</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># True(是否所有元素为真)</span>
a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># a: [1, 2, 3, 4](增加一个元素)</span>
a<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 每执行一次，删除最后一个元素</span>
a<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># a: [1, 2, 3, 9, 8](与其他列表合并)</span>
a<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># a: [1, 'a', 2, 3](在指定索引位插入元素，索引从0开 </span>
a<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># 删除第一个指定元素</span>
a<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># [](清空)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>生成一个列表：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#可以对结果进行处理：</span>
<span class="token punctuation">[</span><span class="token string">'第'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-30.png' width=350px>
</div>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 可以进行条件筛选，实现取偶数</span>
<span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 拆开字符，过滤空格，全变成大写</span>
<span class="token punctuation">[</span>i<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">'Hello world'</span> <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">]</span>
<span class="token comment"># ['H', 'E', 'L', 'L', 'O', 'W', 'O', 'R', 'L', 'D']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="b3-元组"><a class="markdownIt-Anchor" href="#b3-元组"></a> B.3 元组</h4>
<p>元组(tuple)跟列表(list)非常相似，二者之间的差异是<span style='color:red'>元组不可改变</span>，而列表是可以改变的。元组使用圆括号()。</p>
<p>元组是不可修改的，我们修改元素时，就会报错，但是我们可以修改混杂类型里的列表类型数据。</p>
<p>我们需要掌握<span style='color:red'>元组的解包操作</span>，这些操作可以让我们灵活地赋值、定义函数、传参，非常方便。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment">#下面是元组的解包操作</span>
a<span class="token punctuation">,</span> <span class="token operator">*</span>b <span class="token operator">=</span> x <span class="token comment"># a占第一个，剩余的组成列表全给b</span>
a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> x <span class="token comment"># a占第一个，c占最后一个，剩余的组成列表全给b</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-31.png' width=350px>
</div>
<p>元组的一些操作：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
a<span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># 输出(1,2,3,4,5,6)</span>

b <span class="token operator">=</span> a<span class="token operator">*</span><span class="token number">3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment"># 输出(1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>&quot;修改&quot;元组中的元素</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">#a的最后一个元素是[3,4,5],[3,4,5]的最后一个元素是5，将其替换为10.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># (1, 2, [3, 4, 10])，对应于上面提到的“可以修改混杂类型里的列表类型数据”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>索引元组中的内容：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">#输出[3, 4, 5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>生成一个元组：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#输出(1, 2, [0, 2, 4, 6, 8])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="b4-字典"><a class="markdownIt-Anchor" href="#b4-字典"></a> B.4 字典</h4>
<p>字典由“键”“值”对组成。（在客观世界中，所 有的事件都有它的属性和属性对应的值，比如某种花的颜色是红色，有 5个花瓣。其中颜色和花瓣数量是属性，红色和5是值。）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">#定义空字典</span>
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 定义空字典</span>
d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>
d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token comment"># &#123;'a': 1&#125; key不能重复，重复时取最后一个</span>
d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token comment"># 嵌套字典</span>
d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span> <span class="token comment"># 嵌套列表</span>

<span class="token comment"># 以下均可定义如下结果</span>
<span class="token comment"># &#123;'name': 'Tom', 'age': 18, 'height': 180&#125;</span>
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Tom'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问字典元素的方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token comment"># 'Tom'(获取键的值) </span>
d<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># 将age的值更新为20 </span>
d<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'man'</span> <span class="token comment"># 增加属性 </span>
d<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token comment"># 180</span>
<span class="token comment"># 嵌套取值</span>
d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span> 
d<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 5</span>
d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token comment"># 18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>常用的字典操作：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment"># 'Tom'(删除指定key) </span>
d<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 随机删除某一项</span>
<span class="token keyword">del</span> d<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token comment"># 删除键值对 </span>
d<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 清空字典</span>
<span class="token comment"># 按类型访问，可迭代</span>
d<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 列出所有键</span>
d<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 列出所有值</span>
d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 列出所有键值对元组(k, v)</span>
<span class="token comment"># 操作</span>
d<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 插入一个键并给定默认值3，如不指定，则为None </span>
d1<span class="token punctuation">.</span>update<span class="token punctuation">(</span>dict2<span class="token punctuation">)</span> <span class="token comment"># 将字典dict2的键值对添加到字典dict</span>
<span class="token comment"># 如果键存在，则返回其对应值;如果键不在字典中，则返回默认值 d.get('math', 100) # 100</span>
d2 <span class="token operator">=</span> d<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 深拷贝，d变化不影响d2</span>

d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>
<span class="token builtin">max</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># 'c'(最大的键)</span>
<span class="token builtin">min</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># 'a'(最小的键)</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># 3(字典的长度)</span>
<span class="token builtin">str</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># "&#123;'a': 1, 'b': 2, 'c': 3&#125;"(字符串形式) any(d) # True(只要一个键为True)</span>
<span class="token builtin">all</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># True(所有键都为True)</span>
<span class="token builtin">sorted</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># ['a', 'b', 'c'](所有键的列表排序)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="b5-集合"><a class="markdownIt-Anchor" href="#b5-集合"></a> B.5 集合</h4>
<p>集合(set)是存放<b>无顺序、无索引内容</b>的容器。在Python中，集合用花括号{}表示。<span style='color:red'>我们用集合可以消除重复的元素</span>，也可以用它作交、差、并、补等数学运算。以下是它的定义方法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment"># 空集合</span>
s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'5元'</span><span class="token punctuation">,</span> <span class="token string">'10元'</span><span class="token punctuation">,</span> <span class="token string">'20元'</span><span class="token punctuation">&#125;</span> <span class="token comment"># 定义集合</span>
s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 空集合</span>
s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># &#123;1, 2, 3, 4, 5&#125;(使用列表定义) </span>
s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">&#125;</span>
s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token comment"># &#123;1&#125;(去重)</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment"># set(类型检测)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>集合没有顺序，没有索引，所以无法指定位置去访问，但可以用<code>for</code>遍历的方式进行读取。以下是一些常用的操作:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">&#125;</span>
<span class="token comment"># 判断是否有某个元素 </span>
<span class="token string">'a'</span> <span class="token keyword">in</span> s <span class="token comment"># True</span>
<span class="token comment"># 添加元素</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># &#123;2, 'a', 'b', 'c'&#125;</span>
s<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># &#123;1, 2, 3, 4, 'a', 'b', 'c'&#125;</span>
<span class="token comment"># 删除和清空元素</span>
s<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># &#123;'b', 'c'&#125;(删除不存在的会报错) </span>
s<span class="token punctuation">.</span>discard<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span> <span class="token comment"># 删除一个元素，无则忽略，不报错 </span>
s<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># set()(清空)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>集合的数学运算</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span>
s2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">&#125;</span>
s1 <span class="token operator">&amp;</span> s2 <span class="token comment"># &#123;2, 3&#125;(交集)</span>
s1<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;2, 3&#125;(交集) </span>
s1<span class="token punctuation">.</span>intersection_update<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;2, 3&#125;(交集，会覆盖s1)</span>
s1<span class="token operator">|</span>s2 <span class="token comment">#&#123;1,2,3,4&#125;(并集) </span>
s1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;1, 2, 3, 4&#125;(并集)</span>
s1<span class="token punctuation">.</span>difference<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;1&#125;(差集) </span>
s1<span class="token punctuation">.</span>difference_update<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;1&#125;(差集，会覆盖s1)</span>
s1<span class="token punctuation">.</span>symmetric_difference<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># &#123;1, 4&#125;(交集之外)</span>
s1<span class="token punctuation">.</span>isdisjoint<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># False(是否没有交集)</span>
s1<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># False (s1是否是s2的子集)</span>
s1<span class="token punctuation">.</span>issuperset<span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment"># False(s1是否是s2的超集，即s1是否包含s2中的所有元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="附录c-numpy"><a class="markdownIt-Anchor" href="#附录c-numpy"></a> 附录C Numpy</h3>
<h4 id="c1-入门"><a class="markdownIt-Anchor" href="#c1-入门"></a> C.1 入门</h4>
<p>NumPy的ndarray提供了一维到三维的数据结构，图2-2所示为同构数据多维容器，所有元素必须是相同类型。</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-32.png' width=500px>
</div>
<p>使用NumPy需要先导入，约定俗成地为它起别名np。使用np.array 可传入一个元组或列表。如果是二维数据，可以是由列表组成的列表或 由元组组成的列表等形式。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 同上 # array([1, 2, 3])</span>
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 同上 </span>
<span class="token triple-quoted-string string">'''
array([[1, 2],
			[1, 2]])
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>常见的数据生成函数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 10个，不包括10，步长为1 </span>
np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token comment"># 从3到9，步长为0.1</span>
<span class="token comment"># 从2.0到3.0，生成均匀的5个值，不包括终值3.0 </span>
np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> endpoint<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 返回一个6×4的随机数组，浮点型 </span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment"># 指定范围、指定形状的数组，整型 </span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment"># 创建值为0的数组</span>
np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment"># 6个浮点0.</span>
np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment"># 5×6整型0 np.ones(4) # 同上</span>
np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># 同上</span>
<span class="token comment"># 创建一份和目标结构相同的0值数组 </span>
np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
np<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 同上 </span>
np<span class="token punctuation">.</span>empty_like<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 同上</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="c2-numpy的数据类型"><a class="markdownIt-Anchor" href="#c2-numpy的数据类型"></a> C.2 numpy的数据类型</h4>
<p>由于Pandas中的数据类型部分继承了NumPy的数据类型，所以我们需要了解一下NumPy的常见类型。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>int64 <span class="token comment"># 有符号64位整型</span>
np<span class="token punctuation">.</span>float32 <span class="token comment"># 标准双精度浮点类型 </span>
np<span class="token punctuation">.</span><span class="token builtin">complex</span> <span class="token comment"># 由128位的浮点数组成的复数类型 </span>
np<span class="token punctuation">.</span><span class="token builtin">bool</span> <span class="token comment"># bool类型(True或False) </span>
np<span class="token punctuation">.</span><span class="token builtin">object</span> <span class="token comment"># Python中的object类型 </span>
np<span class="token punctuation">.</span>string <span class="token comment"># 固定长度的string类型 </span>
np<span class="token punctuation">.</span><span class="token builtin">unicode</span> <span class="token comment"># 固定长度的unicode类型 </span>
np<span class="token punctuation">.</span>NaN <span class="token comment"># np.float的子类型</span>
np<span class="token punctuation">.</span>nan<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="c3-格式转换"><a class="markdownIt-Anchor" href="#c3-格式转换"></a> C.3 格式转换</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#####DataFrame转为ndarray#######</span>
df<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 转换指定的列</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Q1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#####Series转为ndarray#########</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以用<code>np.array</code>直接读取DataFrame或者Series数据，最终也会转换为array类型:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>df<span class="token punctuation">)</span> <span class="token comment"># Dataframe转</span>
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1<span class="token punctuation">)</span> <span class="token comment"># 直接转</span>
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token comment"># PandasArray转 </span>
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_records<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span>np<span class="token punctuation">.</span>matrix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 转为矩阵</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="c4-统计计算"><a class="markdownIt-Anchor" href="#c4-统计计算"></a> C.4 统计计算</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># 支持类似列表的切片 </span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token operator">+</span>b <span class="token comment"># array([11, 22, 33, 44])(矩阵相加)</span>
a<span class="token operator">-</span><span class="token number">1</span> <span class="token comment"># array([9, 19, 29, 39])</span>
<span class="token number">4</span><span class="token operator">*</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment"># 以下是一些数学函数的例子，还支持非常多的数学函数 </span>
a<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 40</span>
a<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 10</span>
a<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 100</span>
a<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 11.180339887498949</span>
a<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># True</span>
a<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># array([10, 30, 60, 100]) </span>
b<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 多维可以指定方向</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="附录d-pandas"><a class="markdownIt-Anchor" href="#附录d-pandas"></a> 附录D Pandas</h3>
<h4 id="d1-安装与引用"><a class="markdownIt-Anchor" href="#d1-安装与引用"></a> D.1 安装与引用</h4>
<p><a href='https://pandas.pydata.org/docs/' target='_blank'>Pandas</a>（Panel data）是Python这门编程语言中一个专门用来做数据分析的第三方库，它由Wes McKinney在2008年开发，它的基本功能如下：</p>
<ul>
<li>从Excel、CSV、网页、SQL、剪贴板等文件或工具中读取数据;</li>
<li>合并多个文件或者电子表格中的数据，将数据拆分为独立文件；</li>
<li>数据清洗，如去重、处理缺失值、填充默认值、补全格式、处理 极端值等;</li>
<li>按一定业务逻辑插入计算后的列、删除列;</li>
<li>灵活方便的数据查询、筛选;</li>
<li>对时序数据进行分组采样，如按季、按月、按工作小时，也可以 自定义周期，如工作日;</li>
<li>为数据表格增加展示样式，提高数据识别效率。</li>
</ul>
<p>首先安装pandas库。打开“终端”并执行以下命令:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> pandas matplotlib <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装成功后，可以直接导入pandas</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 引入 Pandas库，按惯例起别名pd </span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>一个大神的教程：<a href='https://www.gairuo.com/p/pandas-tutorial' target='_blank'>pandas教程</a></p>
<h4 id="d2-pandas的数据类型"><a class="markdownIt-Anchor" href="#d2-pandas的数据类型"></a> D.2 pandas的数据类型</h4>
<p>（1）Series</p>
<p>如以下各国2019年的GDP就是一 个典型的Series。其中，国家是标签(也称索引)，不是具体的数据，它起到解释、定位数据的作用。如果没有标签，只有一个数字，是不具有业务意义的。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">中国 <span class="token number">14.34</span> 
美国 <span class="token number">21.43</span> 
日本 <span class="token number">5.08</span> 
dtype<span class="token punctuation">:</span> float64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>一些统计运算：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
Q1 49.20
Q2 52.55
Q3 52.67
Q4 52.78
dtype: float64
'''</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># pandas.core.series.Series</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果我们希望按行计算平均数，即数据集中每个学生Q1到Q4的成绩的平均数，可以传入axis参数，列传index或0，行传columns或1:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span> 
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 效果同上 </span>
df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 效果同上</span>
<span class="token triple-quoted-string string">'''
0 49.50
1 41.75
2 54.75
3 84.50
4 65.25
...
95 67.00
96 31.25
97 53.00
98 58.50
99 44.75
Length: 100, dtype: float64
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以将Series转换为list</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
list0 <span class="token operator">=</span> s<span class="token punctuation">.</span>to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list0<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(2)Dataframe</p>
<div align='center'>
  <img src='/../../images/python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%89%8B%E5%86%8C/image-20220824-33.png' width=500px>
</div>
<p>分析其结构：</p>
<ul>
<li>横向的称作行(row)，我们所说的一条数据就是指其中的一 行;</li>
<li>纵向的称作列(column)或者字段，是一条数据的某个值;</li>
<li>第一行是表头，或者叫字段名，类似于Python字典里的键，代表数据的属性;</li>
<li>第一列是索引，就是这行数据所描述的主体，也是这条数据的关键;</li>
<li>行索引和列索引可能会出现多层索引的情况(后面会遇到)。</li>
</ul>
<p>（3）索引</p>
<ul>
<li>索引(index):行和列上的标签，标识二维数据坐标的行索引和列索引，默认情况下，指的是每一行的索引。如果是Series，那只能是它行上的索引。列索引又被称为字段名、表头。</li>
<li>自然索引、数字索引:行和列的0~n(n为数据长度-1)形式的索引，数据天然具有的索引形式。虽然可以指定为其他名称，但在有些方法中依然可以使用。</li>
<li>标签(label):行索引和列索引，如果是Series，那只能是它行上的索引。</li>
<li><b>轴(axis):仅用在DataFrame结构中，代表数据的方向，如行和列，用0代表列(默认)，1代表行。</b></li>
</ul>
<h4 id="d3-自建数据"><a class="markdownIt-Anchor" href="#d3-自建数据"></a> D.3 自建数据</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># 引入Pandas库，按惯例起别名pd</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'month'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">2013</span><span class="token punctuation">,</span> <span class="token number">2014</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token string">'sale'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">)</span> <span class="token comment">#设置'month'为索引</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">,</span>append<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#增加一个索引创建多级索引</span>
df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#传入列表创建多级索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="d4-函数pipe的应用"><a class="markdownIt-Anchor" href="#d4-函数pipe的应用"></a> D.4 函数pipe()的应用</h4>
<p>Pandas提供的<code>pipe()</code>叫作管道方法，DataFrame和Series都支持<code>pipe()</code>方法。<code>pipe()</code>的语法结构为 <code>df.pipe(&lt;函数名&gt;, &lt;传给函数的参数列表或字典&gt;)</code>。它将DataFrame或Series作为函数的第一个参数，可以根据需求返回自己定义的任意类型数据。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 筛选出Q1大于等于80且Q2大于等于90的数据</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>pipe<span class="token punctuation">(</span><span class="token keyword">lambda</span> df_<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> df_<span class="token punctuation">[</span><span class="token punctuation">(</span>df_<span class="token punctuation">.</span>Q1<span class="token operator">>=</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df_<span class="token punctuation">.</span>Q2<span class="token operator">>=</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="d5-函数apply"><a class="markdownIt-Anchor" href="#d5-函数apply"></a> D.5 函数apply()</h4>
<p><code>apply()</code>可以对DataFrame按行和列(默认)进行函数处理，也支持Series。如果是Series，逐个传入具体值，DataFrame逐行或逐列传入:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Series的例子</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#### Dataframe的例子######</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 去掉一个最高分和一个最低分再算出平均分</span>
<span class="token keyword">def</span> <span class="token function">my_mean</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
  max_min_ser <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#去掉最大值和最小值</span>
  <span class="token keyword">return</span> s<span class="token punctuation">.</span>append<span class="token punctuation">(</span>max_min_ser<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># 对数字列应用函数 </span>
df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>my_mean<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="d6-函数map"><a class="markdownIt-Anchor" href="#d6-函数map"></a> D.6 函数map()</h4>
<p><code>map()</code>根据输入对应关系映射值返回最终数据，用于Series对象或 DataFrame对象的一列。传入的值可以是一个字典，键为原数据值，值为替换后的值。可以传入一个函数(参数为Series的每个值)，还可以传入一个字符格式化表达式来格式化数据内容。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>team<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span><span class="token string">'一班'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token string">'二班'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">:</span><span class="token string">'三班'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token string">'四班'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">:</span><span class="token string">'五班'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">#将team中的ABCDE加以替换</span>
df<span class="token punctuation">.</span>team<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token string">'I am a &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span>
<span class="token comment"># 应用函数</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="附录da-pandas文本处理"><a class="markdownIt-Anchor" href="#附录da-pandas文本处理"></a> 附录Da pandas文本处理</h3>
<p>object和StringDtype是Pandas的两个文本类型。默认情况下，文本数据会被推断为object类型:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment"># 原数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a1'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">,</span> <span class="token string">'a2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'b1'</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'b2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dtypes
<span class="token comment"># 指定数据类型</span>
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">)</span> 
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>pd<span class="token punctuation">.</span>StringDtype<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#当然也可以使用之前介绍过的astype()进行转换:</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token comment"># 转换为object </span>
s<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token comment"># 转换为string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="da1-str访问器"><a class="markdownIt-Anchor" href="#da1-str访问器"></a> Da.1 .str访问器</h4>
<p>可以使用<code>.str.&lt;method&gt;</code>访问器(Accessor)来对内容进行字符操作:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'Boy'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">)</span>
<span class="token comment"># 转为小写</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于非字符类型，可以先转换再使用:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 转为object</span>
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span>
<span class="token comment"># 转为StringDtype </span>
df<span class="token punctuation">.</span>team<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span> 
df<span class="token punctuation">.</span>Q1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span>
<span class="token comment"># 对索引进行操作 </span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 对表头、列名进行操作 </span>
df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 移除字符串头尾空格&amp;小写&amp;替换下划线 </span>
df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>

s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 标题格式，每个单词大写</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 首字母大写 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>swapcase<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 大小写互换</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="da2-文本分隔"><a class="markdownIt-Anchor" href="#da2-文本分隔"></a> Da.2 文本分隔</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 构造数据</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'天_地_人'</span><span class="token punctuation">,</span> <span class="token string">'你_我_他'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'风_水_火'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">)</span>
<span class="token comment"># 用下划线分隔 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span>
<span class="token comment"># 取出每行第二个 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment"># []可以使用切片操作 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> 
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment"># 如果不指定分隔符，会按空格进行分隔 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 分隔后展开为DataFrame </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="da3-文本连接"><a class="markdownIt-Anchor" href="#da3-文本连接"></a> Da.3 文本连接</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment"># 文本序列</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">)</span>
<span class="token comment"># 默认无符号连接 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 用逗号连接 </span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment"># 如果序列中有空值，会默认忽略空值，也可以指定空值的占位符号:</span>
<span class="token comment"># 包含空值的文本序列</span>
t <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">)</span>
<span class="token comment"># 用逗号连接 </span>
t<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token comment"># 'h,i,k'</span>
<span class="token comment"># 用连字符</span>
t<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> na_rep<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token comment"># 'h,i,-,k'</span>
t<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> na_rep<span class="token operator">=</span><span class="token string">'j'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者有<code>.join</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'山'</span><span class="token punctuation">,</span><span class="token string">'水'</span><span class="token punctuation">,</span><span class="token string">'风'</span><span class="token punctuation">,</span><span class="token string">'雨'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># '山-水-风-雨',用join前面的字符把后面的列表元素粘起来</span>
<span class="token string">'和'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'诗'</span><span class="token punctuation">,</span> <span class="token string">'远方'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># '诗和远方'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="附录e-数据迭代"><a class="markdownIt-Anchor" href="#附录e-数据迭代"></a> 附录E 数据迭代</h3>
<h4 id="e1-迭代series"><a class="markdownIt-Anchor" href="#e1-迭代series"></a> E.1 迭代Series</h4>
<p>例子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> df<span class="token punctuation">.</span>name<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>迭代索引和指定的多列，使用Python内置的<code>zip</code>函数将其打包为可迭代的<code>zip</code>对象:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>q <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">,</span> df<span class="token punctuation">.</span>name<span class="token punctuation">,</span> df<span class="token punctuation">.</span>Q1<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="e2-按列迭代"><a class="markdownIt-Anchor" href="#e2-按列迭代"></a> E.2 按列迭代</h4>
<p>如需要迭代一个DataFrame的列，可以直接对DataFrame迭代，会循环得到列名:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 直接对DataFrame迭代 </span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">for</span> column <span class="token keyword">in</span> df<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span>
<span class="token comment"># 再利用df [列名]的方法迭代列</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token string">'/Users/juncker/dlog/source/local_file/python/team.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">for</span> column <span class="token keyword">in</span> df<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#可对每个列的内容进行迭代：</span>
<span class="token keyword">for</span> column <span class="token keyword">in</span> df<span class="token punctuation">:</span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> df<span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment">#可以迭代指定列</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> df<span class="token punctuation">.</span>name<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="附录f-lambda的用法"><a class="markdownIt-Anchor" href="#附录f-lambda的用法"></a> 附录F lambda的用法</h3>
<p>（1）直接赋给一个变量，然后再像一般函数那样调用</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">c<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">:</span>x<span class="token operator">*</span>y<span class="token operator">*</span>z
c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">#24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>当然，也可以在函数后面直接传递实参</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">#9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（2）将lambda函数作为参数传递给其他函数比如说结合map、filter、sorted、reduce等一些Python内置函数使用，下面举例说明。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fliter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">%</span><span class="token number">3</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># [3,6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>与sorted函数结合使用，比如：创建由元组构成的列表：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#按照第一个元素排序</span>
<span class="token builtin">sorted</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#[('a',2),('b',3),('c',1),('d',4)]</span>
<span class="token comment">#按照第二个元素排序</span>
<span class="token builtin">sorted</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#[('c',1),('a',2),('b',3),('d',4)]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>求字符串每个单词的长度</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sentence <span class="token operator">=</span> <span class="token string">"Welcome To Beijing!"</span>
words <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
lengths  <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>words<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/private_img/banner2.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/private_img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/private_img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/private_img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/private_img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="4040363416.html"><img class="prev-cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">中国经济发展史摘抄</div></div></a></div><div class="next-post pull-right"><a href="4225970321.html"><img class="next-cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">青海社会科学2022年第3期</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/private_img/yuyingnan.jpg" onerror="this.onerror=null;this.src='/private_img/404.gif'" alt="avatar"/></div><div class="author-info__name">揭晓</div><div class="author-info__description">随手写一写，揭晓这世界</div></div><a id="card-info-btn" href="/"><i></i><span>回到首页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E9%93%BE%E5%BC%8F%E6%96%B9%E6%B3%95%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-text"> 0. 链式方法的模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-python%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1. Python的安装与配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E7%94%A8python%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="toc-text"> 2.用Python将数据导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E4%BB%8Eexcel%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%88%B0python"><span class="toc-text"> 2.1 从Excel将数据导入到Python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#211-%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text"> 2.1.1 导入数据的基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#212-%E8%A1%A8%E5%A4%B4%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text"> 2.1.2 表头的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#213-%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="toc-text"> 2.1.3 导入数据类型的控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#214-%E8%B7%B3%E8%BF%87%E6%8C%87%E5%AE%9A%E8%A1%8C"><span class="toc-text"> 2.1.4 跳过指定行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#215-%E8%AF%BB%E5%8F%96%E6%8C%87%E5%AE%9A%E8%A1%8C"><span class="toc-text"> 2.1.5 读取指定行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#216-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E5%88%97"><span class="toc-text"> 2.1.6 使用指定列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#217-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF"><span class="toc-text"> 2.1.7 查看数据信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E4%BB%8Ecsv%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%88%B0python"><span class="toc-text"> 2.2 从csv将数据导入到Python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-%E7%AE%80%E4%BB%8B"><span class="toc-text"> 2.2.1 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-%E8%A1%A8%E5%A4%B4%E5%89%8D%E7%BC%80"><span class="toc-text"> 2.2.2 表头前缀</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E4%BB%8E%E5%89%AA%E8%B4%B4%E6%9D%BF%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text"> 2.3 从剪贴板导入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E7%BC%BA%E5%A4%B1%E5%80%BC%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text"> 2.4 缺失值的处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#241-%E6%89%BE%E5%87%BA%E7%BC%BA%E5%A4%B1%E5%80%BC"><span class="toc-text"> 2.4.1 找出缺失值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#242-%E7%BC%BA%E5%A4%B1%E5%80%BC%E7%9A%84%E5%90%84%E7%A7%8D%E5%A4%84%E7%90%86"><span class="toc-text"> 2.4.2 缺失值的各种处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%95%B0%E6%8D%AE%E6%9B%BF%E6%8D%A2"><span class="toc-text"> 2.5 数据替换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E7%94%A8pandas%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.用Pandas处理数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#311-%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.1 建立索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#312-%E4%BF%AE%E6%94%B9%E7%B4%A2%E5%BC%95%E5%90%8D"><span class="toc-text"> 3.1.2 修改索引名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#313-%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.3 指定索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#313a-%E5%B0%86%E4%B8%80%E4%B8%AAseries%E6%8C%87%E5%AE%9A%E4%B8%BA%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.3a 将一个Series指定为索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#314-%E6%97%B6%E9%97%B4%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.4 时间索引：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#315-%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.5 重置索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#316-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-text"> 3.1.6 索引的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#317-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text"> 3.1.7 索引的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#318-%E5%A4%9A%E5%B1%82%E7%B4%A2%E5%BC%95%E5%8C%85%E6%8B%AC%E5%B0%86dataframe%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%A4%9A%E5%B1%82%E7%B4%A2%E5%BC%95"><span class="toc-text"> 3.1.8 多层索引——包括将DataFrame转换为多层索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#318a-%E5%A4%9A%E5%B1%82%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.1.8a 多层索引操作——生成数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#319-%E6%A0%B9%E6%8D%AE%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F%E7%BB%93%E5%90%88331"><span class="toc-text"> 3.1.9 根据索引排序（结合3.3.1）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E8%A1%8C%E4%B8%8E%E5%88%97%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text"> 3.2 行与列的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#321-%E6%95%B0%E6%8D%AE%E7%AD%9B%E9%80%89"><span class="toc-text"> 3.2.1 数据筛选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#322-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%88%A0"><span class="toc-text"> 3.2.2 数据增删</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#323-%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5pdconcat"><span class="toc-text"> 3.2.3 数据连接pd.concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#323a-%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6pdmerge"><span class="toc-text"> 3.2.3a 数据合并pd.merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#324-%E4%BD%BF%E7%94%A8%E9%83%A8%E5%88%86%E5%88%97"><span class="toc-text"> 3.2.4 使用部分列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#325-%E5%88%A0%E9%99%A4"><span class="toc-text"> 3.2.5 删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#326-dfwhere"><span class="toc-text"> 3.2.6 df.where()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32a-%E4%BF%AE%E6%94%B9%E6%95%B0%E5%80%BC%E8%A1%8C%E4%B8%8E%E5%88%97%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text"> 3.2a 修改数值（行与列的操作）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32b-%E6%9B%BF%E6%8D%A2%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.2b 替换数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32c-%E5%A1%AB%E5%85%85%E7%A9%BA%E5%80%BC"><span class="toc-text"> 3.2c 填充空值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F"><span class="toc-text"> 3.3 数据排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#331-%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F%E7%BB%93%E5%90%88319"><span class="toc-text"> 3.3.1 索引排序（结合3.1.9）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#332-%E6%95%B0%E5%80%BC%E6%8E%92%E5%BA%8F"><span class="toc-text"> 3.3.2 数值排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#333-%E6%B7%B7%E5%90%88%E6%8E%92%E5%BA%8F"><span class="toc-text"> 3.3.3 混合排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-text"> 3.4 分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#341-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text"> 3.4.1 基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#342-%E7%BB%9F%E8%AE%A1%E6%8F%8F%E8%BF%B0"><span class="toc-text"> 3.4.2 统计描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#343-%E7%BB%84%E5%86%85%E5%88%86%E4%BD%8D%E6%95%B0"><span class="toc-text"> 3.4.3 组内分位数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%9F%E8%AE%A1%E8%AE%A1%E7%AE%97"><span class="toc-text"> 3.5 数据的统计计算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#351-%E6%8F%8F%E8%BF%B0%E7%BB%9F%E8%AE%A1"><span class="toc-text"> 3.5.1 描述统计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#352-%E6%95%B0%E5%AD%A6%E7%BB%9F%E8%AE%A1"><span class="toc-text"> 3.5.2 数学统计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E6%95%B0%E6%8D%AE%E7%9A%84%E9%9D%9E%E7%BB%9F%E8%AE%A1%E8%AE%A1%E7%AE%97"><span class="toc-text"> 3.6 数据的非统计计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-text"> 3.7 逻辑运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%E6%95%B0%E6%8D%AE%E7%AD%9B%E9%80%89"><span class="toc-text"> 3.8 数据筛选</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#381-%E8%A1%8C%E4%B8%8E%E5%88%97%E7%9A%84%E7%AD%9B%E9%80%89"><span class="toc-text"> 3.8.1 行与列的筛选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#382-%E9%80%BB%E8%BE%91%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.8.2 逻辑筛选数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#383-%E5%87%BD%E6%95%B0%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.8.3 函数筛选数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#384-%E7%94%A8dfquery%E5%92%8Cdfeval%E6%9D%A5%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE"><span class="toc-text"> 3.8.4 用df.query()和df.eval()来筛选数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#385-%E7%94%A8dffilter%E7%AD%9B%E9%80%89%E8%A1%8C%E5%90%8D%E5%92%8C%E5%88%97%E5%90%8D"><span class="toc-text"> 3.8.5 用df.filter()筛选行名和列名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#386-%E6%8C%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%AD%9B%E9%80%89"><span class="toc-text"> 3.8.6 按数据类型筛选</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#39-%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.9 文件合并</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#391-%E5%A4%9A%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.9.1 多文件合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#392-%E5%90%8C%E4%B8%80%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6"><span class="toc-text"> 3.9.2 同一目录下文件合并</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#310-%E8%99%9A%E6%8B%9F%E5%8F%98%E9%87%8F"><span class="toc-text"> 3.10 虚拟变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E7%94%A8python%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-text"> 4.用Python将数据导出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E4%B8%BA%E8%A1%A8%E6%A0%BCexcel%E7%AD%89"><span class="toc-text"> 4.1 将数据导出为表格（Excel等）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-excel"><span class="toc-text"> 4.1.1 Excel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-csv"><span class="toc-text"> 4.1.2 CSV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#413-html"><span class="toc-text"> 4.1.3 HTML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#414-markdown"><span class="toc-text"> 4.1.4 Markdown</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-pandas%E6%A0%B7%E5%BC%8F"><span class="toc-text"> 4.2 Pandas样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-%E7%A9%BA%E5%80%BC%E9%AB%98%E4%BA%AE"><span class="toc-text"> 4.2.1 空值高亮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-%E8%83%8C%E6%99%AF%E6%B8%90%E5%8F%98"><span class="toc-text"> 4.2.2 背景渐变</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#423-%E6%98%BE%E7%A4%BA%E6%A0%BC%E5%BC%8F"><span class="toc-text"> 4.2.3 显示格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#424-%E6%B7%BB%E5%8A%A0%E6%A0%87%E9%A2%98"><span class="toc-text"> 4.2.4 添加标题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#425-%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B2%BE%E5%BA%A6"><span class="toc-text"> 4.2.5 设置全局的数据精度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#426-%E8%A1%A8%E6%A0%BCcss%E6%A0%B7%E5%BC%8F"><span class="toc-text"> 4.2.6 表格css样式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E7%94%9F%E6%88%90%E5%9B%BE%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text"> 4.3 生成图表并导出图片(可视化)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#431-%E6%8A%98%E7%BA%BF%E5%9B%BE-plotline"><span class="toc-text"> 4.3.1 折线图 plot.line</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#432-%E6%9F%B1%E7%8A%B6%E5%9B%BEplotbar%E5%92%8Cplotbarh"><span class="toc-text"> 4.3.2 柱状图plot.bar和plot.barh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#433-%E7%9B%B4%E6%96%B9%E5%9B%BE-plothist"><span class="toc-text"> 4.3.3 直方图 plot.hist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#434-%E9%A5%BC%E5%9B%BE-plotpie"><span class="toc-text"> 4.3.4 饼图 plot.pie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#435-%E7%AE%B1%E7%BA%BF%E5%9B%BE-plotboxplot"><span class="toc-text"> 4.3.5 箱线图 plot.boxplot</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43a-%E5%AD%90%E5%9B%BE"><span class="toc-text"> 4.3a 子图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#43a1-%E5%9D%87%E5%8C%80%E5%AD%90%E5%9B%BE"><span class="toc-text"> 4.3a.1 均匀子图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#43a2-%E4%B8%8D%E8%A7%84%E5%88%99%E5%AD%90%E5%9B%BE%E8%BF%99%E6%89%8D%E6%98%AF%E7%94%BB%E5%AD%90%E5%9B%BE%E7%9A%84%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text"> 4.3a.2 不规则子图（这才是画子图的通用方法）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#43a3-%E9%9D%9E%E5%9D%87%E5%8C%80%E5%AD%90%E5%9B%BE"><span class="toc-text"> 4.3a.3 非均匀子图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#43a4-%E5%AD%90%E5%9B%BE%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text"> 4.3a.4 子图的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-plot%E7%9A%84%E4%B8%AA%E6%80%A7%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 4.4 plot()的个性化设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#441-plot%E5%9F%BA%E7%A1%80%E6%96%B9%E6%B3%95"><span class="toc-text"> 4.4.1 plot()基础方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#442-%E8%AE%BE%E5%AE%9Ax%E8%BD%B4%E5%92%8Cy%E8%BD%B4xy"><span class="toc-text"> 4.4.2 设定x轴和y轴:x&#x3D;,y&#x3D;,</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#443-%E5%9B%BE%E5%BD%A2%E6%A0%87%E9%A2%98title"><span class="toc-text"> 4.4.3 图形标题title&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#444-%E5%AD%97%E4%BD%93%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%9B%BE%E5%BD%A2%E5%A4%A7%E5%B0%8Ffontsize"><span class="toc-text"> 4.4.4 字体大小和图形大小fontsize&#x3D;,</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#445-%E7%BA%BF%E6%9D%A1%E6%A0%B7%E5%BC%8F%E5%8C%85%E6%8B%AC%E7%BA%BF%E6%9D%A1%E9%A2%9C%E8%89%B2stylecolorcolormap"><span class="toc-text"> 4.4.5 线条样式——包括线条颜色style&#x3D;,color&#x3D;,colormap&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#446-%E8%83%8C%E6%99%AF%E8%BE%85%E5%8A%A9%E7%BA%BFgrid"><span class="toc-text"> 4.4.6 背景辅助线grid&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#447-%E5%9B%BE%E4%BE%8Blegend"><span class="toc-text"> 4.4.7 图例legend&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#448-%E5%9B%BE%E5%BD%A2%E5%8F%A0%E5%8A%A0"><span class="toc-text"> 4.4.8 图形叠加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#449-%E5%9B%BE%E5%BD%A2%E4%B8%AD%E7%9A%84%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-text"> 4.4.9 图形中的中文乱码问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="toc-text"> 5. 时间序列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E6%97%B6%E9%97%B4%E5%B1%9E%E6%80%A7"><span class="toc-text"> 5.1 时间属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E6%97%B6%E9%97%B4%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text"> 5.2 时间的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%E6%97%B6%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text"> 5.3 时间的格式化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95python%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-text"> 附录：Python编程学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95a-%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E8%BD%AC%E6%8D%A2"><span class="toc-text"> 附录A 常见数据类型及转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95b-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text"> 附录B 数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#b1-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text"> B.1 字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b2-%E5%88%97%E8%A1%A8list"><span class="toc-text"> B.2 列表(list)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b3-%E5%85%83%E7%BB%84"><span class="toc-text"> B.3 元组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b4-%E5%AD%97%E5%85%B8"><span class="toc-text"> B.4 字典</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b5-%E9%9B%86%E5%90%88"><span class="toc-text"> B.5 集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95c-numpy"><span class="toc-text"> 附录C Numpy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#c1-%E5%85%A5%E9%97%A8"><span class="toc-text"> C.1 入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c2-numpy%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> C.2 numpy的数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c3-%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2"><span class="toc-text"> C.3 格式转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c4-%E7%BB%9F%E8%AE%A1%E8%AE%A1%E7%AE%97"><span class="toc-text"> C.4 统计计算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95d-pandas"><span class="toc-text"> 附录D Pandas</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#d1-%E5%AE%89%E8%A3%85%E4%B8%8E%E5%BC%95%E7%94%A8"><span class="toc-text"> D.1 安装与引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d2-pandas%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text"> D.2 pandas的数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d3-%E8%87%AA%E5%BB%BA%E6%95%B0%E6%8D%AE"><span class="toc-text"> D.3 自建数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d4-%E5%87%BD%E6%95%B0pipe%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text"> D.4 函数pipe()的应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d5-%E5%87%BD%E6%95%B0apply"><span class="toc-text"> D.5 函数apply()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d6-%E5%87%BD%E6%95%B0map"><span class="toc-text"> D.6 函数map()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95da-pandas%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86"><span class="toc-text"> 附录Da pandas文本处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#da1-str%E8%AE%BF%E9%97%AE%E5%99%A8"><span class="toc-text"> Da.1 .str访问器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#da2-%E6%96%87%E6%9C%AC%E5%88%86%E9%9A%94"><span class="toc-text"> Da.2 文本分隔</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#da3-%E6%96%87%E6%9C%AC%E8%BF%9E%E6%8E%A5"><span class="toc-text"> Da.3 文本连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95e-%E6%95%B0%E6%8D%AE%E8%BF%AD%E4%BB%A3"><span class="toc-text"> 附录E 数据迭代</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#e1-%E8%BF%AD%E4%BB%A3series"><span class="toc-text"> E.1 迭代Series</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e2-%E6%8C%89%E5%88%97%E8%BF%AD%E4%BB%A3"><span class="toc-text"> E.2 按列迭代</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95f-lambda%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-text"> 附录F lambda的用法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3276806131.html" title="博客搭建日志">博客搭建日志</a><time datetime="2022-12-31T16:41:30.871Z" title="更新于 2023-01-01 00:41:30">2023-01-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="328977694.html" title="调节理论第6章货币体系、信用和危机">调节理论第6章货币体系、信用和危机</a><time datetime="2022-12-30T15:46:51.659Z" title="更新于 2022-12-30 23:46:51">2022-12-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2441655422.html" title="调节理论第4章资本的积聚和集中">调节理论第4章资本的积聚和集中</a><time datetime="2022-12-30T15:46:33.275Z" title="更新于 2022-12-30 23:46:33">2022-12-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="123068617.html" title="现代社会中的科层制与水平组织">现代社会中的科层制与水平组织</a><time datetime="2022-12-30T14:24:19.133Z" title="更新于 2022-12-30 22:24:19">2022-12-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="538824905.html" title="在垂直扁平的组织结构中的领导和管理成功">在垂直扁平的组织结构中的领导和管理成功</a><time datetime="2022-12-30T14:17:15.290Z" title="更新于 2022-12-30 22:17:15">2022-12-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/private_img/banner2.gif')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 揭晓</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎参观我的<a href='https://github.com/dhndzwxj' target='_blank'>github</a>个人主页！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="js/utils.js"></script><script src="js/main.js"></script><script src="js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://dhndzwxj.github.io/5504202.html'
    this.page.identifier = ''
    this.page.title = 'python数据处理手册'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://https-www-dhndzwxj-top.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script type='text/javascript' src='https://ajax.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script id="dsq-count-scr" src="//https-www-dhndzwxj-top.disqus.com/count.js" async></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>