<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>微观计量经济学 | 小荷才露尖尖角</title><meta name="author" content="揭晓"><meta name="copyright" content="揭晓"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="安徽大学许文立：应用计量经济学讲稿 配套dofile  2021版课件 lecture1导论 lecture2 潜在结果分析框架 lecture3 截面数据的参数和非参数估计方法 lecture4 线性回归更多专题 lecture5 面板数据的参数和非参数方法 2020版期末试题">
<meta property="og:type" content="article">
<meta property="og:title" content="微观计量经济学">
<meta property="og:url" content="https://dhndzwxj.github.io/767402338.html">
<meta property="og:site_name" content="小荷才露尖尖角">
<meta property="og:description" content="安徽大学许文立：应用计量经济学讲稿 配套dofile  2021版课件 lecture1导论 lecture2 潜在结果分析框架 lecture3 截面数据的参数和非参数估计方法 lecture4 线性回归更多专题 lecture5 面板数据的参数和非参数方法 2020版期末试题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dhndzwxj.github.io/private_img/banner2.gif">
<meta property="article:published_time" content="2021-10-25T05:18:31.000Z">
<meta property="article:modified_time" content="2022-11-29T11:47:50.046Z">
<meta property="article:author" content="揭晓">
<meta property="article:tag" content="stata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dhndzwxj.github.io/private_img/banner2.gif"><link rel="shortcut icon" href="/private_img/favicon.png"><link rel="canonical" href="https://dhndzwxj.github.io/767402338"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"本文上次更新距离今天已经过去","messageNext":"天, 文中内容可能已经过时，望周知。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '微观计量经济学',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-29 19:47:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng:wght@400;500;700&display=swap" rel="stylesheet"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="小荷才露尖尖角" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/private_img/yuyingnan.jpg" onerror="onerror=null;src='/private_img/404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="archives/"><div class="headline">文章</div><div class="length-num">273</div></a><a href="tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="categories/"><div class="headline">分类</div><div class="length-num">74</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="index.html"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/private_img/banner2.gif')"><nav id="nav"><span id="blog_name"><a id="site-name" href="index.html">小荷才露尖尖角</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="index.html"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 结构</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">微观计量经济学</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-25T05:18:31.000Z" title="发表于 2021-10-25 13:18:31">2021-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-29T11:47:50.046Z" title="更新于 2022-11-29 19:47:50">2022-11-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/">计量与模型</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/">计量</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="categories/%E8%AE%A1%E9%87%8F%E4%B8%8E%E6%A8%A1%E5%9E%8B/%E8%AE%A1%E9%87%8F/%E7%90%86%E8%AE%BA/">理论</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="微观计量经济学"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a href='/local_file/AppliedEconometrics.pdf' target='_blank'>安徽大学许文立：应用计量经济学讲稿</a></p>
<p><a href='/local_file/《应用计量经济学讲稿》配套dofile.do' style='font-family:kaiti' target='_blank'>配套dofile</a></p>
<h2 id="2021版课件"><a class="markdownIt-Anchor" href="#2021版课件"></a> 2021版课件</h2>
<p><a href='/local_file/江艇-微观计量经济学/lec1 导论.pdf' target='_blank'>lecture1导论</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lec2 潜在结果分析框架.pdf' target='_blank'>lecture2 潜在结果分析框架</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lec3 截面数据的参数和非参数方法.pdf' target='_blank'>lecture3 截面数据的参数和非参数估计方法</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lec4 线性回归更多专题.pdf' target='_blank'>lecture4 线性回归更多专题</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lec5 面板数据参数和非参数方法.pdf' target='_blank'>lecture5 面板数据的参数和非参数方法</a></p>
<p><a href='/local_file/江艇-微观计量经济学/final2020.pdf' target='_blank'>2020版期末试题</a></p>
<h2 id="2020版课件"><a class="markdownIt-Anchor" href="#2020版课件"></a> 2020版课件</h2>
<p><a href='/local_file/江艇-微观计量经济学/lecture1导论.pdf' target='_blank'>lecture1导论</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lecture2 线性回归理论回顾（上）.pdf' target='_blank'>lecture2 线性回归理论回顾（上）</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lecture3潜在结果分析框架.pdf' target='_blank'>lecture3潜在结果分析框架（此节建议参考2019版笔记）</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lecture4 截面数据的参数和非参数估计方法.pdf' target='_blank'>lecture4 截面数据的参数和非参数估计方法</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lecture5 线性回归理论回顾（下）.pdf' target='_blank'>lecture5 线性回归理论回顾（下）</a></p>
<p><a href='/local_file/江艇-微观计量经济学/lecture6 面板数据的参数和非参数方法.pdf' target='_blank'>lecture6 面板数据的参数和非参数方法</a></p>
<h2 id="2019版课件"><a class="markdownIt-Anchor" href="#2019版课件"></a> 2019版课件</h2>
<p><a href='/local_file/江艇-微观计量经济学/Lecture1 开幕.pdf' target='_blank'>Lecture1 开幕</a></p>
<p><a href='/local_file/江艇-微观计量经济学/Lecture2 OLS回顾（很全）.pdf' target='_blank'>Lecture2 OLS回顾（很全）</a></p>
<p><a href='/local_file/江艇-微观计量经济学/Lecture3 潜在结果分析框架.pdf' target='_blank'>Lecture3 潜在结果分析框架（有笔记）</a></p>
<p><a href='/local_file/江艇-微观计量经济学/Lecture4 匹配.pdf' target='_blank'>Lecture4 匹配</a></p>
<p><a href='/local_file/江艇-微观计量经济学/Lecture5 双重差分DID.pdf' target='_blank'>Lecture5 双重差分DID</a></p>
<p><a href='/local_file/江艇-微观计量经济学/Lecture6 工具变量.pdf' target='_blank'>Lecture6 工具变量</a></p>
<h2 id="部分代码展示"><a class="markdownIt-Anchor" href="#部分代码展示"></a> 部分代码展示</h2>
<h3 id="1-数值模拟"><a class="markdownIt-Anchor" href="#1-数值模拟"></a> 1、数值模拟</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// demo_ctrl.do</span>
cap set more off
clear all

program define ols_ctrl<span class="token punctuation">,</span> rclass
	tempvar y x1 x1tmp x2
	set obs <span class="token number">100</span>
	gen `x2'<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
	gen `x1tmp<span class="token char">'=0.8*`x2'</span><span class="token operator">+</span><span class="token number">0.2</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>`x2'<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	gen `x1<span class="token char">'=(`x1tmp'</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
	gen `y<span class="token char">'=`x1'</span><span class="token operator">+</span>`x2'<span class="token operator">+</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	reg `y<span class="token char">' `x1'</span>
	<span class="token keyword">return</span> scalar b1<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x1'<span class="token punctuation">]</span>
	reg `y<span class="token char">' `x1'</span> `x2'
	<span class="token keyword">return</span> scalar b1n<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x1'<span class="token punctuation">]</span>
	<span class="token keyword">return</span> scalar b2n<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x2'<span class="token punctuation">]</span>
end

set seed <span class="token number">20190311</span>
simulate b1<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span> b1n<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b1n<span class="token punctuation">)</span> b2n<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b2n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">:</span> ols_ctrl

<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

cap set more off
clear all

program define ols_ctrl<span class="token punctuation">,</span> rclass
	tempvar y x1 x1tmp x2 x2tmp e
	set obs <span class="token number">100</span>
	gen `e'<span class="token operator">=</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	gen `x2tmp<span class="token char">'=`e'</span><span class="token operator">+</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	gen `x2<span class="token char">'=(`x2tmp'</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
	gen `x1tmp<span class="token char">'=0.8*`x2'</span><span class="token operator">+</span><span class="token number">0.2</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>`x2'<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	gen `x1<span class="token char">'=(`x1tmp'</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
	gen `y<span class="token char">'=`x1'</span><span class="token operator">+</span>`x2<span class="token char">'+`e'</span><span class="token operator">+</span><span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	reg `y<span class="token char">' `x1'</span>
	<span class="token keyword">return</span> scalar b1<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x1'<span class="token punctuation">]</span>
	reg `y<span class="token char">' `x1'</span> `x2'
	<span class="token keyword">return</span> scalar b1n<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x1'<span class="token punctuation">]</span>
	<span class="token keyword">return</span> scalar b2n<span class="token operator">=</span>_b<span class="token punctuation">[</span>`x2'<span class="token punctuation">]</span>
end

set seed <span class="token number">20190311</span>
simulate b1<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span> b1n<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b1n<span class="token punctuation">)</span> b2n<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>b2n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">:</span> ols_ctrl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-穷举法示例"><a class="markdownIt-Anchor" href="#2-穷举法示例"></a> 2、穷举法示例</h3>
<p>数据文件：<a href='/local_file/江艇-微观计量经济学/new_obsout.dta' target='_blank'>new_obsout.dta</a></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">*</span>关于穷举处理状态的所有分配方式的方法汇总<span class="token operator">*</span>

<span class="token operator">*</span> 查看各种方法的运行时间
set rmsg on


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法一（<span class="token number">041</span>袁国奇）：使用<span class="token keyword">for</span>循环进行穷举，每生成一次匹配计算一次组间均值差异，并与样本的组间均值差异比较、计数。<span class="token operator">*</span>
clear all
use obsout<span class="token punctuation">.</span>dta
reg outcome treat 
scalar savg <span class="token operator">=</span> _b<span class="token punctuation">[</span>treat<span class="token punctuation">]</span>   <span class="token comment">//观测的组间均值差异</span>
gen bool <span class="token operator">=</span> <span class="token number">0</span>     <span class="token comment">//判断准确分布的组间均值差异是否大于观测的组间均值差异</span>
gen count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">//记录准确分布组间均值差异大于观测组间均值差异的个数</span>
gen total <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">//记录循环次数即穷举的总数</span>

replace treat <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">//从12个0当中选取6个改为1，并列举所有情况</span>
forvalues i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">7</span> <span class="token punctuation">&#123;</span>
    forvalues j <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">/</span><span class="token number">8</span> <span class="token punctuation">&#123;</span>
        forvalues k <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">/</span><span class="token number">9</span> <span class="token punctuation">&#123;</span>
            forvalues v <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">/</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
                forvalues w <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">/</span><span class="token number">11</span> <span class="token punctuation">&#123;</span>
                    forvalues x <span class="token operator">=</span> <span class="token number">6</span><span class="token operator">/</span><span class="token number">12</span> <span class="token punctuation">&#123;</span>
					    <span class="token keyword">if</span> `x<span class="token char">'>`w'</span> <span class="token operator">&amp;</span> `w<span class="token char">'>`v'</span> <span class="token operator">&amp;</span> `v<span class="token char">'>`k'</span> <span class="token operator">&amp;</span> `k<span class="token char">'>`j'</span> <span class="token operator">&amp;</span> `j<span class="token char">'>`i'</span> <span class="token punctuation">&#123;</span>
					        replace treat <span class="token operator">=</span> <span class="token number">1</span> in `i'
                            replace treat <span class="token operator">=</span> <span class="token number">1</span> in `j'
                            replace treat <span class="token operator">=</span> <span class="token number">1</span> in `k'
                            replace treat <span class="token operator">=</span> <span class="token number">1</span> in `v'
                            replace treat <span class="token operator">=</span> <span class="token number">1</span> in `w'
                            replace treat <span class="token operator">=</span> <span class="token number">1</span> in `x'
                            reg outcome treat
                            scalar Savg <span class="token operator">=</span> _b<span class="token punctuation">[</span>treat<span class="token punctuation">]</span>   <span class="token comment">//准确分布的组间均值差异</span>
						    replace bool <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>Savg<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">abs</span><span class="token punctuation">(</span>savg<span class="token punctuation">)</span>
						    replace count <span class="token operator">=</span> count <span class="token operator">+</span> bool
							replace total <span class="token operator">=</span> total <span class="token operator">+</span> <span class="token number">1</span>
						    replace treat <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment">//回到初始状态，重新列举</span>
						    replace bool <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">//以便下次循环做判断</span>
					    <span class="token punctuation">&#125;</span>   
					<span class="token punctuation">&#125;</span>				
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>		        
<span class="token punctuation">&#125;</span>

scalar pvalue <span class="token operator">=</span> count<span class="token operator">/</span>total
dis pvalue


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法二（<span class="token number">046</span>何薇）：构造穷举抽样的程序，利用ritest命令<span class="token operator">*</span>
<span class="token operator">*</span>说明：在完成作业的过程中，有和周澜、石玥同学一起交流讨论
<span class="token comment">//定义穷举的程序</span>
<span class="token comment">//参考https://blog.csdn.net/zhangniuagezhang/article/details/81540743</span>

clear all
use obsout<span class="token punctuation">.</span>dta

program permu1
    scalar i <span class="token operator">=</span> <span class="token number">12</span>
	<span class="token keyword">while</span> i <span class="token operator">>=</span><span class="token number">2</span> <span class="token punctuation">&#123;</span>
	    scalar sum1<span class="token operator">=</span><span class="token number">0</span>
		<span class="token keyword">if</span> treat<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span> treat<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		    replace treat <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> _n <span class="token operator">==</span> i<span class="token operator">-</span><span class="token number">1</span>
			replace treat <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> _n <span class="token operator">==</span> i
			scalar j <span class="token operator">=</span> <span class="token number">12</span>
			<span class="token keyword">while</span> j <span class="token operator">>=</span> i <span class="token punctuation">&#123;</span>
			    <span class="token keyword">if</span> treat<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
				    scalar sum1 <span class="token operator">=</span> sum1 <span class="token operator">+</span> <span class="token number">1</span>
					replace treat <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> _n <span class="token operator">==</span> j
				<span class="token punctuation">&#125;</span>
				scalar j <span class="token operator">=</span> j <span class="token operator">-</span> <span class="token number">1</span>
			<span class="token punctuation">&#125;</span>
			scalar k <span class="token operator">=</span> <span class="token number">12</span>
			<span class="token keyword">while</span> k <span class="token operator">>=</span> <span class="token number">13</span> <span class="token operator">-</span> sum1 <span class="token punctuation">&#123;</span>
			    replace treat <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> _n <span class="token operator">==</span> k
				scalar k <span class="token operator">=</span> k <span class="token operator">-</span> <span class="token number">1</span>
			<span class="token punctuation">&#125;</span>
			<span class="token keyword">continue</span><span class="token punctuation">,</span> <span class="token keyword">break</span>
		<span class="token punctuation">&#125;</span>
		scalar i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span>
	<span class="token punctuation">&#125;</span>
end

ritest treat _b<span class="token punctuation">[</span>treat<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">samplingprogram</span><span class="token punctuation">(</span>permu1<span class="token punctuation">)</span> <span class="token function">reps</span><span class="token punctuation">(</span><span class="token number">924</span><span class="token punctuation">)</span> nodots<span class="token operator">:</span> reg outcome treat


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法三（<span class="token number">001</span>陈慧瑕）：利用mata（矩阵编程语言），写出所有分配方式，再进一步处理<span class="token operator">*</span>
use obsout<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
	mata
	i<span class="token operator">=</span><span class="token number">0</span>
	<span class="token function">st_view</span><span class="token punctuation">(</span>X <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">"treat"</span><span class="token punctuation">)</span>
	info <span class="token operator">=</span> <span class="token function">cvpermutesetup</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>					<span class="token comment">/*cvpermutesetup()函数获得treat的组合信息*/</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token operator">=</span><span class="token function">cvpermute</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">J</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>	<span class="token comment">/*cvpermute()函数获取info中关于treat的组合信息，此处通过构建循环生成所有的组合变量*/</span>
					i<span class="token operator">++</span>
					treat<span class="token operator">=</span><span class="token string">"v"</span><span class="token operator">+</span><span class="token function">strofreal</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
					<span class="token function">st_addvar</span><span class="token punctuation">(</span><span class="token string">"float"</span><span class="token punctuation">,</span>treat<span class="token punctuation">)</span>
					<span class="token function">st_store</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">,</span>treat<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	end									
	drop treat

	reshape <span class="token keyword">long</span> v<span class="token punctuation">,</span> <span class="token function">i</span><span class="token punctuation">(</span>outcome<span class="token punctuation">)</span> <span class="token function">j</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>			<span class="token comment">/*将数据由宽型数据转为长型数据*/</span>
	sort id
	replace v<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">if</span> v<span class="token operator">==</span><span class="token number">0</span>
	gen multi<span class="token operator">=</span>v<span class="token operator">*</span>outcome
	bys id<span class="token operator">:</span> egen subsum<span class="token operator">=</span><span class="token function">sum</span><span class="token punctuation">(</span>multi<span class="token punctuation">)</span>
	gen abs_sub_sum<span class="token operator">=</span><span class="token function">abs</span><span class="token punctuation">(</span>subsum<span class="token punctuation">)</span>					<span class="token comment">/*对生成的subsum取绝对值，由于在计算p值的时候关注的是顺序，所以我并没有求出均值差异，///
												而是以每种组合情况的观测间的总差异作为标准，所以计算出的结果相对于均值都是大6倍，但对p值计算无影响*/</span>
	gen T<span class="token operator">=</span><span class="token number">12.11</span>  								<span class="token comment">/*查找实验组真实得到的均值差异的绝对值（可自己计算，///
												也可在已求得的abs_sub_sum中查找id为1的数值） 12.11/6=2.01833*/</span>
	count <span class="token keyword">if</span> abs_sub_sum <span class="token operator">></span>T		
	gen P<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token operator">/</span>_N								<span class="token comment">/*通过绝对值大于实际实验结果的个数与总个数的比值得到真实的p值*/</span>
	sum P										<span class="token comment">/*通过查看数据或者看sum中的均值可知，精确p=0.2683983*/</span>
	duplicates drop id <span class="token punctuation">,</span>force					<span class="token comment">/*强制删除数据中id重复的情况*/</span>
	<span class="token function">twoway</span><span class="token punctuation">(</span>kdensity subsum<span class="token punctuation">)</span> 
	
	
<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法四（<span class="token number">064</span>张子尧）：使用percom包中的combin命令<span class="token operator">*</span>
clear all
set more off
set seed <span class="token number">20200512</span>

<span class="token comment">/* ----------------------
| STEP 0. 生成分配方案  |
-----------------------*/</span>

<span class="token operator">*</span> 使用第三方程序包percom中的combin命令生成分配方案。
<span class="token operator">*</span> 由于combin命令最多只支持从n个样本中抽取<span class="token number">5</span>个，使用循环手动修改，穷举<span class="token number">12</span>抽<span class="token number">6</span>个的所有组合。

cap cap findfile combin<span class="token punctuation">.</span>ado <span class="token comment">// 检查是否安装了percom程序包中的combin命令</span>
<span class="token keyword">if</span> _rc <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
ssc install percom <span class="token comment">// 安装percom程序包，使用combin命令穷举所有分配方案</span>
<span class="token punctuation">&#125;</span>

forvalue i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">7</span> <span class="token punctuation">&#123;</span>

	clear all
	quietly<span class="token operator">:</span> set obs <span class="token number">12</span>
	gene id <span class="token operator">=</span> _n
	quietly<span class="token operator">:</span> drop <span class="token keyword">if</span> id <span class="token operator">&lt;=</span> `i'
	quietly<span class="token operator">:</span> combin id<span class="token punctuation">,</span> <span class="token function">k</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
	gene id_0 <span class="token operator">=</span> `i'
	order id_0 id_1<span class="token operator">-</span>id_5

	<span class="token keyword">if</span> `i' <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">&#123;</span>
		quietly<span class="token operator">:</span> save resample<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
		append using resample<span class="token punctuation">.</span>dta
		quietly<span class="token operator">:</span> save resample<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

xpose<span class="token punctuation">,</span> clear <span class="token comment">// 转置分配矩阵，用于后面的循环</span>
save resample<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace

<span class="token comment">/* resample数据集为如下形式，共924种分配方案。
每一列为一种分配方案，id在分配方案中的为处理组（treat=1），不在分配方案中的为控制组treat=0） 。
---------------------------------------------------------
v1	v2	v3	v4	v5	……	v921	v922	v923	v924
1	1	1	1	1	……	6		6		6		7
2	2	2	2	2	……	7		7		8		8
3	3	3	3	3	……	8		9		9		9
4	4	4	4	4	……	10		10		10		10
5	5	5	5	5	……	11		11		11		11
6	7	8	9	10	……	12		12		12		12
---------------------------------------------------------*/</span>

<span class="token comment">/* ------------------------------------------------------------
| STEP 1. 使用STATA进行随机推断	(第一题)					  |
| 1. 当检验统计量为组间均值差异时，计算双侧检验的准确 p 值。  |
-------------------------------------------------------------*/</span>

<span class="token operator">*</span> <span class="token number">1.1</span> 计算组间均值差异，生成组间均值差异的总体分布
clear all 
forvalue i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">924</span><span class="token punctuation">&#123;</span>
	use resample<span class="token punctuation">,</span> clear
	keep v`i'					
	rename v`i<span class="token char">' id 			// 选取第i种分配方案，即id包含在V`i'</span>中的个体为处理组
	gene D_resample <span class="token operator">=</span> <span class="token number">1</span>		<span class="token comment">// 重新分配的处理组</span>
	quietly<span class="token operator">:</span> save resample_temp<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace

	use obsout<span class="token punctuation">,</span> clear
	gene id <span class="token operator">=</span> _n
	merge <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span> id using resample_temp<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> nogen noreport
	quietly<span class="token operator">:</span> replace D_resample <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> D_resample <span class="token operator">></span> <span class="token number">1</span>    <span class="token comment">// 若D_resample为缺失值，则说明个体在控制组</span>
	<span class="token comment">/* 	以d1为分配方案再分配后的数据如下
	outcome	treat	id	D_resample
	8.62	0		1		1
	1.48	0		2		1
	8.93	0		3		1
	9.57	0		4		1
	2.65	0		5		1
	7.3		0		6		1
	.06		1		7		0
	1.72	1		8		0
	2.19	1		9		0
	7.32	1		10		0
	7.53	1		11		0
	7.62	1		12		0		*/</span>
	
	<span class="token operator">*</span> 第一题：计算组间均值差异
	quietly<span class="token operator">:</span> regress outcome D_resample
	gene diff_mean <span class="token operator">=</span> _b<span class="token punctuation">[</span>D_resample<span class="token punctuation">]</span> 			<span class="token comment">// D为0-1变量时，D的OLS估计系数代表组间均值差异</span>
	quietly<span class="token operator">:</span> keep diff_mean
	quietly<span class="token operator">:</span> drop <span class="token keyword">if</span> _n <span class="token operator">></span> <span class="token number">1</span>
	<span class="token keyword">if</span> `i'<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
		quietly<span class="token operator">:</span> save diff_mean_total<span class="token punctuation">,</span> replace  <span class="token comment">// 第一次循环储存结果</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		quietly<span class="token operator">:</span> append using diff_mean_total  	<span class="token comment">// 第二次及以后的循环append在第一次的数据上</span>
		quietly<span class="token operator">:</span> save diff_mean_total<span class="token punctuation">,</span> replace
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">if</span> <span class="token function">mod</span><span class="token punctuation">(</span>`i'<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">&#123;</span>
		display <span class="token string">"Iteration "</span> `i' <span class="token string">" is done."</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token operator">*</span> <span class="token number">1.2</span> 真实样本组间均值差异为<span class="token operator">-</span><span class="token number">2.0183333</span>，根据总体分布计算双边检验的精确p<span class="token operator">-</span>value
use diff_mean_total<span class="token punctuation">,</span> clear
gene abs_diff_mean <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>diff_mean<span class="token punctuation">)</span>
gene p_indicator <span class="token operator">=</span> abs_diff_mean <span class="token operator">></span> <span class="token number">2.0183333</span>
egen p_sum <span class="token operator">=</span> <span class="token function">total</span><span class="token punctuation">(</span>p_indicator<span class="token punctuation">)</span>
gene p_value <span class="token operator">=</span> p_sum<span class="token operator">/</span><span class="token number">924</span>
scalar pvalue <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>p_value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">.0000001</span><span class="token punctuation">)</span>   <span class="token comment">// p-value保留7位小数</span>
sum diff_mean
display <span class="token string">"第一题：组间均值差异的双侧精确p-value为0"</span> pvalue


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法五（<span class="token number">056</span>林若兮，方法一）：利用嵌套循环进行穷举，先写出从C12<span class="token punctuation">,</span><span class="token number">0</span>到C12<span class="token punctuation">,</span><span class="token number">12</span>的穷举，再剔除其他的<span class="token operator">*</span>
clear all
use obsout<span class="token punctuation">.</span>dta
 
gen id <span class="token operator">=</span> _n
forvalues i1 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
  forvalues i2 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
    forvalues i3 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
      forvalues i4 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
        forvalues i5 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>		
          forvalues i6 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>			
            forvalues i7 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>	
              forvalues i8 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>	
				forvalues i9 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>	
				  forvalues i10 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>	
					forvalues i11 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>
					  forvalues i12 <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">&#123;</span>	
		                gen d_`i1<span class="token char">'`i2'</span>`i3<span class="token char">'`i4'</span>`i5<span class="token char">'`i6'</span>`i7<span class="token char">'`i8'</span>`i9<span class="token char">'`i10'</span>`i11<span class="token char">'`i12'</span> <span class="token operator">=</span> <span class="token number">99</span> 
						forvalues x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">12</span><span class="token punctuation">&#123;</span>
		                  replace d_`i1<span class="token char">'`i2'</span>`i3<span class="token char">'`i4'</span>`i5<span class="token char">'`i6'</span>`i7<span class="token char">'`i8'</span>`i9<span class="token char">'`i10'</span>`i11<span class="token char">'`i12'</span> <span class="token operator">=</span> `i`x<span class="token char">''</span> <span class="token keyword">if</span> id <span class="token operator">==</span> `x'
                        <span class="token punctuation">&#125;</span>
                      <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                  <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token comment">//利用嵌套循环进行C12,0到C12,12的穷举</span>
set more off
xpose<span class="token punctuation">,</span> clear v
gen sumd <span class="token operator">=</span> <span class="token number">0</span>
forvalues y <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">12</span><span class="token punctuation">&#123;</span>
  replace sumd <span class="token operator">=</span> sumd <span class="token operator">+</span> v`y'
<span class="token punctuation">&#125;</span> <span class="token comment">//计算所有分配方式C12,x中的x</span>
keep <span class="token keyword">if</span> _varname <span class="token operator">==</span> <span class="token string">"outcome"</span> <span class="token operator">|</span> _varname <span class="token operator">==</span> <span class="token string">"treatment"</span> <span class="token operator">|</span> sumd <span class="token operator">==</span> <span class="token number">6</span> <span class="token comment">//保留初始变量，并剔除C12,6以外的分配方式</span>
gen treatment_id <span class="token operator">=</span> _n <span class="token operator">-</span> <span class="token number">2</span>
replace _varname <span class="token operator">=</span> <span class="token string">"d"</span> <span class="token operator">+</span> <span class="token function">string</span><span class="token punctuation">(</span>treatment_id<span class="token punctuation">)</span> <span class="token keyword">if</span> treatment_id <span class="token operator">></span> <span class="token number">0</span> <span class="token comment">//更新变量名称为“d+数字”的格式</span>
drop treatment_id sumd
xpose<span class="token punctuation">,</span> clear
<span class="token comment">//计算组间均值差异，并计算准确p值</span>
forvalues i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">924</span><span class="token punctuation">&#123;</span>
  bys d`i<span class="token char">': egen m`i'</span> <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>outcome<span class="token punctuation">)</span>
  gen m`i<span class="token char">'_0mid = m`i'</span> <span class="token keyword">if</span> d`i' <span class="token operator">==</span> <span class="token number">0</span>
  egen m`i<span class="token char">'_0 = max(m`i'</span>_0mid<span class="token punctuation">)</span>
  gen m`i<span class="token char">'_1mid = m`i'</span> <span class="token keyword">if</span> d`i' <span class="token operator">==</span> <span class="token number">1</span>
  egen m`i<span class="token char">'_1 = max(m`i'</span>_1mid<span class="token punctuation">)</span>
  gen diff_d`i<span class="token char">' = m`i'</span>_1 <span class="token operator">-</span> m`i'_0
  drop m<span class="token operator">*</span>
<span class="token punctuation">&#125;</span> <span class="token comment">//计算每种分配方式下的组间均值差异</span>
xpose<span class="token punctuation">,</span> clear v
gen id <span class="token operator">=</span> _n <span class="token operator">-</span> <span class="token number">2</span>
egen num <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.018334</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> id <span class="token operator">></span> <span class="token number">924</span>
gen exact_p <span class="token operator">=</span> num<span class="token operator">/</span><span class="token number">924</span>
sum exact_p <span class="token comment">//等于0.2683983</span>


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token operator">*</span>方法六（<span class="token number">056</span>林若兮，方法二）：随机<span class="token number">10000</span>次后剔除重复值<span class="token operator">*</span>
clear all
use obsout<span class="token punctuation">.</span>dta

<span class="token keyword">while</span> _N <span class="token operator">&lt;</span> <span class="token number">924</span><span class="token punctuation">&#123;</span>
  clear all
  set maxvar <span class="token number">10001</span> <span class="token comment">//不设定maxvar则默认最大循环次数为4999，通常需循环多次、速度更慢</span>
  set seed <span class="token number">2020</span>
  set obs <span class="token number">12</span>
  forvalues i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">&#123;</span>
    gen d`i' <span class="token operator">=</span> <span class="token punctuation">(</span>_n <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">)</span>
    gen odr <span class="token operator">=</span> <span class="token function">rnormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    sort odr
    drop odr
  <span class="token punctuation">&#125;</span> <span class="token comment">//随机10000次分配方式</span>
  xpose<span class="token punctuation">,</span> clear v
  drop _varname
  duplicates drop <span class="token comment">//剔除重复值</span>
<span class="token punctuation">&#125;</span> <span class="token comment">//剔除重复值后样本量为924即完成穷举，进入下一步，否则循环</span>
set more off
xpose<span class="token punctuation">,</span> clear
gen id <span class="token operator">=</span> _n
sort id
save <span class="token string">"exh.dta"</span><span class="token punctuation">,</span> replace
use <span class="token string">"obsout.dta"</span><span class="token punctuation">,</span> clear
gen id <span class="token operator">=</span> _n
sort id
merge <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span> id using <span class="token string">"exh.dta"</span> <span class="token comment">//合并数据集</span>
drop id _merge
xpose<span class="token punctuation">,</span> clear v
gen treatment_id <span class="token operator">=</span> _n <span class="token operator">-</span> <span class="token number">2</span>
replace _varname <span class="token operator">=</span> <span class="token string">"d"</span> <span class="token operator">+</span> <span class="token function">string</span><span class="token punctuation">(</span>treatment_id<span class="token punctuation">)</span> <span class="token keyword">if</span> treatment_id <span class="token operator">></span> <span class="token number">0</span> <span class="token comment">//更新变量名称为“d+数字”的格式</span>
drop treatment_id
xpose<span class="token punctuation">,</span> clear
<span class="token comment">//计算组间均值差异，并计算准确p值</span>
forvalues i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">924</span><span class="token punctuation">&#123;</span>
  bys d`i<span class="token char">': egen m`i'</span> <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>outcome<span class="token punctuation">)</span>
  gen m`i<span class="token char">'_0mid = m`i'</span> <span class="token keyword">if</span> d`i' <span class="token operator">==</span> <span class="token number">0</span>
  egen m`i<span class="token char">'_0 = max(m`i'</span>_0mid<span class="token punctuation">)</span>
  gen m`i<span class="token char">'_1mid = m`i'</span> <span class="token keyword">if</span> d`i' <span class="token operator">==</span> <span class="token number">1</span>
  egen m`i<span class="token char">'_1 = max(m`i'</span>_1mid<span class="token punctuation">)</span>
  gen diff_d`i<span class="token char">' = m`i'</span>_1 <span class="token operator">-</span> m`i'_0
  drop m<span class="token operator">*</span>
<span class="token punctuation">&#125;</span> <span class="token comment">//计算每种分配方式下的组间均值差异</span>
xpose<span class="token punctuation">,</span> clear v
gen id <span class="token operator">=</span> _n <span class="token operator">-</span> <span class="token number">2</span>
egen num <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.018334</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> id <span class="token operator">></span> <span class="token number">924</span>
gen exact_p <span class="token operator">=</span> num<span class="token operator">/</span><span class="token number">924</span>
sum exact_p <span class="token comment">//等于0.2683983</span>


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token comment">/*
方法七（江艇）：用mata的cvpermute穷举所有分配方式，导出成新变量到数据，
用forvalues循环计算所有的组间均值差异。
*/</span>

cap set more off
clear all
use obsout<span class="token punctuation">.</span>dta

mata
	<span class="token function">st_view</span><span class="token punctuation">(</span>V<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token string">"treat"</span><span class="token punctuation">)</span>
	PV<span class="token operator">=</span><span class="token function">J</span><span class="token punctuation">(</span><span class="token function">rows</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	info<span class="token operator">=</span><span class="token function">cvpermutesetup</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>PV0<span class="token operator">=</span><span class="token function">cvpermute</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">J</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		PV<span class="token operator">=</span>PV<span class="token punctuation">,</span>PV0
		<span class="token punctuation">&#125;</span>
	<span class="token function">st_matrix</span><span class="token punctuation">(</span><span class="token string">"PV"</span><span class="token punctuation">,</span>PV<span class="token punctuation">)</span>
end

svmat PV<span class="token punctuation">,</span> <span class="token function">names</span><span class="token punctuation">(</span>permute<span class="token punctuation">)</span>

qui reg outcome treat
scalar diff_obs<span class="token operator">=</span>_b<span class="token punctuation">[</span>treat<span class="token punctuation">]</span>
scalar extreme<span class="token operator">=</span><span class="token number">0</span>
local all<span class="token operator">=</span><span class="token function">colsof</span><span class="token punctuation">(</span>PV<span class="token punctuation">)</span>
forvalues i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>`all' <span class="token punctuation">&#123;</span>
	qui sum outcome <span class="token keyword">if</span> permute`i'<span class="token operator">==</span><span class="token number">1</span>
	scalar mean1<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
	qui sum outcome <span class="token keyword">if</span> permute`i'<span class="token operator">==</span><span class="token number">0</span>
	scalar mean0<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>mean1<span class="token operator">-</span>mean0<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token function">abs</span><span class="token punctuation">(</span>diff_obs<span class="token punctuation">)</span> scalar extreme<span class="token operator">=</span>extreme<span class="token operator">+</span><span class="token number">1</span>
	<span class="token comment">/*
	如果用下面2行替换上面5行，速度会慢很多。
	
	qui reg outcome permute`i'
	if abs(_b[permute`i'])>=abs(diff_obs) scalar extreme=extreme+1
	
	*/</span>	
	<span class="token punctuation">&#125;</span>
di extreme<span class="token operator">/</span>`all'


<span class="token operator">*</span> 计算精确p值的过程可以在mata内直接完成。

cap set more off
clear all
use obsout<span class="token punctuation">.</span>dta

mata
	<span class="token function">st_view</span><span class="token punctuation">(</span>V<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	diff_obs<span class="token operator">=</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	info<span class="token operator">=</span><span class="token function">cvpermutesetup</span><span class="token punctuation">(</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	extreme<span class="token operator">=</span>all<span class="token operator">=</span><span class="token number">0</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>PV<span class="token operator">=</span><span class="token function">cvpermute</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">J</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		V1<span class="token operator">=</span>V<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>PV
		diff<span class="token operator">=</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>V1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>V1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>V1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>V1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token function">abs</span><span class="token punctuation">(</span>diff_obs<span class="token punctuation">)</span><span class="token punctuation">)</span> extreme<span class="token operator">++</span>
		all<span class="token operator">++</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">(</span>extreme<span class="token punctuation">,</span> all<span class="token punctuation">,</span> extreme<span class="token operator">/</span>all<span class="token punctuation">)</span>
end


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>


<span class="token comment">/*
方法八（江艇）：先穷举所有6位排列，然后扩展成12位排列。
*/</span>

cap set more off
clear all

set obs <span class="token number">200000</span>
gen x<span class="token operator">=</span><span class="token number">1000000</span><span class="token operator">+</span>_n<span class="token operator">-</span><span class="token number">1</span>
forvalues i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">6</span><span class="token punctuation">&#123;</span>
	gen x`i<span class="token char">'=floor(x/10^(6-`i'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">floor</span><span class="token punctuation">(</span>x<span class="token operator">/</span><span class="token number">10</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">-</span>`i'<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
	drop <span class="token keyword">if</span> x`i'<span class="token operator">></span><span class="token number">1</span>
	<span class="token punctuation">&#125;</span>
drop x
save tmp<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace

forvalues i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">6</span><span class="token punctuation">&#123;</span>
	local j<span class="token operator">=</span>`i'<span class="token operator">+</span><span class="token number">6</span>
	rename x`i<span class="token char">' x`j'</span>
<span class="token punctuation">&#125;</span>

cross using tmp<span class="token punctuation">.</span>dta

<span class="token comment">/*

上面用到了cross命令，也可以用下面的方法手动做。

cap set more off
clear all

set obs 200000
gen x=1000000+_n-1
forvalues i=1/6&#123;
	gen x`i'=floor(x/10^(6-`i')-floor(x/10^(6-`i'+1))*10)
	drop if x`i'>1
	&#125;
drop x
gen grp=_n
sort grp
save tmp.dta, replace

forvalues i=1/6&#123;
local j=`i'+6
rename x`i' x`j'
&#125;

expand _N
sort grp
rename grp grp0
by grp0: gen grp=_n
drop grp0
sort grp

merge m:1 grp using tmp.dta
drop grp _merge

*/</span>

egen sumx<span class="token operator">=</span><span class="token function">rowtotal</span><span class="token punctuation">(</span>x<span class="token operator">*</span><span class="token punctuation">)</span>
drop <span class="token keyword">if</span> sumx<span class="token operator">!=</span><span class="token number">6</span>
drop sumx
save tmp<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> replace

use obsout<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
mkmat outcome<span class="token punctuation">,</span> <span class="token function">matrix</span><span class="token punctuation">(</span>outcome<span class="token punctuation">)</span>

use tmp<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear
count
scalar <span class="token keyword">case</span><span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span>
order x1<span class="token operator">-</span>x6 x7<span class="token operator">-</span>x12
mkmat x<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token function">matrix</span><span class="token punctuation">(</span>assign<span class="token punctuation">)</span>
mat yt<span class="token operator">=</span>assign<span class="token operator">*</span>outcome
mat numt<span class="token operator">=</span>assign<span class="token operator">*</span><span class="token function">J</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
mat yc<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">J</span><span class="token punctuation">(</span><span class="token keyword">case</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>assign<span class="token punctuation">)</span><span class="token operator">*</span>outcome
mat numc<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">J</span><span class="token punctuation">(</span><span class="token keyword">case</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span>assign<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">J</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
svmat yt
svmat numt
svmat yc
svmat numc
gen diff<span class="token operator">=</span>yt<span class="token operator">/</span>numt<span class="token operator">-</span>yc<span class="token operator">/</span>numc

gen diff0<span class="token operator">=</span>diff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

gen extreme<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token function">abs</span><span class="token punctuation">(</span>diff0<span class="token punctuation">)</span><span class="token punctuation">)</span>
sum extreme

rm tmp<span class="token punctuation">.</span>dta


<span class="token operator">*</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">*</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-匹配方法演示"><a class="markdownIt-Anchor" href="#3-匹配方法演示"></a> 3、匹配方法演示</h3>
<p>数据文件：<a href='/local_file/江艇-微观计量经济学/matching_demo/lalonde_data_exp.dta' target='_blank'>lalonde_data_exp.dta</a>、<a href='/local_file/江艇-微观计量经济学/matching_demo/lalonde_data_psid.dta' target='_blank'>lalonde_data_psid.dta</a>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 本文档旨在介绍匹配方法，配合使用的数据是关于美国1970年代中期的某个职业培训项目。</span>

use lalonde_data_psid<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear

<span class="token comment">// 实验组的干预前结果和调查数据控制组的干预前结果有很大差异。</span>

tabstat re75<span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token function">stats</span><span class="token punctuation">(</span>n mean sd max min<span class="token punctuation">)</span>
histogram re75<span class="token punctuation">,</span> percent <span class="token function">by</span><span class="token punctuation">(</span>treat<span class="token punctuation">)</span>

<span class="token comment">// 估计倾向得分。基于逐步回归方法搜索函数设定(Imbens, 2015)。</span>
<span class="token comment">// 一次项的临界值c_lin=1; 二次项的临界值c_qua=2.71</span>

<span class="token comment">// 先确定哪些一次项应该加入。</span>

logit treat re74 re75 u74 u75
estimates store a
foreach var in black hispanic age married nodegree edu <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married
estimates store a
foreach var in black hispanic age nodegree edu <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married black
estimates store a
foreach var in hispanic age nodegree edu <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married black `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married black age
estimates store a
foreach var in hispanic nodegree edu <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married black age `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married black age hispanic
estimates store a
foreach var in nodegree edu <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married black age hispanic `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married black age hispanic nodegree
estimates store a
qui logit treat re74 re75 u74 u75 married black age hispanic nodegree edu
lrtest a

<span class="token comment">// 构造所有的二次项，再确定那些应该加入。</span>
<span class="token comment">// 注意，其中一些二次项是冗余的，</span>
<span class="token comment">// 例如，r74*u74恒等于零，而虚拟变量的平方项与一次项恒等。</span>

gen r74s<span class="token operator">=</span>re74<span class="token operator">^</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">10e6</span>
gen r74r75<span class="token operator">=</span>re74<span class="token operator">*</span>re75<span class="token operator">/</span><span class="token number">10e6</span>
<span class="token comment">// gen r74u74=re74*u74</span>
gen r74u75<span class="token operator">=</span>re74<span class="token operator">*</span>u75
gen r74n<span class="token operator">=</span>re74<span class="token operator">*</span>nodegree
gen r74h<span class="token operator">=</span>re74<span class="token operator">*</span>hispanic
gen r74e<span class="token operator">=</span>re74<span class="token operator">*</span>edu
gen r75s<span class="token operator">=</span>re75<span class="token operator">^</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">10e6</span>
gen r75u74<span class="token operator">=</span>re75<span class="token operator">*</span>u74
<span class="token comment">// gen r75u75=re75*u75</span>
gen r75n<span class="token operator">=</span>re75<span class="token operator">*</span>nodegree
gen r75h<span class="token operator">=</span>re75<span class="token operator">*</span>hispanic
gen r75e<span class="token operator">=</span>re75<span class="token operator">*</span>edu
<span class="token comment">// gen u74s=u74^2</span>
gen u74u75<span class="token operator">=</span>u74<span class="token operator">*</span>u75
gen u74n<span class="token operator">=</span>u74<span class="token operator">*</span>nodegree
gen u74h<span class="token operator">=</span>u74<span class="token operator">*</span>hispanic
gen u74e<span class="token operator">=</span>u74<span class="token operator">*</span>edu
<span class="token comment">// gen u75s=u75^2</span>
gen u75n<span class="token operator">=</span>u75<span class="token operator">*</span>nodegree
gen u75h<span class="token operator">=</span>u75<span class="token operator">*</span>hispanic
gen u75e<span class="token operator">=</span>u75<span class="token operator">*</span>edu
<span class="token comment">// gen ns=nodegree^2</span>
gen nh<span class="token operator">=</span>nodegree<span class="token operator">*</span>hispanic
gen ne<span class="token operator">=</span>nodegree<span class="token operator">*</span>edu
<span class="token comment">// gen hs=hispanic^2</span>
gen he<span class="token operator">=</span>hispanic<span class="token operator">*</span>edu
gen es<span class="token operator">=</span>edu<span class="token operator">^</span><span class="token number">2</span>

logit treat re74 re75 u74 u75 married black age hispanic nodegree
estimates store a
foreach var of varlist r74s<span class="token operator">-</span>es <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married black age hispanic nodegree `var'
	lrtest a
<span class="token punctuation">&#125;</span>

logit treat re74 re75 u74 u75 married black age hispanic nodegree u74u75
estimates store a
foreach var of varlist r74s<span class="token operator">-</span>r75e u74n<span class="token operator">-</span>es <span class="token punctuation">&#123;</span>
	di <span class="token string">""</span>
	di <span class="token string">"`var'"</span>
	qui logit treat re74 re75 u74 u75 married black age hispanic nodegree u74u75 `var'
	lrtest a
<span class="token punctuation">&#125;</span>

<span class="token comment">// 展示最终确定的函数形式及估计结果，读入内存，并手动计算倾向得分。</span>

estimates replay a
estimates restore a
predict ps0
tabstat ps0<span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token function">stats</span><span class="token punctuation">(</span>n mean sd min max<span class="token punctuation">)</span>

<span class="token comment">// 删截样本：将倾向得分过高或过低的观测值删去</span>
<span class="token comment">// （否则有可能匹配效果不理想，出现不合理的估计结果）。</span>

gen msample1<span class="token operator">=</span><span class="token punctuation">(</span>ps0<span class="token operator">>=</span><span class="token number">.1</span> <span class="token operator">&amp;</span> ps0<span class="token operator">&lt;=</span><span class="token number">.9</span><span class="token punctuation">)</span>
tab treat <span class="token keyword">if</span> msample1

qui sum ps0 <span class="token keyword">if</span> treat<span class="token operator">==</span><span class="token number">0</span>
scalar psmax<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span>
qui sum ps0 <span class="token keyword">if</span> treat<span class="token operator">==</span><span class="token number">1</span>
scalar psmin<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span>
gen msample2<span class="token operator">=</span><span class="token punctuation">(</span>ps0<span class="token operator">>=</span>psmin <span class="token operator">&amp;</span> ps0<span class="token operator">&lt;=</span>psmax<span class="token punctuation">)</span>
tab treat <span class="token keyword">if</span> msample2

<span class="token comment">// 协变量匹配（有必要在删截后的样本中进行，对于倾向得分匹配也是如此）</span>
<span class="token comment">// 估计ATT，以msample1为例</span>
<span class="token comment">// 注意，不要把用于协变量匹配的协变量和用于倾向得分匹配的协变量混淆。</span>
<span class="token comment">// 进行协变量匹配时，无须加入新生成的二次项。</span>

<span class="token comment">// 官方命令teffects nnmatch和用户自编命令nnmatch的</span>
<span class="token comment">// 平均处理效应估计完全一致，标准误有所差异。</span>
<span class="token comment">// 两个命令的默认选项有所不同，以下两行表示协变量的距离指标为马氏距离</span>
<span class="token comment">// （即用方差-协方差矩阵的逆加权的距离平方和）。</span>

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> atet
nnmatch re78 treat age<span class="token operator">-</span>re75 u74 u75 <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">metric</span><span class="token punctuation">(</span>maha<span class="token punctuation">)</span> <span class="token function">robusth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">tc</span><span class="token punctuation">(</span>att<span class="token punctuation">)</span>

<span class="token comment">// 以下两行表示用于偏误修正的协变量为干预前结果。</span>

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> atet <span class="token function">biasadj</span><span class="token punctuation">(</span>re74 re75 u74 u75<span class="token punctuation">)</span>
nnmatch re78 treat age<span class="token operator">-</span>re75 u74 u75 <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">metric</span><span class="token punctuation">(</span>maha<span class="token punctuation">)</span> <span class="token function">robusth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">tc</span><span class="token punctuation">(</span>att<span class="token punctuation">)</span> <span class="token function">biasadj</span><span class="token punctuation">(</span>re74 re75 u74 u75<span class="token punctuation">)</span>

<span class="token comment">// 以下两行表示用于偏误修正的协变量为所有用于匹配的协变量。</span>

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> atet <span class="token function">biasadj</span><span class="token punctuation">(</span>age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span>
nnmatch re78 treat age<span class="token operator">-</span>re75 u74 u75 <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">metric</span><span class="token punctuation">(</span>maha<span class="token punctuation">)</span> <span class="token function">robusth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">tc</span><span class="token punctuation">(</span>att<span class="token punctuation">)</span> <span class="token function">biasadj</span><span class="token punctuation">(</span>bias<span class="token punctuation">)</span>

<span class="token comment">// 以下两行表示1:2匹配。</span>

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> atet <span class="token function">biasadj</span><span class="token punctuation">(</span>age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token function">nn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
nnmatch re78 treat age<span class="token operator">-</span>re75 u74 u75 <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">metric</span><span class="token punctuation">(</span>maha<span class="token punctuation">)</span> <span class="token function">robusth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">tc</span><span class="token punctuation">(</span>att<span class="token punctuation">)</span> <span class="token function">biasadj</span><span class="token punctuation">(</span>bias<span class="token punctuation">)</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// 以下两行表示先根据两个失业变量进行准确匹配。</span>
<span class="token comment">// 运行下面这条命令会报错，因为稳健标准误估计要求每个个体必须存在两个以上匹配个体，只能把不符合这一条件的观测值删去。</span>
teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">ematch</span><span class="token punctuation">(</span>u74 u75<span class="token punctuation">)</span> atet <span class="token function">biasadj</span><span class="token punctuation">(</span>age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span>

egen ematch<span class="token operator">=</span><span class="token function">concat</span><span class="token punctuation">(</span>u74 u75<span class="token punctuation">)</span>
tab ematch treat

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1 <span class="token operator">&amp;</span> ematch<span class="token operator">!=</span><span class="token string">"01"</span><span class="token punctuation">,</span> <span class="token function">ematch</span><span class="token punctuation">(</span>u74 u75<span class="token punctuation">)</span> atet <span class="token function">biasadj</span><span class="token punctuation">(</span>age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span>
nnmatch re78 treat age<span class="token operator">-</span>re75 u74 u75 <span class="token keyword">if</span> msample1 <span class="token operator">&amp;</span> ematch<span class="token operator">!=</span><span class="token string">"01"</span><span class="token punctuation">,</span> <span class="token function">exact</span><span class="token punctuation">(</span>u74 u75<span class="token punctuation">)</span> <span class="token function">metric</span><span class="token punctuation">(</span>maha<span class="token punctuation">)</span> <span class="token function">robusth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">tc</span><span class="token punctuation">(</span>att<span class="token punctuation">)</span> <span class="token function">biasadj</span><span class="token punctuation">(</span>bias<span class="token punctuation">)</span>


<span class="token comment">// 倾向得分匹配，估计ATT，以msample1为例</span>
<span class="token comment">// 需重新搜索倾向得分估计式（过程从略）</span>
<span class="token comment">// 官方命令teffects psmatch和用户自编命令psmatch2的平均处理效应估计完全一致，标准误有所差异。</span>

teffects <span class="token function">psmatch</span> <span class="token punctuation">(</span>re78<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat re74 re75 u74 u75 married black age hispanic nodegree r75h u74u75 ne r75e u74e<span class="token punctuation">)</span> <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> atet
psmatch2 treat re74 re75 u74 u75 married black age hispanic nodegree r75h u74u75 ne r75e u74e <span class="token keyword">if</span> msample1<span class="token punctuation">,</span> <span class="token function">outcome</span><span class="token punctuation">(</span>re78<span class="token punctuation">)</span> logit ties

mata<span class="token operator">:</span> compare<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"variable name"</span><span class="token punctuation">,</span><span class="token string">"normalized diff before"</span><span class="token punctuation">,</span> <span class="token string">"normalized diff after"</span><span class="token punctuation">)</span>
local xlist black hispanic age married nodegree edu re74 u74 re75 u75
foreach xvar of varlist `xlist' <span class="token punctuation">&#123;</span>
qui ttest `xvar'<span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>treat<span class="token punctuation">)</span> unequal
local nd0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>mu_2<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">r</span><span class="token punctuation">(</span>mu_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>sd_1<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token operator">+</span><span class="token function">r</span><span class="token punctuation">(</span>sd_2<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
local nd0<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>`nd0'<span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">)</span>
ttest `xvar' <span class="token keyword">if</span> _weight<span class="token operator">!=</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token function">by</span><span class="token punctuation">(</span>treat<span class="token punctuation">)</span> unequal
local nd1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>mu_2<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">r</span><span class="token punctuation">(</span>mu_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>sd_1<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token operator">+</span><span class="token function">r</span><span class="token punctuation">(</span>sd_2<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
local nd1<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>`nd1'<span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">)</span>
mata<span class="token operator">:</span> compare<span class="token operator">=</span><span class="token punctuation">(</span>compare\<span class="token string">"`xvar'"</span><span class="token punctuation">,</span><span class="token string">"`nd0'"</span><span class="token punctuation">,</span><span class="token string">"`nd1'"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
mata<span class="token operator">:</span> compare


<span class="token comment">/*
执行psmatch2之后会生成很多临时变量，提供了详尽的匹配细节。

	ties必须选上，否则若有多个ps完全相同的控制组个体（当协变量为离散变量时是有可能的），将会选择
		匹配在数据中当前排序靠前的个体，因此数据的排序会大幅影响结果。

	_id将样本按控制组在前处理组在后、ps由小到大顺序重新排列并标序。_n1给出了匹配个体的序号，
		当完全匹配到多个时（即ties，即使k=1），这个变量没有意义。
	
	_weight的取值，以ATT为例，每个处理组个体权重均为1；如果ps完全相同的多个(N)处理组个体匹配到
		多个(M)控制组个体，则这些控制组个体的权重均为N/M。由此我们可以手动计算ATT：

		tab treat if _weight!=.
		gen tmp=(2*treat-1)*_weight*re78
		sum tmp
		di r(sum)/104

	_weight未缺失的所有观测值即构成了匹配后的样本，在其基础上进行加权简单回归，也可以得到ATT：
	
		reg re78 treat [aw=_weight]
	
	_re78给出了匹配到的控制组个体的（平均）结果。由此我们可以手动计算ATT：
	
		gen tmp2=re78-_re78
		sum tmp2
	
	_pdif给出了匹配到的处理组与控制组之间ps的距离。
*/</span>


<span class="token comment">// 下面再以teffects nnmatch为例，介绍如何得到经过协变量匹配的匹配样本，并用加权简单回归实现匹配估计的结果。</span>
<span class="token comment">// 因为此时标准误估计不重要，因此采用非稳健的vce(iid)形式避免删除观测值。</span>
<span class="token comment">// 下面的gen(mcu)选项生成了一系列以mcu为前缀的变量，</span>
<span class="token comment">// 显示每个处理组个体所匹配到的控制组个体在样本中的序号。</span>

teffects <span class="token function">nnmatch</span> <span class="token punctuation">(</span>re78 age<span class="token operator">-</span>re75 u74 u75<span class="token punctuation">)</span> <span class="token punctuation">(</span>treat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ematch</span><span class="token punctuation">(</span>u74 u75<span class="token punctuation">)</span> <span class="token function">vce</span><span class="token punctuation">(</span>iid<span class="token punctuation">)</span> <span class="token function">gen</span><span class="token punctuation">(</span>mcu<span class="token punctuation">)</span> atet

<span class="token comment">// 计算每个处理组个体匹配到的控制组个体的数目。</span>

egen nn<span class="token operator">=</span><span class="token function">rownonmiss</span><span class="token punctuation">(</span>mcu<span class="token operator">*</span><span class="token punctuation">)</span>

<span class="token comment">// 查看准确匹配变量取值不同状态下最终匹配到的控制组个体数目。</span>

tab nn ematch

<span class="token comment">// 计算权重</span>

gen wgt<span class="token operator">=</span><span class="token punctuation">.</span>
forvalues i<span class="token operator">=</span><span class="token number">186</span><span class="token operator">/</span><span class="token number">2675</span> <span class="token punctuation">&#123;</span>
quiet egen match<span class="token operator">=</span><span class="token function">anymatch</span><span class="token punctuation">(</span>mcu<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">v</span><span class="token punctuation">(</span>`i'<span class="token punctuation">)</span>
quiet gen wgt0<span class="token operator">=</span>match<span class="token operator">/</span>nn
egen wgt1<span class="token operator">=</span><span class="token function">total</span><span class="token punctuation">(</span>wgt0<span class="token punctuation">)</span>
quiet replace wgt<span class="token operator">=</span>wgt1 in `i'
drop match wgt0 wgt1
<span class="token punctuation">&#125;</span>

tab wgt

replace wgt<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> wgt<span class="token operator">==</span><span class="token punctuation">.</span>

<span class="token comment">// 对匹配样本进行加权简单回归，将得到和teffects nnmatch完全相同的ATT估计值。</span>
reg re78 treat <span class="token punctuation">[</span>aweight<span class="token operator">=</span>wgt<span class="token punctuation">]</span>


<span class="token comment">/*

董天一（会计）同学提供了一种更有效率的计算权重的方法，照录如下，供大家参考。

teffects nnmatch (re78 age-re75 u74 u75) (treat), ematch(u74 u75) vce(iid) gen(mcu) atet

gen id=_n 									// 生成样本序号

preserve
keep if treat==1							// 仅保留处理组样本
reshape long mcu,i(id) j(order)				// 转化数据结构
drop if mcu==.
bysort id: gen w=1/_N						// 计算控制组样本匹配单一处理组样本的权重
bysort mcu: egen weight=sum(w)				// 计算控制组样本匹配全部处理组样本的权重
duplicates drop mcu,force 					// 删除冗余控制组样本
keep mcu weight
rename mcu id 								// 重命名变量以方便后续数据合并
save weight,replace							// 保存为权重文件
restore

merge 1:1 id using weight,nogen keep(1 3)	// 合并权重文件
rm weight.dta
replace weight=1 if treat==1				// 处理组样本权重为 1
replace weight=0 if weight==.				// 未匹配上的控制组样本权重为 0

reg re78 treat [aweight=weight]

*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4"><a class="markdownIt-Anchor" href="#4"></a> 4、</h3>
<p>数据文件：<a href='/local_file/江艇-微观计量经济学/matching_demo/private_data.dta' target='_blank'>private_data.dta</a>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">use private_data<span class="token punctuation">.</span>dta<span class="token punctuation">,</span> clear

list

tab group<span class="token punctuation">,</span> <span class="token function">gen</span><span class="token punctuation">(</span>grp<span class="token punctuation">)</span>

reg wage private

reg wage private <span class="token keyword">if</span> grp1<span class="token operator">+</span>grp2<span class="token operator">==</span><span class="token number">1</span>

reg wage private grp<span class="token operator">*</span>

reg wage private grp<span class="token operator">*</span> <span class="token keyword">if</span> grp1<span class="token operator">+</span>grp2<span class="token operator">==</span><span class="token number">1</span>


forvalues i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token punctuation">&#123;</span>
	gen g`i<span class="token char">'t=grp`i'</span><span class="token operator">*</span>private
<span class="token punctuation">&#125;</span>

reg wage private grp1 grp2 grp3 g1t g2t g3t

gen ite<span class="token operator">=</span>_b<span class="token punctuation">[</span>private<span class="token punctuation">]</span><span class="token operator">+</span>_b<span class="token punctuation">[</span>g1t<span class="token punctuation">]</span><span class="token operator">*</span>grp1
sum ite <span class="token keyword">if</span> grp1<span class="token operator">+</span>grp2<span class="token operator">==</span><span class="token number">1</span>
sum ite <span class="token keyword">if</span> grp1<span class="token operator">+</span>grp2<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;</span> private<span class="token operator">==</span><span class="token number">1</span>
sum ite <span class="token keyword">if</span> grp1<span class="token operator">+</span>grp2<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;</span> private<span class="token operator">==</span><span class="token number">0</span>


reg wage private <span class="token punctuation">[</span>aweight<span class="token operator">=</span>watt<span class="token punctuation">]</span>

reg wage private <span class="token punctuation">[</span>aweight<span class="token operator">=</span>watu<span class="token punctuation">]</span>

reg wage private <span class="token punctuation">[</span>aweight<span class="token operator">=</span>wate<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>**5、**nunnq_2011</p>
<p>数据文件：<a href='/local_file/江艇微观计量/nunnq_2011.dta' target='_blank'>nunnq_2011</a></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">use <span class="token string">"nunnq_2011.dta"</span><span class="token punctuation">,</span> clear

foreach x in <span class="token number">1000</span> <span class="token number">1100</span> <span class="token number">1200</span> <span class="token number">1300</span> <span class="token number">1400</span> <span class="token number">1500</span> <span class="token number">1600</span> <span class="token number">1700</span> <span class="token number">1750</span> <span class="token number">1800</span> <span class="token number">1850</span> <span class="token number">1900</span><span class="token punctuation">&#123;</span>
	gen ln_wpot_`x<span class="token char">'=ln_wpot*ydum`x'</span>
	gen ln_all_`x<span class="token char">'=ln_all*ydum`x'</span>
	gen ln_nworld_`x<span class="token char">'=ln_nworld*ydum`x'</span>
	gen ln_oworld_`x<span class="token char">'=ln_oworld*ydum`x'</span>
	gen ln_tropical_`x<span class="token char">'=ln_tropical*ydum`x'</span>
	gen ln_rugged_`x<span class="token char">'=ln_rugged*ydum`x'</span>
	gen ln_elevation_`x<span class="token char">'=ln_elevation*ydum`x'</span>
	gen ln_disteq_`x<span class="token char">'=ln_disteq*ydum`x'</span>
	gen ln_dist_coast_`x<span class="token char">'=ln_dist_coast*ydum`x'</span>
	gen ln_export_`x<span class="token char">'=ln_export*ydum`x'</span>
	gen malaria_`x<span class="token char">'=malaria*ydum`x'</span>
	gen ln_spot_`x<span class="token char">'=ln_spot*ydum`x'</span>
	gen ln_silagemaize_`x<span class="token char">'=ln_silagemaize*ydum`x'</span>
	gen ln_maize_`x<span class="token char">'=ln_maize*ydum`x'</span>
	gen ln_cassava_`x<span class="token char">'=ln_cassava*ydum`x'</span>
	<span class="token punctuation">&#125;</span>

<span class="token comment">/* Macros for the control variables */</span>
global ln_potato_flexible <span class="token string">"ln_wpot_1100 ln_wpot_1200 ln_wpot_1300 ln_wpot_1400 ln_wpot_1500 ln_wpot_1600 ln_wpot_1700 ln_wpot_1750 ln_wpot_1800 ln_wpot_1850 ln_wpot_1900"</span>
global ydum_flexible <span class="token string">"ydum1100 ydum1200 ydum1300 ydum1400 ydum1500 ydum1600 ydum1700 ydum1750 ydum1800 ydum1850 ydum1900"</span>
global ln_all_flexible <span class="token string">"ln_all_1100 ln_all_1200 ln_all_1300 ln_all_1400 ln_all_1500 ln_all_1600 ln_all_1700 ln_all_1750 ln_all_1800 ln_all_1850 ln_all_1900"</span>
global ln_nworld_flexible <span class="token string">"ln_nworld_1100 ln_nworld_1200 ln_nworld_1300 ln_nworld_1400 ln_nworld_1500 ln_nworld_1600 ln_nworld_1700 ln_nworld_1750 ln_nworld_1800 ln_nworld_1850 ln_nworld_1900"</span>
global ln_oworld_flexible <span class="token string">"ln_oworld_1100 ln_oworld_1200 ln_oworld_1300 ln_oworld_1400 ln_oworld_1500 ln_oworld_1600 ln_oworld_1700 ln_oworld_1750 ln_oworld_1800 ln_oworld_1850 ln_oworld_1900"</span>
global ln_tropical_flexible <span class="token string">"ln_tropical_1100 ln_tropical_1200 ln_tropical_1300 ln_tropical_1400 ln_tropical_1500 ln_tropical_1600 ln_tropical_1700 ln_tropical_1750 ln_tropical_1800 ln_tropical_1850 ln_tropical_1900"</span>
global ln_rugged_flexible <span class="token string">"ln_rugged_1100 ln_rugged_1200 ln_rugged_1300 ln_rugged_1400 ln_rugged_1500 ln_rugged_1600 ln_rugged_1700 ln_rugged_1750 ln_rugged_1800 ln_rugged_1850 ln_rugged_1900"</span>
global ln_elevation_flexible <span class="token string">"ln_elevation_1100 ln_elevation_1200 ln_elevation_1300 ln_elevation_1400 ln_elevation_1500 ln_elevation_1600 ln_elevation_1700 ln_elevation_1750 ln_elevation_1800 ln_elevation_1850 ln_elevation_1900"</span>
global ln_disteq_flexible <span class="token string">"ln_disteq_1100 ln_disteq_1200 ln_disteq_1300 ln_disteq_1400 ln_disteq_1500 ln_disteq_1600 ln_disteq_1700 ln_disteq_1750 ln_disteq_1800 ln_disteq_1850 ln_disteq_1900"</span>
global ln_dist_coast_flexible <span class="token string">"ln_dist_coast_1100 ln_dist_coast_1200 ln_dist_coast_1300 ln_dist_coast_1400 ln_dist_coast_1500 ln_dist_coast_1600 ln_dist_coast_1700 ln_dist_coast_1750 ln_dist_coast_1800 ln_dist_coast_1850 ln_dist_coast_1900"</span>
global malaria_flexible <span class="token string">"malaria_1100 malaria_1200 malaria_1300 malaria_1400 malaria_1500 malaria_1600 malaria_1700 malaria_1750 malaria_1800 malaria_1850 malaria_1900"</span>
global ln_export_flexible <span class="token string">"ln_export_1100 ln_export_1200 ln_export_1300 ln_export_1400 ln_export_1500 ln_export_1600 ln_export_1700 ln_export_1750 ln_export_1800 ln_export_1850 ln_export_1900"</span>
global ln_spot_flexible <span class="token string">"ln_spot_1100 ln_spot_1200 ln_spot_1300 ln_spot_1400 ln_spot_1500 ln_spot_1600 ln_spot_1700 ln_spot_1750 ln_spot_1800 ln_spot_1850 ln_spot_1900"</span>
global ln_silagemaize_flexible <span class="token string">"ln_silagemaize_1100 ln_silagemaize_1200 ln_silagemaize_1300 ln_silagemaize_1400 ln_silagemaize_1500 ln_silagemaize_1600 ln_silagemaize_1700 ln_silagemaize_1750 ln_silagemaize_1800 ln_silagemaize_1850 ln_silagemaize_1900"</span>
global ln_maize_flexible <span class="token string">"ln_maize_1100 ln_maize_1200 ln_maize_1300 ln_maize_1400 ln_maize_1500 ln_maize_1600 ln_maize_1700 ln_maize_1750 ln_maize_1800 ln_maize_1850 ln_maize_1900"</span>
global ln_cassava_flexible <span class="token string">"ln_cassava_1100 ln_cassava_1200 ln_cassava_1300 ln_cassava_1400 ln_cassava_1500 ln_cassava_1600 ln_cassava_1700 ln_cassava_1750 ln_cassava_1800 ln_cassava_1850 ln_cassava_1900"</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> TABLE <span class="token number">2</span> <span class="token operator">-</span> BASELINE FLEXIBLE ESTIMATES <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Total Population <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span> Col <span class="token number">1</span>
areg ln_population $ln_potato_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token function">test</span> <span class="token punctuation">(</span>ln_wpot_1750<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1800<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1850<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1900<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token operator">*</span> Col <span class="token number">2</span>
areg ln_population $ln_potato_flexible $ln_oworld_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token function">test</span> <span class="token punctuation">(</span>ln_wpot_1750<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1800<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1850<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1900<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">*</span> Col <span class="token number">3</span>
areg ln_population $ln_potato_flexible $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token function">test</span> <span class="token punctuation">(</span>ln_wpot_1750<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1800<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1850<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ln_wpot_1900<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">/*

*** City Population Share ***
* Col 4
areg city_pop_share $ln_potato_flexible i.year, a(isocode) cluster(isocode)
test (ln_wpot_1750=0) (ln_wpot_1800=0) (ln_wpot_1850=0) (ln_wpot_1900=0)
* Col 5
areg city_pop_share $ln_potato_flexible $ln_oworld_flexible i.year, a(isocode) cluster(isocode)
test (ln_wpot_1750=0) (ln_wpot_1800=0) (ln_wpot_1850=0) (ln_wpot_1900=0)
* Col 6
areg city_pop_share $ln_potato_flexible $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i.year, a(isocode) cluster(isocode)
test (ln_wpot_1750=0) (ln_wpot_1800=0) (ln_wpot_1850=0) (ln_wpot_1900=0)

*/</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Draw Figure <span class="token function">IV</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
areg ln_population $ln_potato_flexible $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
mat result<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
mat list result
mat coef<span class="token operator">=</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token number">.11</span><span class="token punctuation">]</span>'
mat ci<span class="token operator">=</span>result<span class="token punctuation">[</span><span class="token number">5.</span><span class="token number">.6</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token number">.11</span><span class="token punctuation">]</span>'
svmat coef
svmat ci
gen yearplot<span class="token operator">=</span>year<span class="token punctuation">[</span>_n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> _n<span class="token operator">&lt;=</span><span class="token number">11</span>
<span class="token function">twoway</span> <span class="token punctuation">(</span>connected coef1 yearplot<span class="token punctuation">)</span> <span class="token punctuation">(</span>line ci1 yearplot<span class="token punctuation">,</span> <span class="token function">lpattern</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>line ci2 yearplot<span class="token punctuation">,</span> <span class="token function">lpattern</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token number">1100</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token number">1900</span><span class="token punctuation">)</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> TABLE <span class="token number">3</span> <span class="token operator">-</span> ALTERNATIVE CUT<span class="token operator">-</span>OFFS <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token comment">/* 1200--1500: Post = 1400, 1500 (Cols 1 &amp; 2) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1200</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1500</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1400</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1500</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token comment">/* 1300--1600: Post = 1500, 1600 (Cols 3 &amp; 4) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1300</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1600</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1500</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1600</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token comment">/* 1400--1700: Post = 1600, 1700 (Cols 5 &amp; 6) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1400</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1700</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1600</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1700</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token comment">/* 1500--1800: Post = 1700, 1800 (Cols 7 &amp; 8) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1500</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1800</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1700</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1750</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1800</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token comment">/* 1600--1900: Post = 1800, 1850, 1900 (Cols 9 &amp; 10) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1600</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1900</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1800</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1850</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1900</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token comment">/* 1600--1900: post = 1750, 1850, 1900  (Cols 11 &amp; 12) */</span>
preserve
drop ln_wpot_post post
drop <span class="token keyword">if</span> year<span class="token operator">&lt;</span><span class="token number">1600</span>
drop <span class="token keyword">if</span> year<span class="token operator">></span><span class="token number">1900</span>
tab year
gen post<span class="token operator">=</span><span class="token number">0</span>
replace post<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1750</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1800</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1850</span> <span class="token operator">|</span> year<span class="token operator">==</span><span class="token number">1900</span>
gen ln_wpot_post<span class="token operator">=</span>ln_wpot<span class="token operator">*</span>post
<span class="token operator">*</span> Total Population
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> City Population Share
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
restore

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> TABLE <span class="token number">4</span> <span class="token operator">-</span> BASELINE DD ESTIMATES <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Total Population <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span> Col <span class="token number">1</span>
areg ln_population ln_wpot_post i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> Col <span class="token number">2</span>
areg ln_population ln_wpot_post $ln_oworld_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> Col <span class="token number">3</span>
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>

egen numid<span class="token operator">=</span><span class="token function">group</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
xtset numid year

xtreg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> fe <span class="token function">cluster</span><span class="token punctuation">(</span>numid<span class="token punctuation">)</span>

reghdfe ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>numid year<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>numid<span class="token punctuation">)</span>

reghdfe ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>numid year numid#c<span class="token punctuation">.</span>year<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>numid<span class="token punctuation">)</span>

<span class="token operator">*</span> Col <span class="token number">4</span>
areg ln_population ln_wpot_post $ln_all_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
<span class="token operator">*</span> Col <span class="token number">5</span>
areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible $ln_spot_flexible $ln_silagemaize_flexible $ln_maize_flexible $ln_cassava_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>

<span class="token comment">/*

*** City Population Share ***
* Col 6
areg city_pop_share ln_wpot_post i.year, a(isocode) cluster(isocode)
* Col 7
areg city_pop_share ln_wpot_post $ln_oworld_flexible i.year, a(isocode) cluster(isocode)
* Col 8
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i.year, a(isocode) cluster(isocode)
* Col 9
areg city_pop_share ln_wpot_post $ln_all_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i.year, a(isocode) cluster(isocode)
* Col 10
areg city_pop_share ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible $ln_spot_flexible $ln_silagemaize_flexible $ln_maize_flexible $ln_cassava_flexible i.year, a(isocode) cluster(isocode)

*/</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Illustrate magnitude of estimate<span class="token punctuation">,</span> Col <span class="token number">3</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

areg ln_population ln_wpot_post $ln_oworld_flexible $ln_elevation_flexible $ln_tropical_flexible $ln_rugged_flexible i<span class="token punctuation">.</span>year<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>

gen ln_population_19cf<span class="token operator">=</span>ln_population<span class="token operator">-</span>_b<span class="token punctuation">[</span>ln_wpot_post<span class="token punctuation">]</span><span class="token operator">*</span>ln_wpot <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1900</span>
gen population_19cf<span class="token operator">=</span><span class="token function">exp</span><span class="token punctuation">(</span>ln_population_19cf<span class="token punctuation">)</span>
sum population_19cf
scalar lnpop19cf<span class="token operator">=</span><span class="token function">ln</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
sum population <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1700</span>
scalar lnpop17<span class="token operator">=</span><span class="token function">ln</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
sum population <span class="token keyword">if</span> year<span class="token operator">==</span><span class="token number">1900</span>
scalar lnpop19<span class="token operator">=</span><span class="token function">ln</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
di <span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span>lnpop19cf<span class="token operator">-</span>lnpop17<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>lnpop19<span class="token operator">-</span>lnpop17<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>6、nunnw_2011</p>
<p>数据文件：<a href='/local_file/江艇微观计量/nunnw_2011.dta' target='_blank'>nunnw_2011</a></p>
<p>ado文件：<a href='/local_file/江艇微观计量/x_ols2.ado' target='_blank'>x_ols2.ado</a></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">use <span class="token string">"nunnw_2011.dta"</span><span class="token punctuation">,</span> clear

egen num_iso<span class="token operator">=</span><span class="token function">group</span><span class="token punctuation">(</span>isocode<span class="token punctuation">)</span>
egen num_ethn<span class="token operator">=</span><span class="token function">group</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
egen num_dis<span class="token operator">=</span><span class="token function">group</span><span class="token punctuation">(</span>district<span class="token punctuation">)</span>

global base_nofe <span class="token string">"age age2 male urban_dum i.education i.occupation i.religion i.living_conditions district_ethnic_frac frac_ethnicity_in_district"</span>
global baseline_controls <span class="token string">"age age2 male urban_dum i.education i.occupation i.religion i.living_conditions district_ethnic_frac frac_ethnicity_in_district i.isocode"</span>
global colonial_controls <span class="token string">"malaria_ecology total_missions_area explorer_contact railway_contact cities_1400_dum i.v30 v33 ln_init_pop_density"</span>
global manyfe <span class="token string">"i.isocode i.education i.occupation i.religion i.living_conditions"</span>


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">1</span><span class="token operator">:</span> Trust Neighbors <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Slave exports only <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Slave exports<span class="token operator">/</span>land area <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> slave exports<span class="token operator">/</span>historic pop <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> ln slave exports <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors ln_exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors ln_exports $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> ln slave exports<span class="token operator">/</span>land area <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> ln slave exports<span class="token operator">/</span>historic pop <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> reg trust_neighbors ln_export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name<span class="token punctuation">)</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors ln_export_pop $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">1</span> <span class="token operator">-</span> Conley Standard Errors <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span> Replicate column <span class="token number">1</span> only<span class="token punctuation">.</span>

gen cutoff1<span class="token operator">=</span><span class="token number">5</span>	<span class="token comment">/* Closer than cutoff = 1, further = 0 */</span>
gen cutoff2<span class="token operator">=</span><span class="token number">5</span>
gen constant<span class="token operator">=</span><span class="token number">1</span>

drop <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>centroid_lat<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>
drop <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>centroid_long<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>
drop <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>trust_neighbors<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>
<span class="token keyword">for</span> @ in any age male urban_dum education occupation religion living_conditions district_ethnic_frac frac_ethnicity_in_district isocode<span class="token operator">:</span> drop <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>@<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>

preserve
drop <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>
xi<span class="token operator">:</span> reg exports $baseline_controls
predict exports_resid <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> resid
xi<span class="token operator">:</span> reg trust_neighbors $baseline_controls
predict trust_neighbors_resid <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> resid
x_ols2 centroid_lat centroid_long cutoff1 cutoff2 trust_neighbors_resid constant exports_resid<span class="token punctuation">,</span> <span class="token function">coord</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">xreg</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
restore


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">2</span><span class="token operator">:</span> All Trust Measures <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Relatives Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_relatives ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_relatives ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Neighbors Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Trust Local Council <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_local_council ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Intra Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 intra_group_trust ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg intra_group_trust ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Inter Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg inter_group_trust ln_export_area $baseline_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Try controlling <span class="token keyword">for</span> district fixed effects <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

reghdfe trust_relatives ln_export_area $base_nofe<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>num_iso<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>num_ethn num_dis<span class="token punctuation">)</span>

reghdfe trust_relatives ln_export_area $base_nofe<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>num_dis<span class="token punctuation">)</span> <span class="token function">cluster</span><span class="token punctuation">(</span>num_ethn num_dis<span class="token punctuation">)</span>

preserve
bysort district murdock_name<span class="token operator">:</span> keep <span class="token keyword">if</span> _n<span class="token operator">==</span><span class="token number">1</span>
bysort district<span class="token operator">:</span> gen no_ethn<span class="token operator">=</span>_N
bysort district<span class="token operator">:</span> keep <span class="token keyword">if</span> _n<span class="token operator">==</span><span class="token number">1</span>
tab no_ethn
restore


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">3</span><span class="token operator">:</span> All Trust Measures<span class="token punctuation">,</span> Additional Controls <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Relatives Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_relatives ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_relatives ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Neighbors Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_neighbors ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Trust Local Council <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg trust_local_council ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Intra Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 intra_group_trust ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg intra_group_trust ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Inter Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span> small <span class="token function">partial</span><span class="token punctuation">(</span>$manyfe<span class="token punctuation">)</span>
xi<span class="token operator">:</span> vcemway reg inter_group_trust ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">4</span> <span class="token operator">-</span> Altonji Ratios <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Demo<span class="token operator">:</span> Row <span class="token number">2</span><span class="token punctuation">,</span> Col <span class="token number">1</span>

<span class="token operator">*</span> Full
reghdfe trust_relatives ln_export_area $base_nofe $colonial_controls<span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>num_iso<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
scalar beta_f<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span>
<span class="token operator">*</span> Restricted
reghdfe trust_relatives ln_export_area <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">a</span><span class="token punctuation">(</span>num_iso<span class="token punctuation">)</span>
scalar beta_r<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span>
di <span class="token string">"selection_ratio="</span> beta_f<span class="token operator">/</span><span class="token punctuation">(</span>beta_r<span class="token operator">-</span>beta_f<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Full table

foreach x in trust_relatives trust_neighbors trust_local_council intra_group_trust inter_group_trust<span class="token punctuation">&#123;</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Rows #<span class="token number">1</span> <span class="token operator">&amp;</span> #<span class="token number">3</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
sum `x'
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span> Full #<span class="token number">1</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area $baseline_controls
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
gen beta3<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span>
<span class="token operator">*</span> Restricted #<span class="token number">1</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area i<span class="token punctuation">.</span>isocode <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
gen beta1<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
<span class="token operator">*</span> Restricted #<span class="token number">2</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area i<span class="token punctuation">.</span>isocode age age2 male <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
gen beta2<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
<span class="token operator">*</span> Row <span class="token number">1</span>
gen diff1_3<span class="token operator">=</span>beta3<span class="token operator">/</span><span class="token punctuation">(</span>beta1<span class="token operator">-</span>beta3<span class="token punctuation">)</span>
<span class="token operator">*</span> Row <span class="token number">3</span>
gen diff2_3<span class="token operator">=</span>beta3<span class="token operator">/</span><span class="token punctuation">(</span>beta2<span class="token operator">-</span>beta3<span class="token punctuation">)</span>
drop beta<span class="token operator">*</span>
sum diff<span class="token operator">*</span>
drop hat
drop diff<span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Rows #<span class="token number">2</span> <span class="token operator">&amp;</span> #<span class="token number">4</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span> Full #<span class="token number">2</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area $baseline_controls $colonial_controls
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
gen beta5<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span>
<span class="token operator">*</span> Restricted #<span class="token number">1</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area i<span class="token punctuation">.</span>isocode <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
gen beta1<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
<span class="token operator">*</span> Restricted #<span class="token number">2</span>
xi<span class="token operator">:</span> qui reg `x' ln_export_area i<span class="token punctuation">.</span>isocode age age2 male <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
gen beta2<span class="token operator">=</span>_b<span class="token punctuation">[</span>ln_export_area<span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span>
<span class="token operator">*</span> Row <span class="token number">2</span>
gen diff1_5<span class="token operator">=</span>beta5<span class="token operator">/</span><span class="token punctuation">(</span>beta1<span class="token operator">-</span>beta5<span class="token punctuation">)</span>
<span class="token operator">*</span> Row <span class="token number">4</span>
gen diff2_5<span class="token operator">=</span>beta5<span class="token operator">/</span><span class="token punctuation">(</span>beta2<span class="token operator">-</span>beta5<span class="token punctuation">)</span>
drop beta<span class="token operator">*</span>
sum diff<span class="token operator">*</span>
drop hat
drop diff<span class="token operator">*</span>
<span class="token punctuation">&#125;</span>


<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">9</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Test #<span class="token number">1</span><span class="token operator">:</span> Local Council <span class="token function">Trust</span> <span class="token punctuation">(</span>Cols <span class="token number">1</span> <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token comment">/* Controlling for Performance &amp; Corruption (FEs) */</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area i<span class="token punctuation">.</span>local_council_performance i<span class="token punctuation">.</span>corrupt_local_council i<span class="token punctuation">.</span>council_listen $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
drop hat

<span class="token comment">/* Controlling for All - Add public goods */</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area school_present electricity_present piped_water_present sewage_present health_clinic_present i<span class="token punctuation">.</span>local_council_performance i<span class="token punctuation">.</span>corrupt_local_council i<span class="token punctuation">.</span>council_listen $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Test #<span class="token number">2</span><span class="token operator">:</span> Inter<span class="token operator">-</span>Group <span class="token function">Trust</span> <span class="token punctuation">(</span>Cols <span class="token number">3</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token comment">/*** Controlling for slave export exposure of those in the town ***/</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area townvill_nonethnic_mean_exports $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
drop hat

<span class="token comment">/*** Controlling for slave export exposure of those in the district ***/</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area district_nonethnic_mean_exports $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
drop hat

<span class="token comment">/*** Controlling for slave export exposure of those in the region ***/</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area region_nonethnic_mean_exports $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>murdock_name district<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Table <span class="token number">10</span><span class="token operator">:</span> Test #<span class="token number">3</span><span class="token operator">:</span> Internal vs<span class="token punctuation">.</span> External Factors <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Relatives Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_relatives ln_export_area loc_ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_relatives ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Neighbors Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_area loc_ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_neighbors ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Trust Local Council <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area loc_ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 trust_local_council ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Intra Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 intra_group_trust ln_export_area loc_ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 intra_group_trust ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
drop hat

<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Inter Group Trust <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area loc_ln_export_area $baseline_controls $colonial_controls<span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
predict hat <span class="token keyword">if</span> <span class="token function">e</span><span class="token punctuation">(</span>sample<span class="token punctuation">)</span><span class="token punctuation">,</span> xb
<span class="token operator">*</span><span class="token operator">*</span> Point estimate without additional <span class="token function">control</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">*</span>
xi<span class="token operator">:</span> ivreg2 inter_group_trust ln_export_area $baseline_controls $colonial_controls <span class="token keyword">if</span> <span class="token function">missing</span><span class="token punctuation">(</span>hat<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">cluster</span><span class="token punctuation">(</span>loc_murdock_name murdock_name<span class="token punctuation">)</span>
drop hat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="tags/stata/">stata</a></div><div class="post_share"><div class="social-share" data-image="/private_img/banner2.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/private_img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/private_img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/private_img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/private_img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="4201975099.html"><img class="prev-cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">马克思主义视角下的金融化</div></div></a></div><div class="next-post pull-right"><a href="954336338.html"><img class="next-cover" src="/private_img/banner2.gif" onerror="onerror=null;src='/private_img/banner.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">国外马克思主义</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/private_img/yuyingnan.jpg" onerror="this.onerror=null;this.src='/private_img/404.gif'" alt="avatar"/></div><div class="author-info__name">揭晓</div><div class="author-info__description">随手写一写，揭晓这世界</div></div><a id="card-info-btn" href="/"><i></i><span>回到首页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#2021%E7%89%88%E8%AF%BE%E4%BB%B6"><span class="toc-text"> 2021版课件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2020%E7%89%88%E8%AF%BE%E4%BB%B6"><span class="toc-text"> 2020版课件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2019%E7%89%88%E8%AF%BE%E4%BB%B6"><span class="toc-text"> 2019版课件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="toc-text"> 部分代码展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E5%80%BC%E6%A8%A1%E6%8B%9F"><span class="toc-text"> 1、数值模拟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A9%B7%E4%B8%BE%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="toc-text"> 2、穷举法示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8C%B9%E9%85%8D%E6%96%B9%E6%B3%95%E6%BC%94%E7%A4%BA"><span class="toc-text"> 3、匹配方法演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4"><span class="toc-text"> 4、</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="998865776.html" title="Zotero文献管理">Zotero文献管理</a><time datetime="2022-12-11T05:56:24.212Z" title="更新于 2022-12-11 13:56:24">2022-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="4047261339.html" title="MacOS百度网盘不限速设置">MacOS百度网盘不限速设置</a><time datetime="2022-12-10T07:03:52.105Z" title="更新于 2022-12-10 15:03:52">2022-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="3047410174.html" title="国内大循环">国内大循环</a><time datetime="2022-12-09T16:12:16.372Z" title="更新于 2022-12-10 00:12:16">2022-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2511924152.html" title="博士论文提纲">博士论文提纲</a><time datetime="2022-12-09T16:05:41.099Z" title="更新于 2022-12-10 00:05:41">2022-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="2106967379.html" title="资本循环笔记20201107">资本循环笔记20201107</a><time datetime="2022-12-09T12:14:07.407Z" title="更新于 2022-12-09 20:14:07">2022-12-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/private_img/banner2.gif')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 揭晓</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎参观我的<a href='https://github.com/dhndzwxj' target='_blank'>github</a>个人主页！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="js/utils.js"></script><script src="js/main.js"></script><script src="js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://dhndzwxj.github.io/767402338.html'
    this.page.identifier = ''
    this.page.title = '微观计量经济学'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://https-www-dhndzwxj-top.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script type='text/javascript' src='https://ajax.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script id="dsq-count-scr" src="//https-www-dhndzwxj-top.disqus.com/count.js" async></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = '/posts/,/about/'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>